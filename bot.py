import os

import weaponlist
from environ import environ
os.environ.update(environ)

from telebot import TeleBot
import npclist
import skillinfo
from sys import getsizeof
from npclist import *
from keyboards import *
from gametexts import *
from datetime import datetime
import requests
from openworld import *
import pokemonlist
import shennon
import math
#from Lan import lt, localized_language_name
from shop_items import name_to_weapon

from chatwars import cw_skillinfo, cw_weaponlist
from chatwars.utils import *
from chatwars.db import CWDatabase

def sendm(b, chat_id, text, parse_mode=None, entities=None,
    disable_web_page_preview=None, disable_notification=None, protect_content= None, reply_to_message_id= None,
    allow_sending_without_reply= None,
    reply_markup= None,
    timeout= None, message_thread_id= None, reply_parameters= None,
    link_preview_options = None, business_connection_id= None, message_effect_id= None):
    try:
        msg = b.send_message(chat_id, text, parse_mode=parse_mode,
            disable_web_page_preview=disable_web_page_preview,
            disable_notification=disable_notification, reply_to_message_id=reply_to_message_id,
            reply_markup=reply_markup)
        return msg
    except:
        pass


def inc_user_bot_counter(user, falseanswer = False):
    if not falseanswer:

        cwusers.update_one({'id':user['id']},{'$inc':{'bot_counter':1}})
        user['bot_counter'] += 1
    else:
        cwusers.update_one({'id': user['id']}, {'$inc': {'false_answer': 1}})
        user['false_answer'] += 1

    if user['bot_counter'] >= 2:
        cwlogs.send_message(441399484, '‚ùóÔ∏è–ò–≥—Ä–æ–∫ '+user['name']+' (id: '+str(user['id'])+') –ø–æ–ø–∞–ª—Å—è –Ω–∞ –±–æ—Ç–æ–≤–æ–¥—Å—Ç–≤–µ '+str(user['bot_counter'])+' —Ä–∞–∑!‚ùóÔ∏è')
    if user['false_answer'] >= 2:
        cwlogs.send_message(441399484,
                            '‚ùóÔ∏è–ò–≥—Ä–æ–∫ ' + user['name'] + ' (id: ' + str(user['id']) + ') –ø–æ–ø–∞–ª—Å—è –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ ' + str(
                                user['false_answer']) + ' —Ä–∞–∑!‚ùóÔ∏è')


def create_demons_for_rat():
    x = {}
    i = 0
    while len(x) < 1000:
        x.update({str(i):{'pattern':random_duelrat_weights(), 'score':0, 'number':str(i)}})
        i += 1

    return x

from constants import *

token = os.environ['token']
token = '7761726947:AAGOpSlfreC-GPanhCb89Vs5hS4vafxV0RQ' #–¢–û–ö–ï–ù –í–ï–ì–ê–ù–ö–ò
#token = '' #–¢–û–ö–ï–ù –î–õ–Ø –¢–ï–°–¢–û–í
bot = TeleBot(token)
print(bot.get_me())

novice_alex_id = 674065123
pasyuk_2_id = 441399484
cwbottoken = os.getenv("CWBOT_TOKEN")
cwbot = TeleBot(cwbottoken, num_threads=1)
#cwbot = TeleBot(token, num_threads = 2) # –¢–ï–°–¢–û–í–´–ô –¢–û–ö–ï–ù
#cwlogs = TeleBot(cwlogstoken)

radiodemonphoto = 'AgACAgIAAxkBAAFWvZdlu81ilDpKOcbV2iS6xyQHpQMtpgACadIxG99S4ElQibTbkJ2SkwEAAwIAA3kAAzQE'
knight_photo = "AgACAgIAAxkBAAGXY6loPrZTdxQy-ZoknAQ2e_bxgB_0dwACgPMxG82Y-UmAjLGPg2XlCwEAAwIAA3kAAzYE"

# –û–¢–ë–†–û–°–¨ –ù–ê–î–ï–ñ–î–£
# –í–°–Ø–ö –°–Æ–î–ê –í–•–û–î–Ø–©–ò–ô


client = MongoClient(os.environ['database2'])
db = client.veganwars_rebuild
users = db.users
duelstats = db.duelstats
massbattlestats = db.massbattlestats
teamstats = db.teamstats
rats = db.rats
world = db.openworld
wakeups = db.wakeups

ratdemons = db.ratdemons

cwdb = CWDatabase(client)
cwusers = cwdb.users
allcastles = cwdb.castles
auction = cwdb.auction
resourceauc = cwdb.resourceauc
lastbattletime_db = cwdb.last_battle
cwtroll = cwdb.troll
if cwtroll.find_one({}) == None:
    cwtroll.insert_one({'gold':0, 'pogs':0, 'exp':0})

antibot_pics = {
        'AgACAgIAAxkBAAEl8GJkiua5K9umw-vUk9g0zhi-3kn4sAAClccxG26TWEif520JrR16YgEAAwIAA20AAy8E':'1',
        'AgACAgIAAxkBAAEl8LZkiucRWD5QXJrKGrhSL6hzC2yj9wACw8cxG26TWEg9hTbiAjnSQQEAAwIAA20AAy8E':'2',
        'AgACAgIAAxkBAAEl8Mhkiucm7OvUG8jer3q-iJbE9zE9xwACyccxG26TWEgWqCmVzgGwAAEBAAMCAANtAAMvBA':'3'
    }

def picid_to_code(picid):
    return antibot_pics[picid]

def code_to_picid(code):
    for ids in antibot_pics:
        if antibot_pics[ids] == code:
            return ids


def get_answer(fileid):
    quests = ['1', '2', '3']
    answers = ['6', '3', '20']
    i = 0
    for ids in quests:
        if ids == fileid:
            return answers[i]
        i += 1
    return None

now_captcha = []
captcha_timer = []

def dont_answer(user, msg):
    if user['id'] in now_captcha:
        inc_user_bot_counter(user, falseanswer = False)
        now_captcha.remove(user['id'])
        cwbot.delete_message(user['id'], msg.message_id)
    else:
        pass
    
def timerremove(user):
    captcha_timer.remove(user['id'])

def captcha(user):
    if user['id'] in now_captcha:
        return
    if user['id'] in captcha_timer:
        return
    captcha_timer.append(user['id'])
    threading.Timer(300, timerremove, args = [user]).start()
    quest_types = ['math']#, 'pic', 'random']
    quest_type = random.choice(quest_types)
    if quest_type == 'math':
        quests = ['1', '2', '3']
        answers = []
        quest = random.choice(quests)
        answer = get_answer(quest)
        kblist = []
        for i in range(3):
            x = random.randint(-20, 20)
            kblist.append(types.InlineKeyboardButton(text=str(x), callback_data='questanswer?' + quest + '?' + str(x)))
        kblist.append(types.InlineKeyboardButton(text = str(answer), callback_data = 'questanswer?' + quest + '?' + str(answer)))
        random.shuffle(kblist)
        kb = types.InlineKeyboardMarkup()
        for ids in kblist:
            kb.add(ids)
        try:
            msg = cwbot.send_photo(user['id'], code_to_picid(quest), reply_markup=kb)
            threading.Timer(60, dont_answer, args = [user, msg]).start()
            now_captcha.append(user['id'])
        except:
            sendm(cwbot, 441399484, traceback.format_exc())

@cwbot.callback_query_handler(func = lambda call: call.data[:11] == 'questanswer')
def questanssss(call):
    if call.from_user.id not in now_captcha:
        cwbot.delete_message(call.message.chat.id, call.message.message_id)
        return
    quest = call.data.split('?')[1]
    trueans = get_answer(quest)
    userans = get_answer(quest)
    user = cwusers.find_one({'id':call.from_user.id})
    if userans != trueans:
        inc_user_bot_counter(user, falseanswer = True)
    else:
        cwbot.answer_callback_query(call.id, "‚úÖ")
    cwbot.delete_message(call.message.chat.id, call.message.message_id)
    try:
        now_captcha.remove(call.from_user.id)
    except:
        pass


@cwbot.message_handler(content_types = ['photo'])
def phhhotom(m):
    if m.from_user.id == 441399484:
        sendm(cwbot, m.chat.id, m.photo[-1].file_id)

if True:
    if rats.find_one({}) == None:
        rats.insert_one({'wins': 0, 'games': 0})
    try:
        rats.find_one({})['diff1']
    except:
        rats.update_one({}, {
            '$set': {'diff1': {'wins': 0, 'games': 0}, 'diff2': {'wins': 0, 'games': 0}, 'diff3': {'wins': 0, 'games': 0}}})
    if massbattlestats.find_one({}) == None:
        massbattlestats.insert_one({'skills': {}, 'weapons': {}, 'builds': {}})
    if duelstats.find_one({}) == None:
        duelstats.insert_one({'skills': {}, 'weapons': {}, 'builds': {}})
    if teamstats.find_one({}) == None:
        teamstats.insert_one({'skills': {}, 'weapons': {}, 'builds': {}})
    if wakeups.find_one({}) == None:
        wakeups.insert_one({'wakeups': []})

# if world.find_one({}) == None:
#    ow = generate_open_world()
#    world.insert_one({'world':ow})
try:
    world.find_one({})['npc']
except:
    world.update_one({}, {'$set': {'npc': {}}})

#cwusers.update_many({},{'$set':{'bot_counter':0, 'false_answer':0}})

has_necrostaff = []

from shop_items import scrolls_to_sale, weapons_to_sale, generate_object_code, create_scroll, create_weapon, \
    create_skill, create_recipe
from shop_items import create_undefined_scroll, allscrolls, get_lvl_weapon, get_cw_player_weapon
from shop_items import allrecipes_red, allrecipes_green, allrecipes_blue, get_cw_battleitem_name, create_essence

cwratweapons = [cw_weaponlist.Pistol_1, cw_weaponlist.Pistol_2, cw_weaponlist.Pistol_3,
                cw_weaponlist.ShortSword_1, cw_weaponlist.ShortSword_2, cw_weaponlist.ShortSword_3,
                cw_weaponlist.Revolver_1, cw_weaponlist.Revolver_2, cw_weaponlist.Revolver_3,
                cw_weaponlist.Revolver_4_1, cw_weaponlist.Revolver_4_2,
                cw_weaponlist.Baseball_1, cw_weaponlist.Baseball_2, cw_weaponlist.Baseball_3,
                cw_weaponlist.Baseball_4_1, cw_weaponlist.Baseball_4_2,
                cw_weaponlist.Knife_1, cw_weaponlist.Knife_2, cw_weaponlist.Knife_3,
                cw_weaponlist.Knife_4_1, cw_weaponlist.Knife_4_2,
                cw_weaponlist.Obrez_1, cw_weaponlist.Obrez_2, cw_weaponlist.Obrez_3,
                cw_weaponlist.Obrez_4_1, cw_weaponlist.Obrez_4_2,
                cw_weaponlist.Torch_1, cw_weaponlist.Torch_2, cw_weaponlist.Torch_3,
                cw_weaponlist.Torch_4_1, cw_weaponlist.Torch_4_2,
                cw_weaponlist.Flamethrower_1, cw_weaponlist.Flamethrower_2, cw_weaponlist.Flamethrower_3,
                cw_weaponlist.Flamethrower_4_1,
                cw_weaponlist.Axe_1, cw_weaponlist.Axe_2, cw_weaponlist.Axe_3,
                cw_weaponlist.Axe_4_1, cw_weaponlist.Axe_4_2,
                cw_weaponlist.Kastet_1, cw_weaponlist.Kastet_2, cw_weaponlist.Kastet_3,
                cw_weaponlist.Kastet_4_1, cw_weaponlist.Kastet_4_2,
                cw_weaponlist.Kuvalda_1, cw_weaponlist.Kuvalda_2, cw_weaponlist.Kuvalda_3,
                cw_weaponlist.Kuvalda_4_1, cw_weaponlist.Kuvalda_4_2,
                cw_weaponlist.Chain_1, cw_weaponlist.Chain_2, cw_weaponlist.Chain_3,
                cw_weaponlist.Chain_4_1, cw_weaponlist.Chain_4_2,
                cw_weaponlist.Bow_1, cw_weaponlist.Bow_2, cw_weaponlist.Bow_3,
                cw_weaponlist.Bow_4_1, cw_weaponlist.Bow_4_2,
                cw_weaponlist.Molot_1, cw_weaponlist.Molot_2, cw_weaponlist.Molot_3,
                cw_weaponlist.Molot_4_1, cw_weaponlist.Molot_4_2,
                cw_weaponlist.Tesak_1, cw_weaponlist.Tesak_2, cw_weaponlist.Tesak_3,
                cw_weaponlist.Tesak_4_1, cw_weaponlist.Tesak_4_2
                ]

def get_cw_skill_description(skill):
    return cw_skillinfo.info[skill['skillcode'] + '?' + str(skill['lvl'])]


auction_wait = []

takeitemlock = []

lvltable = {}
a = 1.9
totalexp = 0
lvl = 1
while lvl < 40:
    y = round(pow((lvl * 5), a));
    lvltable[lvl] = {'totalexp': totalexp, 'expfornextlvl': y}
    totalexp += y
    lvl += 1
lvltable[40] = {'totalexp': totalexp, 'expfornextlvl': 99999999999}

foresttable = {}
a = 1.6
totalforest = 0
lvl = 1
while lvl < 40:
    y = round(pow((lvl * 1), a)) + 4;
    foresttable[lvl] = {'totalforest': totalforest, 'forestfornextlvl': y}
    totalforest += y
    lvl += 1

foresttable[40] = {'totalforest': totalforest, 'forestfornextlvl': 999999999}

######################################################################CW BATTLE######################################################################
#####################################################################################################################################################
#####################################################################################################################################################
#####################################################################################################################################################
#####################################################################################################################################################


castlefightinfo = {}

cwgames = {}

cw_duel_find = {}

wtbqueue = []

allcastlesbattletext = {}

def getcastletop_percent(players, x):
    tops = {}
    sumdamage = 0
    roleplayers = {}
    for ids in players:
        player = players[ids]
        if player['castlefightrole'] == x:
            roleplayers.update({player['id']: player})
    for ids in roleplayers:
        player = roleplayers[ids]
        if player['castlefightrole'] == x:
            if player['castle'] not in tops:
                tops.update({player['castle']: 0})
            tops[player['castle']] += player['do_damage_in_hp']
            sumdamage += player['do_damage_in_hp']

    percentages = {}
    for ids in tops:
        if ids not in percentages:
            percentages.update({ids:0})
    for ids in percentages:
        dmg = tops[ids]
        try:
            percent = dmg/sumdamage
        except:
            percent = 0
        percentages[ids] = percent
    sorted_perc = {}
    while len(list(percentages)) > 0:
        maxp = -1
        for ids in percentages:
            if percentages[ids] > maxp:
                maxp = percentages[ids]
                topp = ids
        sorted_perc.update({topp:percentages[topp]})
        percentages.pop(topp)
    return sorted_perc

def getcastletop(players, x, returnplayers=False):
    tops = []
    roleplayers = {}
    for ids in players:
        player = players[ids]
        if player['castlefightrole'] == x:
            roleplayers.update({player['id']: player})
    while len(tops) < 3 and len(roleplayers) > 0:
        maxdmg = -1
        topplayer = None
        for ids in roleplayers:
            player = roleplayers[ids]
            if player['castlefightrole'] == x:
                if player['do_damage_in_hp'] > maxdmg:
                    maxdmg = player['do_damage_in_hp']
                    topplayer = player
        tops.append(topplayer)
        roleplayers.pop(topplayer['id'])
    text = ''
    for ids in tops:
        text += castle_to_emoji(ids['castle']) + '' + ids['name'] + ' (' + str(ids['do_damage_in_hp']) + '), '
    if text != '':
        text = text[:len(text) - 2]
        text += '.'
    if not returnplayers:
        return text
    else:
        return tops


def get_cw_player_skills(user):
    pskills = []
    for ids in user['equipped_skills']:
        skill = user['equipped_skills'][ids]
        skilltoadd = skill['skillcode'] + '?' + str(skill['lvl'])
        pskills.append(skilltoadd)
    return pskills


# commit

def set_player_bar_stats(player, user):
    player['drunk'] = 0
    player['napitok'] = None
    player['food'] = None
    player['stakan'] = None
    player['orders'] = []


def set_player_battle_stats(player, user):
    player['weapon'] = get_cw_player_weapon(user)
    player['hp'] = user['hp']
    player['name'] = user['name']
    player['maxhp'] = user['maxhp']
    player['dmglimit'] = user['dmglimit']
    player['maxdmglimit'] = user['maxdmglimit']
    player['energy'] = user['energy']
    player['maxenergy'] = user['maxenergy']
    player['skills'] = get_cw_player_skills(user)
    player['lvl'] = user['lvl']
    iforb = []
    for ids in user['items_for_battle']:
        iforb.append(ids)
    player['inventory'] = iforb
    try:
        if user['resources']['rat_toys'] > 0:
            player['have_rat_toy'] = True
    except:
        pass
    if player['weapon'].name == '–°—é—Ä–∏–∫–µ–Ω—ã':
        if player['weapon'].lvl == 1:
            player['shurikens'] = 2
        if player['weapon'].lvl == 2:
            player['shurikens'] = 4
        if player['weapon'].lvl == 3:
            player['shurikens'] = 6
        if player['weapon'].lvl == 4:
            player['shurikens'] = 6
    if player['weapon'].name == '–¢–µ—Å–∞–∫':
        if player['weapon'].lvl == 1:
            player['tesak_bonus'] = 3
        if player['weapon'].lvl == 2:
            player['tesak_bonus'] = 4
        if player['weapon'].lvl == 3:
            player['tesak_bonus'] = 5
        if player['weapon'].lvl == 4:
            player['tesak_bonus'] = 5
            if player['weapon'].modification == 1:
                player['tesak_bonus'] = 10
    if player['weapon'].lvl == 4:
        player['collecting_souls'] = True
    for ids in user['inventory']:
        item = user['inventory'][ids]
        if item['type'] == 'essence':
            player['collecting_souls'] = True
            break

def give_gold_to_players(stolengold, players, target='defer'):
    roleplayers = {}
    for ids in players:
        player = players[ids]
        if player['castlefightrole'] == target:
            if not player['full_npc']:
                roleplayers.update({player['id']: player})
    sum_damage = 0
    gold_remain = stolengold
    for ids in roleplayers:
        player = roleplayers[ids]
        sum_damage += player['do_damage_in_hp']
    if sum_damage == 0:
        for ids in roleplayers:
            player = roleplayers[ids]
            try:
                dmgpercent = 100/len(roleplayers)
            except:
                dmgpercent = 0
            givegold = int((stolengold / 100) * dmgpercent)
            gold_remain -= givegold
            cwusers.update_one({'id': player['id']}, {'$inc': {'changebattlegold': givegold}})
    else:
        for ids in roleplayers:
            player = roleplayers[ids]
            try:
                dmgpercent = (player['do_damage_in_hp'] / sum_damage) * 100
            except:
                dmgpercent = 0
            givegold = int((stolengold / 100) * dmgpercent)
            gold_remain -= givegold
            cwusers.update_one({'id': player['id']}, {'$inc': {'changebattlegold': givegold}})
    if gold_remain > 0:
        dopgoldplayer = roleplayers[random.choice(list(roleplayers))]
        cwusers.update_one({'id': dopgoldplayer['id']}, {'$inc': {'changebattlegold': gold_remain}})


def give_resources_to_players(stolenres, players, target='attacker'):
    roleplayers = {}
    for ids in players:
        player = players[ids]
        if not player['full_npc']:
            if player['castlefightrole'] == target:
                roleplayers.update({player['id']: player})
    sum_damage = 0
    res_remain = stolenres
    stolenresamount = 0
    for ids in stolenres:
        stolenresamount += stolenres[ids]
    for ids in roleplayers:
        player = roleplayers[ids]
        sum_damage += player['do_damage_in_hp']
    for ids in roleplayers:
        player = roleplayers[ids]
        try:
            dmgpercent = (player['do_damage_in_hp'] / sum_damage) * 100
        except:
            dmgpercent = 0
        giveresamount = int((stolenresamount / 100) * dmgpercent)
        giveres = {}
        while giveresamount > 0:
            curres = random.choice(list(stolenres))
            while stolenres[curres] <= 0:
                curres = random.choice(list(stolenres))
            if curres not in giveres:
                giveres[curres] = 1
            else:
                giveres[curres] += 1
            stolenres[curres] -= 1
            giveresamount -= 1
        user = cwdb.get_user(player['id'])
        for idss in giveres:
            if idss not in user['changebattleres']:
                cwusers.update_one({'id': player['id']}, {'$set': {'changebattleres.' + idss: giveres[idss]}})
            else:
                cwusers.update_one({'id': player['id']}, {'$inc': {'changebattleres.' + idss: giveres[idss]}})
    if sum_damage == 0:
        for ids in roleplayers:
            player = roleplayers[ids]
            try:
                dmgpercent = 100/len(roleplayers)
            except:
                dmgpercent = 0
            giveresamount = int((stolenresamount / 100) * dmgpercent)
            giveres = {}
            while giveresamount > 0:
                curres = random.choice(list(stolenres))
                while stolenres[curres] <= 0:
                    curres = random.choice(list(stolenres))
                if curres not in giveres:
                    giveres[curres] = 1
                else:
                    giveres[curres] += 1
                stolenres[curres] -= 1
                giveresamount -= 1
            user = cwdb.get_user(player['id'])
            for idss in giveres:
                if idss not in user['changebattleres']:
                    cwusers.update_one({'id': player['id']}, {'$set': {'changebattleres.' + idss: giveres[idss]}})
                else:
                    cwusers.update_one({'id': player['id']}, {'$inc': {'changebattleres.' + idss: giveres[idss]}})



def steal_gold(castle=None, players=None, test=False):
    stolengold = 0
    if castle != None:
        for ids in cwusers.find({'castle': castle}):
            player = ids
            sgold = int((player['gold'] / 100) * 30)
            stolengold += sgold
            if not test:
                cwusers.update_one({'id': player['id']}, {'$inc': {'changebattlegold': -sgold}})
    else:
        for ids in players:
            player = cwusers.find_one({'id': players[ids]['id']})
            if player != None:
                sgold = int((player['gold'] / 100) * 30)
                stolengold += sgold
                if not test:
                    cwusers.update_one({'id': player['id']}, {'$inc': {'changebattlegold': -sgold}})
    return stolengold


def steal_resources(castle, test=False):
    stolenres = {}
    # stolengold = 0
    for ids in cwusers.find({'castle': castle}):
        player = ids
        playerstolenres = {}
        playerresamount = 0
        for idss in player['resources']:
            playerresamount += player['resources'][idss]
        stolenamount = int((playerresamount / 100) * 15)
        while stolenamount > 0:
            curres = random.choice(list(player['resources']))
            while player['resources'][curres] <= 0:
                curres = random.choice(list(player['resources']))
            if curres not in playerstolenres:
                playerstolenres[curres] = 1
            else:
                playerstolenres[curres] += 1
            stolenamount -= 1
            player['resources'][curres] -= 1
        for idss in playerstolenres:
            if idss not in player['changebattleres']:
                if not test:
                    cwusers.update_one({'id': player['id']}, {'$set': {'changebattleres.' + idss: -playerstolenres[idss]}})
            else:
                if not test:
                    cwusers.update_one({'id': player['id']}, {'$inc': {'changebattleres.' + idss: -playerstolenres[idss]}})
            if idss not in stolenres:
                stolenres[idss] = playerstolenres[idss]
            else:
                stolenres[idss] += playerstolenres[idss]

    return stolenres

def summon_rat_companion_old_version(game, user, player):
    ratt = summon_rat(game, 1)
    rskills = []
    rweaponlvl = player['weapon'].lvl
    for ids in ratt:
        rat = ratt[ids]
        break
    ratlvl = player['lvl']
    buff = 0
    buffen = 0
    if ratlvl >= 10:
        buff += 1
        buffen += 1
    if ratlvl >= 25:
        buff += 1
    if ratlvl >= 40:
        buff += 1
    rat_skills = rskills
    rat_item_amount = 2
    rat_weapon = get_cw_rat_weapon(rweaponlvl, blockedw = ['–ö–æ—Ä–æ—Ç–∫–∏–π –º–µ—á', '–ü–∏—Å—Ç–æ–ª–µ—Ç'])
    # rat_weapon = rweapon#get_cw_rat_weapon(rat_weaponlvl)
    rat_items = get_cw_rat_items(rat_item_amount)
    rat['weapon'] = rat_weapon
    rat['skills'] = rat_skills
    # rat['items'] = rat_items
    rat['hp'] = 3 + buff
    rat['maxhp'] = 3 + buff
    rat['energy'] = 4 + buffen
    rat['maxenergy'] = 4 + buffen
    rat['dmglimit'] = 5 + buff
    rat['maxdmglimit'] = 5 + buff
    rat['inventory'] = rat_items
    rat['name'] = '–ö—Ä—ã—Å–∞[' + player['name'] + ']|üê≠'
    rat['team'] = player['team']
    rat['castlefightrole'] =  player['castlefightrole']
    rat['castle'] = user['castle']
    rat['full_npc'] = True
    # summon_rats.update(ratt)
    cwusers.update_one({'id': user['id']}, {'$set': {'summon_castlefight_rat': False}})
    return ratt

def summon_rat_companion(game, user, player):
    ratt = summon_rat(game, 1)
    for ids in ratt:
        rat = ratt[ids]
        break
    ratlvl = user['lvl']
    buff = 0
    buffen = 0
    if ratlvl >= 10:
        buff += 1
        buffen += 1
    if ratlvl >= 25:
        buff += 1
    if ratlvl >= 40:
        buff += 1
    rat_skillnumber = len(player['skills'])
    rat_weaponlvl = player['weapon'].lvl
    rat_skill_lvl_summary = 0
    for idss in player['skills']:
        lvl = int(idss.split('?')[1])
        rat_skill_lvl_summary += lvl
    rat_item_amount = len(player['inventory'])
    rat_skills = get_cw_rat_skills(rat_skillnumber, rat_skill_lvl_summary)
    rat_weapon = get_cw_rat_weapon(rat_weaponlvl, blockedw = ['–ö–æ—Ä–æ—Ç–∫–∏–π –º–µ—á', '–ü–∏—Å—Ç–æ–ª–µ—Ç'])
    rat_items = get_cw_rat_items(rat_item_amount)
    rat['weapon'] = rat_weapon
    rat['skills'] = rat_skills
    rat['hp'] = 3 + buff
    rat['maxhp'] = 3 + buff
    rat['energy'] = 4 + buffen
    rat['maxenergy'] = 4 + buffen
    rat['dmglimit'] = 5 + buff
    rat['maxdmglimit'] = 5 + buff
    rat['inventory'] = rat_items
    rat['name'] = '–ö—Ä—ã—Å–∞[' + player['name'] + ']|üê≠'
    rat['team'] = player['team']
    rat['castlefightrole'] = player['castlefightrole']
    rat['castle'] = player['castle']
    rat['full_npc'] = True
    rat['allies'] = player['allies']
    return ratt



def castlefight(test=False):
    castlelist = ['rat', 'darkcastle', 'necromant', 'explosion']
    starttime = time.time()
    castles = {}
    users = cwdb.users.find({})
    cwdb.clean_for_battle()
    allcastlesbattletext.clear()
    for ids in castlelist:
        castles.update(createcastle(ids))
    for ids in users:
        if ids['current_act'] == 'def':
            castles[ids['castle']]['defers'].update({ids['id']: ids})
        elif ids['current_act'] == 'attack':
            castles[ids['attack_target']]['attackers'].update({ids['id']: ids})

    for ids in castles:
        castle = castles[ids]
        allcastlesbattletext[ids] = []
        game = creategame(chatid=castle['name'], castlefight=True)
        loosestreak = allcastles.find_one({})[ids]['loosestreak']
        for idss in game:
            game = game[idss]
            break
        summon_rats = []
        for idss in castle['defers']:
            user = castle['defers'][idss]
            #####################################################################################################################################################
            game['players'].update(
                createplayer(uid=user['id'], weapon=user['weapon'], hp=user['hp'], name=user['name']))
            player = game['players'][user['id']]
            player['team'] = user['castle']
            player['controller'] = 'bot'
            player['loosedamage'] += loosestreak
            player.update({'castlefightrole': 'defer', 'castle': user['castle']})
            set_player_battle_stats(player, user)
            try:
                try:
                    user['summon_castlefight_rat']
                except:
                    user['summon_castlefight_rat'] = False
                if user['summon_castlefight_rat']:
                    rat = summon_rat_companion(game, user, player)
                    summon_rats.append(rat)
                    if not test:
                        cwusers.update_one({'id': user['id']}, {'$set': {'summon_castlefight_rat': False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
            try:
                try:
                    user['necromant_reborn_buff']
                except:
                    user['necromant_reborn_buff'] = False
                if user['necromant_reborn_buff']:
                    game['necromant_reborn_buff'] += 1
                    if not test:
                        cwusers.update_one({'id':user['id']},{'$set':{'necromant_reborn_buff':False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
            try:
                try:
                    user['next_battle_explosion']
                except:
                    user['next_battle_explosion'] = False
                if user['next_battle_explosion']:
                    player['castle_explosion'] = True
                    if not test:
                        cwusers.update_one({'id': user['id']}, {'$set': {'next_battle_explosion': False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
            try:
                try:
                    user['summon_dark_demon']
                except:
                    user['summon_dark_demon'] = False
                if user['summon_dark_demon']:
                    player['summon_dark_demon'] = True
                    if not test:
                        cwusers.update_one({'id': user['id']}, {'$set': {'summon_dark_demon': False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())



        #################################################################################################################################################

        for idss in castle['attackers']:
            newattackers = {}
            user = castle['attackers'][idss]
            #####################################################################################################################################################
            game['players'].update(
                createplayer(uid=user['id'], weapon=user['weapon'], hp=user['hp'], name=user['name']))
            player = game['players'][user['id']]
            player['team'] = user['castle']
            player['controller'] = 'bot'
            player.update({'castlefightrole': 'attacker', 'castle': user['castle']})
            set_player_battle_stats(player, user)
            try:
                try:
                    user['summon_castlefight_rat']
                except:
                    user['summon_castlefight_rat'] = False
                if user['summon_castlefight_rat']:
                    rat = summon_rat_companion(game, user, player)
                    summon_rats.append(rat)
                    if not test:
                        cwusers.update_one({'id': user['id']}, {'$set': {'summon_castlefight_rat': False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
            try:
                try:
                    user['necromant_reborn_buff']
                except:
                    user['necromant_reborn_buff'] = False
                if user['necromant_reborn_buff']:
                    game['necromant_reborn_buff'] += 1
                    if not test:
                        cwusers.update_one({'id':user['id']},{'$set':{'necromant_reborn_buff':False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
            try:
                try:
                    user['summon_dark_demon']
                except:
                    user['summon_dark_demon'] = False
                if user['summon_dark_demon']:
                    player['summon_dark_demon'] = True
                    if not test:
                        cwusers.update_one({'id': user['id']}, {'$set': {'summon_dark_demon': False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
            try:
                try:
                    user['next_battle_explosion']
                except:
                    user['next_battle_explosion'] = False
                if user['next_battle_explosion']:
                    player['castle_explosion'] = True
                    if not test:
                        cwusers.update_one({'id': user['id']}, {'$set': {'next_battle_explosion': False}})
            except:
                sendm(cwbot, 441399484, traceback.format_exc())

        for idss in summon_rats:
            game['players'].update(idss)

        #################################################################################################################################################
        for idss in game['players']:
            allcastlecodes = ['rat', 'explosion', 'necromant', 'darkcastle']
            game['players'][idss].update({'castlefighttexts': []})
            if game['players'][idss]['team'] != castle['name']:
                for idsss in allcastlecodes:
                    if idsss != castle['name']:
                        game['players'][idss]['allies'].append(idsss)
        goo(None, None, game)
        # if sea['defpower']<sea['attackerspower']:
        #    sea['saved']=False
    text = ''
    allc = allcastles.find_one({})
    for ids in castlefightinfo:
        castle = castlefightinfo[ids]
        if castle['winner'] == None or castle['winner'] == 'defers':
            castle['score'] += 8
            loosestreak = allcastles.find_one({})[ids]['loosestreak']
            if loosestreak > 0:
                if not test:
                    allcastles.update_one({}, {'$inc': {ids + '.loosestreak': -1}})
            text += 'üõ°' + castle_to_name(castle['name']) + ' –æ—Ç—Å—Ç–æ—è–ª —Å–≤–æ—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é!\n–¢–æ–ø –∞—Ç–∞–∫—É—é—â–∏—Ö:\n'
            attackers_top = getcastletop(castle['players'], 'attacker')
            if attackers_top != '':
                text += attackers_top + '\n'

            text += '–¢–æ–ø –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤:\n'
            defers_top = getcastletop(castle['players'], 'defer')
            if defers_top != '':
                text += defers_top + '\n'
            else:
                text += ''
            atkers = {}
            for idss in castle['players']:
                    if castle['players'][idss]['castlefightrole'] == 'attacker':
                        atkers.update({castle['players'][idss]['id']: castle['players'][idss]})
                        exp = 1
                        user = cwdb.get_user(castle['players'][idss]['id'])
                        if user != None:
                            if not test:
                                cwusers.update_one({'id': user['id']}, {'$inc': {'exp': exp, 'changebattleexp': exp}})
                                user['exp'] += 1
                                check_lvlup(user)
                    else:
                        user = cwdb.get_user(castle['players'][idss]['id'])
                        if user != None:
                            if not test:
                                exp = exp_for_quest(user['lvl'])
                                multipler = random.randint(7, 13)
                                multipler = multipler / 10
                                exp = int(exp * multipler)
                                cwusers.update_one({'id': user['id']}, {'$inc': {'exp': exp, 'changebattleexp': exp}})
                                user['exp'] += exp
                                check_lvlup(user)
            stolengold = steal_gold(players=atkers, test=test)
            text += '–ê—Ç–∞–∫—É—é—â–∏–µ –ø–æ—Ç–µ—Ä—è–ª–∏ ' + str(stolengold) + 'üí∞.\n\n'
            if not test:
                give_gold_to_players(stolengold, castle['players'], 'defer')


        else:
            castle['score'] += 0
            scores = []
            scoreforcastle = 3
            castlepos = 1
            if not test:
                allcastles.update_one({}, {'$inc': {ids + '.loosestreak': 1}})
            if allc['rat']['score'] > allc[ids]['score']:
                castlepos += 1
            if allc['darkcastle']['score'] > allc[ids]['score']:
                castlepos += 1
            if allc['necromant']['score'] > allc[ids]['score']:
                castlepos += 1
            if allc['explosion']['score'] > allc[ids]['score']:
                castlepos += 1
            if castlepos == 4:
                scoreforcastle = 8
            if castlepos == 3:
                scoreforcastle = 12
            if castlepos == 2:
                scoreforcastle = 16
            if castlepos == 1:
                scoreforcastle = 20
            #castletopattackers = getcastletop(castle['players'], 'attacker', returnplayers=True)
            #for idss in castletopattackers:
            #    atker = idss
            #    if atker['castle'] not in scores:
            #        scores.append(atker['castle'])
            #        castlefightinfo[atker['castle']]['score'] += scoreforcastle
            castletoppercents = getcastletop_percent(castle['players'], 'attacker')
            countscore = scoreforcastle
            for idss in castletoppercents:
                takenscore = scoreforcastle * castletoppercents[idss]
                takenscore = math.ceil(takenscore)
                if takenscore > countscore:
                    takenscore = countscore
                countscore -= takenscore
                if countscore < 0:
                    countscore = 0
                castlefightinfo[idss]['score'] += takenscore

            text += 'üí¢' + castle_to_name(castle['name']) + ' –ø–æ—Ç–µ—Ä–ø–µ–ª –ø–æ—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–∏—Ç–≤–µ!\n–¢–æ–ø –∞—Ç–∞–∫—É—é—â–∏—Ö:\n'
            attackers_top = getcastletop(castle['players'], 'attacker')
            if attackers_top != '':
                text += attackers_top + '\n'
            text += '–¢–æ–ø –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤:\n'
            defers_top = getcastletop(castle['players'], 'defer')
            if defers_top != '':
                text += defers_top + '\n'
            else:
                text += ''
            stolenres = steal_resources(castle=ids, test=test)
            stolenresamount = 0
            for idss in stolenres:
                stolenresamount += stolenres[idss]
            stolengold = steal_gold(ids, test=test)
            if not test:
                give_gold_to_players(stolengold, castle['players'], 'attacker')
                give_resources_to_players(stolenres, castle['players'], 'attacker')
            text += '–ê—Ç–∞–∫—É—é—â–∏–µ —Ä–∞–∑–≥—Ä–∞–±–∏–ª–∏ –∑–∞–º–æ–∫ –Ω–∞ ' + str(stolengold) + 'üí∞ –∏ ' + str(stolenresamount) + 'üì¶.\n\n'
            for idss in castle['players']:
                if not castle['players'][idss]['full_npc']:
                    if castle['players'][idss]['castlefightrole'] == 'attacker':
                        if not test:
                            user = cwusers.find_one({'id': castle['players'][idss]['id']})
                            exp = exp_for_quest(user['lvl'])
                            multipler = random.randint(7, 13)
                            multipler = multipler / 10
                            exp = int(exp * multipler)
                            cwusers.update_one({'id': user['id']}, {'$inc': {'exp': exp, 'changebattleexp': exp}})
                            user['exp'] += exp
                            check_lvlup(user)
                    else:
                        if not test:
                            exp = 1
                            user = cwusers.find_one({'id': castle['players'][idss]['id']})
                            cwusers.update_one({'id': user['id']}, {'$inc': {'exp': exp, 'changebattleexp': exp}})
                            user['exp'] += exp
                            check_lvlup(user)

    text += 'üèÜ–ù–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –æ—á–∫–∏:\n'
    for ids in castlefightinfo:
        text += castle_to_name(castlefightinfo[ids]['name']) + ': ' + str(castlefightinfo[ids]['score']) + ' –æ—á–∫–æ–≤\n'
        if not test:
            allcastles.update_one({}, {'$inc': {castlefightinfo[ids]['name'] + '.score': castlefightinfo[ids]['score']}})
    if not test:
        cwusers.update_many({}, {'$set': {'attack_target': None, 'current_act': None}})
    for ids in cwusers.find({}):
        if not test:
            cwusers.update_one({'id': ids['id']}, {'$inc': {'gold': ids['changebattlegold']}})
            for idss in ids['changebattleres']:
                if idss not in ids['resources']:
                    cwusers.update_one({'id': ids['id']}, {'$set': {'resources.' + idss: ids['changebattleres'][idss]}})
                else:
                    cwusers.update_one({'id': ids['id']}, {'$inc': {'resources.' + idss: ids['changebattleres'][idss]}})
    if not test:
        msg = sendm(cwbot, officialchat, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–∏—Ç–≤—ã:\n\n' + text)
    else:
        msg = sendm(cwbot, officialchat, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¢–ï–°–¢–û–í–û–ô –±–∏—Ç–≤—ã:\n\n' + text)
    cwbot.forward_message(-1001617111483, msg.chat.id, msg.message_id)
    castlefightinfo.clear()
    endtime = time.time()
    secs = int(endtime - starttime)
    sendm(cwbot, pasyuk_id, "–í—Ä–µ–º—è –±–∏—Ç–≤—ã: " + str(secs) + ' —Å–µ–∫—É–Ω–¥.')
    # for ids in allcastlesbattletext:
    #    sendm(cwbot, fullreportschannel, '*–õ–æ–≥ –±–∏—Ç–≤—ã —É –≤–æ—Ä–æ—Ç '+castle_to_name(ids)+':*\n', parse_mode = 'markdown')
    #    for idss in allcastlesbattletext[ids]:
    #        sendm(cwbot, fullreportschannel, idss)
    #        time.sleep(0.2)


last_castle_fight = {
    'time': 0
}

last_castle_fight['time'] = lastbattletime_db.find_one({})['time']

@cwbot.message_handler(func = lambda m: m.forward_from != None)
def forwardblock(m):
    return

def castlefight_check():
    first = True
    while True:
        if not first:
            try:
                current_datetime = datetime.now()
                if current_datetime.hour in [22, 6, 14]:
                    if time.time() - last_castle_fight['time'] > 3600 and current_datetime.minute in [0, 1, 2]:
                        last_castle_fight['time'] = time.time()
                        lastbattletime_db.update_one({}, {'$set': {'time': time.time()}})
                        if current_datetime.hour == 22:
                            cwusers.update_many({},{'$set':{'troll':1}})
                        sendm(cwbot, officialchat, "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –±–∏—Ç–≤–∞ –∑–∞–º–∫–æ–≤!")
                        castlefight()
                        showalllogs()
                        sendm(cwbot, officialchat, "–ë–∏—Ç–≤–∞ –∑–∞–º–∫–æ–≤ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ –±–∏—Ç–≤–∞—Ö –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–∞–Ω–∞–ª–∞—Ö:\n\n"+
                                           "–ó–∞–º–æ–∫ –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ - https://t.me/+QHNp1MM_Z_QxMjgy\n–ó–∞–º–æ–∫ –º–∞–≥–∏–∏ –≤–∑—Ä—ã–≤–æ–≤ - https://t.me/+PwdhmkCPdSRlOGQy\n"+
                                           "–ó–∞–º–æ–∫ —Ç—å–º—ã - https://t.me/+NoPTCCrfjOcyOTY6\n–ö—Ä—ã—Å–∏–Ω—ã–π –∑–∞–º–æ–∫ - https://t.me/+81Eixp_l6FFiMDBi")
            except:
                sendm(cwbot, pasyuk_id, traceback.format_exc())
        first = False
        time.sleep(20)


threading.Thread(target=castlefight_check, args=[]).start()

bargames = {}


def create_bar():
    game = creategame(chatid='bar')
    bargames.update(game)
    game = cwgames['bar']
    game['cwbar'] = True
    goo(game=game, bot=cwbot)


@cwbot.message_handler(commands=['castlefight'])
def castlefightinitt(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        sendm(cwbot, m.chat.id, "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –±–∏—Ç–≤–∞ –∑–∞–º–∫–æ–≤!")
        castlefight()
        showalllogs()
        sendm(cwbot, m.chat.id, "–ë–∏—Ç–≤–∞ –∑–∞–º–∫–æ–≤ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!")
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())

@cwbot.message_handler(commands=['castlefight_test'])
def castlefightinitt(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        sendm(cwbot, m.chat.id, "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –¢–ï–°–¢–û–í–ê–Ø –±–∏—Ç–≤–∞ –∑–∞–º–∫–æ–≤ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ä–µ—Å—É—Ä—Å–æ–≤!")
        castlefight(test=True)
        showalllogs()
        sendm(cwbot, m.chat.id, "–¢–ï–°–¢–û–í–ê–Ø –±–∏—Ç–≤–∞ –∑–∞–º–∫–æ–≤ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!")
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())

@cwbot.message_handler(commands = ['fixrats'])
def fixratsss(m):
    amount = 0
    try:
        idd = int(m.text.split(' ')[1])
    except:
        return
    for ids in cwusers.find({}):
        if 'rat_toys' in ids['resources']:
            amount += ids['resources']['rat_toys']
            cwusers.update_one({'id':ids['id']},{'$set':{'resources.rat_toys':0}})
    cwusers.update_one({'id':idd},{'$inc':{'resources.rat_toys':amount}})
    sendm(cwbot, m.chat.id, 'all rat toys gone')

@cwbot.message_handler(commands=['givenoise'])
def givessss(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        amount = int(m.text.split(' ')[2])
    except:
        return
    cwusers.update_one({'id': id}, {'$inc': {'noise_check': amount}})
    sendm(cwbot, m.chat.id, 'done!')

@cwbot.message_handler(commands=['resetspecials'])
def resetexppplll(m):
    if m.from_user.id != pasyuk_id:
        return
    cwusers.update_many({}, {'$set': {'last_explosion_use': 0}})
    cwusers.update_many({}, {'$set': {'last_dark_demon': 0}})
    cwusers.update_many({}, {'$set': {'last_summon_rat': 0}})
    cwusers.update_many({}, {'$set': {'last_necromant_reborn': 0}})
    sendm(cwbot, m.chat.id, 'done!')


@cwbot.message_handler(commands=['clearscore'])
def givessssclears(m):
    if m.from_user.id != pasyuk_id:
        return
    allcastles.update_one({}, {'$set': {'rat.score': 0, 'dark.score': 0, 'necromant.score': 0, 'explosion.score': 0}})
    sendm(cwbot, m.chat.id, 'cleared')

def sendlogs(ids, x, test = False):
    if ids == 'rat':
        logschat = -1001862559151
        logsbot = ratcastlelogsbot
    if ids == 'darkcastle':
        logschat = -1001891375607
        logsbot = darkcastlelogsbot
    if ids == 'necromant':
        logschat = -1001625669127
        logsbot = necromantcastlelogsbot
    if ids == 'explosion' or ids == 'explosions':
        logschat = -1001835306492
        logsbot = explosioncastlelogsbot
    if not test:
        logsbot.send_message(logschat, "‚öîÔ∏è–ë–∏—Ç–≤–∞ " + str(datetime.now().hour) + ":00‚öîÔ∏è")
    else:
        logsbot.send_message(logschat, "‚öîÔ∏è–¢–ï–°–¢–û–í–ê–Ø –ë–∏—Ç–≤–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ " + str(datetime.now().hour) + ":00‚öîÔ∏è")
    time.sleep(3)
    for idss in x:
        curtext = idss
        if len(curtext) <= 4000:
            try:
                logsbot.send_message(logschat, curtext)
            except:
                sendm(cwbot, 441399484, traceback.format_exc())
        else:
            sumtexts = []
            while len(curtext) > 4000:
                sumtexts.append(curtext[:4000])
                curtext = curtext[4000:]
            for idsss in sumtexts:
                logsbot.send_message(logschat, idsss)
                time.sleep(3)
        time.sleep(3)
    time.sleep(3)
    logsbot.send_message(logschat, "‚öîÔ∏è–ö–æ–Ω–µ—Ü –±–∏—Ç–≤—ã‚öîÔ∏è")

def showalllogs(test = False):
    try:
        for ids in allcastlesbattletext:
            textcopy = allcastlesbattletext[ids]
            threading.Thread(target = sendlogs, args = [ids, textcopy, test]).start()
        allcastlesbattletext.clear()
    except:
        sendm(cwbot, 441399484, traceback.format_exc())


@cwbot.message_handler(commands=['showalllogs'])
def showalllogssss(m):
    if m.from_user.id != pasyuk_id:
        return
    showalllogs()


@cwbot.message_handler(commands=['givescore'])
def showalllogssssgivescore(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        castle = m.text.split(' ')[1]
        amount = int(m.text.split(' ')[2])
    except:
        return
    allcastles.update_one({}, {'$inc': {castle + '.score': amount}})
    sendm(cwbot, m.chat.id, 'done')


#####################################################################################################################################################
#####################################################################################################################################################
#####################################################################################################################################################
#####################################################################################################################################################

def check_users_stamina():
    while True:
        try:
            x = cwusers.find({})
            for ids in x:
                try:
                    needtime = 3600
                    if ids['current_act'] == None:
                        if 'goodsleep' in ids['equipped_skills']:
                            if ids['equipped_skills']['goodsleep']['lvl'] == 1:
                                needtime -= 300
                            if ids['equipped_skills']['goodsleep']['lvl'] == 2:
                                needtime -= 600
                            if ids['equipped_skills']['goodsleep']['lvl'] == 3:
                                needtime -= 900
                    if time.time() - ids['last_stamina_regen'] >= needtime:
                        if ids['stamina'] < ids['maxstamina']:
                            cwusers.update_one({'id': ids['id']}, {'$inc': {'stamina': 1}})
                            ids['stamina'] += 1
                            if ids['stamina'] == ids['maxstamina']:
                                try:
                                    sendm(cwbot, ids['id'], 'üîã–≠–Ω–µ—Ä–≥–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤—ã –≥–æ—Ç–æ–≤—ã –∫ —Å—Ä–∞–∂–µ–Ω–∏—é!')
                                except:
                                    pass
                            cwusers.update_one({'id': ids['id']}, {'$set': {'last_stamina_regen': time.time()}})
                    if time.time() - ids['last_hp_regen'] >= 6:
                        if ids['hp'] < ids['maxhp']:
                            cwusers.update_one({'id': ids['id']}, {'$inc': {'hp': 1}})
                            cwusers.update_one({'id': ids['id']}, {'$set': {'last_hp_regen': time.time()}})
                except:
                    try:
                        sendm(cwbot, pasyuk_id, traceback.format_exc())
                    except:
                        pass
        except:
            try:
                sendm(cwbot, pasyuk_id, traceback.format_exc())
            except:
                pass
        time.sleep(20)


threading.Thread(target=check_users_stamina, args=[]).start()

for ids in cwusers.find({}):
    if ids['current_act'] in ['quest_rathunt', 'quest_castle_protect', 'quest_noise_check', 'wait_help', 'troll']:
        cwusers.update_one({'id': ids['id']}, {'$set': {'current_act': None}})
        if ids['current_act'] != 'quest_noise_check':
            if ids['stamina'] < ids['maxstamina']:
                if ids['current_act'] not in ['wait_help']:
                    cwusers.update_one({'id': ids['id']}, {'$inc': {'stamina': 1}})
            if ids['current_act'] == 'troll':
                cwusers.update_one({'id': ids['id']}, {'$set': {'troll': 1}})
        else:
            if ids['noise_check'] < ids['max_noise_check']:
                cwusers.update_one({'id': ids['id']}, {'$inc': {'noise_check': 1}})
        try:
            sendm(cwbot, ids['id'],
                               '–ë–æ—Ç –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω, –∫–≤–µ—Å—Ç –±—ã–ª –æ—Ç–º–µ–Ω—ë–Ω, –∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –±—ã–ª–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ.')
        except:
            pass


# cwusers.update_many({},{'$set':{'max_items_for_battle':1}})
# cwusers.update_many({},{'$set':{'maxstamina':7}})
# cwusers.update_many({},{'$set':{'current_act':None, 'gold':0, 'resources':{}, 'exp':0, 'lvl':1, 'lvl_points':0, 'attack_target':None,
#                                'inventory':{},'lastbattlelogs':[], 'noise_check':0, 'pogs':0, 'equipped_greedy':0, 'equipped_goodsleep':0,
#                                'dmglimit':5,'maxdmglimit':5, 'birzha':[]}})

def create_cw_profile(m=None, name=None, username=None, uid=None, castle=None, who_invited=None):
    if m != None:
        name = m.from_user.first_name
        username = str(m.from_user.username)
        uid = m.from_user.id
        castle = None
    else:
        name = name
        username = username
        uid = uid
        castle = castle
    x = {
        'name': name,
        'username': username,
        'id': uid,
        'castle': castle,
        'lvl': 1,
        'exp': 0,
        'gold': 0,
        'lvl_points': 0,
        'stamina': 5,
        'maxstamina': 5,
        'hp': 3,
        'maxhp': 3,
        'dmglimit': 5,
        'maxdmglimit': 5,
        'energy': 4,
        'maxenergy': 4,
        'current_act': None,
        'attack_target': None,
        'skills': {},
        'skills_for_battle': {},
        'equipped_skills': {},
        'weapon_for_battle': None,
        'weapon': None,
        'max_skills': 1,
        'items': {},
        'items_for_battle': [],
        'max_items_for_battle': 1,
        'inventory': {},
        'resources': {},
        'lastbattlelogs': [],
        'noise_check': 0,
        'max_noise_check': 5,
        'last_stamina_regen': 0,
        'referal_friends': [],
        'who_invited': who_invited,
        'last_hp_regen': 0,
        'pogs': 0,
        'changebattlegold': 0,
        'changebattleres': {},
        'changebattleexp': 0,
        'set_name': False,
        'equipped_greedy': 0,
        'equipped_goodsleep': 0,
        'birzha': [],
        'last_activity': time.time(),
        'troll':1,
        'bot_counter': 0,
        'false_answer': 0
    }
    # x['skills'].update(create_cw_skill(code='boots', name='–£–¥–æ–±–Ω—ã–µ –±–æ—Ç–∏–Ω–∫–∏', lvl=1, skill_slots=1))
    return x


def need_forest_to_next_lvl(lvl):
    need = foresttable[lvl]['forestfornextlvl']
    return need


def need_exp_to_next_lvl(lvl):
    ANSWER = lvltable[lvl]['totalexp'] + lvltable[lvl]['expfornextlvl']
    return ANSWER


def exp_for_quest(lvl):
    middle_exp = (lvltable[lvl]['expfornextlvl']) / need_forest_to_next_lvl(lvl)
    return middle_exp
        

# expforquest = {}
# i = 1
# while i <= 39:
#    needexp = exp_for_quest(i)
#    expforquest.update({i:needexp})
#    i += 1

# needexpforlvl = {}
# i = 1
# while i <= 39:
#    needexp = need_exp_to_next_lvl(i)
#    needexpforlvl.update({i:needexp})
#    i += 1
cwban = db.cwban
cwblocked = []  # [213720647]


def is_user_banned(m):
    if m.from_user.id in cwblocked:
        return True
    return False


def cwblockedcheck():
    while True:
        for ids in cwban.find({}):
            if ids['id'] not in cwblocked:
                cwblocked.append(ids['id'])
        time.sleep(30)


threading.Thread(target=cwblockedcheck, args=[]).start()


@cwbot.message_handler(commands=['unbanname'])
def unbannnn(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        name = m.text.split('?')[1]
    except:
        sendm(cwbot, m.chat.id, '–§–æ—Ä–º–∞—Ç:\n/banname ?name')
        return
    x = cwusers.find_one({'name': name})
    if x == None or x['set_name'] == False:
        sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    if cwban.find_one({'id': x['id']}) == None:
        sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫ –Ω–µ –∑–∞–±–∞–Ω–µ–Ω!')
        return
    cwban.delete_one({'id': x['id']})
    sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!')


@cwbot.message_handler(commands=['banname'])
def bannnn(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        name = m.text.split('?')[1]
    except:
        sendm(cwbot, m.chat.id, '–§–æ—Ä–º–∞—Ç:\n/banname ?name')
        return
    x = cwusers.find_one({'name': name})
    if x == None or x['set_name'] == False:
        sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    if cwban.find_one({'id': x['id']}) != None:
        sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫ —É–∂–µ –∑–∞–±–∞–Ω–µ–Ω!')
        return
    cwban.insert_one({'id': x['id'], 'name': x['name']})
    sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!')


@cwbot.message_handler(commands=['banid'])
def bannnn(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
    except:
        sendm(cwbot, m.chat.id, '–§–æ—Ä–º–∞—Ç:\n/banid id')
        return
    x = cwusers.find_one({'id': id})
    if x == None or x['set_name'] == False:
        sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫–∞ —Å —Ç–∞–∫–∏–º id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    if cwban.find_one({'id': x['id']}) != None:
        sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫ —É–∂–µ –∑–∞–±–∞–Ω–µ–Ω!')
        return
    cwban.insert_one({'id': x['id'], 'name': x['name']})
    sendm(cwbot, m.chat.id, '–ò–≥—Ä–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!')


@cwbot.message_handler(func=lambda m: is_user_banned(m))
def banneduserrrr(m):
    return


@cwbot.callback_query_handler(func=lambda call: is_user_banned(call))
def banneduserrrr(call):
    return


def create_cw_skill(code, name, lvl, skill_slots=1):
    return {code: {'name': name, 'lvl': lvl, 'skill_slots': skill_slots}}


def get_castle_kb(not_give=None):
    kb = types.ReplyKeyboardMarkup()
    if not_give != 'rat':
        kb.add(types.KeyboardButton("üê≠–ö—Ä—ã—Å–∏–Ω—ã–π –∑–∞–º–æ–∫"))
    if not_give != 'darkcastle':
        kb.add(types.KeyboardButton("üëÅ–ó–∞–º–æ–∫ —Ç—å–º—ã"))
    if not_give != 'necromant':
        kb.add(types.KeyboardButton("üñ§–ó–∞–º–æ–∫ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞"))
    if not_give != 'explosion':
        kb.add(types.KeyboardButton("üíÆ–ó–∞–º–æ–∫ –º–∞–≥–∏–∏ –≤–∑—Ä—ã–≤–æ–≤"))
    return kb


@cwbot.message_handler(commands=['repairitems'])
def stickerrrupdpsfdsp(m):
    if m.from_user.id == pasyuk_id:
        try:
            id = int(m.text.split(' ')[1])
        except:
            amount = 1

        cwusers.update_one({'id': id}, {'$set': {'items_for_battle': []}})
        sendm(cwbot, pasyuk_id, 'Done')


@cwbot.message_handler(commands=['regenstamina'])
def givessss(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        amount = int(m.text.split(' ')[2])
    except:
        return
    cwusers.update_one({'id': id}, {'$inc': {'stamina': amount}})
    sendm(cwbot, m.chat.id, 'done!')


@cwbot.message_handler(commands=['givestamina'])
def givessss(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        amount = int(m.text.split(' ')[2])
    except:
        return
    cwusers.update_one({'id': id}, {'$inc': {'maxstamina': amount}})
    sendm(cwbot, m.chat.id, 'done!')


@cwbot.message_handler(commands=['resetname'])
def givessss(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
    except:
        return
    cwusers.update_one({'id': id}, {'$set': {'set_name': False}})
    sendm(cwbot, m.chat.id, 'Done')


def is_main_chat(m):
    return m.chat.id == int(officialchat)


@cwbot.message_handler(func=lambda m: is_main_chat(m))
def msgs_from_mainchatt(m):
    return


@cwbot.message_handler(commands=['start'])
def cwstarttt(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user == None:
        try:
            ref = int(m.text.split(' ')[1])
        except:
            ref = None
        if ref == m.from_user.id:
            sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ —Å–≤–æ–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª–∫–µ!')
            return
            ref = None
        whoinv = cwusers.find_one({'id': ref})
        if whoinv == None:
            ref = None
        cwusers.insert_one(create_cw_profile(m, who_invited=ref))
        sendm(cwbot, pasyuk_id, m.from_user.first_name + ' –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è!')
        user = cwusers.find_one({'id': m.from_user.id})
        if ref != None:
            sendm(cwbot, ref,
                               m.from_user.first_name + ' –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è –≤ –∏–≥—Ä–µ –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ! –ö–æ–≥–¥–∞ –æ–Ω –ø–æ–ª—É—á–∏—Ç 5, 10 –∏ 15 —É—Ä–æ–≤–Ω–∏ - –≤—ã –ø–æ–ª—É—á–∏—Ç–µ +1 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–º–∏–Ω–µ!')
            sendm(cwbot, pasyuk_id, whoinv['name'] + ' –ø—Ä–∏–≥–ª–∞—Å–∏–ª ' + m.from_user.first_name + '!')
    if user['castle'] == None:
        kb = get_castle_kb()
        sendm(cwbot, m.chat.id,
                           '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç–µ —Å—Ä–∞–∂–∞—Ç—å—Å—è - –ø–æ—Ç–æ–º –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä:',
                           reply_markup=kb)
    else:
        text = get_profile_text(m)
        kb = main_menu_kb()
        sendm(cwbot, m.chat.id, text, reply_markup=kb)


def is_user_registered(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user == None:
        cwusers.insert_one(create_cw_profile(m))
        sendm(cwbot, pasyuk_id, m.from_user.first_name + ' –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è!')
        return False
    if user['castle'] == None:
        return False
    return True


@cwbot.message_handler(commands=['create_npc'])
def create_npc_cw(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        name = m.text.split('?')[1]
        uid = m.text.split('?')[2]
        castle = m.text.split('?')[3]
    except:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞:\n/create_npc ?name?id?castle')
        return
    user = cwusers.find_one({'id': uid})
    if user != None:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ù–ü–° —Å —Ç–∞–∫–∏–º –∞–π–¥–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    user = cwusers.find_one({'name': name})
    if user != None:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –∏–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    castlename = castle_to_name(castle)
    if castlename == None:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ó–∞–º–∫–∞ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    try:
        cwusers.insert_one(create_cw_profile(name=name, uid=uid, castle=castle))
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'controllable_npc': uid}})
        sendm(cwbot, m.chat.id,
                           '–ù–ü–° ' + name + ' —Å –∞–π–¥–∏ "' + uid + '" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –≤ –∑–∞–º–∫–µ ' + castlename + '!')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(commands=['del_npc'])
def create_npc_cw(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        uid = m.text.split(' ')[1]
    except:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞:\n/del_npc id')
        return
    npc = cwusers.find_one({'id': uid})
    if npc == None:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ù–ü–° —Å —Ç–∞–∫–∏–º –∞–π–¥–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    cwusers.delete_one({'id': npc['id']})
    sendm(cwbot, m.chat.id, '–ù–ü–° —Å –∞–π–¥–∏ ' + npc['id'] + ' —É–¥–∞–ª–µ–Ω!')


@cwbot.message_handler(commands=['select_npc'])
def select_npc_cw(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        uid = m.text.split(' ')[1]
    except:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:\n/select_npc uid')
        return
    user = cwusers.find_one({'id': uid})
    if user == None:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ù–ü–° —Å —Ç–∞–∫–∏–º –∞–π–¥–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    cwusers.update_one({'id': m.from_user.id}, {'$set': {'controllable_npc': uid}})
    sendm(cwbot, m.chat.id,
                       '–í—ã–±—Ä–∞–Ω –ù–ü–° –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è: ' + user['name'] + ' –∏–∑ ' + castle_to_name(user['castle']) + '!')


@cwbot.message_handler(commands=['calclvl'])
def calclvvlll(m):
    if m.from_user.id != pasyuk_id:
        return
    lvl = 1
    text = ''
    while lvl < 40:
        text += 'lvl.' + str(lvl) + ': totalexp=' + str(lvltable[lvl]['totalexp']) + ', exp for next lvl = ' + str(
            lvltable[lvl]['expfornextlvl']) + '\n'
        lvl += 1
    sendm(cwbot, m.chat.id, text)
    lvl = 1
    text = ''
    while lvl < 40:
        text += 'lvl.' + str(lvl) + ': totalforest=' + str(
            foresttable[lvl]['totalforest']) + ', forest for next lvl = ' + str(
            foresttable[lvl]['forestfornextlvl']) + '\n'
        lvl += 1
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(commands=['clear_castle'])
def clear_ccc(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        idd = int(m.text.split(' ')[1])
    except:
        return
    cwusers.update_one({'id': idd}, {'$set': {'castle': None}})
    sendm(cwbot, m.chat.id, 'done')


@cwbot.message_handler(commands=['attack_npc'])
def attack_npc_cw(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        try:
            castle = m.text.split(' ')[1]
        except:
            sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:\n/attack_npc castle')
            return
        castlename = castle_to_name(castle)
        if castlename == None:
            sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ó–∞–º–∫–∞ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
            return
        user = cwusers.find_one({'id': m.from_user.id})
        npc = cwusers.find_one({'id': user['controllable_npc']})
        if npc == None:
            sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ù–ü–° –∫–æ–º–∞–Ω–¥–æ–π /select_npc!')
            return
        cwusers.update_one({'id': npc['id']}, {'$set': {'attack_target': castle, 'current_act': 'attack'}})
        sendm(cwbot, m.chat.id, '–£—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω–∞ —Ü–µ–ª—å –∞—Ç–∞–∫–∏ –¥–ª—è ' + npc['name'] + ' –∏–∑ ' + castle_to_name(
            npc['castle']) + ': ' + castlename + '!')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(commands=['def_npc'])
def attack_npc_cw(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        user = cwusers.find_one({'id': m.from_user.id})
        npc = cwusers.find_one({'id': user['controllable_npc']})
        if npc == None:
            sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ù–ü–° –∫–æ–º–∞–Ω–¥–æ–π /select_npc!')
            return
        cwusers.update_one({'id': npc['id']}, {'$set': {'current_act': 'def'}})
        sendm(cwbot, m.chat.id, '–£—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è ' + npc['name'] + ' –∏–∑ ' + castle_to_name(
            npc['castle']) + ': üõ°–ó–∞—â–∏—Ç–∞ ' + castle_to_name(npc['castle']) + '!')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(commands=['givegold'])
def givegoldd(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        uid = int(m.text.split(' ')[1])
        gold = int(m.text.split(' ')[2])
    except:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:\n/givegold uid gold')
        return
    cwusers.update_one({'id': uid}, {'$inc': {'gold': gold}})
    sendm(cwbot, m.chat.id, '–ó–æ–ª–æ—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!')


@cwbot.message_handler(commands=['givepogs'])
def givegoldd(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        uid = int(m.text.split(' ')[1])
        gold = int(m.text.split(' ')[2])
    except:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:\n/givegold uid gold')
        return
    cwusers.update_one({'id': uid}, {'$inc': {'pogs': gold}})
    sendm(cwbot, m.chat.id, '–ü–æ–≥–∏ –ø–æ–ª—É—á–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!')


@cwbot.message_handler(commands=['giverecipe'])
def giverrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        recipecode = m.text.split(' ')[1]
    except:
        return
    try:
        user = cwusers.find_one({'id': m.reply_to_message.from_user.id})
        color = random.choice(["blue", "red", "green"])
        # sendm(cwbot, m.chat.id, str(user))
        # recipecode = "recipe_"+color
        objectcode = generate_object_code(user)
        recipename = resource_to_name(recipecode)
        res = create_recipe(recipecode, objectcode, recipename, undefined=False, color=color)
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: res}})
        sendm(cwbot, m.chat.id, '–†–µ—Ü–µ–ø—Ç ' + recipecode + ' –ø–æ–ª—É—á–µ–Ω.')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['giveurecipe'])
def giverrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        color = m.text.split(' ')[2]
    except:
        return
    try:
        user = cwusers.find_one({'id': id})
        recipecode = "recipe_" + color
        objectcode = generate_object_code(user)
        recipename = resource_to_name(recipecode)
        res = create_recipe(recipecode, objectcode, recipename, undefined=True, color=color)
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: res}})
        sendm(cwbot, m.chat.id, '–†–µ—Ü–µ–ø—Ç ' + recipecode + ' –ø–æ–ª—É—á–µ–Ω.')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['giveuscroll'])
def giverrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
    except:
        return
    try:
        user = cwusers.find_one({'id': id})
        # sendm(cwbot, m.chat.id, str(user))
        objectcode = generate_object_code(user)
        scroll = create_undefined_scroll(objectcode, resource_to_name("undefined_scroll"))
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: scroll}})
        sendm(cwbot, m.chat.id, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–≤–∏—Ç–æ–∫ –ø–æ–ª—É—á–µ–Ω.')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['givelvlpoints'])
def giverrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        amount = int(m.text.split(' ')[2])
    except:
        return
    try:
        user = cwusers.find_one({'id': id})
        # sendm(cwbot, m.chat.id, str(user))
        cwusers.update_one({'id': user['id']}, {'$inc': {'lvl_points': amount}})
        sendm(cwbot, m.chat.id, '–û—á–∫–∏ –ª–≤–ª–∞ –ø–æ–ª—É—á–µ–Ω—ã.')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['resetref'])
def giverrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
    except:
        return
    try:
        user = cwusers.find_one({'id': id})
        cwusers.update_one({'id': user['id']}, {'$set': {'who_invited': None}})
        sendm(cwbot, m.chat.id, 'Reset referal.')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['removeweaponfromuser'])
def removewww(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        try:
            itemcode = m.text.split(' ')[2]
            id = int(m.text.split(' ')[1])
        except:
            return
        user = cwusers.find_one({'id': id})
        if itemcode not in user['inventory']:
            sendm(cwbot, m.chat.id, 'not in inv')
            return
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['removeskillfromuser'])
def removepricelll(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        try:
            skillcode = m.text.split(' ')[2]
            id = int(m.text.split(' ')[1])
        except:
            return
        sendm(cwbot, m.chat.id, 'Begin')
        for ids in cwusers.find({}):
            if ids['id'] == id:
                user = cwusers.find_one({'id': ids['id']})
                wasp = False
                plvl = 0
                if skillcode in user['skills']:
                    cwusers.update_one({'id': user['id']}, {'$unset': {'skills.' + skillcode: 1}})
                    wasp = True
                    plvl = user['skills'][skillcode]['lvl']
                if skillcode in user['equipped_skills']:
                    cwusers.update_one({'id': user['id']}, {'$unset': {'equipped_skills.' + skillcode: 1}})
                    wasp = True
                    plvl = user['equipped_skills'][skillcode]['lvl']
                if wasp:
                    sendm(cwbot, m.chat.id, 'was skills ' + user['name'] + ' = ' + str(user['skills']))
                    sendm(cwbot, m.chat.id,
                                       'was equipped skills ' + user['name'] + ' = ' + str(user['equipped_skills']))
                    sendm(cwbot, m.chat.id, 'was DNA ' + user['name'] + ' = ' + str(
                        user['lvl_points']) + '\nWAS pogs = ' + str(user['pogs']))
                    sendm(cwbot, m.chat.id, user['name'] + ' –ø–æ—Ç–µ—Ä—è–ª ' + skillcode + ' –ª–≤–ª–∞ ' + str(plvl))
                    if plvl == 2:
                        cwusers.update_one({'id': user['id']}, {'$inc': {'lvl_points': 3}})
                    if plvl == 3:
                        cwusers.update_one({'id': user['id']}, {'$inc': {'lvl_points': 12}})
                    cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': 1}})
                    scrollamount = plvl
                    for i in range(scrollamount):
                        objectcode = generate_object_code(user)
                        newscroll = create_undefined_scroll(objectcode, resource_to_name("undefined_scroll"))
                        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: newscroll}})
                        user = cwusers.find_one({'id': user['id']})
                    sendm(cwbot, m.chat.id, 'now skills ' + user['name'] + ' = ' + str(user['skills']))
                    sendm(cwbot, m.chat.id,
                                       'now equipped skills ' + user['name'] + ' = ' + str(user['equipped_skills']))
                    sendm(cwbot, m.chat.id, 'now DNA ' + user['name'] + ' = ' + str(
                        user['lvl_points']) + '\nNOW pogs = ' + str(user['pogs']))

                for ids in user['inventory']:
                    if user['inventory'][ids]['type'] == 'scroll':
                        if user['inventory'][ids]['code'] == skillcode:
                            cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + ids: 1}})
                            objectcode = generate_object_code(user)
                            newscroll = create_undefined_scroll(objectcode, resource_to_name("undefined_scroll"))
                            cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: newscroll}})
                            cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': 1}})
                            sendm(cwbot, m.chat.id, user['name'] + ' get undefined scroll')

        sendm(cwbot, m.chat.id, 'End')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['removeobject'])
def removepricelllq(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        try:
            id = int(m.text.split(' ')[1])
            objectcode = m.text.split(' ')[2]
        except:
            return
        cwusers.update_one({'id': id}, {'$unset': {'inventory.' + objectcode: 1}})
        sendm(cwbot, m.chat.id, 'done')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['removeskill'])
def removepricelll(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        try:
            skillcode = m.text.split(' ')[1]
        except:
            return
        sendm(cwbot, m.chat.id, 'Begin')
        for ids in cwusers.find({}):
            user = cwusers.find_one({'id': ids['id']})
            wasp = False
            plvl = 0
            if skillcode in user['skills']:
                cwusers.update_one({'id': user['id']}, {'$unset': {'skills.' + skillcode: 1}})
                wasp = True
                plvl = user['skills'][skillcode]['lvl']
            if skillcode in user['equipped_skills']:
                cwusers.update_one({'id': user['id']}, {'$unset': {'equipped_skills.' + skillcode: 1}})
                wasp = True
                plvl = user['equipped_skills'][skillcode]['lvl']
            if wasp:
                sendm(cwbot, m.chat.id, 'was skills ' + user['name'] + ' = ' + str(user['skills']))
                sendm(cwbot, m.chat.id,
                                   'was equipped skills ' + user['name'] + ' = ' + str(user['equipped_skills']))
                sendm(cwbot, m.chat.id,
                                   'was DNA ' + user['name'] + ' = ' + str(user['lvl_points']) + '\nWAS pogs = ' + str(
                                       user['pogs']))
                sendm(cwbot, m.chat.id, user['name'] + ' –ø–æ—Ç–µ—Ä—è–ª ' + skillcode + ' –ª–≤–ª–∞ ' + str(plvl))
                if plvl == 2:
                    cwusers.update_one({'id': user['id']}, {'$inc': {'lvl_points': 3}})
                if plvl == 3:
                    cwusers.update_one({'id': user['id']}, {'$inc': {'lvl_points': 12}})
                cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': 1}})
                scrollamount = plvl
                for i in range(scrollamount):
                    objectcode = generate_object_code(user)
                    newscroll = create_undefined_scroll(objectcode, resource_to_name("undefined_scroll"))
                    cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: newscroll}})
                    user = cwusers.find_one({'id': user['id']})
                sendm(cwbot, m.chat.id, 'now skills ' + user['name'] + ' = ' + str(user['skills']))
                sendm(cwbot, m.chat.id,
                                   'now equipped skills ' + user['name'] + ' = ' + str(user['equipped_skills']))
                sendm(cwbot, m.chat.id,
                                   'now DNA ' + user['name'] + ' = ' + str(user['lvl_points']) + '\nNOW pogs = ' + str(
                                       user['pogs']))

            for ids in user['inventory']:
                if user['inventory'][ids]['type'] == 'scroll':
                    if user['inventory'][ids]['code'] == skillcode:
                        cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + ids: 1}})
                        objectcode = generate_object_code(user)
                        newscroll = create_undefined_scroll(objectcode, resource_to_name("undefined_scroll"))
                        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: newscroll}})
                        cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': 1}})
                        sendm(cwbot, m.chat.id, user['name'] + ' get undefined scroll')

        sendm(cwbot, m.chat.id, 'End')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['medium_loot'])
def mediumlootgett(m):
    if m.from_user.id != pasyuk_id:
        return
    sendm(cwbot, m.chat.id, '–ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏.')
    try:
        quest = m.text.split(' ')[1]
        if quest not in ["patrol", "rathunt", "duel"]:
            quest = "patrol"
    except:
        quest = "patrol"
    try:
        repeats = int(m.text.split(' ')[2])
    except:
        repeats = 100000
    sum_amount = {}
    for i in range(repeats):
        loot = get_loot_for_quest(quest=quest)
        for ids in loot:
            if ids not in sum_amount:
                sum_amount[ids] = loot[ids]
            else:
                sum_amount[ids] += loot[ids]

    text = '–ö–≤–µ—Å—Ç: ' + quest + '. –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:\n\n'
    for ids in sum_amount:
        medium = sum_amount[ids] / repeats
        text += resource_to_name(ids) + ': ' + str(medium) + '\n'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(commands=['giveresource'])
def giverrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        resource = m.text.split(' ')[2]
        amount = int(m.text.split(' ')[3])
    except:
        return
    try:
        user = cwusers.find_one({'id': id})
        # sendm(cwbot, m.chat.id, str(user))
        if resource in user['resources']:
            cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + resource: amount}})
        else:
            cwusers.update_one({'id': user['id']}, {'$set': {'resources.' + resource: amount}})
        sendm(cwbot, m.chat.id, '–†–µ—Å—É—Ä—Å –ø–æ–ª—É—á–µ–Ω.')
    except:
        sendm(cwbot, m.chat.id, traceback.format_exc())


@cwbot.message_handler(commands=['sethpregen'])
def sethpregennn(m):
    if m.from_user.id != pasyuk_id:
        return
    cwusers.update_one({'id': m.from_user.id}, {'$set': {'last_hp_regen': time.time()}})
    sendm(cwbot, m.chat.id, 'Fixed!')


kings = [792414733, 674065123, pasyuk_id, 733334564, 611961761, 1134827568]


def castlewarriorsfunc(m):
    if m.from_user.id not in kings:
        return
    user = cwusers.find_one({'id': m.from_user.id})
    text = '–°–æ—Å—Ç–∞–≤ –≤–æ–∏–Ω–æ–≤ –∑–∞–º–∫–∞ ' + castle_to_name(user['castle']) + ':\n'
    for ids in cwusers.find({'castle': user['castle']}):
        if ids['castle'] == user['castle']:
            name = ids['name']
            try:
                if ids['set_name'] == False:
                    name = '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª(–∞) –∏–≥—Ä–æ–≤–æ–µ –∏–º—è'
            except:
                pass
            uact = get_player_state(ids)
            text += '(' + uact + ') ```' + str(ids['id']) + '``` [' + name + '](tg://user?id=' + str(
                ids['id']) + ') üèÖ' + str(ids['lvl']) + '\n'
    doptext = []
    if len(text) > 3000:
        while len(text) > 3000:
            text1 = text[:3000]
            doptext.append(text1)
            text = text[3000:]
        doptext.append(text)
        for ids in doptext:
            try:
                sendm(cwbot, m.chat.id, ids, parse_mode='markdown')
            except:
                try:
                    sendm(cwbot, m.chat.id, ids)
                except:
                    sendm(cwbot, 441399484, traceback.format_exc())
            time.sleep(3)
        #sendm(cwbot, m.chat.id, text, parse_mode='markdown')
    else:
        sendm(cwbot, m.chat.id, text, parse_mode='markdown')

@cwbot.message_handler(commands=['castle_warriors'])
def castleww(m):
    threading.Thread(target = castlewarriorsfunc, args = [m]).start()


@cwbot.message_handler(commands=['clear_inv'])
def givegolddclearinv(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'inventory': {}, 'resources': {}}})
    except:
        sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞!')
        return
    sendm(cwbot, m.chat.id, '–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –æ—á–∏—â–µ–Ω!')


@cwbot.callback_query_handler(func=lambda call: not is_user_registered(call))
def calls_from_unregistered_user(call):
    return


@cwbot.message_handler(func=lambda m: not is_user_registered(m))
def msgs_from_notreg_user(m):
    if m.text not in ["üê≠–ö—Ä—ã—Å–∏–Ω—ã–π –∑–∞–º–æ–∫", "üëÅ–ó–∞–º–æ–∫ —Ç—å–º—ã", "üñ§–ó–∞–º–æ–∫ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞", "üíÆ–ó–∞–º–æ–∫ –º–∞–≥–∏–∏ –≤–∑—Ä—ã–≤–æ–≤"]:
        kb = get_castle_kb()
        sendm(cwbot, m.chat.id,
                           '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç–µ —Å—Ä–∞–∂–∞—Ç—å—Å—è: (—ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä—ã, –ø–æ—Ç–æ–º –∑–∞–º–æ–∫ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å)',
                           reply_markup=kb)
        return
    if m.text == "üê≠–ö—Ä—ã—Å–∏–Ω—ã–π –∑–∞–º–æ–∫":
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'castle': 'rat'}})
    if m.text == "üëÅ–ó–∞–º–æ–∫ —Ç—å–º—ã":
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'castle': 'darkcastle'}})
    if m.text == "üñ§–ó–∞–º–æ–∫ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞":
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'castle': 'necromant'}})
    if m.text == "üíÆ–ó–∞–º–æ–∫ –º–∞–≥–∏–∏ –≤–∑—Ä—ã–≤–æ–≤":
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'castle': 'explosion'}})
    kb = types.ReplyKeyboardRemove()
    sendm(cwbot, m.chat.id,
                       '–¢–µ–ø–µ—Ä—å –≤—ã –∂–∏–≤–µ—Ç–µ –∏ —Å—Ä–∞–∂–∞–µ—Ç–µ—Å—å –∑–∞ ' + m.text + '. –ù–∞–±–∏—Ä–∞–π—Ç–µ—Å—å –æ–ø—ã—Ç–∞ –∏ —Å–∏–ª, —á—Ç–æ–±—ã –æ–¥–æ–ª–µ—Ç—å –≤—Ä–∞–≥–∞! –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –≤–æ–∏–Ω–µ - /me.',
                       reply_markup=kb)


def is_user_setname(m):
    user = cwusers.find_one({'id': m.from_user.id})
    try:
        if user['set_name'] == False:
            return True
    except:
        cwusers.update_one({'id': m.from_user.id}, {'$set': {'set_name': False}})
        return True
    return False

@cwbot.message_handler(commands=['resetname'])
def setnnname(m):
    if m.from_user.id != 441399484:
        return
    try:
        target = int(m.text.split(' ')[1])
    except:
        sendm(cwbot, m.chat.id, '–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã: /resetname 748752225')
        return
    cwusers.update_one({'id':target},{'$set':{'set_name':False}})
    sendm(cwbot, m.chat.id, '–°–±—Ä–æ—à–µ–Ω–æ –∏–º—è –¥–ª—è '+str(target))

@cwbot.message_handler(commands=['setname'])
def setnnname(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['set_name'] != False:
        sendm(cwbot, m.chat.id, '–í—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å–µ–±–µ –∏–≥—Ä–æ–≤–æ–µ –∏–º—è!')
        return
    try:
        newname = m.text.split('/setname ')[1]
    except:
        sendm(cwbot, m.chat.id, '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞! –ü—Ä–∏–º–µ—Ä:\n/setname –ò–≤–∞–Ω')
        return
    allowsymb = [' ', '–∞', '–±', '–≤', '–≥', '–¥', '–µ', '—ë', '–∂', '–∑', '–∏', '–π', '–∫', '–ª', '–º', '–Ω', '–æ', '–ø', '—Ä', '—Å',
                 '—Ç', '—É', '—Ñ', '—Ö', '—Ü', '—á', '—à', '—â',
                 '—ä', '—ã', '—å', '—ç', '—é', '—è', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
                 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']
    adds = []
    for ids in allowsymb:
        if ids != ' ':
            adds.append(ids.capitalize())
    for ids in adds:
        allowsymb.append(ids)
    for ids in newname:
        if ids not in allowsymb:
            sendm(cwbot, m.chat.id, '–í –Ω–∏–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã, –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –∏ –ø—Ä–æ–±–µ–ª—ã!')
            return
    if len(newname) > 25:
        sendm(cwbot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∏–∫–∞ - 25 —Å–∏–º–≤–æ–ª–æ–≤!')
        return
    for ids in cwusers.find({}):
        if ids['name'] == newname and ids['set_name']:
            sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–µ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!')
            return
    cwusers.update_one({'id': m.from_user.id}, {'$set': {'name': newname, 'set_name': True}})
    kb = main_menu_kb()
    sendm(cwbot, m.chat.id, '–¢–µ–ø–µ—Ä—å –≤–∞—Å –±—É–¥—É—Ç –Ω–∞–∑—ã–≤–∞—Ç—å ' + newname + '!', reply_markup=kb)
    l = '–û—à–∏–±–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ü–∞—Å—é–∫—É.'
    if user['castle'] == 'rat':
        l = ratslink
    if user['castle'] == 'darkcastle':
        l = darklink
    if user['castle'] == 'necromant':
        l = necromantlink
    if user['castle'] == 'explosion':
        l = explosionlink
    sendm(cwbot, m.chat.id,
                       '–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à –∑–∞–º–∫–æ–≤—ã–π —á–∞—Ç: ' + l + '. –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—â–∏–π —á–∞—Ç - @Veganochatwars. –ö–∞–Ω–∞–ª —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –±–æ—Ç–∞ - @Veganochatwars_updates.')


@cwbot.message_handler(func=lambda m: is_user_setname(m))
def msgs_from_notregname_user(m):
    sendm(cwbot, m.chat.id, '–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∂–∏–∑–Ω–∏ –≤ –∑–∞–º–∫–µ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–µ–±–µ –∏–º—è –∫–æ–º–∞–Ω–¥–æ–π /setname!')
    return


@cwbot.message_handler(commands=['referal'])
def reffff(m):
    ref = str(m.from_user.id)
    sendm(cwbot, m.chat.id,
                       '–í–æ—Ç –≤–∞—à–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π:\n' + 'https://telegram.me/Veganochatwars_bot?start=' + ref + '\n\n–ï—Å–ª–∏ –ø–µ—Ä–µ—à–µ–¥—à–∏–π –ø–æ —Å—Å—ã–ª–∫–µ –∏–≥—Ä–æ–∫ ' + \
                       '–ø–æ–ª—É—á–∞–µ—Ç 5, 10 –∏ 15 —É—Ä–æ–≤–Ω–∏ - –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +1 —Å—Ç–∞–º–∏–Ω—ã –∑–∞ –∫–∞–∂–¥—ã–π!')


def is_castle_fight():
    current_datetime = datetime.now()
    if current_datetime.hour in [22, 6, 14]:
        if current_datetime.minute in [0, 1]:
            return True
    return False


def is_battle_near():
    current_datetime = datetime.now()
    if current_datetime.hour in [21, 5, 13]:
        if current_datetime.minute >= 52:
            return True
    return False


@cwbot.message_handler(func=lambda m: is_castle_fight())
def castlefightnoww(m):
    text = '–í–µ—Ç–µ—Ä –≤–æ–µ—Ç –Ω–∞ –ª—É–≥–∞—Ö, –≤ –∑–∞–º–∫–∞—Ö –Ω–µ–ø—Ä–∏–≤—ã—á–Ω–æ —Ç–∏—Ö–æ. –í–æ–∏–Ω—ã –∑–∞–ª–µ—á–∏–≤–∞—é—Ç —Å–≤–æ–∏ —Ä–∞–Ω—ã –∏ —á–∏–Ω—è—Ç –¥–æ—Å–ø–µ—Ö–∏ –ø–æ—Å–ª–µ ' + \
           '—É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–æ–≥–æ –±–æ—è. –í—Å–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –∏ –≤–æ—Ä–æ—Ç–∞ –∑–∞–º–∫–∞ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ –ø–∞—Ä—É –º–∏–Ω—É—Ç. –û–±—Å—É–¥–∏—Ç—å –±–æ–π –º–æ–∂–Ω–æ –≤ @Veganochatwars. –ö–∞–Ω–∞–ª –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Å ' + \
           '–æ—Ç—á–µ—Ç–∞–º–∏ –±–∏—Ç–≤ - @Veganochatwars_reports.'
    sendm(cwbot, m.chat.id, text)


def is_attack_message(m):
    if m.text == "üó°–ê—Ç–∞–∫–∞":
        return True
    return False


def is_def_message(m):
    if m.text == "üõ°–ó–∞—â–∏—Ç–∞":
        return True
    return False


@cwbot.message_handler(commands=['castlelink'])
def castlelinkk(m):
    user = cwusers.find_one({'id': m.from_user.id})
    l = '–û—à–∏–±–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ü–∞—Å—é–∫—É.'
    if user['castle'] == 'rat':
        l = ratslink
    if user['castle'] == 'darkcastle':
        l = darklink
    if user['castle'] == 'necromant':
        l = necromantlink
    if user['castle'] == 'explosion':
        l = explosionlink
    sendm(cwbot, m.chat.id,
                       '–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à –∑–∞–º–∫–æ–≤—ã–π —á–∞—Ç: ' + l + '. –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—â–∏–π —á–∞—Ç - @Veganochatwars. –ö–∞–Ω–∞–ª —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –±–æ—Ç–∞ - @Veganochatwars_updates.')


@cwbot.message_handler(func=lambda m: is_attack_message(m))
def atkkk(m):
    user = cwusers.find_one({'id': m.from_user.id})
    attackkb = get_castle_kb(not_give=user['castle'])
    sendm(cwbot, m.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫ –¥–ª—è –∞—Ç–∞–∫–∏:', reply_markup=attackkb)


@cwbot.message_handler(commands=['clear_castle'])
def delacc(m):
    return
    if m.from_user.id != pasyuk_id:
        return
    cwusers.delete_one({'id': m.from_user.id})
    sendm(cwbot, m.chat.id, 'Account removed.')


@cwbot.message_handler(commands=['clear_lvl'])
def delaclvlc(m):
    # return
    if m.from_user.id != pasyuk_id:
        return
    cwusers.update_one({'id': m.from_user.id}, {'$set': {'lvl': 1, 'exp': 0}})
    sendm(cwbot, m.chat.id, 'Account reset.')


@cwbot.message_handler(commands=['giveexp'])
def giveexppp(m):
    # return
    if m.from_user.id != pasyuk_id:
        return
    try:
        exp = int(m.text.split(' ')[1])
    except:
        return
    cwusers.update_one({'id': m.from_user.id}, {'$inc': {'exp': exp}})
    user = cwusers.find_one({'id': m.from_user.id})
    check_lvlup(user)
    sendm(cwbot, m.chat.id, 'ADD ' + str(exp) + ' exp.')


def get_time_to_battle():
    lastbattletime = last_castle_fight['time']
    nextbattletime = lastbattletime + 8 * 60 * 60
    secs = nextbattletime - time.time()
    mins = 0
    hours = 0
    while secs >= 60:
        secs -= 60
        mins += 1
    while mins >= 60:
        mins -= 60
        hours += 1
    if hours > 0:
        text = str(hours) + '—á ' + str(mins) + '–º'
    else:
        text = str(mins) + '–º'
    if mins == 0 and hours == 0:
        text = '–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥'
    return text


@cwbot.message_handler(func=lambda m: is_def_message(m))
def deffffff(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['current_act'] in busy_acts:
        sendm(cwbot, m.chat.id, '–í—ã —Å–µ–π—á–∞—Å —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å.')
        return
    cwusers.update_one({'id': m.from_user.id}, {'$set': {'current_act': 'def'}})
    # kb = types.ReplyKeyboardRemove()
    kb = main_menu_kb()
    battletime = get_time_to_battle()
    sendm(cwbot, m.chat.id, '–í—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏—Å—å –∫ –∑–∞—â–∏—Ç–µ –∑–∞–º–∫–∞. –ë–∏—Ç–≤–∞ —á–µ—Ä–µ–∑ ' + battletime + '!', reply_markup=kb)


def check_castle_attack(m):
    if m.text == None:
        return False
    if m.text in ["üê≠–ö—Ä—ã—Å–∏–Ω—ã–π –∑–∞–º–æ–∫", "üëÅ–ó–∞–º–æ–∫ —Ç—å–º—ã", "üñ§–ó–∞–º–æ–∫ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞", "üíÆ–ó–∞–º–æ–∫ –º–∞–≥–∏–∏ –≤–∑—Ä—ã–≤–æ–≤"]:
        return True
    return False


@cwbot.message_handler(func=lambda m: check_castle_attack(m))
def select_castle_attack(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['current_act'] in busy_acts:
        sendm(cwbot, m.chat.id, '–í—ã —Å–µ–π—á–∞—Å —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å.')
        return
    castle = name_to_castle(m.text)
    if castle == user['castle']:
        sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è –∞—Ç–∞–∫–æ–≤–∞—Ç—å —Å–≤–æ–π –∑–∞–º–æ–∫!')
        return
    cwusers.update_one({'id': m.from_user.id}, {'$set': {'attack_target': castle, 'current_act': 'attack'}})
    # kb = types.ReplyKeyboardRemove()
    kb = main_menu_kb()
    battletime = get_time_to_battle()
    sendm(cwbot, m.chat.id, '–í—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏—Å—å –∫ –∞—Ç–∞–∫–µ –Ω–∞ ' + m.text + '. –ë–∏—Ç–≤–∞ —á–µ—Ä–µ–∑ ' + battletime + '!',
                       reply_markup=kb)


@cwbot.message_handler(func=lambda m: m.text == "/special_ability")
def specialcastleabil(m):
    user = cwusers.find_one({'id': m.from_user.id})
    text = 'None'
    if user['lvl'] < 8:
        return
    if user['castle'] == 'explosion':
        text = "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–º–∫–∞ üíÆ–º–∞–≥–∏–∏ –≤–∑—Ä—ã–≤–æ–≤ - EXPLOSIOOOOOOOON!\n\n–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –º–µ—Å—Ç–æ –¥–ª—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π. –í –Ω–∞—á–∞–ª–µ –±–æ—è –∑–∞–º–∫–æ–≤ –≤—ã "+\
            "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–∞–≥–∏—é –≤–∑—Ä—ã–≤–æ–≤ –Ω–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞, –Ω–∞–Ω–æ—Å—è 100 —É—Ä–æ–Ω–∞ –∏ –ø–æ–¥–∂–∏–≥–∞—è —Ü–µ–ª—å –Ω–∞ 100. –î–æ –∫–æ–Ω—Ü–∞ –º–∞—Ç—á–∞ –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂ –±—É–¥–µ—Ç –æ–≥–ª—É—à–µ–Ω.\n\n"+\
            "–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–æ—è - /use_explosion. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑ –≤ 24 —á–∞—Å–∞."
    elif user['castle'] == "rat":
        text = "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å üê≠–∫—Ä—ã—Å–∏–Ω–æ–≥–æ –∑–∞–º–∫–∞ - –∫—Ä—ã—Å–∏–Ω–∞—è —Å—Ç–∞—è\n\n–í–º–µ—Å—Ç–µ —Å –≤–∞–º–∏ –≤ —Å–ª–µ–¥—É—é—â—É—é –±–∏—Ç–≤—É –∑–∞–º–∫–æ–≤ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å—Ä–∞–∂–∞—Ç—å—Å—è —Å–ª—É—á–∞–π–Ω–∞—è "+\
               "–∫—Ä—ã—Å–∞ –∏–∑ –∫—Ä—ã—Å–∏–Ω–æ–≥–æ –ª–æ–≥–æ–≤–∞ –≤–∞—à–µ–≥–æ —É—Ä–æ–≤–Ω—è. –≠—Ç–∞ –∫—Ä—ã—Å–∞ –Ω–µ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å –≤ –±–æ–π –º–µ—á –∏–ª–∏ –ø–∏—Å—Ç–æ–ª–µ—Ç.\n\n–ü—Ä–∏–∑–≤–∞—Ç—å –∫—Ä—ã—Å—É - /summon_rat. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑ –≤ 24 —á–∞—Å–∞."
    elif user['castle'] == "necromant":
        text = "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–º–∫–∞ üñ§–Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ - –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ –º–µ—Ä—Ç–≤—ã—Ö.\n\n–ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–ª–æ–∂–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –±–∏—Ç–≤—É –∑–∞–º–∫–æ–≤ –ø—Ä–æ–∫–ª—è—Ç—å–µ, "+\
               "–≤–æ—Å–∫—Ä–µ—à–∞—é—â–µ–µ –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –≤–æ–∏–Ω–æ–≤ –≤ –≤–∏–¥–µ —Å–∫–µ–ª–µ—Ç–æ–≤ —Å —É—Ä–æ–Ω–æ–º 1-3 –∏ —Å 2 –∑–æ–º–±–∏-—Ö–æ–¥–æ–º. –°–∫–µ–ª–µ—Ç—ã –≤–æ—Å—Å—Ç–∞—é—Ç –≤ –±–ª–∏–∂–Ω–µ–º –±–æ—é —Å–æ –≤—Å–µ–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏. "+\
               "–ó–∞ –∫–∞–∂–¥–æ–µ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ª–æ–∂–µ–Ω–Ω–æ–µ –ø—Ä–æ–∫–ª—è—Ç—å–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ "+\
               "–≤–æ—Å–∫—Ä–µ—à–∞–µ–º—ã—Ö –≤–æ–∏–Ω–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1. –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π –≤–æ—Å—Å—Ç–∞–≤—à–∏–π —Å–∫–µ–ª–µ—Ç –∂–∏–≤–µ—Ç –Ω–∞ —Ö–æ–¥ –¥–æ–ª—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ."+\
               "–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑ –≤ 24 —á–∞—Å–∞.\n\n"+\
               "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å - /use_reborn."
    elif user['castle'] == "darkcastle":
        text = "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–º–∫–∞ üëÅ—Ç—å–º—ã - –ø—Ä–∏–∑—ã–≤ –¥–µ–º–æ–Ω–∞ —Ç—å–º—ã.\n\n–í—Å–µ, –∫—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª —ç—Ç—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å, –≤ —Å–ª–µ–¥—É—é—â–µ–π –±–∏—Ç–≤–µ –∑–∞–º–∫–æ–≤ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è –∏ –ø—Ä–∏–∑—ã–≤–∞—é—Ç –¥–µ–º–æ–Ω–∞ —Ç—å–º—ã, "+\
            "—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —É—Ä–æ–≤–Ω—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π, –≤–∑—è—Ç—ã—Ö –∏–≥—Ä–æ–∫–∞–º–∏, –∞ —Ç–∞–∫ –∂–µ –æ—Ç —É—Ä–æ–≤–Ω—è –∏—Ö –æ—Ä—É–∂–∏—è –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.\n\n"+\
               "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å - /use_dark. –ú–æ–∂–Ω–æ "+\
            "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑ –≤ 24 —á–∞—Å–∞."
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: m.text == "/summon_rat")
def specialcastleabil_userat(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['castle'] != 'rat':
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ —É–º–µ–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ!')
        return
    if user['lvl'] < 8:
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ! –°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 8–≥–æ —É—Ä–æ–≤–Ω—è.')
        return
    try:
        if time.time() - user['last_summon_rat'] < 60*60*24:
            sendm(cwbot, m.chat.id, '–≠—Ç—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏!')
            return
    except:
        pass
    cwusers.update_one({'id': user['id']}, {'$set': {'summon_castlefight_rat': True, 'last_summon_rat':time.time()}})

    sendm(cwbot, m.chat.id, '‚úÖ–í —Å–ª–µ–¥—É—é—â–µ–π –±–∏—Ç–≤–µ –≤—ã –ø–æ–∑–æ–≤–µ—Ç–µ –Ω–∞ –ø–æ–º–æ—â—å –∫—Ä—ã—Å—É –∏–∑ –ª–æ–≥–æ–≤–∞.')

@cwbot.message_handler(func=lambda m: m.text == "/use_dark")
def specialcastleabil_userat(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['castle'] != 'darkcastle':
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ —É–º–µ–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ!')
        return
    if user['lvl'] < 8:
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ! –°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 8–≥–æ —É—Ä–æ–≤–Ω—è.')
        return
    try:
        if time.time() - user['last_dark_demon'] < 60*60*24:
            sendm(cwbot, m.chat.id, '–≠—Ç—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏!')
            return
    except:
        pass
    cwusers.update_one({'id': user['id']}, {'$set': {'summon_dark_demon': True, 'last_dark_demon':time.time()}})

    sendm(cwbot, m.chat.id, '‚úÖ–í —Å–ª–µ–¥—É—é—â–µ–π –±–∏—Ç–≤–µ –≤—ã –ø—Ä–∏–∑–æ–≤–µ—Ç–µ –¥–µ–º–æ–Ω–∞ —Ç—å–º—ã.')


@cwbot.message_handler(func=lambda m: m.text == "/use_reborn")
def specialcastleabil_userat(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['castle'] != 'necromant':
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ —É–º–µ–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ!')
        return
    if user['lvl'] < 8:
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ! –°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 8–≥–æ —É—Ä–æ–≤–Ω—è.')
        return


    try:
        if time.time() - user['last_necromant_reborn'] < 60*60*24:
            sendm(cwbot, m.chat.id, '–≠—Ç—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏!')
            return
    except:
        pass
    cwusers.update_one({'id': user['id']}, {'$set': {'necromant_reborn_buff':True, 'last_necromant_reborn':time.time()}})
    sendm(cwbot, m.chat.id, '‚úÖ–í —Å–ª–µ–¥—É—é—â–µ–π –±–∏—Ç–≤–µ –≤—ã –Ω–∞–ª–æ–∂–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ –±–æ—è –ø—Ä–æ–∫–ª—è—Ç—å–µ –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞.')

@cwbot.message_handler(func=lambda m: m.text == "/use_rat")
def specialcastleabil_userat(m):
    return
    user = cwusers.find_one({'id': m.from_user.id})
    if user['castle'] != 'rat':
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ —É–º–µ–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ!')
        return
    if user['lvl'] < 8:
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ! –°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 8–≥–æ —É—Ä–æ–≤–Ω—è.')
        return
    try:
        user['personal_rat']
    except:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∏—Ä—É—á–µ–Ω–Ω–æ–π –∫—Ä—ã—Å—ã!')
        return
    cwusers.update_one({'id':user['id']},{'$set':{'use_rat_castlefight':True}})
    sendm(cwbot, m.chat.id, '‚úÖ–í—ã –≤–æ–∑—å–º–µ—Ç–µ –∫—Ä—ã—Å—É –≤ —Å–ª–µ–¥—É—é—â–∏–π –±–æ–π –∑–∞–º–∫–æ–≤!')

@cwbot.message_handler(func=lambda m: m.text == "/craft_toy")
def specialcastleabil_createratdoll(m):
    return
    user = cwusers.find_one({'id': m.from_user.id})
    if user['castle'] != 'rat':
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ —É–º–µ–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ!')
        return
    if user['lvl'] < 8:
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ! –°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 8–≥–æ —É—Ä–æ–≤–Ω—è.')
        return
    materials = {
        'diamonds':1,
        'wood':15,
        'plastic':15,
        'rope':10
    }

    allow = True
    for ids in materials:
        try:
            if user['resources'][ids] < materials[ids]:
                allow = False
                break
        except:
            allow = False
            break
    if not allow:
        sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!')
        return
    try:
        user['resources']['rat_toys']
        cwusers.update_one({'id':user['id']},{'$inc':{'resources.rat_toys':1}})
    except:
        cwusers.update_one({'id': user['id']}, {'$set': {'resources.rat_toys': 1}})
    for ids in materials:
        cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + ids: -materials[ids]}})

    sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Å–∫—Ä–∞—Ñ—Ç–∏–ª–∏ –∏–≥—Ä—É—à–∫—É –¥–ª—è –∫—Ä—ã—Å!')


@cwbot.message_handler(func=lambda m: m.text == "/use_explosion")
def specialcastleabil_explos(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['castle'] != 'explosion':
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ —É–º–µ–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ!')
        return
    if user['lvl'] < 8:
        sendm(cwbot, m.chat.id, '–í—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ! –°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 8–≥–æ —É—Ä–æ–≤–Ω—è.')
        return
    try:
        if time.time() - user['last_explosion_use'] < 60*60*24:
            sendm(cwbot, m.chat.id, '–≠—Ç—É —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏!')
            return
    except:
        pass
    cwusers.update_one({'id':user['id']},{'$set':{'next_battle_explosion':True, 'last_explosion_use':time.time()}})
    sendm(cwbot, m.chat.id, '‚úÖ–í —Å–ª–µ–¥—É—é—â–µ–º –±–æ—é –≤—ã –≤–æ–∑—å–º–µ—Ç–µ –ø–æ—Å–æ—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–∞–≥–∏—é –≤–∑—Ä—ã–≤–æ–≤.')


@cwbot.message_handler(commands=['score'])
def scoreee(m):
    x = allcastles.find_one({})
    text = '–û—á–∫–∏ –∑–∞–º–∫–æ–≤:\n\n'
    text += '*' + castle_to_name('rat') + '*: üèÜ' + str(x['rat']['score']) + ' –æ—á–∫–æ–≤\n'
    text += '*' + castle_to_name('darkcastle') + '*: üèÜ' + str(x['darkcastle']['score']) + ' –æ—á–∫–æ–≤\n'
    text += '*' + castle_to_name('necromant') + '*: üèÜ' + str(x['necromant']['score']) + ' –æ—á–∫–æ–≤\n'
    text += '*' + castle_to_name('explosion') + '*: üèÜ' + str(x['explosion']['score']) + ' –æ—á–∫–æ–≤\n'
    sendm(cwbot, m.chat.id, text, parse_mode='markdown')


def get_player_state(user):
    act = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
    if user['current_act'] == None:
        act = 'üõå–û—Ç–¥—ã—Ö'
    elif user['current_act'] == 'attack':
        act = 'üó°–ê—Ç–∞–∫–∞ ' + castle_to_name(user['attack_target'])
    elif user['current_act'] == 'def':
        act = 'üõ°–ó–∞—â–∏—Ç–∞ ' + castle_to_name(user['castle'])
    elif user['current_act'] == 'quest_rathunt':
        act = 'üê≠–ë–∏—Ç–≤–∞ —Å –∫—Ä—ã—Å–æ–π'
    elif user['current_act'] == 'quest_noise_check':
        act = 'ü™ì–°—Ä–∞–∂–µ–Ω–∏–µ —Å –≤—Ä–∞–∂–µ—Å–∫–∏–º –±–æ–π—Ü–æ–º'
    elif user['current_act'] == 'troll':
        act = 'üëπ–ü—Ä–æ–≥—É–ª–∫–∞ –¥–æ –ª–æ–≥–æ–≤–∞ —Ç—Ä–æ–ª–ª—è'
    elif user['current_act'] == 'wait_help':
        act = 'üëπ–í –ø–ª–µ–Ω—É —É —Ç—Ä–æ–ª–ª—è, –æ–∂–∏–¥–∞–µ—Ç–µ –ø–æ–º–æ—â–∏'
    elif user['current_act'] == 'quest_castle_protect':
        mins = 0
        secs_passed = time.time() - user['quest_started']
        secs_remained = 180 - secs_passed
        while secs_remained >= 60:
            mins += 1
            secs_remained -= 60
        if mins == 0:
            act = 'ü•æ–ü–∞—Ç—Ä—É–ª—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π. –í–µ—Ä–Ω—ë—Ç–µ—Å—å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.'
        else:
            act = 'ü•æ–ü–∞—Ç—Ä—É–ª—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π. –í–µ—Ä–Ω—ë—Ç–µ—Å—å —á–µ—Ä–µ–∑ ' + str(mins) + ' –º–∏–Ω—É—Ç—ã.'
    return act


def main_menu_kb():
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add(types.KeyboardButton("üó°–ê—Ç–∞–∫–∞"), types.KeyboardButton("üõ°–ó–∞—â–∏—Ç–∞"), types.KeyboardButton("üó∫–ö–≤–µ—Å—Ç—ã"))
    kb.add(types.KeyboardButton("üèÖ–ü—Ä–æ—Ñ–∏–ª—å"), types.KeyboardButton("üì¶–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å"), types.KeyboardButton("üè∞–ó–∞–º–æ–∫"))
    kb.add(types.KeyboardButton("üß¨–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"), types.KeyboardButton("üí£–ü—Ä–µ–¥–º–µ—Ç—ã"))
    return kb


def get_profile_text(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user == None:
        return "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!"
    text = ''
    text += '‚ùóÔ∏è–ë–∏—Ç–≤–∞ —á–µ—Ç—ã—Ä–µ—Ö –∑–∞–º–∫–æ–≤ —á–µ—Ä–µ–∑ ' + get_time_to_battle() + '!\n\n'
    text += user['name'] + ', –≤–æ–∏–Ω ' + castle_to_name(user['castle']) + '\n'
    text += 'üèÖ–£—Ä–æ–≤–µ–Ω—å: ' + str(user['lvl']) + '\n'
    text += 'üß¨–û—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤: ' + str(user['lvl_points']) + ' (/lvlup)\n'
    dopexpfornextlvl = lvltable[user['lvl']]['expfornextlvl']
    totalexp = lvltable[user['lvl']]['totalexp']
    diff = dopexpfornextlvl
    earned = user['exp'] - totalexp
    perc = (earned / diff) * 100
    perc = round(perc, 2)
    text += 'üî•–û–ø—ã—Ç: ' + str(int(user['exp'])) + '/' + str(int(totalexp + dopexpfornextlvl)) + ' ' + str(perc) + '%\n'
    text += ''
    text += 'üí∞' + str(user['gold']) + ' üëù' + str(user['pogs']) + '\n'
    secsfromstamina = time.time() - user['last_stamina_regen']
    needtime = 3600
    if user['current_act'] == None:
        if 'goodsleep' in user['equipped_skills']:
            if user['equipped_skills']['goodsleep']['lvl'] == 1:
                needtime -= 300
            if user['equipped_skills']['goodsleep']['lvl'] == 2:
                needtime -= 600
            if user['equipped_skills']['goodsleep']['lvl'] == 3:
                needtime -= 900
    secs = needtime - secsfromstamina
    mins = 0
    while secs >= 60:
        secs -= 60
        mins += 1
    if mins > 0:
        timefromstamina = str(mins) + "–º–∏–Ω."
    else:
        timefromstamina = '—Å–µ–π—á–∞—Å'
    timefromstamina = ' ‚è∞' + timefromstamina
    if user['stamina'] == user['maxstamina']:
        timefromstamina = ""

    secsfromhp = time.time() - user['last_hp_regen']
    secs = 600 - secsfromhp
    mins = 0
    while secs >= 60:
        secs -= 60
        mins += 1
    if mins > 0:
        timefromhp = str(mins) + "–º–∏–Ω."
    else:
        timefromhp = '—Å–µ–π—á–∞—Å'
    timefromhp = ' ‚è∞' + timefromhp
    if user['hp'] == user['maxhp']:
        timefromhp = ""

    text += 'üîã–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å: ' + str(user['stamina']) + '/' + str(user['maxstamina']) + timefromstamina + '\n'
    text += '‚ô•Ô∏è' * user['hp'] + '|–•–ü: ' + str(user['hp']) + '/' + str(user['maxhp']) + timefromhp + '\n'
    weapontext = ''
    dopwtext = ''
    if user['weapon'] == None:
        weapontext = '–ö—É–ª–∞–∫–∏ lvl.1'
    else:
        weapontext = user['weapon']['name'] + ' lvl.' + str(user['weapon']['lvl'])
        dopwtext = ' (—Å–Ω—è—Ç—å - /woff_' + user['weapon']['objectcode'] + ')'
    text += '‚öîÔ∏è–û—Ä—É–∂–∏–µ: ' + weapontext + dopwtext + '\n'
    act = get_player_state(user)
    text += '–°–æ—Å—Ç–æ—è–Ω–∏–µ:\n' + act + '\n'
    try:
        if user['next_battle_explosion']:
            text += 'üíÆ–°–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–≥–∏—é –≤–∑—Ä—ã–≤–æ–≤ –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–æ—é.\n'
    except:
        pass
    try:
        if user['summon_castlefight_rat']:
            text += 'üê≠–°–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤–∑—è—Ç—å –∫—Ä—ã—Å—É –≤ —Å–ª–µ–¥—É—é—â–∏–π –±–æ–π.\n'
    except:
        pass
    try:
        if user['necromant_reborn_buff']:
            text += 'üñ§–°–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –Ω–∞–ª–æ–∂–∏—Ç—å –ø—Ä–æ–∫–ª—è—Ç—å–µ –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–ª–µ –±–æ—è.\n'
    except:
        pass
    try:
        if user['summon_dark_demon']:
            text += 'üëÅ–°–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å —Å–æ–±–æ–π –¥–ª—è –ø—Ä–∏–∑—ã–≤–∞ –¥–µ–º–æ–Ω–∞ –¢—å–º—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–æ—é.\n'
    except:
        pass
    if user['lvl'] >= 8:
        text += '‚ùì–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞—Å–æ–≤–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: /special_ability\n'
    return text


@cwbot.message_handler(func=lambda m: m.text[:6] == '/woff_')
def wofff(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['weapon'] == None:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ä—É–∂–∏—è!')
        return
    weapon = user['weapon']
    objectcode = weapon['objectcode']
    cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: weapon, 'weapon': None}})
    sendm(cwbot, m.chat.id, '–í—ã —Å–Ω—è–ª–∏ —Ç–µ–∫—É—â–µ–µ –æ—Ä—É–∂–∏–µ!')


@cwbot.message_handler(commands=['me'])
def cwme(m):
    text = get_profile_text(m)
    kb = main_menu_kb()
    sendm(cwbot, m.chat.id, text, reply_markup=kb)


@cwbot.message_handler(func=lambda m: is_profile_message(m))
def profilemsggg(m):
    text = get_profile_text(m)
    kb = main_menu_kb()
    sendm(cwbot, m.chat.id, text, reply_markup=kb)
    user = cwusers.find_one({'id':m.from_user.id})
    try:
        if not user['know_about_ability'] and user['lvl'] >= 8:
            sendm(cwbot, user['id'],
                       '–í—ã —Å—Ç–∞–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –º–∞—Å—Ç–µ—Ä–∞ –≤–∞—à–µ–≥–æ –∑–∞–º–∫–∞ –æ–±—É—á–∏–ª–∏ –≤–∞—Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –∏–∑–≤–µ—Å—Ç–Ω–æ–π —Ç–æ–ª—å–∫–æ –∏–º. ' + \
                       "–í–∞—Å –æ—Ç–≤–µ–ª–∏ –≤ –ø–æ–º–µ—â–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–∞—Å –≤—Å—Ç—Ä–µ—Ç–∏–ª –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, –ª–∏—Ü–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –¥–∞–∂–µ –Ω–µ –º–æ–≥–ª–∏ —Ä–∞–∑–≥–ª—è–¥–µ—Ç—å. " + \
                       "–í—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –≤—ã—Å–ª—É—à–∞–ª–∏ –≤—Å–µ —Ç–æ, —á—Ç–æ –æ–Ω –≤–∞–º —Ä–∞—Å—Å–∫–∞–∑–∞–ª...\n\n" + \
                       "–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∑–Ω–∞–ª–∏ - /special_ability")
            cwusers.update_one({'id':user['id']},{'$set':{'know_about_ability':True}})
    except:
        if user['lvl'] >= 8:
            sendm(cwbot, user['id'],
                               '–í—ã —Å—Ç–∞–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –º–∞—Å—Ç–µ—Ä–∞ –≤–∞—à–µ–≥–æ –∑–∞–º–∫–∞ –æ–±—É—á–∏–ª–∏ –≤–∞—Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –∏–∑–≤–µ—Å—Ç–Ω–æ–π —Ç–æ–ª—å–∫–æ –∏–º. ' + \
                               "–í–∞—Å –æ—Ç–≤–µ–ª–∏ –≤ –ø–æ–º–µ—â–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–∞—Å –≤—Å—Ç—Ä–µ—Ç–∏–ª –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, –ª–∏—Ü–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –¥–∞–∂–µ –Ω–µ –º–æ–≥–ª–∏ —Ä–∞–∑–≥–ª—è–¥–µ—Ç—å. " + \
                               "–í—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –≤—ã—Å–ª—É—à–∞–ª–∏ –≤—Å–µ —Ç–æ, —á—Ç–æ –æ–Ω –≤–∞–º —Ä–∞—Å—Å–∫–∞–∑–∞–ª...\n\n" + \
                               "–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∑–Ω–∞–ª–∏ - /special_ability")
            cwusers.update_one({'id': user['id']}, {'$set': {'know_about_ability': True}})


def is_profile_message(m):
    if m.text == "üèÖ–ü—Ä–æ—Ñ–∏–ª—å":
        return True
    return False


def is_quest_message(m):
    if m.text == "üó∫–ö–≤–µ—Å—Ç—ã":
        return True
    return False


def is_castle_message(m):
    if m.text == "üè∞–ó–∞–º–æ–∫":
        return True
    return False


def is_shop_message(m):
    if m.text == "üèö–ú–∞–≥–∞–∑–∏–Ω":
        return True
    return False


def is_scrolls_message(m):
    if m.text == "üìú–°–≤–∏—Ç–∫–∏":
        return True
    return False

def is_class_message(m):
    if m.text == "‚≠êÔ∏è–ö–ª–∞—Å—Å":
        return True
    return False



def is_weapons_message(m):
    if m.text == "‚öôÔ∏è–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ":
        return True
    return False


def is_inventory_message(m):
    if m.text == "üì¶–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å":
        return True
    return False


def is_skills_message(m):
    if m.text == "üß¨–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏":
        return True
    return False


def is_craft_message(m):
    if m.text == "üõ†–ö—Ä–∞—Ñ—Ç":
        return True
    return False


def is_create_weapon_message(m):
    if m.text == "üõ†–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è":
        return True
    return False


def is_upgrade_weapon_message(m):
    if m.text == "üÜô–£–ª—É—á—à–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è":
        return True
    return False


def is_auction_message(m):
    if m.text == "üõé–ê—É–∫—Ü–∏–æ–Ω":
        return True
    return False


def is_scroll_decrypt_message(m):
    if m.text == "üóû‚ùì–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å–≤–∏—Ç–∫–æ–≤":
        return True
    return False


def is_recipe_decrypt_message(m):
    if m.text == "üìì‚ùì–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤":
        return True
    return False


def is_items_message(m):
    if m.text == "üí£–ü—Ä–µ–¥–º–µ—Ç—ã":
        return True
    return False


def is_birzha_message(m):
    if m.text == "‚öñÔ∏è–ë–∏—Ä–∂–∞":
        return True
    return False


def is_bar_message(m):
    if m.text == "üç∫–ë–∞—Ä":
        return True
    return False


def quests_kb(user):
    kb = types.InlineKeyboardMarkup()
    kb.add(types.InlineKeyboardButton(text="ü•æ|–ü–∞—Ç—Ä—É–ª—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π", callback_data="quest_select?castle_protect"),
           types.InlineKeyboardButton(text="üê≠|–ö—Ä—ã—Å–∏–Ω–æ–µ –ª–æ–≥–æ–≤–æ", callback_data="quest_select?rathunt"))

    kb.add(types.InlineKeyboardButton(
        text="üëÄ|–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–Ω—ã–π —à—É–º (" + str(user['noise_check']) + '/' + str(user['max_noise_check']) + ')',
        callback_data="quest_select?noise_check"))
    kb.add(types.InlineKeyboardButton(text="üëπ|–¢—Ä–æ–ª–ª—å –ø–æ–¥ –º–æ—Å—Ç–æ–º", callback_data="quest_select?troll"))
    return kb


def castle_kb():
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add(types.KeyboardButton("üèö–ú–∞–≥–∞–∑–∏–Ω"), types.KeyboardButton("üõ†–ö—Ä–∞—Ñ—Ç"))
    kb.add(types.KeyboardButton("üõé–ê—É–∫—Ü–∏–æ–Ω"), types.KeyboardButton("‚öñÔ∏è–ë–∏—Ä–∂–∞"))
    # kb.add(types.KeyboardButton("üç∫–ë–∞—Ä"))
    kb.add(types.KeyboardButton("üèÖ–ü—Ä–æ—Ñ–∏–ª—å"))
    return kb


def shop_kb():
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add(types.KeyboardButton("üìú–°–≤–∏—Ç–∫–∏"), types.KeyboardButton("‚öôÔ∏è–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ"))
    kb.add(types.KeyboardButton("üóû‚ùì–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å–≤–∏—Ç–∫–æ–≤"), types.KeyboardButton("üìì‚ùì–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤"))
    kb.add(types.KeyboardButton("üèÖ–ü—Ä–æ—Ñ–∏–ª—å"))
    return kb


def is_essence_craft(m):
    if m.text == "üåê–°–æ–∑–¥–∞–Ω–∏–µ \"—Å—É—â–Ω–æ—Å—Ç–µ–π\"":
        return True
    return False

def craft_kb():
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add(types.KeyboardButton("üõ†–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è"), types.KeyboardButton("üÜô–£–ª—É—á—à–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è"))
    kb.add(types.KeyboardButton("üåê–°–æ–∑–¥–∞–Ω–∏–µ \"—Å—É—â–Ω–æ—Å—Ç–µ–π\""))
    kb.add(types.KeyboardButton("üèÖ–ü—Ä–æ—Ñ–∏–ª—å"))
    return kb

def class_to_text(x):
    if x == 'engineer':
        return '–ò–Ω–∂–µ–Ω–µ—Ä'
    if x == 'alchemist':
        return "–ê–ª—Ö–∏–º–∏–∫"
    if x == 'knight':
        return '–†—ã—Ü–∞—Ä—å'
    if x == 'defer':
        return '–ó–∞—â–∏—Ç–Ω–∏–∫'
    if x == 'summoner':
        return '–ü—Ä–∏–∑—ã–≤–∞—Ç–µ–ª—å'

def select_class_kb(user):
    kbs = []
    classes = ['engineer', 'alchemist', 'knight', 'defer', 'summoner']
    for ids in classes:
        kbs.append(types.InlineKeyboardButton(text=class_to_text(ids), callback_data = 'selectclass?'+ids))
    kb = types.InlineKeyboardMarkup()
    kb.add(*kbs)
    return kb

def is_essence_list_kb(m):
    if m.text == 'üîÆ–°–ø–∏—Å–æ–∫ —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞':
        return True
    return False

def essence_kb():
    kb = types.ReplyKeyboardMarkup()
    kb.add("üîÆ–°–ø–∏—Å–æ–∫ —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞")
    kb.add("üèÖ–ü—Ä–æ—Ñ–∏–ª—å")
    return kb

@cwbot.message_handler(func=lambda m: is_essence_list_kb(m))
def essencecrafttt(m):
    user = cwusers.find_one({'id': m.from_user.id})
    essencelist = []
    essencename = []
    weapons_to_craft = []
    for ids in user['inventory']:
        item = user['inventory'][ids]
        if item['type'] == 'weapon':
            if item['lvl'] == 3 and item['code'] not in ['shortsword', 'pistol']:
                if item['code'] not in weapons_to_craft:
                    weapons_to_craft.append(item['code'])
                else:
                    if item['code'] not in essencelist:
                        essencelist.append(item['code'])
                        essencename.append(item['name'])
    text = '–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç—Å—Å–µ–Ω—Ü–∏–∏ –æ—Ä—É–∂–∏—è –≤–∞–º –Ω—É–∂–Ω–æ –¥–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—Ä—É–∂–∏—è 3–≥–æ —É—Ä–æ–≤–Ω—è –∏ 25üëù. –°–ø–∏—Å–æ–∫ —ç—Å—Å–µ–Ω—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å:\n\n'
    i = 0
    for ids in essencelist:
        text += "üåê–≠—Å—Å–µ–Ω—Ü–∏—è: "+essencename[i]+' (/essencecraft_'+ids+'_–ù–æ–º–µ—Ä–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏)\n'
        i += 1
    text += '\n–£–∑–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ä—É–∂–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∞—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Å—Å–µ–Ω—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–µ–π - /essenceinfo_weaponcode_1 /essenceinfo_weaponcode_2 (—á–∏—Å–ª–æ –Ω–∞ –∫–æ–Ω—Ü–µ - –Ω–æ–º–µ—Ä –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏)'
    sendm(cwbot, m.chat.id, text)

@cwbot.message_handler(func = lambda m: m.text[:13] == '/essenceinfo_')
def essenceinfow(m):
    user = cwusers.find_one({'id': m.from_user.id})
    try:
        weaponcode = m.text.split('_')[1]
        modification = int(m.text.split('_')[2])
    except:
        sendm(cwbot, m.chat.id, '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã! –ü—Ä–∏–º–µ—Ä:\n/essenceinfo_revolver_2')
        return
    if modification not in [1, 2]:
        sendm(cwbot, m.chat.id, '–°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –¥–≤–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏!')
        return

    try:
        objectcode = None
        weapon = get_lvl_weapon(weapon=None, objectcode=objectcode, code=weaponcode, lvl=4, need_create=True, modification = modification)
        if weapon == None:
            sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –æ—Ä—É–∂–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
            return
        text = ''
        text += '‚öîÔ∏è|' + weapon['name'] + ' lvl.' + str(weapon['lvl']) + ', mod.'+str(modification)+':\n'
        text += weapon['description'] + '\n'
        if weapon['name'] not in ['–û–≥–Ω–µ–º–µ—Ç', '–†–µ–≤–æ–ª—å–≤–µ—Ä', '–°—é—Ä–∏–∫–µ–Ω—ã']:
            text += 'üí¢–£—Ä–æ–Ω: ' + str(1 + weapon['dmgbonus']) + '-' + str(weapon['cubes'] + weapon['dmgbonus']) + '\n'
        else:
            if weapon['name'] == '–†–µ–≤–æ–ª—å–≤–µ—Ä':
                wdmg = 3
            if weapon['name'] == '–û–≥–Ω–µ–º–µ—Ç':
                wdmg = 1
                if weapon['lvl'] == 4 and weapon['modification'] == 2:
                    wdmg = 0
            if weapon['name'] == '–°—é—Ä–∏–∫–µ–Ω—ã':
                wdmg = 2
            wdmg += weapon['dmgbonus']
            text += 'üí¢–£—Ä–æ–Ω: ' + str(wdmg) + '\n'
        text += 'üéØ–¢–æ—á–Ω–æ—Å—Ç—å: ' + str(weapon['accuracybonus']) + '\n'
        text += '‚ö°Ô∏è–ó–∞—Ç—Ä–∞—Ç—ã —ç–Ω–µ—Ä–≥–∏–∏: ' + str(weapon['energycost']) + '\n'
        if weapon['ranged']:
            text += 'üéØ–î–∞–ª—å–Ω–æ–±–æ–π–Ω–µ–µ\n'
        else:
            text += 'üëä–ë–ª–∏–∂–Ω–µ–µ\n'
        if weapon['lvl'] == 4:
            text += 'üåê–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥—É—à–∏: '+str(weapon['kills'])+'\n'
        sendm(cwbot, m.chat.id, text)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func = lambda m: m.text[:14] == '/essencecraft_')
def essencecraftttt(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        try:
            weaponcode = m.text.split('_')[1]
            modification = int(m.text.split('_')[2])
        except:
            sendm(cwbot, m.chat.id, '–û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–æ–º–∞–Ω–¥—ã!')
            return
        if modification not in [1, 2]:
            sendm(cwbot, m.chat.id, '–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–≤–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏!')
            return
        weaponamount = 0
        weapons_to_del = []
        for ids in user['inventory']:
            item = user['inventory'][ids]
            if item['type'] == 'weapon':
                if item['lvl'] == 3 and item['code'] == weaponcode:
                    weaponamount += 1
                    weapons_to_del.append(item['objectcode'])
        if user['pogs'] < 25:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üëù (–Ω—É–∂–Ω–æ 25)!')
            return
        if weaponamount < 2:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–ø–∏–π –æ—Ä—É–∂–∏—è 3–≥–æ —É—Ä–æ–≤–Ω—è (–Ω—É–∂–Ω–æ 2)!')
            return
        objectcode = generate_object_code(user)
        name = '–≠—Å—Å–µ–Ω—Ü–∏—è ('+name_to_weapon(weaponcode)+', –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è '+str(modification)+')'
        essence = create_essence(objectcode, weaponcode, name, modification)
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: essence}})
        cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + weapons_to_del[0]: 1}})
        cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + weapons_to_del[1]: 1}})
        cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': -25}})
        sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç "'+essence['name']+'"!')
    except:
        sendm(cwbot, 441399484, traceback.format_exc())

@cwbot.message_handler(commands = ['giveweapon'])
def giveweaponnn(m):
    if m.from_user.id != 441399484:
        return
    user = cwusers.find_one({'id':int(m.text.split(' ')[1])})
    if user == None:
        return
    try:
        code = m.text.split(' ')[2]
    except:
        return
    objectcode = generate_object_code(user)
    weapon = get_lvl_weapon(weapon=None, objectcode=objectcode, code=code, lvl=3,
                            need_create=True)
    cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: weapon}})
    sendm(cwbot, m.chat.id, '–í—ã–¥–∞–ª '+weapon['name']+' –ª–≤–ª3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é '+user['name'])


@cwbot.message_handler(func=lambda m: is_essence_craft(m))
def essencecrafttt(m):
    user = cwusers.find_one({'id': m.from_user.id})
    text = '–ù–∞ —ç—Ç–æ–º –º–∞–≥–∏—á–µ—Å–∫–æ–º —Å—Ç–æ–ª–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–≤–ª–µ–∫–∞—Ç—å üåê—Å—É—â–Ω–æ—Å—Ç—å –∏–∑ —Å–∏–ª—å–Ω–µ–π—à–∏—Ö –æ—Ä—É–∂–∏–π, —Å–æ–∑–¥–∞–≤–∞—è –Ω–µ—á—Ç–æ, –æ–ø–∏—Å—ã–≤–∞–µ–º–æ–µ –ø–µ—Ä–≤–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç–µ–ª—è–º–∏ '+\
        '—ç—Ç–æ–≥–æ —è–≤–ª–µ–Ω–∏—è –∫–∞–∫ "–¥—É—à–∞ –æ—Ä—É–∂–∏—è".\n\n"__–ï—Å–ª–∏ –º—ã –¥–∞–∂–µ –Ω–µ –º–æ–∂–µ–º –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã, –µ—Å—Ç—å –ª–∏ "—Å–æ–∑–Ω–∞–Ω–∏–µ" —É –æ–∫—Ä—É–∂–∞—é—â–∏—Ö –Ω–∞—Å –ª—é–¥–µ–π, –ª–∏–±–æ –∂–µ –≤—Å–µ –æ–Ω–∏ - '+\
        '"—Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –∑–æ–º–±–∏", —Ç–æ –∫–∞–∫ –º–æ–∂–µ–º –º—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã –≤ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ–≥–æ —Å–∞–º–æ–≥–æ "—Å–æ–∑–Ω–∞–Ω–∏—è" –Ω–µ—Ç —É –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ä–º –∂–∏–∑–Ω–∏ (–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –∂–∏–∑–Ω–∏)?__"\n\n'+\
        '–ò–º–µ–Ω–Ω–æ —Ç–∞–∫–∏–µ –º—ã—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ —É —Ç–µ—Ö, –∫—Ç–æ –≤–ø–µ—Ä–≤—ã–µ —Å–º–æ–≥ –¥–æ—Å—Ç–∞—Ç—å –∏–∑ –æ—Ä—É–∂–∏—è –µ–≥–æ "–¥—É—à—É". –î–∞–Ω–Ω–∞—è —Å—É–±—Å—Ç–∞–Ω—Ü–∏—è, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–µ –∏–º–µ—é—â–∞—è —á–µ—Ç–∫–æ–π —Ñ–æ—Ä–º—ã, –∞ –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–∞—è —á—Ç–æ-—Ç–æ, '+\
        '–±–æ–ª—å—à–µ –ø–æ—Ö–æ–∂–µ–µ –Ω–∞ —Å–≥—É—Å—Ç–æ–∫ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ –≤–µ—â–µ—Å—Ç–≤–∞, –ø–æ–≥–ª–æ—â–∞–ª–æ —ç–Ω–µ—Ä–≥–∏—é —É–±–∏—Ç—ã—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Å—É—â–µ—Å—Ç–≤, –æ–±—Ä–µ—Ç–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ—á–µ—Ä—Ç–∞–Ω–∏—è. –°–ø—É—Å—Ç—è –≤—Ä–µ–º—è, –Ω–∞–∫–æ–ø–∏–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ '+\
        '—ç–Ω–µ—Ä–≥–∏–∏, —Å—É—â–Ω–æ—Å—Ç—å –æ–±—Ä–µ–ª–∞ —á–µ—Ç–∫–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ—á–µ—Ä—Ç–∞–Ω–∏—è, —Å—Ç–∞–≤ –ø–æ—Ö–æ–∂–µ–π –Ω–∞ —Ç–æ –æ—Ä—É–∂–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –µ—ë –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è. –ò –±—ã–ª–∞ —Å–∏–ª—å–Ω–µ–µ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.'+\
        ' –ò –¥–∞–∂–µ –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ –æ–Ω–æ –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–ª–æ –ø–æ–≥–ª–æ—â–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é, –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω—è—è —Å–≤–æ–π –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥. –¢–∞–∫ –º–∞—Å—Ç–µ—Ä–∞ –¥–∞–∂–µ –Ω–∞—É—á–∏–ª–∏—Å—å –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ç–µ–º –∏–ª–∏ –∏–Ω—ã–º '+\
        '"–æ–¥—É—à–µ–≤–ª–µ–Ω–Ω—ã–º" –æ—Ä—É–∂–∏–µ–º –±—ã–ª–æ –ø–æ–≥–ª–æ—â–µ–Ω–æ –¥—É—à.'
    kb = essence_kb()
    sendm(cwbot, m.chat.id, text, reply_markup = kb, parse_mode = 'markdown')


@cwbot.message_handler(func=lambda m: is_class_message(m))
def classinfooo(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['lvl'] < 5:
        sendm(cwbot, m.chat.id, '–°–Ω–∞—á–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 5–≥–æ —É—Ä–æ–≤–Ω—è!')
        return
    try:
        user['class']
    except:
        cwusers.update_one({'id':user['id']},{'$set':{'class':None}})
        user['class'] = None
    if user['class'] == None:
        kb = select_class_kb(user)
        sendm(cwbot, m.chat.id, "–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –≤—ã–±—Ä–∞—Ç—å —Å–µ–±–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é. –ß—Ç–æ –≤–∞–º –±–æ–ª—å—à–µ –ø–æ –¥—É—à–µ - —Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã, –∏–ª–∏ –∂–µ —Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã? "+\
                           "(–±–ª—è –Ω—É —Ç—É—Ç –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∏–Ω–∂–µ–Ω–µ—Ä, —Ç–µ–∫—Å—Ç—ã –ø–æ—Ç–æ–º –¥–æ–ø–∏—à—É)", kb = kb)

@cwbot.message_handler(func=lambda m: is_bar_message(m))
def barrrrrm(m):
    return
    user = cwusers.find_one({'id': m.from_user.id})
    if user['current_act'] in busy_acts:
        sendm(cwbot, m.chat.id, '–í—ã —Å–µ–π—á–∞—Å —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã.')
        return
    try:
        game = bargames['bar']
    except:
        return
    if user['id'] in game['players']:
        sendm(cwbot, m.chat.id, '–í—ã —É–∂–µ –≤ –±–∞—Ä–µ!')
        return
    if user['id'] in game['waitbarplayers']:
        sendm(cwbot, m.chat.id, '–í—ã —É–∂–µ –≤ –±–∞—Ä–µ!')
        return
    game['waitbarplayers'].append(user['id'])
    sendm(cwbot, m.chat.id, '–í—ã –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å –≤ –±–∞—Ä.')
    cwusers.update_one({'id': user['id']}, {'$set': {'current_act': 'bar'}})


@cwbot.message_handler(func=lambda m: is_birzha_message(m))
def itemsssssmmirzha(m):
    user = cwusers.find_one({'id': m.from_user.id})
    text = '–î–ª—è –ø—Ä–æ–¥–∞–∂–∏ —Ä–µ—Å—É—Ä—Å–∞ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /wts_–∫–æ–¥—Ä–µ—Å—É—Ä—Å–∞_—á–∏—Å–ª–æ_—Ü–µ–Ω–∞. –ü—Ä–∏–º–µ—Ä:\n/wts_wood_10_3 - –ø—Ä–æ–¥–∞–∂–∞ 10 –¥–µ—Ä–µ–≤–∞ –ø–æ 3 –º–æ–Ω–µ—Ç—ã –∫–∞–∂–¥–æ–µ. ' + \
           '\n–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–æ—Ç—ã (' + str(len(user['birzha'])) + '/3):\n\n'
    for ids in user['birzha']:
        x = resourceauc.find_one({'wtscode': ids})
        if x != None:
            text += resource_to_name(x['item']) + ': ' + str(x['amount']) + '—à—Ç. –ø–æ ' + str(
                x['cost']) + 'üí∞. –û—Ç–º–µ–Ω–∏—Ç—å - /bcancel_' + x['wtscode'] + '\n\n'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: is_items_message(m))
def itemsssssm(m):
    user = cwusers.find_one({'id': m.from_user.id})
    text = 'üì¶–ü—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ:\n'
    wasitem = False
    for ids in user['items']:
        if user['items'][ids] > 0:
            text += get_cw_battleitem_name(ids) + ': ' + str(
                user['items'][ids]) + '. –í–∑—è—Ç—å —Å —Å–æ–±–æ–π - /takeitem_' + ids + '\n'
            wasitem = True
    if not wasitem:
        text += '–ü—É—Å—Ç–æ!\n'
    text += '\n'
    doptext = '‚úÖ–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:\n'
    for ids in user['items_for_battle']:
        doptext += get_cw_battleitem_name(ids) + '. –°–Ω—è—Ç—å - /takeoffitem_' + ids + '\n'
    if len(user['items_for_battle']) == 0:
        doptext += '–ü—É—Å—Ç–æ!\n'
    text += doptext
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: m.text[:10] == "/takeitem_")
def takeitemmmm(m):
    try:
        if m.from_user.id in takeitemlock:
            return
        takeitemlock.append(m.from_user.id)
        try:
            item = m.text.split('_')[1]
        except:
            takeitemlock.remove(m.from_user.id)
            return
        x = get_cw_battleitem_name(item)
        if x == "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
            sendm(cwbot, m.chat.id, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!')
            takeitemlock.remove(m.from_user.id)
            return
        user = cwusers.find_one({'id': m.from_user.id})
        if user['current_act'] in busy_acts:
            sendm(cwbot, m.chat.id, '–í—ã —Å–µ–π—á–∞—Å —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã!')
            takeitemlock.remove(m.from_user.id)
            return
        if item not in user['items']:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!')
            takeitemlock.remove(m.from_user.id)
            return
        if user['items'][item] <= 0:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!')
            takeitemlock.remove(m.from_user.id)
            return
        if len(user['items_for_battle']) >= user['max_items_for_battle']:
            sendm(cwbot, m.chat.id, '–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤!')
            takeitemlock.remove(m.from_user.id)
            return
        if item in user['items_for_battle']:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ —É–∂–µ –µ—Å—Ç—å —Ç–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç!')
            takeitemlock.remove(m.from_user.id)
            return
        cwusers.update_one({'id': user['id']}, {'$push': {'items_for_battle': item}})
        cwusers.update_one({'id': user['id']}, {'$inc': {'items.' + item: -1}})
        sendm(cwbot, m.chat.id, '–£—Å–ø–µ—à–Ω–æ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: "' + x + '"!')
        takeitemlock.remove(m.from_user.id)
    except:
        takeitemlock.remove(m.from_user.id)
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:11] == "/cancellot_")
def cancellaucc(m):
    lot = None
    try:
        code = m.text.split('_')[1]
    except:
        return
    for ids in auction.find({}):
        if ids['code'] == code:
            lot = ids
            break
    if lot == None:
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –ª–æ—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    user = cwusers.find_one({'id': m.from_user.id})
    if lot['owner'] != user['id']:
        sendm(cwbot, m.chat.id, '–≠—Ç–æ –Ω–µ –≤–∞—à –ª–æ—Ç!')
        return
    objectcode = generate_object_code(user)
    lot['item']['objectcode'] = objectcode
    cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: lot['item']}})
    if lot['buyer'] != None:
        cwusers.update_one({'id': lot['buyer']}, {'$inc': {'pogs': lot['cost']}})
        sendm(cwbot, lot['buyer'], '–õ–æ—Ç –Ω–∞ —Ç–æ–≤–∞—Ä "' + lot['item'][
            'name'] + '" –±—ã–ª –æ—Ç–º–µ–Ω—ë–Ω, –≤–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –±—ã–ª–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞.')
    auction.delete_one({'code': lot['code']})
    sendm(cwbot, m.chat.id, '–í—ã –æ—Ç–º–µ–Ω–∏–ª–∏ –ª–æ—Ç –Ω–∞ —Ç–æ–≤–∞—Ä "' + lot['item'][
        'name'] + '". –í–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç - /info_' + objectcode + '.')


@cwbot.message_handler(func=lambda m: m.text[:13] == "/takeoffitem_")
def takeitemmmm(m):
    try:
        if m.from_user.id in takeitemlock:
            return
        takeitemlock.append(m.from_user.id)
        try:
            item = m.text.split('_')[1]
        except:
            takeitemlock.remove(m.from_user.id)
            return
        x = get_cw_battleitem_name(item)
        if x == "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
            takeitemlock.remove(m.from_user.id)
            return
        user = cwusers.find_one({'id': m.from_user.id})
        if user['current_act'] in busy_acts:
            sendm(cwbot, m.chat.id, '–í—ã —Å–µ–π—á–∞—Å —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã!')
            takeitemlock.remove(m.from_user.id)
            return
        if item not in user['items_for_battle']:
            sendm(cwbot, m.chat.id, '–≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É –≤–∞—Å –Ω–µ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!')
            takeitemlock.remove(m.from_user.id)
            return
        itemss = []
        for ids in user['items_for_battle']:
            itemss.append(ids)
        itemss.remove(item)
        cwusers.update_one({'id': user['id']}, {'$set': {'items_for_battle': itemss}})
        if item not in user['items']:
            cwusers.update_one({'id': user['id']}, {'$set': {'items.' + item: 1}})
        else:
            cwusers.update_one({'id': user['id']}, {'$inc': {'items.' + item: 1}})
        sendm(cwbot, m.chat.id, '–£—Å–ø–µ—à–Ω–æ —Å–Ω—è—Ç –ø—Ä–µ–¥–º–µ—Ç: "' + x + '"!')
        takeitemlock.remove(m.from_user.id)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: is_recipe_decrypt_message(m))
def recipedecryptmsgg(m):
    user = cwusers.find_one({'id': m.from_user.id})
    text = ''
    text += '–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –æ—Ç–¥–µ–ª–µ –ª–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π –¥—Ä–µ–≤–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π. –ó–∞ —Ö–æ—Ä–æ—à—É—é —Ü–µ–Ω—É, —Ä–∞–∑—É–º–µ–µ—Ç—Å—è. ' + \
            '–ß—Ç–æ–±—ã —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç, –Ω–∞–∂–º–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É –∫–æ–º–∞–Ω–¥—É.\n\n'
    alreadycolors = []
    for ids in user['inventory']:
        item = user['inventory'][ids]
        if item['type'] == 'undefined_recipe':
            if item['color'] not in alreadycolors:
                alreadycolors.append(item['color'])
                goldcost = 100
                emoj = "üìó"
                if item['color'] == 'red':
                    goldcost = 100
                    emoj = "üìï"
                if item['color'] == 'blue':
                    goldcost = 100
                    emoj = "üìò"
                if item['color'] == 'green':
                    goldcost = 100
                    emoj = "üìó"
                text += emoj + item['name'] + ': üí∞' + str(goldcost) + ' /dec_' + item['objectcode'] + '\n'
    if len(alreadycolors) == 0:
        text += '–£ –≤–∞—Å –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å!'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: is_scroll_decrypt_message(m))
def scrolldecryptmsgg(m):
    user = cwusers.find_one({'id': m.from_user.id})
    text = ''
    text += '–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –æ—Ç–¥–µ–ª–µ –ª–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π –¥—Ä–µ–≤–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π. –ó–∞ —Ö–æ—Ä–æ—à—É—é —Ü–µ–Ω—É, —Ä–∞–∑—É–º–µ–µ—Ç—Å—è. ' + \
            '–ß—Ç–æ–±—ã —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–≤–∏—Ç–æ–∫, –Ω–∞–∂–º–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É –∫–æ–º–∞–Ω–¥—É.\n\n'
    has = False
    for ids in user['inventory']:
        item = user['inventory'][ids]
        if item['type'] == 'undefined_scroll':
            has = True
            goldcost = 100
            text += "üóû" + item['name'] + ': üí∞' + str(goldcost) + ' /dec_' + item['objectcode'] + '\n'
            break
    if not has:
        text += '–£ –≤–∞—Å –Ω–µ—Ç —Å–≤–∏—Ç–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å!'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: m.text[:5] == "/dec_")
def decryptrecipess(m):
    user = cwusers.find_one({'id': m.from_user.id})
    try:
        item = user['inventory'][m.text.split('_')[1]]
    except:
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ —É –≤–∞—Å –Ω–µ—Ç!')
        return
    if item['type'] not in ['undefined_scroll', 'undefined_recipe']:
        sendm(cwbot, m.chat.id, '–≠—Ç–æ –Ω–µ —Å–≤–∏—Ç–æ–∫ –∏ –Ω–µ —Ä–µ—Ü–µ–ø—Ç!')
        return
    if item['type'] == 'undefined_scroll':
        goldcost = 100
        if user['gold'] < goldcost:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!')
            return
        scroll = random.choice(allscrolls)
        objectcode = generate_object_code(user)
        newscroll = create_scroll(scroll, objectcode)
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: newscroll}})
        cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + item['objectcode']: 1}})
        cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -goldcost}})
        sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç: "üìú' + newscroll['name'] + ' lvl.' + str(
            newscroll['lvl']) + '"! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode)

    if item['type'] == 'undefined_recipe':
        goldcost = 100
        emoj = "üìó"
        if item['color'] == 'red':
            goldcost = 100
            emoj = "üìï"
            recipelist = allrecipes_red.copy()
        if item['color'] == 'blue':
            goldcost = 100
            emoj = "üìò"
            recipelist = allrecipes_blue.copy()
        if item['color'] == 'green':
            goldcost = 100
            emoj = "üìó"
            recipelist = allrecipes_green.copy()
        if user['gold'] < goldcost:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!')
            return
        recipecode = random.choice(recipelist)
        objectcode = generate_object_code(user)
        recipename = resource_to_name(recipecode)
        newrecipe = create_recipe(recipecode, objectcode, recipename, undefined=False)
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: newrecipe}})
        cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + item['objectcode']: 1}})
        cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -goldcost}})
        sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–ª–∏ –ø—Ä–µ–¥–º–µ—Ç: "üìì' + newrecipe[
            'name'] + '"! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode)


@cwbot.message_handler(commands = ['fix_abuse'])
def fixabusee(m):
    x = cwusers.find_one({'name': "–ü–∞—Å—é–∫ –õ–æ—à–∞–¥–∫–∏–Ω"})
    counter_saw = 0
    counter_claws = 0
    counter_bulava = 0
    sendm(cwbot, m.chat.id, '–ù–∞—á–∞–ª–æ –ø–∏–ª–æ–º–µ—Ç–∞')
    for ids in x['inventory']:
        item = x['inventory'][ids]
        if item['name'] in ['–ü–∏–ª–æ–º–µ—Ç']:
            cwusers.update_one({'name':"–ü–∞—Å—é–∫ –õ–æ—à–∞–¥–∫–∏–Ω"},{'$unset':{'inventory.'+ids:1}})
            counter_saw += 1
    sendm(cwbot, m.chat.id, '–£–¥–∞–ª–µ–Ω–æ: ' + str(counter_saw) + ' –ø–∏–ª, ' + str(counter_claws) + ' –∫–æ–≥—Ç–µ–π, ' + str(
        counter_bulava) + ' –±—É–ª–∞–≤—ã')
    sendm(cwbot, m.chat.id, '–ù–∞—á–∞–ª–æ –∫–æ–≥—Ç–µ–π')
    for ids in x['inventory']:
        item = x['inventory'][ids]
        if item['name'] in ['–°—Ç–∞–ª—å–Ω—ã–µ –∫–æ–≥—Ç–∏']:
            cwusers.update_one({'name':"–ü–∞—Å—é–∫ –õ–æ—à–∞–¥–∫–∏–Ω"},{'$unset':{'inventory.'+ids:1}})
            counter_claws += 1
    sendm(cwbot, m.chat.id, '–£–¥–∞–ª–µ–Ω–æ: ' + str(counter_saw) + ' –ø–∏–ª, ' + str(counter_claws) + ' –∫–æ–≥—Ç–µ–π, ' + str(
        counter_bulava) + ' –±—É–ª–∞–≤—ã')
    sendm(cwbot, m.chat.id, '–ù–∞—á–∞–ª–æ –±—É–ª–∞–≤—ã')
    for ids in x['inventory']:
        item = x['inventory'][ids]
        if item['name'] in ['–ë—É–ª–∞–≤–∞']:
            cwusers.update_one({'name':"–ü–∞—Å—é–∫ –õ–æ—à–∞–¥–∫–∏–Ω"},{'$unset':{'inventory.'+ids:1}})
            counter_bulava += 1
    sendm(cwbot, m.chat.id, '–£–¥–∞–ª–µ–Ω–æ: '+str(counter_saw)+' –ø–∏–ª, '+str(counter_claws)+' –∫–æ–≥—Ç–µ–π, '+str(counter_bulava)+' –±—É–ª–∞–≤—ã')


@cwbot.message_handler(func=lambda m: m.text[:11] == '/skillinfo_')
def skillinffooom(m):
    try:
        skill = m.text.split('_')[1]
        lvl = m.text.split('_')[2]
    except:
        sendm(cwbot, m.chat.id, '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã!')
        return
    try:
        text = cw_skillinfo.info[skill + '?' + lvl]
    except:
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ —Å–∫–∏–ª–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ª–∏–±–æ –≤—ã –≤–≤–µ–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!')
        return
    sendm(cwbot, m.chat.id, '–û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:\n' + text)


@cwbot.message_handler(func=lambda m: is_castle_message(m))
def castlessmsggg(m):
    # user = cwusers.find_one({'id':m.from_user.id})
    kb = castle_kb()
    sendm(cwbot, m.chat.id, "–í–∞—à —Ä–æ–¥–Ω–æ–π –∑–∞–º–æ–∫. –í –º–∞–≥–∞–∑–∏–Ω–µ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –±–∞–∑–æ–≤—ã–µ —Å–≤–∏—Ç–∫–∏ –∏–∑—É—á–µ–Ω–∏—è —Å–∫–∏–ª–ª–æ–≤ –∏ –æ—Ä—É–∂–∏–µ.",
                       reply_markup=kb)


@cwbot.message_handler(func=lambda m: is_auction_message(m))
def auctionssmsggg(m):
    # user = cwusers.find_one({'id':m.from_user.id})
    text = ''
    text += '–ù–∞ –∞—É–∫—Ü–∏–æ–Ω –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤–µ—â–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è. –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç, –ø–æ–∫–∞ –Ω–µ –≤—ã–π–¥–µ—Ç –≤—Ä–µ–º—è –∞—É–∫—Ü–∏–æ–Ω–∞. ' + \
            '–§–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã:\n/auc_jtUIq_3_1\n–ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞—É–∫—Ü–∏–æ–Ω, –∞ –≤—Ç–æ—Ä–æ–µ - –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—Ç–∞–≤–∫—É. ' + \
            '–ï—Å–ª–∏ –Ω–µ –≤–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ, –∞—É–∫—Ü–∏–æ–Ω –±—É–¥–µ—Ç ' + \
            '–≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ 3 —á–∞—Å–∞.\n\n–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤ - /viewlots\n–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö —Å—Ç–∞–≤–æ–∫ - /viewbets\n–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤ - /viewalllots'
    sendm(cwbot, m.chat.id, text)


def get_user_inventory_text(user):
    text = ''
    for ids in user['inventory']:
        item = user['inventory'][ids]
        if item['type'] == 'weapon':
            if item['lvl'] == 4:
                text += '‚öîÔ∏è|' + item['name'] + ' (' + str(item['lvl']) + '–ª–≤–ª mod.'+str(item['modification'])+') /info_' + ids + '\n'
            else:
                text += '‚öîÔ∏è|' + item['name'] + ' (' + str(item['lvl']) + '–ª–≤–ª) /info_' + ids + '\n'

        elif item['type'] == 'scroll':
            text += 'üìú|–°–≤–∏—Ç–æ–∫ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ "' + item['name'] + '" (' + str(item['lvl']) + '–ª–≤–ª) /info_' + ids + '\n'
        elif item['type'] == 'recipe':
            text += 'üìì|' + item['name'] + ' /info_' + ids + '\n'
        elif item['type'] == 'undefined_recipe':
            emoj = "üìï"
            etext = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
            if item['code'] == "recipe_red":
                emoj = "üìï"
                etext = "–ö—Ä–∞—Å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç"
            if item['code'] == "recipe_green":
                emoj = "üìó"
                etext = "–ó–µ–ª—ë–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç"
            if item['code'] == "recipe_blue":
                emoj = "üìò"
                etext = "–°–∏–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç"
            text += emoj + '|' + etext + ' /info_' + ids + '\n'
        elif item['type'] == 'undefined_scroll':
            text += 'üóû' + '|' + item['name'] + ' /info_' + ids + '\n'
        elif item['type'] == 'essence':
            text += 'üåê|' + item['name'] + ' /info_' + ids + '\n'

    restext = ''
    for ids in user['resources']:
        if user['resources'][ids] > 0:
            restext += 'üì¶' + resource_to_name(ids) + ': ' + str(user['resources'][ids]) + ' (/t_' + ids + ')\n'
    if restext != '':
        text += '\n–†–µ—Å—É—Ä—Å—ã:\n' + restext
    return text


def get_user_skills_text(user):
    text = ''
    text += '‚úÖ–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:'
    if len(user['equipped_skills']) > 0:
        text += '\n'
    for ids in user['equipped_skills']:
        skill = user['equipped_skills'][ids]
        text += 'üß¨' + skill['name'] + ' lvl.' + str(skill['lvl']) + ' (—Å–Ω—è—Ç—å - /off_' + skill['skillcode'] + '), '
    if len(user['equipped_skills']) > 0:
        text = text[:len(text) - 2]
        text += '.'
    text += '\n\n'
    text += 'üìú–ò–∑—É—á–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:\n'
    for ids in user['skills']:
        skill = user['skills'][ids]
        text += 'üß¨' + skill['name'] + ' lvl.' + str(skill['lvl']) + ':\n'
        text += get_cw_skill_description(skill) + '\n'
        text += '–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å - /use_' + skill['skillcode'] + ', —ç–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∏—Ç–≤—ã –∑–∞–º–∫–æ–≤ - /use_' + skill[
            'skillcode'] + '_castlefight.\n\n'
    return text


def get_user_skills_lvlup_text(user):
    text = ''
    text += 'üìú–ò–∑—É—á–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:\n'
    for ids in user['skills']:
        skill = user['skills'][ids]
        text += 'üß¨' + skill['name'] + ' lvl.' + str(skill['lvl']) + ':\n'
        text += get_cw_skill_description(skill) + '\n'
        lvluptext = ''
        cantlvl = False
        cost = 100
        if skill['lvl'] == 1:
            cost = 3
        if skill['lvl'] == 2:
            cost = 9
        if skill['lvl'] >= 3:
            cantlvl = True
        if not cantlvl:
            skill['lvl'] += 1
            lvluptext += '–û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ ' + str(skill['lvl']) + ':\n'
            lvluptext += get_cw_skill_description(skill)
            text += 'üÜô–ü–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ - /lvlup_' + skill['skillcode'] + '. ' + lvluptext + '\n'
            text += '–¶–µ–Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è: ' + str(cost) + 'üß¨\n\n'
        else:
            text += '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!' + '\n\n'

    return text
from telebot.util import smart_split

@cwbot.message_handler(func=lambda m: is_inventory_message(m))
def inventorysmsggg(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        text = get_user_inventory_text(user)
        if text == '':
            text = "–ü—É—Å—Ç–æ!"
        [sendm(cwbot, m.chat.id, tts) for tts in smart_split(text)] 
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: is_skills_message(m))
def skillsmsggg(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        text = get_user_skills_text(user)
        if text == '':
            text = "–ü—É—Å—Ç–æ!"
        sendm(cwbot, m.chat.id, text)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: is_shop_message(m))
def castlessmsggg(m):
    # user = cwusers.find_one({'id':m.from_user.id})
    kb = shop_kb()
    text = "*üìú–°–≤–∏—Ç–∫–∏* - –î—Ä–µ–≤–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –≤–µ–¥–µ–Ω–∏–∏ –±–æ—è –∏ –µ–≥–æ —Ç–µ—Ö–Ω–∏–∫–∞—Ö. –° –ø–æ–º–æ—â—å—é –Ω–∏—Ö –º–æ–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å–∫–∏–ª–ª—ã.\n\n" + \
           "*‚öôÔ∏è–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ* - –æ—Ä—É–∂–µ–π–Ω–∞—è –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è —Å—Ç–∞—Ä–æ–≥–æ –∫—É–∑–Ω–µ—Ü–∞. –ü—Ä–æ—Å—Ç–æ–µ, –Ω–æ –Ω–∞–¥—ë–∂–Ω–æ–µ –æ—Ä—É–∂–∏–µ."
    sendm(cwbot, m.chat.id, text, reply_markup=kb, parse_mode="markdown")


@cwbot.message_handler(func=lambda m: is_scrolls_message(m))
def scrollsmsggg(m):
    # user = cwusers.find_one({'id':m.from_user.id})
    text = ''
    for ids in scrolls_to_sale:
        scroll = scrolls_to_sale[ids]
        text += '*' + scroll['name'] + '*\nüí∞–¶–µ–Ω–∞: ' + str(scroll['cost']) + ' (' + scroll['buy_command'].replace('_',
                                                                                                                 '\_') + ')\nüí¨' + \
                scroll['description'] + '\n\n'
    sendm(cwbot, m.chat.id, text, parse_mode="markdown")


@cwbot.message_handler(func=lambda m: is_weapons_message(m))
def weaponsmsggg(m):
    # user = cwusers.find_one({'id':m.from_user.id})
    text = ''
    for ids in weapons_to_sale:
        weapon = weapons_to_sale[ids]
        text += '*' + weapon['name'] + '*\nüí∞–¶–µ–Ω–∞: ' + str(weapon['cost']) + ' (' + weapon['buy_command'].replace('_',
                                                                                                                 '\_') + ')\nüí¨' + \
                weapon['description'] + '\n\n'
    sendm(cwbot, m.chat.id, text, parse_mode="markdown")


@cwbot.message_handler(func=lambda m: is_quest_message(m))
def questssmsggg(m):
    user = cwusers.find_one({'id': m.from_user.id})
    kb = quests_kb(user)
    sendm(cwbot, m.chat.id,
                       '–í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–µ—Å—Ç:\n\n*üê≠|–ö—Ä—ã—Å–∏–Ω–æ–µ –ª–æ–≥–æ–≤–æ* - –±–∏—Ç–≤–∞ —Å –∫—Ä—ã—Å–æ–π. –°—Ä–∞–∂–µ–Ω–∏–µ —Å —ç—Ç–∏–º–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏ —Å—É—â–µ—Å—Ç–≤–∞–º–∏ –æ–ø–∞—Å–Ω–æ, ' + \
                       '–Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –Ω–∞–±—Ä–∞—Ç—å—Å—è –æ–ø—ã—Ç–∞.\n\n*ü•æ|–ü–∞—Ç—Ä—É–ª—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π* - –æ—Ö—Ä–∞–Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ —Å–≤–æ–µ–≥–æ –∑–∞–º–∫–∞.\n\n' + \
                       '*üëÄ|–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–Ω—ã–π —à—É–º* - –µ—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –ø–∞—Ç—Ä—É–ª—è –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ - –≤–µ—Ä–æ—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ, —ç—Ç–æ –≤—Ä–∞–∂–µ—Å–∫–∏–π –±–æ–µ—Ü. –°–∞–º—ã–µ —Å–º–µ–ª—ã–µ ' + \
                       '–º–æ–≥—É—Ç –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –≤—Ä–∞–≥–æ–º –∏ –±—Ä–æ—Å–∏—Ç—å –µ–º—É –≤—ã–∑–æ–≤. –ù–µ —Ç—Ä–∞—Ç–∏—Ç –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.\n\nüëπ|–¢—Ä–æ–ª–ª—å –ø–æ–¥ –º–æ—Å—Ç–æ–º - –ø–æ–ø—ã—Ç–∞–π—Ç–µ—Å—å –∑–∞—Å—Ç–∞—Ç—å —Ç—Ä–æ–ª–ª—è –≤—Ä–∞—Å–ø–ª–æ—Ö! –ù–∞–≤–µ—Ä–Ω—è–∫–∞ '+\
                       '—É –Ω–µ–≥–æ –≤ –ª–æ–≥–æ–≤–µ –µ—Å—Ç—å, —á–µ–º –ø–æ–∂–∏–≤–∏—Ç—å—Å—è... –¢—Ä–∞—Ç–∏—Ç 2 –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏.', reply_markup=kb,
                       parse_mode='markdown')


def get_materials_for_upgrade(item):
    returnitems = {
        'wood': 999999,
        'gold': 999999
    }
    if item['code'] == 'baseball':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_baseball': 1,
                'wood': 50,
                'steelplate': 5,
                'rope': 8,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_baseball': 1,
                'wood': 100,
                'steelplate': 10,
                'rope': 15,
                'gold': 3000
            }
    if item['code'] == 'shortsword':
        if item['lvl'] == 1:
            returnitems = {
                'wood': 15,
                'plastic': 10,
                'steelplate': 2,
                'threads': 3,
                'gold': 250
            }
        if item['lvl'] == 2:
            returnitems = {
                'wood': 25,
                'plastic': 25,
                'steelplate': 6,
                'threads': 9,
                'gold': 800
            }

    if item['code'] == 'revolver':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_revolver': 1,
                'plastic': 20,
                'steelplate': 5,
                'gunpowder': 15,
                'diamonds': 1,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_revolver': 1,
                'plastic': 20,
                'steelplate': 5,
                'gunpowder': 30,
                'diamonds': 6,
                'gold': 3000
            }

    if item['code'] == 'pistol':
        if item['lvl'] == 1:
            returnitems = {
                'plastic': 20,
                'wood': 10,
                'steelplate': 5,
                'gunpowder': 5,
                'gold': 400
            }
        if item['lvl'] == 2:
            returnitems = {
                'plastic': 30,
                'wood': 30,
                'steelplate': 10,
                'gunpowder': 15,
                'gold': 1000
            }

    if item['code'] == 'knife':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_knife': 1,
                'ironbars': 25,
                'wood': 5,
                'steelplate': 15,
                'rope': 10,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_knife': 1,
                'ironbars': 50,
                'wood': 10,
                'steelplate': 25,
                'rope': 15,
                'gold': 3000
            }

    if item['code'] == 'obrez':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_obrez': 1,
                'ironbars': 15,
                'steelplate': 15,
                'gunpowder': 30,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_obrez': 1,
                'ironbars': 35,
                'steelplate': 20,
                'gunpowder': 50,
                'diamonds': 1,
                'gold': 3000
            }

    if item['code'] == 'torch':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_torch': 1,
                'gunpowder': 10,
                'kerosene': 10,
                'threads': 10,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_torch': 1,
                'gunpowder': 30,
                'kerosene': 30,
                'threads': 30,
                'gold': 3000
            }

    if item['code'] == 'flamethrower':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_flamethrower': 1,
                'kerosene': 20,
                'ironbars': 30,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_flamethrower': 1,
                'kerosene': 40,
                'ironbars': 60,
                'gold': 3000
            }

    if item['code'] == 'rifle':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_rifle': 1,
                'diamonds': 8,
                'ironbars': 50,
                'steelplate': 4,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_rifle': 1,
                'diamonds': 16,
                'ironbars': 70,
                'steelplate': 8,
                'gold': 3000
            }
    if item['code'] == 'axe':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_axe': 1,
                'wood': 40,
                'rope': 40,
                'ironbars': 5,
                'diamonds': 1,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_axe': 1,
                'wood': 60,
                'rope': 60,
                'ironbars': 7,
                'diamonds': 1,
                'gold': 3000
            }
    if item['code'] == 'bulava':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_bulava': 1,
                'wood': 50,
                'ironbars': 50,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_bulava': 1,
                'wood': 100,
                'ironbars': 60,
                'gold': 3000
            }

    if item['code'] == 'kastet':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_kastet': 1,
                'ironbars': 15,
                'steelplate': 10,
                'medicalcomponents': 10,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_kastet': 1,
                'ironbars': 25,
                'steelplate': 30,
                'medicalcomponents': 30,
                'gold': 3000
            }

    if item['code'] == 'kuvalda':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_kuvalda': 1,
                'steelplate': 20,
                'battery': 4,
                'threads': 10,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_kuvalda': 1,
                'steelplate': 30,
                'battery': 8,
                'threads': 20,
                'gold': 3000
            }

    if item['code'] == 'chain':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_chain': 1,
                'steelplate': 15,
                'wood': 20,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_chain': 1,
                'steelplate': 25,
                'wood': 45,
                'gold': 3000
            }

    if item['code'] == 'spear':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_spear': 1,
                'ironbars': 15,
                'wood': 15,
                'threads': 15,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_spear': 1,
                'ironbars': 25,
                'wood': 25,
                'threads': 25,
                'gold': 3000
            }

    if item['code'] == 'saber':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_saber': 1,
                'medicalcomponents': 8,
                'battery': 8,
                'diamonds': 2,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_saber': 1,
                'medicalcomponents': 16,
                'battery': 16,
                'diamonds': 3,
                'gold': 3000
            }

    if item['code'] == 'bow':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_bow': 1,
                'kerosene': 10,
                'wood': 30,
                'threads': 30,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_bow': 1,
                'kerosene': 20,
                'wood': 50,
                'threads': 50,
                'gold': 3000
            }

    if item['code'] == 'claws':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_claws': 1,
                'steelplate': 25,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_claws': 1,
                'steelplate': 50,
                'gold': 3000
            }

    if item['code'] == 'police':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_police': 1,
                'battery': 10,
                'wood': 20,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_police': 1,
                'battery': 20,
                'wood': 30,
                'gold': 3000
            }

    if item['code'] == 'saw':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_saw': 1,
                'ironbars': 10,
                'diamonds': 10,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_saw': 1,
                'ironbars': 15,
                'diamonds': 15,
                'gold': 3000
            }

    if item['code'] == 'shurikens':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_shurikens': 1,
                'ironbars': 16,
                'steelplate': 12,
                'threads': 4,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_shurikens': 1,
                'ironbars': 24,
                'steelplate': 16,
                'threads': 6,
                'gold': 3000
            }

    if item['code'] == 'molot':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_molot': 1,
                'wood': 15,
                'battery': 6,
                'ironbars': 15,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_molot': 1,
                'wood': 25,
                'battery': 10,
                'ironbars': 25,
                'gold': 3000
            }

    if item['code'] == 'shest':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_shest': 1,
                'wood': 60,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_shest': 1,
                'wood': 100,
                'gold': 3000
            }

    if item['code'] == 'tesak':
        if item['lvl'] == 1:
            returnitems = {
                'recipe_tesak': 1,
                'steelplate': 10,
                'ironbars': 10,
                'wood': 10,
                'diamonds': 4,
                'gold': 1000
            }
        if item['lvl'] == 2:
            returnitems = {
                'recipe_tesak': 1,
                'steelplate': 15,
                'ironbars': 15,
                'wood': 15,
                'diamonds': 6,
                'gold': 3000
            }

    return returnitems


def get_materials_for_craft(item):
    returnitems = {
        'wood': 10000,
        'gold': 100000
    }
    if item['code'] == "recipe_baseball":
        returnitems = {
            'recipe_baseball': 1,
            'wood': 15,
            'steelplate': 1,
            'gold': 500
        }
    elif item['code'] == "recipe_revolver":
        returnitems = {
            'recipe_revolver': 1,
            'plastic': 15,
            'steelplate': 5,
            'gunpowder': 5,
            'gold': 500
        }

    elif item['code'] == "recipe_knife":
        returnitems = {
            'recipe_knife': 1,
            'ironbars': 15,
            'wood': 5,
            'steelplate': 10,
            'rope': 5,
            'gold': 500
        }

    elif item['code'] == "recipe_obrez":
        returnitems = {
            'recipe_obrez': 1,
            'ironbars': 10,
            'steelplate': 5,
            'gunpowder': 15,
            'gold': 500
        }

    elif item['code'] == "recipe_torch":
        returnitems = {
            'recipe_torch': 1,
            'gunpowder': 5,
            'kerosene': 5,
            'threads': 5,
            'gold': 500
        }

    elif item['code'] == "recipe_flamethrower":
        returnitems = {
            'recipe_flamethrower': 1,
            'kerosene': 10,
            'ironbars': 20,
            'gold': 500
        }

    elif item['code'] == "recipe_rifle":
        returnitems = {
            'recipe_rifle': 1,
            'diamonds': 4,
            'ironbars': 30,
            'steelplate': 2,
            'gold': 500
        }

    elif item['code'] == "recipe_axe":
        returnitems = {
            'recipe_axe': 1,
            'wood': 20,
            'rope': 20,
            'ironbars': 3,
            'diamonds': 1,
            'gold': 500
        }

    elif item['code'] == "recipe_bulava":
        returnitems = {
            'recipe_bulava': 1,
            'wood': 20,
            'ironbars': 20,
            'gold': 500
        }

    elif item['code'] == "recipe_kastet":
        returnitems = {
            'recipe_kastet': 1,
            'ironbars': 10,
            'steelplate': 5,
            'medicalcomponents': 5,
            'gold': 500
        }

    elif item['code'] == "recipe_kuvalda":
        returnitems = {
            'recipe_kuvalda': 1,
            'steelplate': 10,
            'battery': 1,
            'threads': 5,
            'gold': 500
        }

    elif item['code'] == "recipe_chain":
        returnitems = {
            'recipe_chain': 1,
            'steelplate': 10,
            'wood': 10,
            'gold': 500
        }

    elif item['code'] == "recipe_spear":
        returnitems = {
            'recipe_spear': 1,
            'ironbars': 10,
            'wood': 10,
            'threads': 10,
            'gold': 500
        }

    elif item['code'] == "recipe_saber":
        returnitems = {
            'recipe_saber': 1,
            'medicalcomponents': 4,
            'battery': 4,
            'diamonds': 1,
            'gold': 500
        }

    elif item['code'] == "recipe_bow":
        returnitems = {
            'recipe_bow': 1,
            'kerosene': 5,
            'wood': 15,
            'threads': 15,
            'gold': 500
        }

    elif item['code'] == "recipe_claws":
        returnitems = {
            'recipe_claws': 1,
            'steelplate': 10,
            'gold': 500
        }

    elif item['code'] == "recipe_police":
        returnitems = {
            'recipe_police': 1,
            'battery': 5,
            'wood': 10,
            'gold': 500
        }

    elif item['code'] == "recipe_saw":
        returnitems = {
            'recipe_saw': 1,
            'ironbars': 5,
            'diamonds': 5,
            'gold': 500
        }

    elif item['code'] == "recipe_shurikens":
        returnitems = {
            'recipe_shurikens': 1,
            'ironbars': 8,
            'steelplate': 8,
            'threads': 2,
            'gold': 500
        }

    elif item['code'] == "recipe_molot":
        returnitems = {
            'recipe_molot': 1,
            'wood': 10,
            'battery': 3,
            'ironbars': 10,
            'gold': 500
        }

    elif item['code'] == "recipe_shest":
        returnitems = {
            'recipe_shest': 1,
            'wood': 30,
            'gold': 500
        }

    elif item['code'] == "recipe_tesak":
        returnitems = {
            'recipe_tesak': 1,
            'steelplate': 5,
            'ironbars': 5,
            'wood': 5,
            'diamonds': 2,
            'gold': 500
        }

    return returnitems


def get_craft_text(user):
    text = ''
    for ids in user['inventory']:
        item = user['inventory'][ids]
        print(str(item))
        if item['type'] == "recipe":
            # print("2")
            # print(str(item))
            text += '\n*' + item['name'] + '*\n–¢—Ä–µ–±—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:\n'
            materials = get_materials_for_craft(item)
            materialtext = ''
            for ids in materials:
                if ids == 'gold':
                    materialtext += "    –ó–æ–ª–æ—Ç–æ - " + str(materials[ids]) + 'üí∞\n'
                else:
                    materialtext += "    " + resource_to_name(ids) + ' - ' + str(materials[ids]) + '\n'
            materialtext += '–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ /wcraft\_' + item['objectcode'] + '.\n'
            materialtext += '–£–∑–Ω–∞—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ—Ä—É–∂–∏—è - /winfo\_' + item['code'].split('_')[
                1] + '\_1 (—á–∏—Å–ª–æ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –æ—Ç 1 –¥–æ 3).\n'
            text += materialtext
    if text == '':
        text = '–£ –≤–∞—Å –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤!'
    return text


def get_upgrade_text(user):
    text = ''
    for ids in user['inventory']:
        item = user['inventory'][ids]
        if item['type'] == "weapon":
            if item['lvl'] < 3:
                text += '\n' + item['name'] + ' lvl.' + str(item['lvl']) + '\n–¢—Ä–µ–±—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:\n'
                materials = get_materials_for_upgrade(item)
                materialtext = ''
                for idss in materials:
                    if idss == 'gold':
                        materialtext += "    –ó–æ–ª–æ—Ç–æ - " + str(materials[idss]) + 'üí∞\n'
                    else:
                        materialtext += "    " + resource_to_name(idss) + ' - ' + str(materials[idss]) + '\n'
                materialtext += '–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ /wlvlup\_' + item['objectcode'] + '.\n'
                materialtext += '–£–∑–Ω–∞—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ—Ä—É–∂–∏—è - /winfo\_' + item['code'] + '\_' + str(
                    item['lvl'] + 1) + ' (—á–∏—Å–ª–æ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –æ—Ç 1 –¥–æ 3).\n'
                text += materialtext
    if text == '':
        text = '–£ –≤–∞—Å –Ω–µ—Ç –æ—Ä—É–∂–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å!'
    return text


@cwbot.message_handler(func=lambda m: m.text[:7] == '/winfo_')
def winfooom(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        try:
            weaponcode = m.text.split('_')[1]
            weaponlvl = int(m.text.split('_')[2])
        except:
            sendm(cwbot, m.chat.id, '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã!')
            return
        if weaponlvl < 1 or weaponlvl > 3:
            sendm(cwbot, m.chat.id, '–û—Ä—É–∂–∏—è –±—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ 1-3 –ª–≤–ª–æ–≤!')
            return
        objectcode = None
        weapon = get_lvl_weapon(weapon=None, objectcode=objectcode, code=weaponcode, lvl=weaponlvl, need_create=True)
        if weapon == None:
            sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –æ—Ä—É–∂–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
            return
        text = ''
        text += '‚öîÔ∏è|' + weapon['name'] + ' lvl.' + str(weapon['lvl']) + ':\n'
        text += weapon['description'] + '\n'
        if weapon['name'] not in ['–û–≥–Ω–µ–º–µ—Ç', '–†–µ–≤–æ–ª—å–≤–µ—Ä', '–°—é—Ä–∏–∫–µ–Ω—ã']:
            text += 'üí¢–£—Ä–æ–Ω: ' + str(1 + weapon['dmgbonus']) + '-' + str(weapon['cubes'] + weapon['dmgbonus']) + '\n'
        else:
            if weapon['name'] == '–†–µ–≤–æ–ª—å–≤–µ—Ä':
                wdmg = 3
            if weapon['name'] == '–û–≥–Ω–µ–º–µ—Ç':
                wdmg = 1
            if weapon['name'] == '–û–≥–Ω–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª':
                wdmg = 1
            if weapon['name'] == '–°—é—Ä–∏–∫–µ–Ω—ã':
                wdmg = 2
            wdmg += weapon['dmgbonus']
            text += 'üí¢–£—Ä–æ–Ω: ' + str(wdmg) + '\n'
        text += 'üéØ–¢–æ—á–Ω–æ—Å—Ç—å: ' + str(weapon['accuracybonus']) + '\n'
        text += '‚ö°Ô∏è–ó–∞—Ç—Ä–∞—Ç—ã —ç–Ω–µ—Ä–≥–∏–∏: ' + str(weapon['energycost']) + '\n'
        if weapon['ranged']:
            text += 'üéØ–î–∞–ª—å–Ω–æ–±–æ–π–Ω–µ–µ\n'
        else:
            text += 'üëä–ë–ª–∏–∂–Ω–µ–µ\n'
        sendm(cwbot, m.chat.id, text)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


def end_auc(lot):
    owner = cwusers.find_one({'id': lot['owner']})
    item = lot['item']
    if lot['buyer'] != None:
        buyer = cwusers.find_one({'id': lot['buyer']})
        objectcode = generate_object_code(buyer)
        item['objectcode'] = objectcode
        cwusers.update_one({'id': buyer['id']}, {'$set': {'inventory.' + objectcode: item}})
        cwusers.update_one({'id': owner['id']}, {'$inc': {'pogs': lot['cost'] + 1}})
        sendm(cwbot, buyer['id'], '–í—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ –ø—Ä–µ–¥–º–µ—Ç "' + item[
            'name'] + '"! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode)
        sendm(cwbot, owner['id'], '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–∞–ª–∏ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ –ø—Ä–µ–¥–º–µ—Ç "' + item['name'] + '" –∑–∞ ' + str(
            lot['cost']) + 'üëù!')
        cwlogs.send_message(pasyuk_id,
                            '[' + str(buyer['id']) + '] ' + buyer['name'] + ' —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ –ø—Ä–µ–¥–º–µ—Ç "' +
                            item['name'] + '" –∑–∞ ' + str(
                                lot['cost']) + 'üëù —É ' + owner['name'] + ' ' + str(owner['id']) + '!')
        auction.delete_one({'code': lot['code']})
    else:
        objectcode = generate_object_code(owner)
        item['objectcode'] = objectcode
        cwusers.update_one({'id': owner['id']}, {'$set': {'inventory.' + objectcode: item}})
        cwusers.update_one({'id': owner['id']}, {'$inc': {'pogs': 1}})
        sendm(cwbot, owner['id'], '–í–∞—à –ª–æ—Ç "' + item['name'] + ' –Ω–µ –±—ã–ª –ø—Ä–æ–¥–∞–Ω! –ü—Ä–µ–¥–º–µ—Ç - /info_' + objectcode)
        cwlogs.send_message(pasyuk_id, '[' + str(owner['id']) + '] ' + owner['name'] + ' –Ω–µ —Å–º–æ–≥ –ø—Ä–æ–¥–∞—Ç—å –ª–æ—Ç "' + item[
            'name'] + '"!')
        auction.delete_one({'code': lot['code']})


@cwbot.message_handler(commands=['unsetitem'])
def unsetitemm(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        code = m.text.split(' ')[2]
    except:
        sendm(cwbot, m.chat.id, 'error')
        return
    cwusers.update_one({'id': id}, {'$unset': {'inventory.' + code: 1}})
    sendm(cwbot, m.chat.id, 'done')


def auctioncheck():
    while True:
        for ids in auction.find({}):
            if ids['end_time'] - time.time() < 0:
                end_auc(ids)
        time.sleep(10)


threading.Thread(target=auctioncheck, args=[]).start()


def create_auction_lot(user, item, hours, mincost):
    codes = []
    for ids in auction.find({}):
        codes.append(ids['code'])
    code = ''
    while len(code) < 4:
        code += random.choice(["1", "2", "3", "4", "5", "6", "7", "8", "9", "0"])
    while code in codes:
        code = ''
        while len(code) < 4:
            code += random.choice(["1", "2", "3", "4", "5", "6", "7", "8", "9", "0"])
    cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + item['objectcode']: 1}})
    cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': -1}})
    auction.insert_one({'owner': user['id'], 'item': item, 'code': code, 'cost': mincost - 1, 'buyer': None,
                        'end_time': time.time() + hours * 3600})
    return code


@cwbot.message_handler(commands=['viewlots'])
def viewlll(m):
    text = '–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–æ—Ç—ã:\n\n'
    x = auction.find({'owner': m.from_user.id})
    for ids in x:
        if ids['item']['type'] == 'weapon':
            text += ids['item']['name'] + ' lvl.' + str(ids['item']['lvl']) + ': /l_' + ids['code'] + '\n'
        else:
            text += ids['item']['name'] + ': /l_' + ids['code'] + '\n'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(commands=['viewbets'])
def viewlllbets(m):
    text = '–í–∞—à–∏ —Å—Ç–∞–≤–∫–∏:\n\n'
    x = auction.find({'buyer': m.from_user.id})
    for ids in x:
        if ids['item']['type'] == 'weapon':
            text += ids['item']['name'] + ' lvl.' + str(ids['item']['lvl']) + ': /l_' + ids['code'] + '\n'
        else:
            text += ids['item']['name'] + ': /l_' + ids['code'] + '\n'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(commands=['viewalllots'])
def viewallll(m):
    text = '–í—Å–µ –ª–æ—Ç—ã –∞—É–∫—Ü–∏–æ–Ω–∞:\n\n'
    x = auction.find({})
    for ids in x:
        if ids['item']['type'] == 'weapon':
            text += ids['item']['name'] + ' lvl.' + str(ids['item']['lvl']) + ': /l_' + ids['code'] + '\n'
        else:
            text += ids['item']['name'] + ': /l_' + ids['code'] + '\n'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: m.text[:2] == '/c')
def craftttexts(m):
    user = cwusers.find_one({'id': m.from_user.id})
    try:
        item = m.text.split('_')[1]
    # if x == 'wood':
    #     y = "–î–µ—Ä–µ–≤–æ"
    # if x == 'iron_bars':
    #     y = "–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫"
    # if x == 'steel_plate':
    #     y = "–°—Ç–∞–ª—å–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞"
    # if x == 'rope':
    #     y = "–í–µ—Ä—ë–≤–∫–∞"
    # if x == 'kerosene':
    #     y = "–ö–µ—Ä–æ—Å–∏–Ω"
    # if x == 'plastic':
    #     y = "–ü–ª–∞—Å—Ç–∏–∫"
    # if x == 'gunpowder':
    #     y = "–ü–æ—Ä–æ—Ö"
    # if x == 'threads':
    #     y = "–ù–∏—Ç–∫–∏"
    # if x == "diamonds":
    #     y = "–ê–ª–º–∞–∑—ã"
    except:
        text = '–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –≤–∞–º —Ä–µ—Ü–µ–ø—Ç—ã –∫—Ä–∞—Ñ—Ç–∞:\n\n*–ú–µ—à–æ–∫ –∑–æ–ª–æ—Ç–∞* (120 "–ó–æ–ª–æ—Ç–æ" + 10 "–ù–∏—Ç–∫–∞") /c\_100\n\n'
        text += '*–ì—Ä–∞–Ω–∞—Ç–∞* (2 "–ü–æ—Ä–æ—Ö" + 1 "–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_101\n\n'
        text += '*–©–∏—Ç* (2 "–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫" + 5 "–î–µ—Ä–µ–≤–æ" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_102\n\n'
        text += '*–°–≤–µ—Ç–æ–≤–∞—è –≥—Ä–∞–Ω–∞—Ç–∞* (2 "–°—Ç–∞–ª—å–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞" + 2 "–ü–ª–∞—Å—Ç–∏–∫" + 1 "–ü–æ—Ä–æ—Ö" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_103\n\n'
        text += '*–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω* (1 "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã" + 2 "–í–µ—Ä—ë–≤–∫–∞" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_104\n\n'
        text += '*–î–∂–µ—Ç* (1 "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã" + 2 "–í–µ—Ä—ë–≤–∫–∞" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_105\n\n'
        text += '*–•–∏—Ç–∏–Ω* (2 "–°—Ç–∞–ª—å–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_106\n\n'
        text += '*–ö–æ–∫—Ç–µ–π–ª—å –ú–æ–ª–æ—Ç–æ–≤–∞* (1 "–ö–µ—Ä–æ—Å–∏–Ω" + 1 "–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_107\n\n'
        text += '*–ú–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂* (1 "–∂–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫" + 1 "—Å—Ç–∞–ª—å–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞" + 3 "–ü–ª–∞—Å—Ç–∏–∫" + 3 "–ó–æ–ª–æ—Ç–æ") /c\_108\n\n'
        sendm(cwbot, m.chat.id, text, parse_mode="markdown")
        return
    allow = False
    if item == "100":
        if user['gold'] >= 120:
            try:
                if user['resources']['threads'] >= 10:
                    allow = True
            except:
                pass
        if not allow:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!')
            return
        cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -120, 'pogs': 1, 'resources.threads': -10}})
        sendm(cwbot, m.chat.id,
                           "–°–æ–∑–¥–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: \"üëù–ú–µ—à–æ–∫ –∑–æ–ª–æ—Ç–∞\"! –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å 100 –∑–æ–ª–æ—Ç–∞ - /unwrappog.")
        return
    allow = True
    if item == "101":
        res = {'gunpowder': 2, 'ironbars': 1}
        gold = 3
        result = "grenade"
    if item == "102":
        res = {'wood': 5, 'ironbars': 2}
        gold = 3
        result = "shield"
    if item == "103":
        res = {'steelplate': 2, 'plastic': 2, "gunpowder": 1}
        gold = 3
        result = "flash"
    if item == "104":
        res = {'medicalcomponents': 1, 'rope': 2}
        gold = 3
        result = "adrenaline"
    if item == "105":
        res = {'medicalcomponents': 1, 'rope': 2}
        gold = 3
        result = "dzet"
    if item == "106":
        res = {'steelplate': 2}
        gold = 3
        result = "hitin"
    if item == "107":
        res = {'kerosene': 1, "ironbars": 1}
        gold = 3
        result = "molotov"
    if item == "108":
        res = {'ironbars': 1, "steelplate": 1, 'plastic': 3}
        gold = 3
        result = "knife"
    if user['gold'] < gold:
        allow = False
    for ids in res:
        try:
            if user['resources'][ids] < res[ids]:
                allow = False
                break
        except:
            allow = False
            break
    if not allow:
        sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!')
        return
    if result not in user['items']:
        cwusers.update_one({'id': user['id']}, {'$set': {'items.' + result: 1}})
    else:
        cwusers.update_one({'id': user['id']}, {'$inc': {'items.' + result: 1}})
    for ids in res:
        cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + ids: -res[ids]}})
    cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -gold}})
    sendm(cwbot, m.chat.id, '–°–æ–∑–¥–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: "' + get_cw_battleitem_name(result) + '"!')


@cwbot.message_handler(commands=['removeitem'])
def removeii(m):
    if m.from_user.id != 441399484:
        return
    try:
        id = int(m.text.split(' ')[1])
        item = m.text.split(' ')[2]
    except:
        pass
    user = cwusers.find_one({'id': id})
    sendm(cwbot, m.chat.id, str(user['items']))
    cwusers.update_one({'id': user['id']}, {'$inc': {'items.' + item: -1}})
    sendm(cwbot, m.chat.id, 'removed 1 ' + item + '!')


@cwbot.message_handler(commands=['giveitem'])
def removeii(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        id = int(m.text.split(' ')[1])
        item = m.text.split(' ')[2]
    except:
        pass
    user = cwusers.find_one({'id': id})
    sendm(cwbot, m.chat.id, str(user['items']))
    cwusers.update_one({'id': user['id']}, {'$inc': {'items.' + item: 1}})
    sendm(cwbot, m.chat.id, 'gived 1 ' + item + '!')


def generate_birzha_code():
    codes = []
    for ids in resourceauc.find({}):
        print(ids)
        try:
            codes.append(ids['wtscode'])
        except:
            resourceauc.delete_one({'_id': ids['_id']})
    code = ''
    numbers = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0']
    while len(code) < 10:
        code += random.choice(numbers)
    while code in codes:
        code = ''
        while len(code) < 10:
            code += random.choice(numbers)
    return code


@cwbot.message_handler(func=lambda m: m.text[:5] == '/wts_')
def wtssitewmss(m):
    if m.from_user.id in auction_wait:
        return
    auction_wait.append(m.from_user.id)
    try:
        itemcode = m.text.split('_')[1]
        amount = int(m.text.split('_')[2])
        cost = int(m.text.split('_')[3])
    except:
        sendm(cwbot, m.chat.id,
                           '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã! –ü—Ä–∏–º–µ—Ä:\n/wts_wood_10_3\n10 - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–∞ "–¥–µ—Ä–µ–≤–æ", 3 - —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–π —à—Ç—É–∫–∏.')
        auction_wait.remove(m.from_user.id)
        return
    if itemcode == 'yaroslavwood':
        sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è –ø—Ä–æ–¥–∞—Ç—å –ø–æ–ª–µ–Ω–æ –Ø—Ä–æ—Å–ª–∞–≤–∞ - –µ–≥–æ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∑–∞–±—Ä–∞—Ç—å –≤ –±–æ—é!')
        auction_wait.remove(m.from_user.id)
        return
    if cost < 1:
        sendm(cwbot, m.chat.id, '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ - 1üí∞!')
        auction_wait.remove(m.from_user.id)
        return
    if cost > 100000000:
        sendm(cwbot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ - 100000000üí∞!')
        auction_wait.remove(m.from_user.id)
        return
    if amount < 1:
        sendm(cwbot, m.chat.id, '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã!')
        auction_wait.remove(m.from_user.id)
        return
    user = cwusers.find_one({'id': m.from_user.id})
    if itemcode not in user['resources']:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å —ç—Ç–æ–≥–æ –Ω–µ—Ç!')
        auction_wait.remove(m.from_user.id)
        return
    if user['resources'][itemcode] < amount:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å —Å—Ç–æ–ª—å–∫–æ –Ω–µ—Ç!')
        auction_wait.remove(m.from_user.id)
        return
    if len(user['birzha']) > 2:
        sendm(cwbot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–æ—Ç–æ–≤ –Ω–∞ –±–∏—Ä–∂–µ - 3!')
        auction_wait.remove(m.from_user.id)
        return
    newc = generate_birzha_code()
    resourceauc.insert_one(
        {'item': itemcode, 'owner': user['id'], 'amount': amount, 'cost': cost, 'time': time.time(), 'wtscode': newc})
    cwusers.update_one({'id': user['id']}, {'$push': {'birzha': newc}})
    cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + itemcode: -amount}})
    sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—Å—Ç–∞–≤–∏–ª–∏ ' + str(amount) + ' —à—Ç—É–∫ —Ç–æ–≤–∞—Ä–∞ "' + resource_to_name(
        itemcode) + '" –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –ø–æ ' + str(cost) + 'üí∞! –û—Ç–º–µ–Ω–∏—Ç—å - /bcancel_' + newc)
    auction_wait.remove(m.from_user.id)


@cwbot.message_handler(func=lambda m: m.text[:9] == '/bcancel_')
def wtssitewmsscancel(m):
    wtbqueue.append([m, 'cancel'])


def cancel_exchange_resource(m):
    try:
        itemcode = m.text.split('_')[1]
    except:
        return
    lot = resourceauc.find_one({'wtscode': itemcode})
    if lot == None:
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –ª–æ—Ç–∞ —É –≤–∞—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    if lot['owner'] != m.from_user.id:
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –ª–æ—Ç–∞ —É –≤–∞—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    cwusers.update_one({'id': m.from_user.id}, {'$inc': {'resources.' + lot['item']: lot['amount']}})
    resourceauc.delete_many({'wtscode': itemcode})
    cwusers.update_one({'id': m.from_user.id}, {'$pull': {'birzha': itemcode}})
    sendm(cwbot, m.chat.id, '–õ–æ—Ç –æ—Ç–º–µ–Ω—ë–Ω!')


@cwbot.message_handler(func=lambda m: m.text[:3] == '/t_')
def showitemsss(m):
    try:
        itemcode = m.text.split('_')[1]
    except:
        sendm(cwbot, m.chat.id, '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã! –ü—Ä–∏–º–µ—Ä:\n/t_wood')
        return
    resname = resource_to_name(itemcode)
    if resname == '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ':
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    mincost = 10001
    top1 = {'amount': 0, 'cost': 0}
    top2 = {'amount': 0, 'cost': 0}
    top3 = {'amount': 0, 'cost': 0}
    x = resourceauc.find({'item': itemcode})
    y = []
    for ids in x:
        y.append(ids)
    bancost = []
    for ids in y:
        if ids['cost'] < mincost:
            mincost = ids['cost']
    top1['cost'] = mincost
    for ids in y:
        if ids['cost'] == mincost:
            top1['amount'] += ids['amount']
    bancost.append(mincost)
    mincost = 10001
    for ids in y:
        if ids['cost'] > bancost[0]:
            if ids['cost'] < mincost:
                mincost = ids['cost']
    top2['cost'] = mincost
    for ids in y:
        if ids['cost'] == mincost:
            top2['amount'] += ids['amount']

    bancost.append(mincost)
    mincost = 10001
    for ids in y:
        if ids['cost'] > bancost[1]:
            if ids['cost'] < mincost:
                mincost = ids['cost']
    top3['cost'] = mincost
    for ids in y:
        if ids['cost'] == mincost:
            top3['amount'] += ids['amount']

    text = '*' + resname + '*:\n'
    if top1['amount'] > 0:
        text += str(top1['amount']) + '—à—Ç. –ø–æ ' + str(top1['cost']) + 'üí∞\n'
    if top2['amount'] > 0:
        text += str(top2['amount']) + '—à—Ç. –ø–æ ' + str(top2['cost']) + 'üí∞\n'
    if top3['amount'] > 0:
        text += str(top3['amount']) + '—à—Ç. –ø–æ ' + str(top3['cost']) + 'üí∞\n'
    if top1['amount'] == 0:
        text += '–≠—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å –µ—â–µ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ–¥–∞–µ—Ç!'
    else:
        text += '–ö—É–ø–∏—Ç—å 1 —à—Ç—É–∫—É: /wtb\_' + itemcode + '\_1 (–∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å —á–∏—Å–ª–æ –≤ –∫–æ–Ω—Ü–µ –Ω–∞ –∂–µ–ª–∞–µ–º–æ–µ).'
    sendm(cwbot, m.chat.id, text, parse_mode='markdown')


@cwbot.message_handler(func=lambda m: m.text[:5] == '/wtb_')
def wtbbitewmss(m):
    wtbqueue.append([m, 'wtb'])


def buy_exchange_resource(m):
    try:
        try:
            itemcode = m.text.split('_')[1]
            amount = int(m.text.split('_')[2])
        except:
            sendm(cwbot, m.chat.id,
                               '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã! –ü—Ä–∏–º–µ—Ä:\n/wtb_wood_10\n10 - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–∞ "–¥–µ—Ä–µ–≤–æ".')
            return
        resname = resource_to_name(itemcode)
        if resname == '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ':
            sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
            return
        sendm(cwbot, m.chat.id, '–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–∫—É–ø–∫–∞...')
        x = resourceauc.find({'item': itemcode})
        y = []
        for ids in x:
            y.append(ids)
        user = cwusers.find_one({'id': m.from_user.id})
        gold = user['gold']
        boughts = {}

        mincost = 10001
        for ids in y:
            if ids['cost'] < mincost and ids['owner'] != user['id'] and ids['amount'] > 0:
                mincost = ids['cost']

        while amount > 0:
            lot = None
            for ids in y:
                if ids['cost'] == mincost and ids['owner'] != user['id'] and ids['amount'] > 0:
                    lot = ids
                    break
            if lot != None:
                while lot['amount'] > 0 and user['gold'] >= lot['cost'] and amount > 0:
                    lot['amount'] -= 1
                    user['gold'] -= lot['cost']
                    amount -= 1
                    if lot['_id'] not in boughts:
                        boughts[lot['_id']] = {'amount': 1, 'owner': lot['owner'], 'cost': lot['cost'],
                                               'wtscode': lot['wtscode']}
                    else:
                        boughts[lot['_id']]['amount'] += 1
                if user['gold'] < lot['cost']:
                    break
            else:
                break
        buyamount = 0
        buygold = 0
        for ids in boughts:
            buyamount += boughts[ids]['amount']
            buygold += boughts[ids]['amount'] * boughts[ids]['cost']
            resourceauc.update_one({'_id': ids}, {'$inc': {'amount': -boughts[ids]['amount']}})
            cwusers.update_one({'id': boughts[ids]['owner']},
                               {'$inc': {'gold': boughts[ids]['amount'] * boughts[ids]['cost']}})
            cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -(boughts[ids]['amount'] * boughts[ids]['cost'])}})
            if itemcode not in user['resources']:
                cwusers.update_one({'id': user['id']}, {'$set': {'resources.' + itemcode: boughts[ids]['amount']}})
            else:
                cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + itemcode: boughts[ids]['amount']}})
        for ids in boughts:
            x = resourceauc.find_one({'_id': ids})
            if x['amount'] <= 0:
                cwusers.update_one({'id': boughts[ids]['owner']}, {'$pull': {'birzha': boughts[ids]['wtscode']}})
        resourceauc.delete_many({'amount': {'$lt': 1}})
        sendm(cwbot, m.chat.id,
                           '–í—ã –∫—É–ø–∏–ª–∏ ' + str(buyamount) + '—à—Ç. —Ä–µ—Å—É—Ä—Å–∞ "' + resname + '" –∑–∞ ' + str(buygold) + 'üí∞!')
        sellerstext = ''
        for ids in boughts:
            sellerstext += cwusers.find_one({'id': boughts[ids]['owner']})['name'] + '(' + str(
                boughts[ids]['owner']) + ')\n'
        cwlogs.send_message(pasyuk_id,
                            '[' + str(user['id']) + ' ' + user['name'] + ']:\n' + '–í—ã –∫—É–ø–∏–ª–∏ ' + str(
                                buyamount) + '—à—Ç. —Ä–µ—Å—É—Ä—Å–∞ "' + resname + '" –∑–∞ ' + str(
                                buygold) + 'üí∞! –ü—Ä–æ–¥–∞–≤—Ü—ã:\n' + sellerstext)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(commands=['repairbirzha'])
def repairb(m):
    if m.from_user.id != pasyuk_id:
        return
    text = 'fixes:\n'
    for ids in cwusers.find({}):
        for idss in ids['birzha']:
            if resourceauc.find_one({'wtscode': idss}) == None:
                cwusers.update_one({'id': ids['id']}, {'$pull': {'birzha': idss}})
                text += 'fixed ' + ids['name'] + '\n'
    sendm(cwbot, m.chat.id, text)


def checkwtbqueue():
    while True:
        wremove = []
        for ids in wtbqueue:
            if ids[1] == 'wtb':
                buy_exchange_resource(ids[0])
            else:
                cancel_exchange_resource(ids[0])
            wremove.append(ids)
        for ids in wremove:
            wtbqueue.remove(ids)
        time.sleep(0.1)


threading.Thread(target=checkwtbqueue, args=[]).start()


@cwbot.message_handler(commands=['unwrappog'])
def unwrapp(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['pogs'] <= 0:
        sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üëù–º–µ—à–∫–æ–≤ –∑–æ–ª–æ—Ç–∞!')
        return
    cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': -1, 'gold': 100}})
    sendm(cwbot, m.chat.id, '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: üëù–ú–µ—à–æ–∫ –∑–æ–ª–æ—Ç–∞. –ü–æ–ª—É—á–µ–Ω–æ: 100üí∞')


@cwbot.message_handler(func=lambda m: m.text[:4] == "/auc")
def sellitemaucc(m):
    try:
        if m.from_user.id in auction_wait:
            return
        auction_wait.append(m.from_user.id)
        user = cwusers.find_one({'id': m.from_user.id})
        try:
            item = m.text.split('_')[1]
        except:
            auction_wait.remove(m.from_user.id)
            return
        try:
            mincost = int(m.text.split('_')[3])
        except:
            mincost = 1
        if mincost < 1:
            sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è –≤—ã—Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É —Å—Ç–∞–≤–∫–∏ –Ω–∏–∂–µ 1!')
            auction_wait.remove(m.from_user.id)
            return
        if mincost >= 1000000:
            sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è –≤—ã—Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É —Å—Ç–∞–≤–∫–∏ –≤—ã—à–µ –º–∏–ª–ª–∏–æ–Ω–∞!')
            auction_wait.remove(m.from_user.id)
            return
        if item not in user['inventory']:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –Ω–µ—Ç —ç—Ç–æ–≥–æ!')
            auction_wait.remove(m.from_user.id)
            return
        if user['pogs'] < 1:
            sendm(cwbot, m.chat.id, '–í–∞–º –Ω—É–∂–µ–Ω 1üëù –¥–ª—è –∑–∞–ª–æ–≥–∞!')
            auction_wait.remove(m.from_user.id)
            return
        try:
            hours = int(m.text.split('_')[2])
            if hours < 1:
                hours = 1
        except:
            hours = 3
        if hours > 48:
            sendm(cwbot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ª–æ—Ç–∞ - 48 —á–∞—Å–æ–≤!')
            auction_wait.remove(m.from_user.id)
            return
        item = user['inventory'][item]
        code = create_auction_lot(user, item, hours, mincost)
        sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –ª–æ—Ç –ø—Ä–µ–¥–º–µ—Ç–∞ "' + item['name'] + '" –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤ ' + str(
            hours) + ' —á–∞—Å–∞(–æ–≤). –ü—Ä–æ—Å–º–æ—Ç—Ä - /l_' + code)
        auction_wait.remove(m.from_user.id)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:5] == "/bet_")
def bettaucc(m):
    lot = None
    try:
        code = m.text.split('_')[1]
        amount = int(m.text.split('_')[2])
    except:
        return
    for ids in auction.find({}):
        if ids['code'] == code:
            lot = ids
            break
    if lot == None:
        sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –ª–æ—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    if lot['cost'] >= amount:
        sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–µ–π!')
        return
    user = cwusers.find_one({'id': m.from_user.id})
    if user['pogs'] < amount:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —Å—Ç–æ–ª—å–∫–æ üëù–ø–æ–≥–æ–≤!')
        return
    if user['id'] == lot['owner']:
        sendm(cwbot, m.chat.id, '–ù–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –Ω–∞ —Å–≤–æ–π –ª–æ—Ç!')
        return
    if user['id'] == lot['buyer']:
        sendm(cwbot, m.chat.id, '–í—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–∫—É –Ω–∞ —ç—Ç–æ—Ç –ª–æ—Ç!')
        return
    end_time = lot['end_time']
    if end_time - time.time() <= 15 * 60:
        end_time = time.time() + 15 * 60
    if lot['buyer'] != None:
        buyer = cwusers.find_one({'id': lot['buyer']})
        cwusers.update_one({'id': buyer['id']}, {'$inc': {'pogs': lot['cost']}})
        try:
            sendm(cwbot, buyer['id'], "–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–±–∏—Ç–∞! –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ—Ç–∞ - /l_" + code)
        except:
            pass
    cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': -amount}})
    auction.update_one({'code': code}, {'$set': {'buyer': m.from_user.id, 'cost': amount, 'end_time': end_time}})
    sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Å–¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–∫—É! –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ—Ç–∞ - /l_' + code)


@cwbot.message_handler(func=lambda m: m.text[:3] == "/l_")
def watchitemaucc(m):
    try:
        code = m.text.split('_')[1]
    except:
        return
    text = get_lot_info(code, m)
    sendm(cwbot, m.chat.id, text)


def get_lot_info(code, m):
    try:
        lot = None
        for ids in auction.find({}):
            if ids['code'] == code:
                lot = ids
                break
        if lot == None:
            return '–¢–∞–∫–æ–≥–æ –ª–æ—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!'
        text = ''
        if ids['item']['type'] == 'weapon' and ids['item']['lvl'] == 4:
            text += '–õ–æ—Ç ' + code + ' - "' + ids['item']['name'] + ' lvl.' + str(ids['item']['lvl']) + ' mod.' + str(
                ids['item']['modification']) + ' (' + str(ids['item']['kills']) + ' –¥—É—à)"\n'
        elif ids['item']['type'] == 'weapon' or ids['item']['type'] == "scroll":
            text += '–õ–æ—Ç ' + code + ' - "' + ids['item']['name'] + ' lvl.' + str(ids['item']['lvl']) + '"\n'
        elif ids['item']['type'] == 'essence':
            text += '–õ–æ—Ç ' + code + ' - "' + ids['item']['name'] + ' ('+str(ids['item']['kills'])+' –¥—É—à)"\n'
        else:
            text += '–õ–æ—Ç ' + code + ' - "' + ids['item']['name'] + '"\n'
        text += '–¶–µ–Ω–∞ - ' + str(ids['cost']) + 'üëù\n'
        if ids['buyer'] == None:
            buyer = "–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
        else:
            buyeruser = cwusers.find_one({'id': ids['buyer']})
            if buyeruser['id'] == m.from_user.id:
                buyer = "–í—ã"
            else:
                buyer = castle_to_emoji(buyeruser['castle'])
        text += '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å - ' + buyer + '\n'
        timeleft = 0
        hours = 0
        mins = 0
        secs = ids['end_time'] - time.time()
        while secs >= 60:
            secs -= 60
            mins += 1
        while mins >= 60:
            hours += 1
            mins -= 60
        if hours >= 1:
            timeleft = str(hours) + '—á' + str(mins) + '–º'
        else:
            timeleft = str(mins) + '–º'
        if mins < 1:
            timeleft = "–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥"
        text += '–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è: ' + timeleft + '\n'
        if ids['owner'] != m.from_user.id:
            text += '–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É - /bet_' + code + '_' + str(ids['cost'] + 1) + '\n'
        else:
            text += '–û—Ç–º–µ–Ω–∏—Ç—å –ª–æ—Ç - /cancellot_' + code + '\n'
        return text
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:7] == "/wcraft")
def wcraftttm(m):
    user = cwusers.find_one({'id': m.from_user.id})
    try:
        itemcode = m.text.split('_')[1]
    except:
        return
    if itemcode not in user['inventory']:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –Ω–µ—Ç —ç—Ç–æ–≥–æ!')
        return
    recipe = user['inventory'][itemcode]
    if recipe['type'] != 'recipe':
        sendm(cwbot, m.chat.id, '–≠—Ç–æ –Ω–µ —Ä–µ—Ü–µ–ø—Ç!')
        return
    materials = get_materials_for_craft(recipe)
    gold = materials['gold']
    if user['gold'] < gold:
        sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!')
        return
    allow = True
    for ids in materials:
        ids_not_recipe = True
        try:
            if ids.split('_')[0] == 'recipe':
                ids_not_recipe = False
        except:
            pass
        if ids != 'gold' and ids_not_recipe:
            try:
                if user['resources'][ids] < materials[ids]:
                    allow = False
                    break
            except:
                allow = False
                break
    if not allow:
        sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!')
        return

    objectcode = generate_object_code(user)
    weapon = get_lvl_weapon(weapon=None, objectcode=objectcode, code=recipe['code'].split('_')[1], lvl=1,
                            need_create=True)
    cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: weapon}})
    cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + itemcode: 1}})
    for ids in materials:
        if ids != 'gold' and 'recipe' not in ids:
            cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + ids: -materials[ids]}})
    cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -gold}})
    sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —Å–∫—Ä–∞—Ñ—Ç–∏–ª–∏ –æ—Ä—É–∂–∏–µ "' + weapon['name'] + ' lvl.' + str(
        weapon['lvl']) + '"! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode + '.')
    sendm(cwbot, pasyuk_id,
                       '[' + str(user['id']) + ' ' + user['name'] + ']:\n' + '–í—ã —É—Å–ø–µ—à–Ω–æ —Å–∫—Ä–∞—Ñ—Ç–∏–ª–∏ –æ—Ä—É–∂–∏–µ "' + weapon[
                           'name'] + ' lvl.' + str(weapon['lvl']) + '"! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode + '.')


@cwbot.message_handler(func=lambda m: m.text[:7] == "/wlvlup")
def wlvluppppm(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        try:
            itemcode = m.text.split('_')[1]
        except:
            return
        weapon = None
        if itemcode in user['inventory']:
            weapon = user['inventory'][itemcode]
        if weapon == None:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –Ω–µ—Ç —ç—Ç–æ–≥–æ!')
            return
        if weapon['type'] != 'weapon':
            sendm(cwbot, m.chat.id, '–≠—Ç–æ –Ω–µ –æ—Ä—É–∂–∏–µ!')
            return
        if weapon['lvl'] >= 3:
            sendm(cwbot, m.chat.id, '–û—Ä—É–∂–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!')
            return
        materials = get_materials_for_upgrade(weapon)
        gold = materials['gold']
        if user['gold'] < gold:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!')
            return
        allow = True
        hasrecipe = False
        for ids in materials:
            ids_not_recipe = True
            try:
                if ids.split('_')[0] == 'recipe':
                    ids_not_recipe = False
            except:
                pass
            if ids != 'gold' and ids_not_recipe:
                try:
                    if user['resources'][ids] < materials[ids]:
                        allow = False
                        break
                except:
                    allow = False
                    break
            if not ids_not_recipe:
                for idss in user['inventory']:
                    if user['inventory'][idss]['type'] == 'recipe' and user['inventory'][idss]['code'] == ids:
                        hasrecipe = True
                        recipeobjectcode = user['inventory'][idss]['objectcode']
                        break
        if not allow:
            sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!')
            return
        if weapon['code'] not in ['pistol', 'shortsword']:
            if not hasrecipe:
                sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–∞!')
                return

        objectcode = weapon['objectcode']
        weapon['lvl'] += 1
        weapon = get_lvl_weapon(weapon, objectcode)
        cwusers.update_one({'id': user['id']}, {'$set': {'inventory.' + objectcode: weapon}})
        if weapon['code'] not in ['pistol', 'shortsword']:
            cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + recipeobjectcode: 1}})
        for ids in materials:
            if ids != 'gold' and 'recipe' not in ids:
                cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + ids: -materials[ids]}})
        cwusers.update_one({'id': user['id']}, {'$inc': {'gold': -gold}})
        sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ —É–ª—É—á—à–∏–ª–∏ –æ—Ä—É–∂–∏–µ "' + weapon['name'] + '" –¥–æ —É—Ä–æ–≤–Ω—è ' + str(
            weapon['lvl']) + '! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode + '.')
        sendm(cwbot, pasyuk_id,
                           '[' + str(user['id']) + ' ' + user['name'] + ']:\n' + '–í—ã —É—Å–ø–µ—à–Ω–æ —É–ª—É—á—à–∏–ª–∏ –æ—Ä—É–∂–∏–µ "' +
                           weapon['name'] + '" –¥–æ —É—Ä–æ–≤–Ω—è ' + str(
                               weapon['lvl']) + '! –ü—Ä–æ—Å–º–æ—Ç—Ä - /info_' + objectcode + '.')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: is_craft_message(m))
def craftsssmsggg(m):
    user = cwusers.find_one({'id': m.from_user.id})
    kb = craft_kb()
    text = "–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ —É–ª—É—á—à–∏—Ç—å –æ—Ä—É–∂–∏–µ.\n–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –≤–∞–º —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∫—Ä–∞—Ñ—Ç–∞ - /c."
    # crafttext = get_craft_text(user)
    # kb = types.ReplyKeyboardMarkup()
    sendm(cwbot, m.chat.id, text, reply_markup=kb, parse_mode='markdown')


@cwbot.message_handler(func=lambda m: is_create_weapon_message(m))
def createwmsggg(m):
    user = cwusers.find_one({'id': m.from_user.id})
    crafttext = get_craft_text(user)
    # kb = types.ReplyKeyboardMarkup()
    sendm(cwbot, m.chat.id, crafttext, parse_mode='markdown')


@cwbot.message_handler(func=lambda m: is_upgrade_weapon_message(m))
def createwmsggg(m):
    user = cwusers.find_one({'id': m.from_user.id})
    crafttext = get_upgrade_text(user)
    # kb = types.ReplyKeyboardMarkup()
    sendm(cwbot, m.chat.id, crafttext, parse_mode='markdown')


@cwbot.message_handler(func=lambda m: m.text[:4] == "/buy")
def shop_buysss(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user['current_act'] in busy_acts:
        sendm(cwbot, m.chat.id, '–í—ã —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ.')
        return
    try:
        category = m.text.split("_")[1]
    except:
        return
    if category == "scroll":
        try:
            scrollname = m.text.split("_")[2]
            if scrollname not in scrolls_to_sale:
                sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ —Å–≤–∏—Ç–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
                return
            scroll = scrolls_to_sale[scrollname]
            if user['gold'] < scroll['cost']:
                sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç üí∞–∑–æ–ª–æ—Ç–∞!')
                return
            cwusers.update_one({'id': m.from_user.id}, {'$inc': {'gold': -scroll['cost']}})
            objectcode = generate_object_code(user)
            cwusers.update_one({'id': m.from_user.id},
                               {'$set': {'inventory.' + objectcode: create_scroll(scroll, objectcode)}})
            sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∏ —Å–≤–∏—Ç–æ–∫ "' + scroll['name'] + ' lvl.' + str(
                scroll['lvl']) + '"! –ò–∑—É—á–∏—Ç—å –Ω–∞–≤—ã–∫ - /use_' + objectcode + '.')
        except:
            pass
            # sendm(cwbot, pasyuk_id, traceback.format_exc())

    elif category == "weapon":
        try:
            weaponname = m.text.split("_")[2]
            if weaponname not in weapons_to_sale:
                sendm(cwbot, m.chat.id, '–¢–∞–∫–æ–≥–æ –æ—Ä—É–∂–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
                return
            weapon = weapons_to_sale[weaponname]
            if user['gold'] < weapon['cost']:
                sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç üí∞–∑–æ–ª–æ—Ç–∞!')
                return
            cwusers.update_one({'id': m.from_user.id}, {'$inc': {'gold': -weapon['cost']}})
            objectcode = generate_object_code(user)
            cwusers.update_one({'id': m.from_user.id},
                               {'$set': {'inventory.' + objectcode: create_weapon(weapon, objectcode)}})
            sendm(cwbot, m.chat.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∏ –æ—Ä—É–∂–∏–µ "' + weapon['name'] + ' lvl.' + str(
                weapon['lvl']) + '"! –≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å - /on_' + objectcode + \
                               ', —ç–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∏—Ç–≤—ã –∑–∞–º–∫–æ–≤ - /on_' + objectcode + '_castlefight.')
        except:
            sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:5] == "/info")
def items_infooo(m):
    user = cwusers.find_one({'id': m.from_user.id})
    itemcode = m.text.split('_')[1]
    if itemcode not in user['inventory']:
        sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!')
        return
    item = user['inventory'][itemcode]
    text = ''
    if item['type'] == 'weapon':
        if item['lvl'] != 4:
            text += '‚öîÔ∏è|' + item['name'] + ' lvl.' + str(item['lvl']) + ':\n'
        else:
            text += '‚öîÔ∏è|' + item['name'] + ' lvl.' + str(item['lvl']) + ' mod.'+str(item['modification'])+':\n'
        text += item['description'] + '\n'
        if item['name'] not in ['–û–≥–Ω–µ–º–µ—Ç', '–†–µ–≤–æ–ª—å–≤–µ—Ä', '–°—é—Ä–∏–∫–µ–Ω—ã']:
            text += 'üí¢–£—Ä–æ–Ω: ' + str(1 + item['dmgbonus']) + '-' + str(item['cubes'] + item['dmgbonus']) + '\n'
        else:
            if item['name'] == '–†–µ–≤–æ–ª—å–≤–µ—Ä':
                wdmg = 3
            if item['name'] == '–û–≥–Ω–µ–º–µ—Ç':
                wdmg = 1
                try:
                    if item['lvl'] == 4 and item['modification'] == 2:
                        wdmg = 0
                except:
                    pass
            if item['name'] == '–°—é—Ä–∏–∫–µ–Ω—ã':
                wdmg = 2
            wdmg += item['dmgbonus']
            text += 'üí¢–£—Ä–æ–Ω: ' + str(wdmg) + '\n'
        text += 'üéØ–¢–æ—á–Ω–æ—Å—Ç—å: ' + str(item['accuracybonus']) + '\n'
        text += '‚ö°Ô∏è–ó–∞—Ç—Ä–∞—Ç—ã —ç–Ω–µ—Ä–≥–∏–∏: ' + str(item['energycost']) + '\n'
        if item['ranged']:
            text += 'üéØ–î–∞–ª—å–Ω–æ–±–æ–π–Ω–µ–µ\n'
        else:
            text += 'üëä–ë–ª–∏–∂–Ω–µ–µ\n'
        if item['lvl'] == 4:
            text += 'üåê–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥—É—â–∏: '+str(item['kills'])+'\n'
        text += '–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å: /on_' + itemcode + '\n'
    if item['type'] == 'scroll':
        text += 'üìú|–°–≤–∏—Ç–æ–∫ –Ω–∞–≤—ã–∫–∞ "' + item['name'] + '" (' + str(item['lvl']) + '–ª–≤–ª):\n'
        text += item['description'] + '\n'
        text += '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: /use_' + itemcode + '\n'
    if item['type'] == 'recipe':
        text += 'üìì|' + item['name'] + '\n'
    if item['type'] == 'undefined_recipe':
        emoj = "üìï"
        etext = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
        if item['code'] == "recipe_red":
            emoj = "üìï"
            etext = "–ö—Ä–∞—Å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç"
        if item['code'] == "recipe_green":
            emoj = "üìó"
            etext = "–ó–µ–ª—ë–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç"
        if item['code'] == "recipe_blue":
            emoj = "üìò"
            etext = "–°–∏–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç"
        text += emoj + '|' + etext + '\n'
    if item['type'] == 'undefined_scroll':
        text += 'üóû|' + item['description'] + '\n'
    if item['type'] == 'essence':
        text += 'üåê|'+item['name']+':\n'
        text += item['description'] + '\n'
        text += 'üåê|–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥—É—à–∏: '+str(item['kills'])+'\n'
    sendm(cwbot, m.chat.id, text)


@cwbot.message_handler(func=lambda m: m.text[:3] == "/on")
def item_useee(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        if user['current_act'] in busy_acts:
            sendm(cwbot, m.chat.id, '–í—ã —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ.')
            return
        itemcode = m.text.split('_')[1]
        if itemcode not in user['inventory']:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!')
            return
        item = user['inventory'][itemcode]
        if item['type'] == 'weapon':
            w_not_none = False
            if user['weapon'] != None:
                w_not_none = True
            w = item
            if w_not_none:
                cwusers.update_one({'id': user['id']},
                                   {'$set': {'weapon': w, 'inventory.' + user['weapon']['objectcode']: user['weapon']}})
            else:
                cwusers.update_one({'id': user['id']}, {'$set': {'weapon': w}})
            cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + w['objectcode']: 1}})
            sendm(cwbot, m.chat.id, '‚öîÔ∏è|–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + w['name'] + ' lvl.' + str(w['lvl']))
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:4] == "/off")
def item_useee(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        if user['current_act'] in busy_acts:
            sendm(cwbot, m.chat.id, '–í—ã —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ.')
            return
        itemcode = m.text.split('_')[1]
        if itemcode not in user['equipped_skills']:
            sendm(cwbot, m.chat.id, '–≠—Ç–æ—Ç —Å–∫–∏–ª–ª —É –≤–∞—Å –Ω–µ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!')
            return
        item = user['equipped_skills'][itemcode]
        # if itemcode == 'greedy':
        #    if time.time() - user['equipped_greedy'] < 60*60*8:
        #        sendm(cwbot, m.chat.id, '–≠—Ç–æ—Ç —Å–∫–∏–ª–ª –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–ø—É—Å—Ç—è 8 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏!')
        #        return
        if itemcode == 'goodsleep':
            if time.time() - user['equipped_goodsleep'] < 60 * 60 * 6:
                sendm(cwbot, m.chat.id, '–≠—Ç–æ—Ç —Å–∫–∏–ª–ª –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–ø—É—Å—Ç—è 6 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏!')
                return
        if item['type'] == 'skill':
            cwusers.update_one({'id': user['id']}, {'$unset': {'equipped_skills.' + item['skillcode']: 1}})
            sendm(cwbot, m.chat.id, 'üß¨|–°–Ω—è—Ç–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: "' + item['name'] + ' lvl.' + str(item['lvl']) + '".')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:6] == "/lvlup")
def skillss_lvlupp(m):
    try:
        user = cwusers.find_one({'id': m.from_user.id})
        try:
            skillcode = m.text.split('_')[1]
        except:
            text = get_user_skills_lvlup_text(user)
            sendm(cwbot, m.chat.id, text)
            return
        if user['current_act'] in busy_acts:
            sendm(cwbot, m.chat.id, '–í—ã —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ.')
            return
        if skillcode not in user['skills']:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ —Å–∫–∏–ª–ª–∞!')
            return
        if skillcode in user['equipped_skills']:
            sendm(cwbot, m.chat.id, '–ß—Ç–æ–±—ã —É–ª—É—á—à–∞—Ç—å —Å–∫–∏–ª–ª, –µ–≥–æ –Ω–∞–¥–æ —Å–Ω—è—Ç—å!')
            return
        skill = user['skills'][skillcode]
        if skill['type'] == 'skill':
            needp = 100
            if skill['lvl'] == 1:
                needp = 3
            elif skill['lvl'] == 2:
                needp = 9
            elif skill['lvl'] == 3:
                sendm(cwbot, m.chat.id, '–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–∫–∏–ª–ª–∞ - 3!')
                return
            if user['lvl_points'] < needp:
                sendm(cwbot, m.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤!')
                return
            hasscroll = False
            for idss in user['inventory']:
                if user['inventory'][idss]['type'] == 'undefined_scroll':
                    hasscroll = True
                    recipeobjectcode = user['inventory'][idss]['objectcode']
                    break
            if not hasscroll:
                sendm(cwbot, m.chat.id, '–î–ª—è —ç—Ç–æ–≥–æ –≤–∞–º –Ω—É–∂–µ–Ω —Å–≤–∏—Ç–æ–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏!')
                return
            cwusers.update_one({'id': user['id']},
                               {'$inc': {'skills.' + skill['skillcode'] + '.lvl': 1, 'lvl_points': -needp}})
            skill['lvl'] += 1
            cwusers.update_one({'id': user['id']}, {
                '$set': {'skills.' + skill['skillcode'] + '.description': get_cw_skill_description(skill)}})
            cwusers.update_one({'id': user['id']}, {
                '$unset': {'inventory.' + recipeobjectcode: 1}})
            sendm(cwbot, m.chat.id, 'üÜô|–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å "' + skill['name'] + '" —É—Å–ø–µ—à–Ω–æ —É–ª—É—á—à–µ–Ω–∞ –¥–æ —É—Ä–æ–≤–Ω—è ' + str(
                skill['lvl']) + '!')
            sendm(cwbot, pasyuk_id,
                               '[' + str(user['id']) + ' ' + user['name'] + ']:\n' + 'üÜô|–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å "' + skill[
                                   'name'] + '" —É—Å–ø–µ—à–Ω–æ —É–ª—É—á—à–µ–Ω–∞ –¥–æ —É—Ä–æ–≤–Ω—è ' + str(
                                   skill['lvl']) + '!')
        else:
            sendm(cwbot, m.chat.id, '–≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∫–∏–ª–ª–æ–º!')
            return
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(func=lambda m: m.text[:4] == "/use")
def item_useee(m):
    try:
        key = 'inventory'
        user = cwusers.find_one({'id': m.from_user.id})
        if user['current_act'] in busy_acts:
            sendm(cwbot, m.chat.id, '–í—ã —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ.')
            return
        try:
            itemcode = m.text.split('_')[1]
        except:
            sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!')
            return
        if itemcode not in user['inventory']:
            if itemcode not in user['skills']:
                sendm(cwbot, m.chat.id, '–£ –≤–∞—Å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!')
                return
            else:
                key = 'skills'
        item = user[key][itemcode]
        if item['type'] == 'scroll':
            skillcode = item['code']
            if skillcode in user['skills']:
                alreadyskill = user['skills'][skillcode]
                if alreadyskill['lvl'] >= item['lvl']:
                    sendm(cwbot, m.chat.id,
                                       '–í—ã —É–∂–µ –≤–ª–∞–¥–µ–µ—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é "' + alreadyskill['name'] + ' lvl.' + str(
                                           alreadyskill['lvl']) + '"!')
                    return
            if skillcode in user['equipped_skills']:
                alreadyskill = user['equipped_skills'][skillcode]
                if alreadyskill['lvl'] >= item['lvl']:
                    sendm(cwbot, m.chat.id,
                                       '–í—ã —É–∂–µ –≤–ª–∞–¥–µ–µ—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é "' + alreadyskill['name'] + ' lvl.' + str(
                                           alreadyskill['lvl']) + '"!')
                    return
            cwusers.update_one({'id': user['id']},
                               {'$set': {'skills.' + skillcode: create_skill(item['name'], item['code'], item['lvl'])}})
            cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + itemcode: 1}})
            sendm(cwbot, m.chat.id, 'üìú|–ò–∑—É—á–µ–Ω–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: "' + item['name'] + ' lvl.' + str(
                item['lvl']) + '"! –≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å - /use_' + item['code'] + ', ' + \
                               '—ç–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∏—Ç–≤—ã –∑–∞–º–∫–æ–≤ - /use_' + item['code'] + '_castlefight.')
        elif item['type'] == 'skill':
            if item['skillcode'] in user['equipped_skills']:
                sendm(cwbot, m.chat.id, '–≠—Ç–æ—Ç —Å–∫–∏–ª–ª —É –≤–∞—Å —É–∂–µ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!')
                return
            if len(user['equipped_skills']) >= user['max_skills']:
                sendm(cwbot, m.chat.id,
                                   '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å–∫–∏–ª–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ - ' + str(user['max_skills']) + '!')
                return
            cwusers.update_one({'id': user['id']}, {'$set': {'equipped_skills.' + item['skillcode']: item}})
            sendm(cwbot, m.chat.id,
                               '–í—ã —É—Å–ø–µ—à–Ω–æ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–ª–∏ —Å–∫–∏–ª–ª "' + item['name'] + ' lvl.' + str(item['lvl']) + '"!')
            if item['skillcode'] == 'greedy':
                cwusers.update_one({'id': user['id']}, {'$set': {'equipped_greedy': time.time()}})
            if item['skillcode'] == 'goodsleep':
                cwusers.update_one({'id': user['id']}, {'$set': {'equipped_goodsleep': time.time()}})

    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


def get_loot_for_quest(quest="patrol", user=None):
    ################### ITEMS
    ironbars = 0
    steelplate = 0
    rope = 0
    kerosene = 0
    plastic = 0
    wood = 0
    gunpowder = 0
    threads = 0
    diamonds = 0
    medicalcomponents = 0
    battery = 0
    undefined_scroll = 0

    ################ RECIPES
    blue_recipe = 0
    red_recipe = 0
    green_recipe = 0

    if quest == "patrol":
        if random.randint(1, 100) <= 40:
            ironbars += random.randint(1, 4)
        if random.randint(1, 100) <= 25:
            steelplate += random.randint(1, 3)
        if random.randint(1, 100) <= 40:
            rope += random.randint(1, 5)
        if random.randint(1, 100) <= 45:
            plastic += random.randint(1, 5)
        if random.randint(1, 100) <= 45:
            wood += random.randint(1, 7)
        if random.randint(1, 100) <= 45:
            threads += random.randint(1, 6)
        if random.randint(1, 100) <= 5:
            diamonds += random.randint(1, 3)
        if random.randint(1, 100) <= 5:
            undefined_scroll += 1
        if random.randint(1, 100) <= 3:
            blue_recipe += 1
        if random.randint(1, 100) <= 20:
            medicalcomponents += random.randint(1, 2)

    if quest == "rathunt":
        if random.randint(1, 100) <= 30:
            gunpowder += random.randint(1, 4)
        if random.randint(1, 100) <= 30:
            kerosene += random.randint(1, 3)
        if random.randint(1, 100) <= 50:
            ironbars += random.randint(2, 4)
        if random.randint(1, 100) <= 10:
            diamonds += random.randint(1, 4)
        if random.randint(1, 100) <= 5:
            undefined_scroll += 1
        if random.randint(1, 100) <= 3:
            red_recipe += 1

    if quest == "duel":
        if random.randint(1, 100) <= 40:
            rope += random.randint(2, 6)
        if random.randint(1, 100) <= 45:
            plastic += random.randint(2, 5)
        if random.randint(1, 100) <= 45:
            threads += random.randint(3, 7)
        if random.randint(1, 100) <= 5:
            undefined_scroll += 1
        if random.randint(1, 100) <= 3:
            green_recipe += 1
        if random.randint(1, 100) <= 25:
            medicalcomponents += random.randint(1, 2)
        if random.randint(1, 100) <= 25:
            battery += random.randint(1, 3)

    itemlist = {'ironbars': ironbars,
                'steelplate': steelplate,
                'rope': rope,
                'kerosene': kerosene,
                'plastic': plastic,
                'wood': wood,
                'gunpowder': gunpowder,
                'threads': threads,
                'diamonds': diamonds,
                'medicalcomponents': medicalcomponents,
                'battery': battery,

                'recipe_blue': blue_recipe,
                'recipe_red': red_recipe,
                'recipe_green': green_recipe,

                'undefined_scroll': undefined_scroll

                }
    itemlistremove = []
    for ids in itemlist:
        if itemlist[ids] == 0:
            itemlistremove.append(ids)
    for ids in itemlistremove:
        itemlist.pop(ids)

    maxitemlen = random.randint(0, 6)
    give_items = {}
    while len(give_items) < maxitemlen and len(itemlist) > 0:
        x = random.choice(list(itemlist))
        give_items.update({x: itemlist[x]})
        itemlist.pop(x)

    getloot = give_items

    restext = ''
    if len(getloot) > 0:
        restext += '\n–†–µ—Å—É—Ä—Å—ã:\n'
    for ids in getloot:
        if ids.split('_')[0] != 'recipe' and ids != 'undefined_scroll':
            if ids not in user['resources']:
                cwusers.update_one({'id': user['id']}, {'$set': {'resources.' + ids: getloot[ids]}})
            else:
                cwusers.update_one({'id': user['id']}, {'$inc': {'resources.' + ids: getloot[ids]}})
            restext += '*üì¶' + resource_to_name(ids) + '*: ' + str(getloot[ids]) + '\n'
        else:
            if ids != 'undefined_scroll':
                objectcode = generate_object_code(user)
                recipename = resource_to_name(ids)
                x = ids.split('_')[1]
                und = False
                if x in ['blue', 'green', 'red']:
                    und = True
                cwusers.update_one({'id': user['id']}, {'$set': {
                    'inventory.' + objectcode: create_recipe(ids, objectcode, recipename, undefined=und, color=x)}})
                user = cwusers.find_one({'id': user['id']})
                restext += '*' + resource_to_name(ids) + '*: ' + str(getloot[ids]) + '\n'
                sendm(cwbot, pasyuk_id, user['name'] + ' –ø–æ–ª—É—á–∏–ª:\n' + resource_to_name(ids) + ': ' + str(
                    getloot[ids]) + '\n')
            else:
                objectcode = generate_object_code(user)
                scrollname = resource_to_name(ids)
                scroll = create_undefined_scroll(objectcode=objectcode, name=scrollname)
                cwusers.update_one({'id': user['id']}, {
                    '$set': {'inventory.' + objectcode: scroll}})
                user = cwusers.find_one({'id': user['id']})
                restext += '*' + resource_to_name(ids) + '*: ' + str(getloot[ids]) + '\n'
                sendm(cwbot, pasyuk_id, user['name'] + ' –ø–æ–ª—É—á–∏–ª:\n' + resource_to_name(ids) + ': ' + str(
                    getloot[ids]) + '\n')

    return restext


# cwusers.update_many({},{'$set':{'inventory.resources':{}}})


def resource_to_name(x):
    ################## ITEMS
    y = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
    if x == 'wood':
        y = "ü™µ–î–µ—Ä–µ–≤–æ"
    if x == 'ironbars':
        y = "üî©–ñ–µ–ª–µ–∑–Ω—ã–π —Å–ª–∏—Ç–æ–∫"
    if x == 'steelplate':
        y = "ü™ô–°—Ç–∞–ª—å–Ω–∞—è –ø–ª–∞—Å—Ç–∏–Ω–∞"
    if x == 'rope':
        y = "„Ä∞Ô∏è–í–µ—Ä—ë–≤–∫–∞"
    if x == 'kerosene':
        y = "üõ¢–ö–µ—Ä–æ—Å–∏–Ω"
    if x == 'plastic':
        y = "üñ±–ü–ª–∞—Å—Ç–∏–∫"
    if x == 'gunpowder':
        y = "üçö–ü–æ—Ä–æ—Ö"
    if x == 'threads':
        y = "üßµ–ù–∏—Ç–∫–∏"
    if x == "diamonds":
        y = "üíé–ê–ª–º–∞–∑—ã"
    if x == 'medicalcomponents':
        y = "üíâ–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
    if x == "battery":
        y = "üîã–ë–∞—Ç–∞—Ä–µ–π–∫–∞"
    if x == 'rat_toys':
        y = "üß∏–ò–≥—Ä—É—à–∫–∞ –¥–ª—è –∫—Ä—ã—Å"
    if x == 'yaroslavwood':
        y = "ü™µ–ü–æ–ª–µ–Ω–æ –Ø—Ä–æ—Å–ª–∞–≤–∞"

    ################## RECIPES
    if x == 'recipe_blue':
        y = "–°–∏–Ω–∏–π —Ä–µ—Ü–µ–ø—Ç"
    if x == 'recipe_red':
        y = "–ö—Ä–∞—Å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç"
    if x == 'recipe_green':
        y = '–ó–µ–ª—ë–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç'

    if x == "undefined_scroll":
        y = "–ù–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Å–≤–∏—Ç–æ–∫ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏"

    if x == 'recipe_baseball':
        y = "–†–µ—Ü–µ–ø—Ç: –±–∏—Ç–∞"
    if x == 'recipe_knife':
        y = "–†–µ—Ü–µ–ø—Ç: –Ω–æ–∂"
    if x == 'recipe_obrez':
        y = "–†–µ—Ü–µ–ø—Ç: –æ–±—Ä–µ–∑"
    if x == 'recipe_drobovik':
        y = "–†–µ—Ü–µ–ø—Ç: –¥—Ä–æ–±–æ–≤–∏–∫"
    if x == 'recipe_torch':
        y = "–†–µ—Ü–µ–ø—Ç: —Ñ–∞–∫–µ–ª"
    if x == 'recipe_flamethrower':
        y = "–†–µ—Ü–µ–ø—Ç: –æ–≥–Ω–µ–º—ë—Ç"
    if x == 'recipe_revolver':
        y = "–†–µ—Ü–µ–ø—Ç: —Ä–µ–≤–æ–ª—å–≤–µ—Ä"
    if x == 'recipe_bulava':
        y = '–†–µ—Ü–µ–ø—Ç: –±—É–ª–∞–≤–∞'
    if x == 'recipe_chain':
        y = '–†–µ—Ü–µ–ø—Ç: —Ü–µ–ø—å'
    if x == 'recipe_bow':
        y = '–†–µ—Ü–µ–ø—Ç: –ª—É–∫'
    if x == 'recipe_claws':
        y = '–†–µ—Ü–µ–ø—Ç: —Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–≥—Ç–∏'
    if x == 'recipe_shurikens':
        y = '–†–µ—Ü–µ–ø—Ç: —Å—é—Ä–∏–∫–µ–Ω—ã'
    if x == 'recipe_rifle':
        y = '–†–µ—Ü–µ–ø—Ç: —Å–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞'
    if x == 'recipe_kastet':
        y = '–†–µ—Ü–µ–ø—Ç: –∫–∞—Å—Ç–µ—Ç'
    if x == 'recipe_saber':
        y = '–†–µ—Ü–µ–ø—Ç: —Å–∞–±–ª—è'
    if x == 'recipe_saw':
        y = '–†–µ—Ü–µ–ø—Ç: –ø–∏–ª–æ–º–µ—Ç'
    if x == 'recipe_molot':
        y = '–†–µ—Ü–µ–ø—Ç: –º–æ–ª–æ—Ç'
    if x == 'recipe_tesak':
        y = '–†–µ—Ü–µ–ø—Ç: —Ç–µ—Å–∞–∫'
    if x == 'recipe_axe':
        y = '–†–µ—Ü–µ–ø—Ç: —Ç–æ–ø–æ—Ä'
    if x == 'recipe_kuvalda':
        y = '–†–µ—Ü–µ–ø—Ç: –∫—É–≤–∞–ª–¥–∞'
    if x == 'recipe_spear':
        y = '–†–µ—Ü–µ–ø—Ç: –∫–æ–ø—å–µ'
    if x == 'recipe_police':
        y = '–†–µ—Ü–µ–ø—Ç: –ø–æ–ª–∏—Ü–µ–π—Å–∫–∞—è –¥—É–±–∏–Ω–∫–∞'
    if x == 'recipe_shest':
        y = '–†–µ—Ü–µ–ø—Ç: —à–µ—Å—Ç'

    return y

from datetime import datetime
def castle_protect_quest(user):
    try:
        middle_exp = exp_for_quest(user['lvl'])
        multipler = random.randint(7, 13)
        multipler = multipler / 10
        taken_exp = int(middle_exp * multipler)
        if taken_exp < 1:
            taken_exp = 1
        if random.randint(1, 100) <= 4:
            taken_exp = 0
        cwusers.update_one({'id': user['id']}, {'$inc': {'exp': taken_exp}})
        cwusers.update_one({'id': user['id']}, {'$set': {'current_act': None}})
        user['exp'] += taken_exp
        check_lvlup(user)
        quest_texts = [
            '–í—ã –≥—É–ª—è–ª–∏ –ø–æ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç—è–º –∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –∫—Ä—ã—Å—É. –¢–æ–ª—å–∫–æ –≤—ã –¥–æ—Å—Ç–∞–ª–∏ —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ, –∫–∞–∫ –æ–Ω–∞ —É–±–µ–∂–∞–ª–∞ –∫—É–¥–∞-—Ç–æ –≤ –ª–µ—Å.',
            '–í—ã —Å–µ–ª–∏ —Ä—ã–±–∞—á–∏—Ç—å –Ω–∞ –æ–∑–µ—Ä–µ –æ–∫–æ–ª–æ –∑–∞–º–∫–∞. –ü–æ–π–º–∞–ª–∏ –Ω–µ–º–Ω–æ–≥–æ —Ä—ã–±—ã, –∞ –∑–∞—Ç–µ–º –ø—Ä–æ–¥–∞–ª–∏, –≤—ã—Ä—É—á–∏–≤ –Ω–µ–º–Ω–æ–≥–æ –¥–µ–Ω–µ–≥.',
            '–í –ª–µ—Å—É –≤—ã –Ω–∞—à–ª–∏ –∫–∞–∫–æ–π-—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –º–∞–Ω–µ–∫–µ–Ω –∏–∑ –¥–µ—Ä–µ–≤–∞ –∏ —Ä–µ—à–∏–ª–∏ –ø–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–µ–º.',
            '–í –ª–µ—Å—É —Ç—ã –Ω–∞—à—ë–ª —Ä–µ–¥–∫–∏–π –≤–∏–¥ –≥—Ä–∏–±–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–¥–∞—Ç—å —Å–∫—É–ø—â–∏–∫—É –∏–ª–∏ –º–µ—Å—Ç–Ω—ã–º –∞–ª—Ö–∏–º–∏–∫–∞–º.',
            '–ù–∞ –Ω–µ–±–æ–ª—å—à–æ–π –ª—É–∂–∞–π–∫–µ –ø–æ—Å—Ä–µ–¥–∏ –ª–µ—Å–∞ —Å—Ç—Ä–∞–Ω–Ω–∞—è —Ä–∞–∑–Ω–æ—à–µ—Ä—Å—Ç–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è —Ç—è–Ω—É–ª–∞ –∏–∑ –∑–µ–º–ª–∏ –æ–≥—Ä–æ–º–Ω—É—é —Ä–µ–ø—É. ' + \
            '–¢—ã –ø–æ–º–æ–≥ –≤—ã—Ç–∞—â–∏—Ç—å –æ–≤–æ—â –∏ –ø–æ–ª—É—á–∏–ª –æ—Ç –ø—Ä–µ–¥–≤–æ–¥–∏—Ç–µ–ª—è –Ω–µ–±–æ–ª—å—à–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ.',
            '–í —á–∞—â–µ –ª–µ—Å–∞ –≤–∏–¥–Ω–µ–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ—Å–∫ –º–∏—Ñ—Ä–∏–ª–æ–≤–æ–π —Ä—É–¥—ã. –ö–∞–∫ –∂–∞–ª—å ‚Äî —ç—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å —Ç—Ä—É–ø —Å –º–µ–¥–Ω—ã–º–∏ –∑—É–±–∞–º–∏.',
            '–¢—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª –ø–∞—Ä–Ω—è –≤ –¥–æ—Å–ø–µ—Ö–∞—Ö —Å–æ —Å—Ç—Ä–µ–ª–æ–π –≤ –∫–æ–ª–µ–Ω–µ. –¢—ã —Å–º–æ–≥ –æ–∫–∞–∑–∞—Ç—å –µ–º—É –ø–µ—Ä–≤—É—é –ø–æ–º–æ—â—å, –∑–∞ —á—Ç–æ —Ç–æ—Ç –æ—Ç–±–ª–∞–≥–æ–¥–∞—Ä–∏–ª —Ç–µ–±—è, –Ω–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π –µ–º—É –±–æ–ª—å—à–µ –Ω–µ –≤–∏–¥–∞—Ç—å.',
            '–û–∫–æ–ª–æ –∑–∞–º–∫–∞ –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ —Ä–∞–∑—å—è—Ä–µ–Ω–Ω–æ–≥–æ –Ω–æ—Å–æ—Ä–æ–≥–∞. –î–æ—Å—Ç–∞–≤ –∫—Ä–∞—Å–Ω—É—é —Ç—Ä—è–ø–∫—É –∏ –∫–∏–Ω—É–≤ –µ–µ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –¥–µ—Ä–µ–≤–æ, –≤—ã –∑–∞—Å—Ç–∞–≤–∏–ª–∏ –Ω–æ—Å–æ—Ä–æ–≥–∞ –≤–æ—Ç–∫–Ω—É—Ç—å—Å—è –≤ –Ω–µ–≥–æ —Ä–æ–≥–æ–º, ' + \
            '—á–µ–º —Å–ø–∞—Å–ª–∏ —Å–µ–±–µ, –∏ –≤–æ–∑–º–æ–∂–Ω–æ, –∫–æ–º—É-—Ç–æ –µ—â–µ, –∂–∏–∑–Ω—å.',
            '–ü—Ä–æ—Ö–æ–¥—è –º–∏–º–æ –∫–ª–∞–¥–±–∏—â–∞ —Ç—ã —É—Å–ª—ã—à–∞–ª –∂–∞–ª–æ–±–Ω—ã–π –≤–æ–π –∏–∑ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –≥—Ä–æ–±–∞:\n"–ù—É –¥–∞–π—Ç–µ –º–Ω–µ –∫–æ—Ñ–µ, –∫–æ—Ñ–µ —Ö–æ—á–µ—Ç—Å—è".',
            '–ü—Ä–æ—Ö–æ–¥—è –º–∏–º–æ —á–∞–π–Ω–æ–≥–æ –¥–æ–º–∞, –≤—ã —É–≤–∏–¥–µ–ª–∏ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –≤ –Ω–∞—É—à–Ω–∏–∫–∞—Ö. –ù–µ –ø–æ—Ö–æ–∂–µ, —á—Ç–æ–±—ã –æ–Ω–æ –æ–±—Ä–∞—Ç–∏–ª–æ –Ω–∞ –≤–∞—Å –≤–Ω–∏–º–∞–Ω–∏–µ.',
            '–ì—É–ª—è—è –ø–æ –ª–µ—Å—É, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –≥—Ä—É–ø–ø—É –¥—Ä—É–∂–µ–ª—é–±–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏—Ö —Ä–∞–∑–Ω—ã–º –∑–∞–º–∫–∞–º. –ù–µ–º–Ω–æ–≥–æ –ø–æ–±–æ–ª—Ç–∞–≤, –≤—ã —É—à–ª–∏ –æ—Ç –Ω–∏—Ö —Å –º—ã—Å–ª—è–º–∏, —á—Ç–æ –º–µ–∂–¥—É –Ω–∏–º–∏ –æ–±—â–µ–≥–æ?',
            '–ì—É–ª—è—è –≤–æ–∑–ª–µ —Å—Ç–µ–Ω –∑–∞–º–∫–∞, –≤—ã –∏–∑ –ø–æ–¥ –∑–µ–º–ª–∏ —É—Å–ª—ã—à–∞–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –∑–≤—É–∫–∏. –ó–≤—É–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –≤—Å—ë –≥—Ä–æ–º—á–µ –∏ –≥—Ä–æ–º—á–µ, –ø–æ–∫–∞ –Ω–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∏—Å—å. '+\
            '–í—ã —É–∂–µ —É—Å–ø–µ–ª–∏ –≤—ã–¥–æ—Ö–Ω—É—Ç—å –∫–∞–∫ —É—Å–ª—ã—à–∞–ª–∏ –≥—Ä–æ–º–∫–∏–π –∫—Ä–∏–∫ "–û–ù–û –ñ–ò–í–û–ï, –ñ–ò–í–û–ï!"\n–ù–∞—á–∞–≤ –±–µ–∂–∞—Ç—å —Å–æ –≤—Å–µ—Ö –Ω–æ–≥ –≤—ã —Å–ø–æ—Ç–∫–Ω—É–ª–∏—Å—å –∏ –Ω–∞—à–ª–∏:',
            '–ò—â–∞ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ, –Ω–µ—Å—É—â–µ–≥–æ –º–µ—à–æ–∫ –∑–æ–ª–æ—Ç–∞. –í–∏–¥–Ω–æ –∫ —Ç—Ä–æ–ª–ª—é –º–æ–∂–Ω–æ —É–∂–µ –Ω–µ –∏–¥—Ç–∏.',
            '–í –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ —Ä–∞–∑–¥–≤–∏–Ω—É–ª –≤–µ—Ç–≤–∏ –¥–µ—Ä–µ–≤—å–µ–≤, –≤—ã —É–≤–∏–¥–µ–ª–∏ –≤–æ–∏–Ω–∞ —Ç—å–º—ã, —Å–∏–¥—è—â–µ–≥–æ –Ω–∞ –∑–µ–º–ª–µ –∏ –±–µ–∑–æ–±–∏–¥–Ω–æ –ø—å—é—â–µ–≥–æ —á–∞–π —Å –ø—Ä—è–Ω–∏–∫–∞–º–∏. –í—ã —Ä–µ—à–∏–ª–∏ –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å –µ–≥–æ –∏ –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
            '–ò–¥—è –ø–æ —Ç—Ä–æ–ø–∏–Ω–∫–µ, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –¥–µ—Ä–µ–≤–Ω—é —Å–∫–µ–ª–µ—Ç–æ–≤ –Ω–æ—Å—è—â–∏–º–∏ —Ç—ã–∫–≤—ã –Ω–∞ –≥–æ–ª–æ–≤–∞—Ö. –í—ã —Ä–µ—à–∏–ª–∏ –Ω–µ —Ä–∏—Å–∫–æ–≤–∞—Ç—å –∏ –æ–±–æ—à–ª–∏ —ç—Ç–æ –º–µ—Å—Ç–æ —Å—Ç–æ—Ä–æ–Ω–æ–π.',
            '–ì—É–ª—è—è –ø–æ –ª–µ—Å—É, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ —Ö–∏–∂–∏–Ω—É –ª–µ—Å–Ω–∏–∫–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ª–µ—Å–Ω–∏–∫, –≤—ã –ø—Ä–æ–≥–æ—Å—Ç–∏–ª–∏ –¥–æ –Ω–æ—á–∏, –∏ –∫–∞–∫ –≤–æ–ª–∫–∏ –∑–∞–≤—ã–ª–∏ –ø–æ–¥ –æ–∫–Ω–æ–º –ª–µ—Å–Ω–∏–∫ —É—à—ë–ª. –ï–≥–æ –¥–æ–ª–≥–æ –Ω–µ –±—ã–ª–æ –∏ –≤—ã —Ä–µ—à–∏–ª–∏ —É–π—Ç–∏, –ø—Ä–∏—Ö–≤–∞—Ç–∏–≤ —Å —Å–æ–±–æ–π:',
            '–í—ã —É–≤–∏–¥–µ–ª–∏ –∫–∞–∫ –º–µ—á–Ω–∏–∫ –æ—Ç—Ç–æ–ª–∫–Ω—É–ª —Ç–æ–ª–ø—É –∫—Ä—ã—Å —Ñ—Ä–∞–∑–æ–π:"ùï±ùñÄùïæ ùïΩùï∫ ùïØùï¨!" –ò –ø–æ—à–µ–ª –∏—Å–∫–∞—Ç—å –¥—Ä–∞–∫–æ–Ω–∞. –ü–æ–ª–∞–∑–∏–≤ –ø–æ –∫–∞—Ä–º–∞–Ω–∞–º –Ω—ã—Ö, –∫—Ä—ã—Å –≤—ã –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
            '–ü–æ –ø—É—Ç–∏ –∫ –∑–∞–º–∫—É, –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –±—Ä–∞—Ç—å–µ–≤ —Å–∫–µ–ª–µ—Ç–æ–≤. –û–¥–∏–Ω –ø—ã—Ç–∞–ª—Å—è —Å—Ç—Ä–æ–∏—Ç—å –≤–∞–º –ª–æ–≤—É—à–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤–µ—Å—å–º–∞ –ø—Ä–æ—Å—Ç—ã, –∞ –≤—Ç–æ—Ä–æ–π –≥–æ–≤–æ—Ä–∏–ª –∫—Ä–∞–π–Ω–µ –∑–∞–ö–û–°–¢–ï–Ω–µ–ª—ã–µ —à—É—Ç–∫–∏.',
            '–ü—Ä–æ—Ö–æ–¥—è –º–∏–º–æ –æ–∑–µ—Ä–∞, –≤—ã —É–≤–∏–¥–µ–ª–∏ —Å—Ç–æ—è—â–µ–≥–æ –≤ –Ω–µ–π —Ä—ã—Ü–∞—Ä—è –≤ –¥–æ—Å–ø–µ—Ö–∞—Ö, —Å —Å–∏–Ω–µ–π –∫–æ–∂–µ–π –∏ –∂–∞–±—Ä–∞–º–∏. –û–Ω –±—ã –≤–∞—Å –ø–æ–ø—ã—Ç–∞–ª—Å—è —Å—Ö–≤–∞—Ç–∏—Ç—å, –Ω–æ –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é —Ä—ã—Ü–∞—Ä—å –Ω–µ –º–æ–≥ –Ω–∞ –∂–∞—Ä–µ –¥–æ–ª–≥–æ –ø—Ä–æ—Å—Ç–æ—è—Ç—å. –í—ã –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
            '–ë–ª—É–∂–¥–∞—è –ø–æ –ª–µ—Å—É, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ —Å–∫–µ–ª–µ—Ç, –∏–º–µ—é—â–∏–º –Ω–µ–æ–±—ã—á–Ω—ã–µ —Ä–æ–≥–∞ —Å –æ—Ä—É–∂–∏–µ–º, –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–µ–º —Ä–æ–≥–∞. –û–±—ã—Å–∫–∞–≤ –µ–≥–æ, –≤—ã –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.', 
            '–í—ã –ø–æ–¥–æ—à–ª–∏ –∫ –ø–µ—â–µ—Ä–µ —Ç—Ä–æ–ª–ª—è –∏ —É–≤–∏–¥–µ–ª–∏, –∫–∞–∫ –ª—ã—Å—ã–π –º—É–∂—á–∏–Ω–∞ —Å –æ–¥–Ω–æ–≥–æ —É–¥–∞—Ä–∞ –∫—É–ª–∞–∫–æ–º –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª —Ç—Ä–æ–ª–ª—è –≤ –∫—Ä–æ–≤–∞–≤–æ–µ –º–µ—Å–∏–≤–æ. –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≥—Ä—É—Å—Ç–Ω–æ –≤–∑–¥–æ—Ö–Ω—É–ª –∏ –ø–æ—à–µ–ª –∫—É–¥–∞ –≥–ª–∞–∑–∞ –≥–ª—è–¥—è—Ç. –í—ã –≤–∑—è–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –¥–µ–Ω–µ–≥, —á—Ç–æ –±—ã–ª–æ –≤ –ø–µ—â–µ—Ä–µ.',
            '–í –ø–æ–∏—Å–∫–∞—Ö —Ü–µ–Ω–Ω—ã—Ö –≤–µ—â–µ–π –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –¥–æ–º. –í–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ —Å–∏–¥–µ–ª –ø–æ–∂–∏–ª–æ–π –º—É–∂—á–∏–Ω–∞. –ü—Ä–∏ –≤–∏–¥–µ –≤–∞—Å –æ–Ω —Å–∫–∞–∑–∞–ª:\n"–ü—Ä–æ—Ö–æ–¥–∏. –•–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω–Ω—É—é —Å–Ω–∞—Ä—è–≥—É? –ú–æ–≥—É –¥–∞—Ç—å –∑–∞ –ø–∞—Ä–æ—á–∫—É –∑–∞–¥–∞–Ω–∏–π". –í—ã, —á—É–≤—Å—Ç–≤—É—è –ø–æ–¥–≤–æ—Ö –≤ —ç—Ç–∏—Ö —Å–ª–æ–≤–∞—Ö, –≤—ã—à–ª–∏ –∏–∑ –¥–æ–º–∞, –ø—Ä–∏—Ö–≤–∞—Ç–∏–≤ –≤–µ—â–∏ —Å —Ç—É–º–±–æ—á–∫–∏ —É –≤—ã—Ö–æ–¥–∞.',
            '–ü—Ä–æ—Ö–æ–¥—è –º–∏–º–æ —Ä–µ–∫–∏, –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—É—é –∫—Ä—ã—Å—É, –≤–∏–¥—è —á—Ç–æ –æ–Ω–∞ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∞–º –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—ã —Ä–µ—à–∏–ª–∏ –ø–æ–¥–æ–π—Ç–∏ –∫ –Ω–µ–π. –ö—Ä—ã—Å–∞ –≤–∞–º —á—Ç–æ-—Ç–æ –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å, '+\
            '–∂–∞–ª—å —á—Ç–æ –≤—ã —Ç–∞–∫ –∏ –Ω–µ –ø–æ–Ω—è–ª–∏ –∫–∞–∫—É—é –ø–ª–æ—Ç–∏–Ω—É –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å —Ä—ã—á–∞–≥–æ–º –∏ –∫–∞–∫–æ–π –∫–∞–Ω–∞–ª –Ω—É–∂–Ω–æ –∑–∞–≤–∞–ª–∏—Ç—å –∫–∞–º–Ω–µ–º. –£—Ö–æ–¥—è –æ—Ç –∫—Ä—ã—Å—ã –≤—ã –Ω–∞—à–ª–∏:',
            '–ò–¥—è –ø–æ –ª–µ—Å—É, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –≥—Ä—É–ø–ø—É –∏–∑ –ø—è—Ç–∏ —á–µ–ª–æ–≤–µ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∞–º–∏. –û–Ω–∏ –Ω–∞—á–∞–ª–∏ –≤–∞–º —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ –∫–∞–∫–∏—Ö-—Ç–æ —Ç–µ—Ä—Ä–æ—Ä–∏—Å—Ç–æ–≤ –∏ –±–æ–º–±—É –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ–±–µ–∑–≤—Ä–µ–¥–∏—Ç—å. –í—ã –Ω–∏—á–µ–≥–æ, –Ω–µ –ø–æ–Ω—è–≤ –∏ –ø–æ–∂–µ–ª–∞–≤ –∏–º —É–¥–∞—á–∏, –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
            '–ü—Ä–æ—Ö–æ–¥—è –ø–æ –¥–µ—Ä–µ–≤–Ω–µ, –≤—ã —É–≤–∏–¥–µ–ª–∏ –≥—Ä—É–ø–ø—É –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤, —Å—Ç–æ—è—â—É—é —É –∑–∞–±–æ—Ä–∞. –û–¥–Ω–∞ –ø–æ–ª–æ–≤–∏–Ω–∞ –∫—Ä–∞—Å–∏–ª–∞, –≤—Ç–æ—Ä–∞—è –º–æ–ª–∏–ª–∞ –æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –ø–æ–∫—Ä–∞—Å–∏—Ç—å –∑–∞ –ø–ª–∞—Ç—É. –í–∑–≥–ª—è–Ω—É–≤ –Ω–∞ –∑–∞–±–æ—Ä –≤—ã —É–≤–∏–¥–µ–ª–∏ –Ω–∞–¥–ø–∏—Å—å "...–±–µ–ª –Ω–µ –∫–æ–Ω—Ç—Ä–∏—Ç—Å—è". –†–µ—à–∏–≤ –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–º—É—Ç–Ω—ã—Ö —Å—Ö–µ–º–∞—Ö, –≤—ã –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
            '–ü—Ä–æ—Ö–æ–¥—è –º–∏–º–æ –¥–µ—Ä–µ–≤–∞, –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –µ–≥–æ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –≠—Ç–æ –æ–∫–∞–∑–∞–ª–æ—Å—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ. –ü—Ä–∏—Ç—Ä–æ–Ω—É–≤—à–∏—Å—å –∫ –Ω–µ–º—É, –≤ –¥–µ—Ä–µ–≤–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å –º–∞–ª–µ–Ω—å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –¢–∞–º –±—ã–ª–∞ –∫–Ω–∏–≥–∞ "–ö–∞–∫ –≤—ã–∂–∏—Ç—å –≤ —ç—Ç–æ–º –º–∏—Ä–µ", –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø–æ—Å—á–∏—Ç–∞–ª–∏ –Ω–µ–Ω—É–∂–Ω—ã–º –≤–∞–º –∏ –≤—ã –≤–µ—Ä–Ω—É–ª–∏ –µ–≥–æ –Ω–∞ –º–µ—Å—Ç–æ, –∑–∞–∫—Ä—ã–≤ —Ç–∞–π–Ω–∏–∫.',
            '–ö–∞–∫-—Ç–æ —Ä–∞–∑ –≤—ã —É–≤–∏–¥–µ–ª–∏, —á—Ç–æ –Ω–∞ —É–ª–∏—Ü–µ –¥–≤–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —á–µ–ª–æ–≤–µ–∫–∞ –≥—Ä–∞–±—è—Ç –±–æ–≥–∞—á–∞.\n–í—ã —Å—Ä–∞–∑—É –±—Ä–æ—Å–∏–ª–∏—Å—å –Ω–∞ –≤—ã—Ä—É—á–∫—É.\n–í—ã—Ä—É—á–∫—É –ø—Ä–∏—à–ª–æ—Å—å –¥–µ–ª–∏—Ç—å –Ω–∞ —Ç—Ä–æ–∏—Ö.',
            '–í—ã–π–¥—è –∏–∑ –∑–∞–º–∫–∞, –≤—ã –≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –≥—Ä–æ–±, –ø—Ä–∏—Ç–∞–Ω—Ü–æ–≤–∞—è –ø–æ–¥ –∫–∞–∫—É—é-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω—É—é –º—É–∑—ã–∫—É –Ω–µ—Å—É—Ç, —á–µ—Ç—ã—Ä–µ –∞–¥–µ–ø—Ç–∞ —Ç—å–º—ã. –ü—Ä–æ–π–¥—è –∑–∞ –Ω–∏–º–∏, –≤—ã –ø–æ–ø–∞–ª–∏ –Ω–∞ –ø–æ—Ö–æ—Ä–æ–Ω—ã, –≥–¥–µ –ø–µ—Ä–µ–∫—É—Å–∏–ª–∏.',
            '–ö–æ–≥–¥–∞ –≤—ã –ø—Ä–∏—Å–µ–ª–∏ –ø–µ—Ä–µ–¥–æ—Ö–Ω—É—Ç—å –ø–æ—Å–ª–µ –¥—Ä–∞–∫–∏ —Å –∫—Ä—ã—Å–æ–π, –∫–∞–∫ –ø–æ–¥–æ—à—ë–ª –∫—É–¥—Ä—è–≤—ã–π –ø–∞—Ä–Ω–∏—à–∫–∞ —Å —Ä–æ–∑–æ–≤—ã–º –∫–∞–º–Ω–µ–º –≤ –ø—É–ø–∫–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –≤–∞–º —Ü–µ–ª–µ–±–Ω—ã–º–∏ —Å–ª—é–Ω—è–º–∏ –∏ —Å–≤–æ–∏–º —â–∏—Ç–æ–≤.\n –û—Ç–∫–∞–∂–∞–≤—à–∏—Å—å, –≤—ã –≤—Å–µ –∂–µ –≤–∑—è–ª–∏ –ø—Ä–∏–ø–∞—Å—ã –∏–∑ –µ–≥–æ —Ä—é–∫–∑–∞–∫–∞-—á–∏–∑–±—É—Ä–≥–µ—Ä–∞.',
            '–¢—ã –Ω–∞—Ç—ã–∫–∞–µ—à—å—Å—è –Ω–∞ –¥–æ–º –≥–¥–µ –∑–∞–º–µ—á–∞–µ—à—å –º–∞–ª–µ–Ω—å–∫—É—é –¥—ã—Ä–∫—É –≤ —Å—Ç–µ–Ω–µ, –∏ —Ç—ã –∫–∞–∫–∏–º —Ç–æ —á—É–¥–æ–º —Å–º–æ–≥ —Ç—É–¥–∞ –ø—Ä–æ–ª–µ–∑—Ç—å –≤ –Ω–µ√´. –¢–∞–º —Ç—ã –Ω–∞—Ç—ã–∫–∞–µ—à—å—Å—è –Ω–∞ –∫–æ—Ä–æ–ª—è –∫—Ä—ã—Å –∏ —É–±–∏–≤–∞–µ—à—å –µ–≥–æ –≤ —Ç—è–∂–µ–ª–æ–º –±–æ—é –∑–∞–±–∏—Ä–∞—è –µ–≥–æ –ø–æ–∂–∏—Ç–∫–∏.',
            '–ì—É–ª—è—è –ø–æ –ª–µ—Å—É, –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞-–ø–æ—Å–ª—É—à–Ω–∏–∫–∞ –∫–æ—Ç–æ—Ä—ã–π –±–µ–∑—Ä–µ–∑—É–ª—å—Ç–∞—Ç–Ω–æ –ø—ã—Ç–∞–ª—Å—è –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∑–æ–º–±–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –µ–º—É –∫–æ—Ñ–µ.\n–í—ã —Ç–æ–∂–µ –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –≤–∞–º –∫–æ—Ñ–µ, –∏ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –∑–æ–º–±–∏ –≤–∞–º –ø—Ä–∏–Ω–µ—Å:',
            '–í—ã —à–ª–∏ –ø–æ —Å–≤–æ–∏–º –¥–µ–ª–∞–º, –∫–∞–∫ –∫ –≤–∞–º –ø–æ–¥–æ—à—ë–ª —é—Ä–∏—Å—Ç –∏ —Å–∫–∞–∑–∞–ª, —á—Ç–æ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ –≤ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ –≤ –¥–µ—Ä–µ–≤–Ω–µ –¥–æ–º–∏–∫, –≥–¥–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–∞—Ö–∞—Ç—å, —Ä—ã–±–∞—á–∏—Ç—å, —Å—Ç—Ä–æ–∏—Ç—å –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –û–±–æ–∫—Ä–∞–≤ –µ–≥–æ –∏ –ø–æ—Å–ª–∞–≤ –ø–æ–¥–∞–ª—å—à–µ, –≤—ã –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
            '–ò–¥—è –ø–æ –ª–µ—Å—É –≤—ã –Ω–∞—à–ª–∏ –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –∑–∞–º–æ–∫. –ü–æ–≥—É–ª—è—è –ø–æ –Ω–µ–º—É –≤—ã –≤—ã—à–ª–∏ –≤ –ø—Ä–æ—Å—Ç–æ—Ä–Ω—É—é –∫–æ–º–Ω–∞—Ç—É. –í –µ—ë —Ü–µ–Ω—Ç—Ä–µ –±—ã–ª –∫–∞–∫–æ–π-—Ç–æ –ø—å–µ–¥–µ—Å—Ç–∞–ª –∏–∑ –∫–∞–º–Ω—è –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞ –∏ –Ω–∞ –µ–≥–æ –≤–µ—Ç–≤—è—Ö 5 –∫–∞–∫–∏—Ö-—Ç–æ –∫–∞–º–Ω–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∏—Å—É–Ω–∫–∞–º–∏. –í—ã –Ω–µ –æ–±—Ä–∞—Ç–∏–ª–∏ –Ω–∞ –Ω–∏—Ö –≤–Ω–∏–º–∞–Ω–∏—è –∏ —Å—Ä–∞–∑—É —Å–ø—É—Å—Ç–∏–ª–∏—Å—å –≤ —Å–æ–∫—Ä–æ–≤–∏—â–Ω–∏—Ü—É –∏ –Ω–∞—à–ª–∏:',
            '–ü—Ä–æ–≥—É–ª–∏–≤–∞—è—Å—å –ø–æ –∑–∞–º–∫—É –≤—ã –ø—Ä–∏–¥—É–º—ã–≤–∞–ª–∏ –Ω–æ–≤—ã–µ –∏–¥–µ–∏. –î–æ–ª–≥–æ –¥—É–º–∞—è –≤—ã –ø—Ä–∏–¥—É–º–∞–ª–∏ –Ω–∞ –≤–∞—à –≤–∑–≥–ª—è–¥ –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—É—é –∏–¥–µ—é. –ù–æ –æ—Ç –Ω–∞—á–∞–ª—å—Å—Ç–≤–∞ –≤—ã —É—Ö–æ–¥–∏–ª–∏ —Å –≥—Ä—É—Å—Ç—å—é –∏–∑-–∑–∞ –Ω–µ–Ω—É–∂–Ω–æ–π –∏–¥–µ–∏. –ê –Ω–∞—á–∞–ª—å—Å—Ç–≤–æ –≤ —ç—Ç–æ –≤—Ä–µ–º—è –ø–æ–ø–∏–≤–∞–ª–æ –∫–æ—Ñ–µ—ë–∫. –í—ã –≤—ã—à–ª–∏ –∏–∑ –∑–∞–º–∫–∞ –∏ —É–≤–∏–¥–µ–ª–∏:',
            '–ì—É–ª—è—è –≤–¥–æ–ª—å –±–µ—Ä–µ–≥–∞, –≤—ã —É–≤–∏–¥–µ–ª–∏ —Ä—ã–±–æ–ª–æ–≤–Ω–æ–µ —Å—É–¥–Ω–æ "–ë–∏—Å–º–∞—Ä–∫", –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ–Ω–æ –≥–ª—É—à–∏–ª–æ —Ä—ã–±—É –∏–∑ 8x25—Å–º SK, –≥–∞—É–±–∏—Ü–∞ –∫—Ä–∞—Å–∏–≤–æ –≤–∑—Ä—ã–≤–∞–ª–æ –≤–æ–¥—É –∏ "–ª–æ–≤–∏–ª–∞" —Ä—ã–±—É. –°–æ–±—Ä–∞–≤ –æ—Å—Ç–∞—Ç–∫–∏ —Ä—ã–±—ã, –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Ä—ã–±–æ–ª–æ–≤–Ω–æ–µ —Å—É–¥–Ω–æ —É—à–ª–æ –∫—É–¥–∞-—Ç–æ –≤ –º–æ—Ä–µ, –≤—ã –ø—Ä–æ–¥–∞–ª–∏ –∏ –ø–æ–ª—É—á–∏–ª–∏:',
            '–ò–¥—è –ø–æ –¥–µ—Ä–µ–≤–Ω–µ –≤ —É–≤–∏–¥–µ–ª–∏ —Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ –º–∞–ª—å—á–∏–∫–∏ —Å  –ª–æ–º–æ–º –≤ —Ä—É–∫–µ –∏ –ø–∞–∫–µ—Ç–æ–º –Ω–∞ –≥–æ–ª–æ–≤–µ. –ü–æ–¥–æ–π–¥—è  –ø–æ –±–ª–∏–∂–µ –≤ —É—Å–ª—ã—à–∞–ª–∏ –∫–∞–∫ –æ–Ω –±–æ—Ä–º–æ—Ç–∞–ª —á—Ç–æ –ø—Ä–æ –∫–∞–∫–æ–π-—Ç–æ "—Å–∞–¥ —Ç–µ–Ω–µ–π". –£–≤–∏–¥–µ–≤ –≤–∞—Å –æ–Ω –±—Ä–æ—Å–∏–ª—Å—è –Ω–∞ —É—Ç–µ–∫ –∏ –æ–±—Ä–æ–Ω–∏–ª –∑–æ–ª–æ—Ç—ã–µ –º–æ–Ω–µ—Ç—ã. –í—ã –ø–æ–¥–æ–±—Ä–∞–ª–∏ –∏—Ö –∏ –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ —Ä–∞–∑–¥—É–º—ã–≤–∞—è –Ω–∞ —ç—Ç—É —Ç–µ–º—É.',
            '–í—ã —à–ª–∏ –ø–æ –ø–æ–ª—é, –∫–∞–∫ –≤–Ω–µ–∑–∞–ø–Ω–æ –Ω–∞—á–∞–ª–∞—Å—å –±–æ–π–Ω—è! –î—Ä–∞–ª–∏—Å—å —ç–ª—å—Ñ—ã —Å –ª–µ–ø—Ä–µ–∫–æ–Ω–∞–º–∏, –≤—ã—Å–µ–∫–∞—è –∏—Å–∫—Ä—ã –æ—Ç —É–¥–∞—Ä–æ–≤ –º–µ—á–µ–π, –Ω–æ –≤–¥—Ä—É–≥ –≤–∞—Å –∑–∞–¥–µ–ª–æ –ª–∞–∑–µ—Ä–æ–º. –õ—ë–∂–∞ –Ω–∞ –∑–µ–º–ª–µ, –≤—ã –ø–æ–¥—É–º–∞–ª–∏ :"–í—Å—ë —Ç–∞–∫–∏ —ç—Ç–æ –±—ã–ª–∏ –ø–æ–≥–∞–Ω–∫–∏..."\n–ù–∞ –ø–æ–ª–µ –≤—ã –Ω–∞—à–ª–∏:',
            '–ü–æ—Å–ª–µ –¥—Ä–∞–∫–∏ —Å –∫—Ä—ã—Å–æ–π, –≤—ã –ª–µ–∂–∞–ª–∏ –Ω–∞ –∑–µ–º–ª–µ –∏ —Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–∞ –Ω–µ–±–æ –∞—É—Å—Ç–µ—Ä–ª–∏–π—Ü–∞. –ß–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –≤—ã –ø–æ–Ω—è–ª–∏, —á—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –∑–∞ –∞—É—Å—Ç–µ—Ä–ª–∏–π—Ü –∏ –ø–æ—à–ª–∏ –æ–±—ã—Å–∫–∏–≤–∞—Ç—å —Ç—Ä—É–ø –∫—Ä—ã—Å—ã.',
            '–í—ã –ø–æ–¥–æ—à–ª–∏ –∫ –Ω–µ–∫–æ–π –±–∞–∑–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±–µ–≥–∞–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ª—é–¥–∏ –≤... –°–∫–∞—Ñ–∞–Ω–¥—Ä–∞—Ö? –û–¥–∏–Ω –∏–∑ –Ω–∏—Ö –ø–æ–¥–æ—à—ë–ª –∫ –≤–∞–º, –∏–∑ –µ–≥–æ —Ä—Ç–∞ –Ω–∞ –≤–∞—Å –Ω–∞–ø—Ä–∞–≤–∏–ª–æ—Å—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç–µ–Ω—Ç–∞–∫–ª–µ–π, —Å —Ü–µ–ª—å—é —Å –¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ —É–∂–∞—Å–Ω–æ–µ. –£–±–∏–≤ –≤—Å–µ—Ö —á—É–¥–∏—â—å, –≤—ã –ø–æ–ª—É—á–∏–ª–∏:',
            '–ë–µ–∂–∞ –ø–æ –¥–æ—Ä–æ–≥–µ –≤ –∑–∞–º–µ—á–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ —Å –ø–∞–ª–∫–æ–π –Ω–∞ —Å–ø–∏–Ω–µ. –ü–æ–¥–æ–π–¥—è –ø–æ–±–ª–∏–∂–µ –≤—ã –≤–∏–¥–∏—Ç–µ —Ç–æ —á—Ç–æ –æ–Ω –±–∏–ª –∫–∞–º–Ω–∏ –∏ –∫—Ä–∏—á–∞–ª - "–ï–º—É –± –µ—â—ë –∫–æ–Ω—Å–µ—Ä–≤–Ω—ã—Ö –±–∞–Ω–æ–∫ –Ω–∞—Å–æ–±–∏—Ä–∞—Ç—å, –∫–æ–Ω—Å–µ—Ä–≤–Ω—ã—Ö".\n–ü–æ–¥ –≤–∞–º–∏ —Ö—Ä—É—Å—Ç–Ω—É–ª–∞ –≤–µ—Ç–∫–∞ –∏ –æ–Ω –æ–±–µ—Ä–Ω—É–≤—à–∏—Å—å –ø–æ–±–µ–∂–∞–ª –∫ –≤–∞–º , –≤—ã –Ω–∞—á–∞–ª–∏ —É–¥–∏—Ä–∞—Ç—å —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞ —Å–æ –≤—Å–µ—Ö –Ω–æ–≥.',
            '–í—ã —à–ª–∏ –ø–æ —Ç—Ä–æ–ø–∏–Ω–∫–µ, –∫–∞–∫ –≤–∞–º –∑–∞—Å–∞–¥–∏–ª–∏ —Å—Ç—Ä–µ–ª–æ–π –≤ –∫–æ–ª–µ–Ω–æ, –∫ –≤–∞–º –ø–æ–¥–æ—à—ë–ª –ø–æ—Ç—Ä–µ–ø–∞–Ω–Ω—ã–π –∏ —è–≤–Ω–æ –Ω–µ –º—ã—Ç—ã–π –º—É–∂–∏–∫ —Å–æ —Å–ª–æ–≤–∞–º–∏:"–ü—Ä–æ—Å—Ç–∏, —è –¥—É–º–∞–ª —Ç—ã –æ–±–æ—Ä–æ—Ç–µ–Ω—å".\n–í–∏–¥–Ω–æ –∑–∞–π—Ç–∏ –¥–æ–º–æ–π –ø–æ–±—Ä–∏—Ç—å—Å—è –≤—Å–µ –∂–µ –Ω—É–∂–Ω–æ. –û–Ω –≤—ã –≤–µ—Ä–Ω—É–ª —Å–≤–æ—é —Å—É–º–∫—É –Ω–∞–∏–∑–Ω–∞–Ω–∫—É –∏ –æ—Ç–¥–∞–ª –≤–∞–º:',
            '–í—ã —à–ª–∏ –ø–æ –ª–µ—Å—É, –∫–∞–∫ —É—Å–ª—ã—à–∞–ª–∏ –≥–æ–ª–æ—Å–∞. –í—ã–≥–ª—è–Ω—É–≤ –∏–∑ –∫—É—Å—Ç–æ–≤, –≤—ã —É–≤–∏–¥–∏–ª–∏ –¥–≤—É—Ö –ª—é–¥–µ–π, –æ–¥–µ—Ç—ã—Ö –≤ –∫–æ—Å—Ç—é–º—ã —á—É–º–Ω—ã—Ö –¥–æ–∫—Ç–æ—Ä–æ–≤.\n"–°–ª—É—à–∞–π, –º—ã –Ω–∞—à–ª–∏ –∑–∞—Ä–∞–∂–µ–Ω–Ω—É—é –¥–µ—Ä–µ–≤–Ω—é..."\n"–î–∞–∂–µ –Ω–µ –Ω–∞—á–∏–Ω–∞–π! –ü—Ä–æ—Å—Ç–æ –Ω–µ—Å–∏ –º–∞—Å–ª–æ –¥–ª—è —Ñ–æ–Ω–∞—Ä–µ–π"\n"–û, –±—É–¥–µ–º –µ—ë –æ—Å–≤–µ—â–∞—Ç—å?"\n–°–ø—Ä–æ—Å–∏–ª —á—É–º–Ω–æ–π, –Ω–æ —É–≤–∏–¥–µ–ª —É —Ç–æ–≤–∞—Ä–∏—â–∞ —Å–ø–∏—á–∫–∏ –≤ —Ä—É–∫–∞—Ö.\n"–ù—É.... –í –Ω–µ–∫–æ—Ç–æ—Ä–æ–º —Ä–æ–¥–µ –¥–∞"\n–°–ø—É—Å—Ç—è –ø—è—Ç—å –º–∏–Ω—É—Ç –Ω–∞ –ø–µ–ø–µ–ª–∏—â–µ –≤—ã –Ω–∞—à–ª–∏:',
            '–ò–¥—è –ø–æ –ª–µ—Å—É –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç–∞—Ä—Ü–∞ –∂—É—é—â–µ–≥–æ –≥—Ä–∏–±. –í—ã —Ä–µ—à–∏–ª–∏ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å –µ–≥–æ –≥—Ä–∏–± –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –æ—Ç–∫—É—Å–∞–Ω –∏ –Ω–µ –≤—ã –µ–≥–æ –∫—É—Å–∞–ª–∏. –û–±–æ–π–¥—è –º–∏–º–æ –≤—ã –Ω–∞—à–ª–∏ –µ—â√´ –º–Ω–æ–≥–æ –≥—Ä–∏–±–æ–≤, –∞ —Å—Ä–µ–¥–∏ –Ω–∏—Ö:'

            ]
        
        quest_winter_text = ['–ù–∞—Å–ª–∞–∂–¥–∞—è—Å—å –∑–∏–º–Ω–∏–º–∏ –≤–∏–¥–∞–º–∏ –≤–æ–∑–ª–µ –∑–∞–º–∫–∞, –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∫–∞–∫ –±–∞–Ω–¥–∞ —Å–Ω–µ–≥–æ–≤–∏–∫–æ–≤-–º–∞—Ñ–∏–æ–∑–∏ –∫—É–¥–∞-—Ç–æ —Ç–∞—â–∏–ª–∏ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞.',
                            '–ò–¥—è –ø–æ –ª–µ—Å—É, –≤—ã —É—Å–ª—ã—à–∞–ª–∏ —à–æ—Ä–æ—Ö, –∏—Å—Ö–æ–¥—è—â–∏–π —Å–∑–∞–¥–∏.\n-"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç"- –ø–æ–¥—É–º–∞–ª–∏ –≤—ã –∏ –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.\n-"–ù–µ –∑–∞–º–µ—Ç–∏–ª" - –ø–æ–¥—É–º–∞–ª–∞ –±–µ–ª–∞—è –∫—Ä—ã—Å–∞, –ª–µ–∂–∞—â–∞—è –≤ —Å–Ω–µ–≥—É.',
                            '–ò–¥—è –ø–æ –ª–µ—Å—É, –≤—ã —É–≤–∏–¥–µ–ª–∏ —Ü–µ–ª–æ–µ –ø–æ–ª–µ –ø–æ–ª—Å–Ω–µ–∂–Ω–∏–∫–æ–≤. –°–æ–±—Ä–∞–≤ –ø–∞—Ä—É —à—Ç—É–∫, –≤—ã –ø–æ–ø–∞–ª–∏ –ø–æ–¥ —Å–Ω–µ–≥–æ–ø–∞–¥. –ö–∞–∂–µ—Ç—Å—è —ç—Ç–∏ —Ü–≤–µ—Ç—ã –º–æ–∂–µ—Ç —Å–∫—É–ø–∏—Ç—å –Ω–µ–∫–∞—è –∫–æ—Ä–æ–ª–µ–≤–∞.',
                            '–í—ã —à–ª–∏ –ø–æ –≥–æ—Ä–∞–º –∏ –≤ –æ–¥–Ω–æ–π –∏–∑ –ø–µ—â–µ—Ä —É–≤–∏–¥–µ–ª–∏ –∫–æ—Ä–æ–ª—è, —Å–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ –ø–∏–Ω–≥–≤–∏–Ω–∞, –∫–∞–∫—É—é –ø—Ä–∏–Ω—Ü–µ—Å—Å—É –ø–æ—Ö–∏—Ç–∏—Ç—å. –ó–∞–±—Ä–∞–≤ –æ—Ç—Ç—É–¥–∞ –ø–∞—Ä—É –±–µ–∑–¥–µ–ª—É—à–µ–∫, –≤—ã –ø–æ—à–ª–∏ –¥–∞–ª—å—à–µ.',
                            '–ò–¥—è –ø–æ –ª–µ—Å—É, –≤—ã –≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –∏–∑ –Ω–∏–æ—Ç–∫—É–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞–º–æ–∫ –∏–∑ –ª—å–¥–∞. –ß—Ç–æ–±—ã –≤ —Ç–∞–∫–æ–º –ø–æ—Å–µ–ª–∏—Ç—å—Å—è, –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –Ω—É–∂–Ω–æ –≤—Å–µ –æ—Ç–ø—É—Å—Ç–∏—Ç—å –∏ –∑–∞–±—ã—Ç—å. –ù–æ —Ö–æ–ª–æ–¥ –≤–∞–º –Ω–µ –ø–æ –¥—É—à–µ –∏ –≤—ã —Ä–µ—à–∏–ª–∏ –ø–æ–æ—Ö–æ—Ç–∏—Ç—å—Å—è.',
                             '–í—ã –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –º–∏–º–æ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∫–∞, –∫–∞–∫ –∏–∑ –¥—ã–º–æ—Ö–æ–¥–∞ –æ–¥–Ω–æ–≥–æ –¥–æ–º–∞ –≤—ã–ª–µ–∑–ª–æ –∑–µ–ª—ë–Ω–æ–µ –Ω–µ—á—Ç–æ —Å –º–µ—à–∫–æ–º –Ω–∞ –ø–ª–µ—á–µ. –ü–æ–π–º–∞–≤ –µ–≥–æ –∏ –æ—Ç–æ–±—Ä–∞–≤ –º–µ—à–æ–∫, –≤—ã —É—à–ª–∏. –í—ã —Å–¥–µ–ª–∞–ª–∏ –¥–æ–±—Ä–æ–µ –¥–µ–ª–æ... –ù–∞–≤–µ—Ä–Ω–æ.',
                             '–í—ã –ø—Ä–æ–∫–∞–ø—ã–≤–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ –≥–æ—Ä—ã —Å–Ω–µ–≥–∞, –æ—Ç–±–∏–≤–∞–ª–∏—Å—å –æ—Ç –≤–æ–ª–∫–æ–≤, –ø—Ä—è—Ç–∞–ª–∏—Å—å –æ—Ç —Ç—Ä–æ–ª–ª—è. –ü—Ä–æ–¥–µ–ª–∞–≤ –ø—É—Ç—å, –≤—ã –Ω–∞–∫–æ–Ω–µ—Ü —Å–º–æ–≥–ª–∏ –ø–æ–ª—É—á–∏—Ç—å... –ê, —ç—Ç–æ –Ω–µ –≥—Ä—É–¥–∞ —Å–µ—Ä–µ–±—Ä–∞, –∞ –≥–ª—ã–±–∞ –±–ª–µ—Å—Ç—è—â–µ–≥–æ –ª—å–¥—è. –ë–ª—è—Å—Ç—è—â–µ.',
                             '–ò–¥—è –ø–æ –ø–æ–ª—é –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞... –ü—Ä—è–Ω–∏—á–Ω–æ–≥–æ –≥–æ–ª–µ–º–∞ —Ä–∞–∑–º–µ—Ä–æ–º —Å –º–∏–∑–∏–Ω–µ—Ü, –æ—Ö—Ä–∞–Ω—è—é—â–µ–≥–æ –¥–æ–º –∏–∑ –ø—Ä—è–Ω–∏–∫–∞. –û—Ç —à–æ–∫–∞, –≤—ã —Ä–µ—à–∏–ª–∏ –æ–≥—Ä–∞–±–∏—Ç—å –¥–æ–º –∏ –æ—Ç–∫—É—Å–∏—Ç—å —á–∞—Å—Ç—å —Å–ª–∞–¥–∫–æ–π —Ä—É–∫–∏ –≥–æ–ª–µ–º–∞.',
                            '–ü—Ä–æ—Ö–æ–¥—è –º–∏–º–æ —É—Ç–µ—Å–∞, –≤—ã —É–≤–∏–¥–µ–ª–∏ –ø–ª–∞—á—É—â—É—é –¥–µ–≤—É—à–∫—É, —Å–∏–¥—è—â—É—é –Ω–∞ –∫–æ–ª–µ–Ω—è—Ö. –í–¥—Ä—É–≥ —Å–Ω–∏–∑—É –Ω–∞ –ø—Ä–æ–ø–µ–ª–µ—Ä–µ –ø–æ–¥–Ω—è–ª—Å—è –º—É–∂—á–∏–Ω–∞, –ø—Ä–∏–∑–Ω–∞–ª—Å—è –≤ –ª—é–±–≤–∏ –∏ —É–ø–∞–ª –≤ –≤–æ–¥—É. –ó–∞ –ø–ª–∞—Ç—É, –≤—ã –Ω—ã—Ä–Ω—É–ª–∏ –∑–∞ "–†–æ–º–µ–æ" –∏ —Å–ø–∞—Å–ª–∏ –µ–≥–æ.',
                             '–ü–æ—Ç–µ—Ä—è–≤—à–∏—Å—å –≤ –ª–µ—Å—É, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –¥–µ–≤–æ—á–∫—É. –í—ã —Å–ø—Ä–æ—Å–∏–ª–∏ –µ—ë –¥–æ—Ä–æ–≥—É –¥–æ –∑–∞–º–∫–∞, –Ω–æ –æ–Ω–∞ –Ω–µ –∑–Ω–∞–µ—Ç. –°–ø—Ä–æ—Å–∏–≤ –≤–∞—Å –æ –ª–µ–¥—è–Ω–æ–π –∫–æ—Ä–æ–ª–µ–≤–µ, –≤—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –µ–π —Ç–µ–º –∂–µ. –û–±–º–µ–Ω—è–≤—à–∏—Å—å –≤–µ—â–∞–º–∏, —Ä–∞–∑–æ—à–ª–∏—Å—å.',
                             '–ü–µ—Ä–µ–¥–≤–∏–≥–∞—è—Å—å –ø–æ —Å—É–≥—Ä–æ–±–∞–º –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ —Å–µ–º—å—é –¥—Ä—É–∂–Ω—ã—Ö –±–æ–±—Ä–æ–≤. –û–Ω–∏ –≤–∞—Å –Ω–∞–∫–æ—Ä–º–∏–ª–∏, –≤—Å—ë –≤—Ä–µ–º—è —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—è –ø—Ä–æ –ª—å–≤–∞ –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫–æ–Ω—á–∏—Ç –∑–∏–º—É'
                            
                            ]
        current_datetime = datetime.now()
        if current_datetime.month in [12, 1, 2]:
            for i in quest_winter_text:
                quest_texts.append(i)

        quest_spring_text = ['–í—ã —à–ª–∏ –ø–æ –ª–µ—Å—É, –∫–∞–∫ –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –∑–∞–±—Ä–æ—à–µ–Ω–Ω—É—é –¥–µ—Ä–µ–≤—É—à–∫—É. –í—ã —Ä–µ—à–∏–ª–∏—Å—å –ø–æ–∏—Å–∫–∞—Ç—å –µ–¥—É –≤ —Ç–µ–ø–ª–∏—Ü–µ. –ú–∞–∫, —Ä–æ–º–∞—à–∫–∞, –≤–µ–Ω–µ—Ä–∏–Ω–∞ –º—É—Ö–æ–ª–æ–≤–∫–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤... –£–≤–µ—Ä–Ω—É–≤—à–∏—Å—å –æ—Ç —É–∫—É—Å–∞ –∏ –ø—Ä–∏—Ö–≤–∞—Ç–∏–≤ –ø–∞—Ä—É —Ü–≤–µ—Ç–æ–≤, –≤—ã –ø–æ–º—á–∞–ª–∏—Å—å –ø—Ä–æ—á—å'
            ]
        current_datetime = datetime.now()
        if current_datetime.month in [3, 4, 5]:
            for i in quest_spring_text:
                quest_texts.append(i)

        quest_autumn_text = ['–í–æ –≤—Ä–µ–º—è –æ—Å–µ–Ω–Ω–µ–≥–æ —Ñ–µ—Å—Ç–∏–≤–∞–ª—è, –≤—Å–µ –∂–∏—Ç–µ–ª–∏ –∑–∞–º–∫–æ–≤ —Ä–µ—à–∏–ª–∏ —É—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–∏—Ä–∏–µ –∏ —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–µ –æ—Ç–ø—Ä–∞–∑–¥–Ω–æ–≤–∞—Ç—å –µ–≥–æ. –ü–æ—Å–ª–µ —á–µ–≥–æ –∫—Ç–æ —Ç–æ –ø–µ—Ä–µ–æ–¥–µ–ª—Å—è –≤ —Ç—Ä–æ–ª—è, –¥–∏–∫—É—é –∫—Ä—ã—Å—É, –¥–µ–º–æ–Ω–∞ —Ç—å–º—ã, —Å–∫–µ–ª–µ—Ç–∞. –ü–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–±—Ä–∞–ª–∏—Å—å –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞ –∏ –Ω–∞—á–∞–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä—ã—Ö –∫—Ä—ã—Å—ã –Ω–∞–∫—Ä–∏–ª–∏ —Å—Ç–æ–ª –∏ —É–≥–æ—Å—Ç–∏–ª–∏ –≤—Å–µ—Ö —Ç—ã–∫–≤–µ–Ω–Ω—ã–º–∏ –ø–∏—Ä–æ–≥–∞–º–∏. –í–∫—É—Å–Ω–æ –ø–æ–µ–≤, –≤—ã –Ω–∞—à–ª–∏ —Ç—ã–∫–≤—É –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–∫–∞–∑–∞–ª–∞—Å—å:',
                             '–í—ã—Ö–æ–¥—è –∏–∑ –∑–∞–º–∫–∞, —Å—Ç—Ä–∞–∂–Ω–∏–∫ –≤–∞—Å –ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–≥:\n"–ü–∞—Ç—Ä—É–ª–∏—Ä—É–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: –Ω–∞ —ç—Ç–æ–º –º–µ—Å—Ç–µ –Ω–µ–¥–∞–≤–Ω–æ –≤–∏–¥–µ–ª–∏ –¥–∏–∫–∏—Ö –∫—Ä—ã—Å, –∏ –æ–Ω–∏ –ø—Ä–æ—Å–∏–ª–∏ –æ–¥–µ—è–ª–∞ –∏ –≥–æ—Ä—è—á–∏–π —á–∞–π. –ë–ª–∞–≥–æ —Ç—ã –Ω–∞ –Ω–∏—Ö –Ω–µ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂, —Ç–∞–∫ —á—Ç–æ –¥–µ—Ä–∂–∏:"',
                             '–ë–ª—É–∂–¥–∞—è –ø–æ –ª–µ—Å—É –≤ –ø–æ–∏—Å–∫–∞—Ö –¥–æ–±—Ä–∞ —Ç—ã –Ω–∞—Ç–∫–Ω—É–ª—Å—è –Ω–∞ –≤–µ–¥—å–º—É!\n- "–ï—Å–ª–∏ —Å–ª—ã—à–∏—à—å —à–æ—Ä–æ—Ö –≤ –∫—É—Å—Ç–∞—Ö ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫—Ä—ã—Å–∞!"\n –ò –ø—Ä–∞–≤–¥–∞, –æ–±—ã—Å–∫–∞–≤ –∫—É—Å—Ç —Ä—è–¥–æ–º —Å –≤–µ–¥—å–º–æ–π —Ç—ã –Ω–∞—à—ë–ª:',
                             '–û–¥–∏–Ω –∞–≤–∞–Ω—Ç—é—Ä–∏—Å—Ç 40 –ª–µ—Ç –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–ª –≤ —Å–∞–º–æ–π —É—Å–ø–µ—à–Ω–æ–π –≥–∏–ª—å–¥–∏–∏ –≤ –∑–∞–º–∫–µ –∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –ø–∞—Ç—Ä—É–ª—ë–º –æ–Ω –¥–æ—Å—Ç–∞–≤–∞–ª –∏–∑ –∫–∞—Ä–º–∞–Ω–∞ –ø–æ–º—è—Ç—É—é –±—É–º–∞–∂–∫—É, –¥–æ–ª–≥–æ —Å–º–æ—Ç—Ä–µ–ª –Ω–∞ –Ω–µ—ë, –∏ —É–±–∏—Ä–∞–ª –æ–±—Ä–∞—Ç–Ω–æ. –ö–æ–≥–¥–∞ –æ–Ω –æ–±—Ä–æ–Ω–∏–ª –±—É–º–∞–∂–∫—É, —Ç—ã –ø–æ–±–µ–∂–∞–ª –∏ –ø—Ä–æ—á–∏—Ç–∞–ª –Ω–∞ –Ω–µ–π: "–ö–∞–∂–¥—ã–π –ø–∞—Ç—Ä—É–ª—å –æ—Å–µ–Ω—å—é ‚Äî —ç—Ç–æ –º–∏–Ω–∏-–∫–≤–µ—Å—Ç –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ: –Ω–µ –ø–æ—Å–∫–æ–ª—å–∑–Ω–∏—Å—å –Ω–∞ –ª–∏—Å—Ç—å—è—Ö –∏ –Ω–µ –ø–æ–ø–∞–¥–∏ –≤ –ø–∞—É—Ç–∏–Ω—É"\n–°–ª–µ–¥—É—è –ø–æ–¥—Å–∫–∞–∑–∫–µ —Ç—ã –Ω–∞—à—ë–ª:',
                             '–í—ã —à–ª–∏ –ø–æ –ª–µ—Å—É, –∫–∞–∫ –º–∏–º–æ –≤–∞—Å –ø—Ä–æ–±–µ–∂–∞–ª —Å–ª–µ–≥–∫–∞ –ø–æ–ª–Ω–æ–≤–∞—Ç—ã–π –º—É–∂–∏–∫ –≤ –æ—á–∫–∞—Ö —Å –∫–Ω–∏–≥–æ–π –≤ —Ä—É–∫–∞—Ö, –∑–∞ –Ω–∏–º –≥–Ω–∞–ª–∞—Å—å –æ—Ä–∞–≤–∞ —Å–∞–º—ã—Ö —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö —Ç–≤–∞—Ä–µ–π.\n"–ß—Ç–æ–± —è –µ—â—ë —Ä–∞–∑ –æ —á–µ–º-—Ç–æ —Ç–∞–∫–æ–º –Ω–∞–ø–∏—Å–∞–ª! –õ—É—á—à–µ –±—ã –Ω–∞–ø–∏—Å–∞–ª –Ω–æ–≤—ã–µ –∏–¥–µ–∏ –¥–ª—è –∏–¥–µ–µ-–≥–µ–Ω–µ—Ä–∞—Ç–æ–≤ " - –∫—Ä–∏—á–∞–ª –º—É–∂–∏–∫.\n–í—ã —É–±–∏–ª–∏ –ø–∞—Ä—É –º–æ–Ω—Å—Ç—Ä–æ–≤ –∏ –Ω–∞—à–ª–∏ —É –Ω–∏—Ö:',
                             '–ü—Ä–∏–º–µ—Ç–∏–≤ –¥–æ–∂–¥—å –∑–∞ –æ–∫–Ω–æ–º —Å–≤–æ–µ–π –∫–æ–º–Ω–∞—Ç—ã, —Ç—ã —Ä–µ—à–∏–ª –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–∞—Ç—Ä—É–ª—å –≤ —Å–≤–æ–µ–π –∫–æ–º–Ω–∞—Ç–µ.\n–¢—ã —Ö–æ–¥–∏–ª –ø–æ —Å–≤–æ–µ–π —Å–ø–∞–ª—å–Ω–∏, –∫–∞–∫ –ø–æ—á—É—è–ª, —á—Ç–æ –∏–∑ –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –æ—Å–≤–µ—â–µ–Ω–Ω–æ–≥–æ —É–≥–ª–∞ –∑–∞ —Ç–æ–±–æ–π –∫—Ç–æ-—Ç–æ —Å–ª–µ–¥–∏—Ç... –¢—ã –ø–æ—Å–≤–µ—Ç–∏–ª —Ç—É–¥–∞ —Ñ–æ–Ω–∞—Ä—ë–º –∏ —Ç–∞–º –æ–∫–∞–∑–∞–ª—Å—è –º–∞–ª–µ–Ω—å–∫–∏–π, –∑–µ–ª—ë–Ω—ã–π, —à–∞—Ä–æ–æ–±—Ä–∞–∑–Ω—ã–π —Ü–∏–∫–ª–æ–ø! –û–Ω –∑–∞–º–µ—Ç–∏–ª —Ç–µ–±—è –∏ —Å –∫—Ä–∏–∫–æ–º –æ—Ç —Å—Ç—Ä–∞—Ö–∞ –≤—ã–ø—Ä—ã–≥–Ω—É–ª –≤ –æ–∫–Ω–æ. –ü–æ—Å–ª–µ —Å–µ–±—è –æ–Ω –æ—Å—Ç–∞–≤–∏–ª:'
                            ]

        current_datetime = datetime.now()
        if current_datetime.month in [9, 10, 11]:
            for i in quest_spring_text:
                quest_texts.append(i)
        
        quest_fools_day = ['–ü–æ–∫–∞ –≤—ã —à–ª–∏ –ø–æ –ª–µ—Å—É, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –∑–∞—Å–∞–¥—É –∫—Ä—ã—Å, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–æ–±—Ä–∞–ª–∞ –≤—Å–µ –≤–∞—à–∏ –≤–µ—â–∏ –∏ –∏–∑–±–∏–ª–∞ –¥–æ –ø–æ—Ç–µ—Ä–∏ —Å–æ–∑–Ω–∞–Ω–∏—è... –ë–æ—é—Å—å –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –í–°–Å. –£–¥–∞—á–∏!',
                           '–í—ã –≥—É–ª—è–ª–∏ –ø–æ –¥–µ—Ä–µ–≤–Ω–µ –∏ –ø–æ–¥–æ—à–ª–∏ –∫ —Ü–µ—Ä–∫–≤–µ. –¢–∞–º –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –±–æ–≥–∞ —Å–ª–∞–¥–∫–∏—Ö –±—É–ª–æ—á–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–∞—â–∏–ª –≤–∞—Å –∫ —Å–µ–±–µ –∏ —Å–¥–µ–ª–∞–ª —Å–≤–æ–∏–º –∂—Ä–µ—Ü–æ–º. –¢–µ–ø–µ—Ä—å –≤—ã –∂—Ä–µ—Ü –±—É–ª–æ—á–µ–∫ (–¥–æ —Å–ª–∞–¥–∫–∏—Ö –µ—â—ë –Ω–µ –¥–æ—Ä–æ—Å–ª–∏ =)).',
                           '–í—ã –≥—É–ª—è–ª–∏ –ø–æ –∑–∞–º–∫—É, –∫–∞–∫ –∫ –≤–∞–º —Å–∑–∞–¥–∏ –ø–æ–¥–æ—à—ë–ª –≤–æ—Ä–∏—à–∫–∞ –∏ —É–∫—Ä–∞–ª —É –≤–∞—Å 1 –ø—Ä–µ–¥–º–µ—Ç —Å –∫—Ä–∏–∫–æ–º :"–ë–´–õ–û –¢–í–û–Å, –°–¢–ê–õ–û –ú–û–Å!" \n–ü–æ–∫–∞ –≤—ã –∑–∞ –Ω–∏–º –≥–Ω–∞–ª–∏—Å—å, –æ–Ω, —á—Ç–æ–± –æ—Ç–æ—Ä–≤–∞—Ç—å—Å—è –æ—Ç –≤–∞—Å, –∫–∏–Ω—É–ª –≤–∞–º –≤ –ª–∏—Ü–æ –º–µ—à–æ–∫. (—Å–æ–≤–µ—Ç—É—é –≤–∞–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–¥–µ—Ç—ã–µ –≤–µ—â–∏ =))\n–í –º–µ—à–∫–µ –±—ã–ª–æ:',
                           '–í—ã –≥—É–ª—è–ª–∏ –æ–∫–æ–ª–æ –º–æ—Å—Ç–∞ –∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –¢—Ä–æ–ª–ª—è, —Ç–æ—Ç –æ–∑–≤–µ—Ä–µ–ª —É–≤–∏–¥–µ–≤ –≤–∞—Å –∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª—Å—è –∫ –±–æ—é! –ü–æ–∫–∞ —Ç–æ—Ç –≥–æ—Ç–æ–≤–∏–ª—Å—è, –≤—ã —Å–∫–∞–∑–∞–ª–∏ —á—Ç–æ —É –Ω–µ–≥–æ —Ä–∞–∑–≤—è–∑–∞–ª–∏—Å—å —à–Ω—É—Ä–∫–∏, –ø–æ–∫–∞ —Ç—Ä–æ–ª–ª—å –Ω–∞—á–∞–ª —Ä–∞–∑–≥–ª—è–¥—ã–≤–∞—Ç—å —Å–≤–æ–∏ –±–æ—Å—ã–µ –Ω–æ–≥–∏ –≤—ã —É—Å–ø–µ–ª–∏ —É–±–µ–∂–∞—Ç—å –ø—Ä–∏—Ö–≤–∞—Ç–∏–≤ —Å —Å–æ–±–æ–π:'
            ]
        current_datetime = datetime.now()
        if current_datetime.month == 4 and current_datetime.day == 1:  
            for i in quest_fools_day:
                quest_texts.append(i)
            
        quest_zero_exp_texts = [
            '–ü–æ–∫–∞ –≤—ã –±—Ä–æ–¥–∏–ª–∏ –ø–æ –æ–∫—Ä–µ—Å—Ç–Ω–æ–º—É –ª–µ—Å—É, –≤—ã –∑–∞–º–µ—Ä–∑–ª–∏ –∏ —Ä–µ—à–∏–ª–∏ —Ä–∞–∑–≤–µ—Å—Ç–∏ –∫–æ—Å—Ç–µ—Ä, –æ—Ç–¥—ã—Ö–∞—è –æ—Ç –±–∏—Ç–≤ –∏ —Å—Ä–∞–∂–µ–Ω–∏–π.',
        '–í—ã–π–¥—è –∏–∑ –∑–∞–º–∫–∞, –≤—ã —É–≤–∏–¥–µ–ª–∏ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞, –∏–∑–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—â–µ–≥–æ —Ä–∞–∑–ª–∏—á–Ω–æ–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ. –£–≤–∏–¥–µ–≤ –≤–∞—Å, –æ–Ω –±—Ä–æ—Å–∏–ª —Å–≤–µ—Ç–æ–≤—É—é –∏ —Å–∫—Ä—ã–ª—Å—è.',
        '–ò—â–∞, —Å –∫–µ–º –±—ã –ø–æ–¥—Ä–∞—Ç—å—Å—è, –≤—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –º–∞–ª–µ–Ω—å–∫—É—é –≤–æ–ª—à–µ–±–Ω–∏—Ü—É, —É—Ç–≤–µ—Ä–∂–¥–∞—é—â—É—é, —á—Ç–æ –æ–Ω–∞ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Å–∏–ª—å–Ω–∞. –í—ã, –Ω–µ –≤–µ—Ä—è –µ–π, –ø–æ–ø—Ä–æ—Å–∏–ª–∏ –µ–µ —á—Ç–æ-—Ç–æ —Å–∫–∞—Å—Ç–∞–Ω—É—Ç—å... –í—ã –æ—á–Ω—É–ª–∏—Å—å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –≤–µ—Å—å –æ–±–≥–æ—Ä–µ–ª—ã–π.',
        '–í—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –º–æ—Å—Ç, –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–π —Ä–µ–∫—É. –ù–∞ –º–æ—Å—Ç—É —Å—Ç–æ—è–ª —Å—Ç–∞—Ä—ã–π –±–æ—Ä–æ–¥–∞—Ç—ã–π –≤–æ–ª—à–µ–±–Ω–∏–∫ —Å –ø–æ—Å–æ—Ö–æ–º –≤ —Ä—É–∫–∞—Ö. –û–Ω –∫—Ä–∏—á–∏—Ç:"–¢—ã –Ω–µ –ø—Ä–æ–π–¥–µ—à—å!" –ò –±—å—ë—Ç –ø–æ—Å–æ—Ö–æ–º –ø–æ –∑–µ–º–ª–µ. –¢—ã –ø–µ—Ä–µ–ø–ª—ã–≤–∞–µ—à—å —Ä–µ–∫—É –∏ –∏–¥—ë—à—å —Å–≤–æ–µ–π –¥–æ—Ä–æ–≥–æ–π.',
        '–í—ã –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ –∑–∞–º–æ–∫ —Ç–∞–º –≤–∞—Å –≤—Å—Ç—Ä–µ—á–∞–µ—Ç —Å–∫–µ–ª–µ—Ç –∏ –≥–æ–≤–æ—Ä–∏—Ç " –•–æ—Ä–æ—à–∏–π –¥–µ–Ω—ë–∫ –ø—Ç–∏—á–∫–∏ –ø–æ—é—Ç, —Ü–≤–µ—Ç—ã –±–ª–∞–≥–æ—É—Ö–∞—é—Ç. –•–æ—Ä–æ—à–∏–π –¥–µ–Ω—å —É–º–µ—Ä–µ—Ç—å." –í—ã —Ç–µ—Ä—è–µ—Ç–µ —Å–æ–∑–Ω–∞–Ω–∏–µ. –û—á–Ω—É–≤—à–∏—Å—å –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —á—Ç–æ —ç—Ç–æ –±—ã–ª —Å—Ç—Ä–∞—à–Ω—ã–π —Å–æ–Ω.'
        ]
        
        quest_zero_winter = ['–ì—É–ª—è—è –ø–æ —Å–Ω–µ–∂–Ω—ã–º —Ä–∞–≤–Ω–∏–Ω–∞–º –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∂—ë–ª—É–¥—å, –Ω–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –≤–∑—è–ª–∏ –µ–≥–æ –≤ —Ä—É–∫–∏ –Ω–∞ –≤–∞—Å –Ω–∞–ø–∞–ª–∞ –∏ –ø–æ–±–∏–ª–∞ –±–µ–ª–∫–∞']
        if current_datetime.month in [12, 1, 2]:
            for i in quest_zero_winter:
                quest_zero_exp_texts.append(i)
                
        quest_zero_fools_days = ['‚ö†Ô∏è –ü–†–û–ò–°–•–û–î–ò–¢ –°–î–í–ò–ì –í–û –í–†–ï–ú–ï–ù–ò! –ú–ò–† –ñ–î–Å–¢ –¢–û–¢–ê–õ–¨–ù–û–ï –û–ß–ò–©–ï–ù–ò–ï! –ù–û–í–´–ô –ö–ê–¢–ê–ö–õ–ò–ó–ú –ü–†–ò–ë–õ–ò–ñ–ê–ï–¢–°–Ø!\n\n–ö—Ä–∏—á–∞–ª –≥–æ–ª—ã–π –∏ —Å—É–º–∞—Å—à–µ–¥—à–∏–π —Å—Ç—Ä–∞–∂–Ω–∏–∫ –≤–æ–∑–ª–µ –≤–æ—Ä–æ—Ç –∑–∞–º–∫–∞'
            ]
        if current_datetime.month == 4 and current_datetime.day == 1:  
            for i in quest_fools_day:
                quest_texts.append(i)
                
        quest__zero_autumn = ['–û–±—Ö–æ–¥—è –ª–µ—Å –≤–æ–∑–ª–µ –∑–∞–º–∫–∞ —Ç—ã –∑–∞–º–µ—Ç–∏–ª —Ç–∞–±–ª–∏—á–∫—É –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞–Ω–æ:\n¬´–ì—Ä–∞—Ñ –ú—è—É–∫–∞–ª–∞ –≤ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ –ø–µ—Ä–µ–ø—É—Ç–∞–ª –Ω–æ—á–Ω—ã–µ –ø—Ä–æ–≥—É–ª–∫–∏ —Å –Ω–æ—á–Ω—ã–º–∏ –æ–±–Ω–∏–º–∞—à–∫–∞–º–∏. –û—Å—Ç–µ—Ä–µ–≥–∞–π—Å—è –≤–Ω–µ–∑–∞–ø–Ω—ã—Ö –æ–±–Ω–∏–º–∞—à–µ–∫!¬ª\n–ß—Ç–æ –∑–∞ –±—Ä–µ–¥ –ø–æ–¥—É–º–∞–ª —Ç—ã, –Ω–æ –≤ —Ç–æ—Ç –∂–µ —á–∞—Å –æ–∫–∞–∑–∞–ª—Å—è –≤ –∫—Ä–µ–ø–∫–∏—Ö –æ–±—ä—è—Ç–∏—è—Ö.',
                             '–í—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –∫–ª–∞–¥–±–∏—â–µ –≥–¥–µ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –º–∏—Å–∫—É —Å –∫–æ–Ω—Ñ–µ—Ç–∞–º–∏ –∏ –∑–∞–ø–∏—Å–∫—É —Ä—è–¥–æ–º: "–ù–µ –±–æ–ª—å—à–µ –¥–≤—É—Ö". –í–∑—è–≤ –≤—Å–µ (–æ–Ω–∏ –±—ã–ª–∏ –æ—á–µ–Ω—å –≤–∫—É—Å–Ω—ã–º–∏=)) –≤–∞–º –æ—Ç—Ä—É–±–∏–ª–æ –æ–±–µ —Ä—É–∫–∏. –ü—Ä–æ—Å–Ω—É–≤—à–∏—Å—å —Å–æ —Å—Ç—Ä–∞—à–Ω—ã–º –∫—Ä–∏–∫–æ–º –≤ –∫—Ä–æ–≤–∞—Ç–∏ –≤—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ –Ω–∞ —Ä—É–∫–∏. –ò—Ö –Ω–µ –±—ã–ª–æ. –í—ã –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å –ø–æ—Å—Ä–µ–¥–∏ –±–æ—è —Å –∫—Ä–∏–∫–æ–º:"–ù–∏–∫–∞–∫–∏—Ö –±–æ–ª—å—à–µ —Ö–∏—Ç–∏–Ω–æ–≤!"',
                              '–ë—É–¥—É—á–∏ –≤ –∑–∞–º–∫–µ –≤–∑—Ä—ã–≤–æ–≤ –Ω–∞ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞—Ö –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –Ω–∞–∫–∞—á–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–Ω—è –ø–æ-–≤–∏–¥–∏–º–æ–º—É –Ω–µ —Å –Ω–∞—à–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –≤—Ä–µ–º–µ–Ω–∏. –û–Ω –≤—Å–µ –≤—Ä–µ–º—è —Ä–∞—Å—Å–ø—Ä–∞—à–∏–≤–∞–ª –≤–∞—Å –æ "–°–∞—Ä–µ –ö–æ–Ω–æ—Ä" —Ä–µ—à–∏–≤ —á—Ç–æ –æ–Ω —Å—É–º–∞—Å—à–µ–¥—à–∏–π –≤ —É–∫–∞–∑–∞–ª–∞ –Ω–∞ —Å—É–º–∫—É –≤ –≤–∏–¥–µ —Ç—ã–∫–≤—ã –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–µ—Ç –∏ –±—ã—Å—Ç—Ä–æ –æ—Ç—Ç—É–¥–∞ —Å–±–µ–∂–∞–ª–∏'
        ]
        if current_datetime.month in [9, 10, 11]:
            for i in quest_zero_winter:
                quest_zero_exp_texts.append(i)

        quest_gold = random.randint(0, 10)
        x = random.randint(1, 100)
        if x <= 40:
            quest_gold += random.randint(1, 10)
        if x <= 25:
            quest_gold += random.randint(1, 8)
        if x <= 5:
            quest_gold += random.randint(5, 10)
        pogchance = 0
        quest_pogs = 0
        if 'greedy' in user['equipped_skills']:
            if user['equipped_skills']['greedy']['lvl'] == 1:
                pogchance = 5
            if user['equipped_skills']['greedy']['lvl'] == 2:
                pogchance = 10
            if user['equipped_skills']['greedy']['lvl'] == 3:
                pogchance = 15
        if random.randint(1, 1000) <= pogchance:
            quest_pogs += 1
        if taken_exp > 0:
            quest_text = random.choice(quest_texts)
        else:
            quest_text = random.choice(quest_zero_exp_texts)
            quest_gold = 0
            quest_pogs = 0
        if random.randint(1, 100) <= 30:
            quest_text += '\n‚ùóÔ∏è–í—ã —É—Å–ª—ã—à–∞–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–π —à—É–º –≤ –∫—É—Å—Ç–∞—Ö –Ω–µ–ø–æ–¥–∞–ª–µ–∫—É.'
            if user['noise_check'] < user['max_noise_check']:
                cwusers.update_one({'id': user['id']}, {'$inc': {'noise_check': 1}})
        if taken_exp > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –æ–ø—ã—Ç–∞:* üî•' + str(taken_exp)
        if quest_gold > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –∑–æ–ª–æ—Ç–∞:* üí∞' + str(quest_gold)
            cwusers.update_one({'id': user['id']}, {'$inc': {'gold': quest_gold}})
        if quest_pogs > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –º–µ—à–∫–æ–≤ –∑–æ–ª–æ—Ç–∞:* üëù' + str(quest_pogs) + '\n'
            cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': quest_pogs}})
            sendm(cwbot, pasyuk_id, user['name'] + ':' + '\n*–ü–æ–ª—É—á–µ–Ω–æ –º–µ—à–∫–æ–≤ –∑–æ–ª–æ—Ç–∞:* üëù' + str(quest_pogs) + '\n')
        restext = ''
        if taken_exp > 0:
            restext = get_loot_for_quest(quest="patrol", user=user)
        if restext != '':
            quest_text += restext
        sendm(cwbot, user['id'], quest_text, parse_mode='markdown')
        sendm(cwbot, pasyuk_id, '[' + user['name'] + ']:\n' + quest_text, parse_mode='markdown')

        try:
            user = cwusers.find_one({'id':user['id']})
            try:
                user['forest_queue']
            except:
                return
            if user['forest_queue'] > 0:
                if user['stamina'] < 1:
                    sendm(cwbot, user['id'], '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏!')
                    cwusers.update_one({'id': user['id']}, {'$set': {'forest_queue': 0}})
                    return
                #cwusers.update_one({'id':user['id']},{'$inc':{'forest_queue':-1}})
                questtime = 180  # 300
                text = '–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –ø–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏. –í–µ—Ä–Ω–µ—Ç–µ—Å—å —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã.'
                staminaregen = user['last_stamina_regen']
                if user['stamina'] >= user['maxstamina']:
                    staminaregen = time.time()
                cwusers.update_one({'id': user['id']}, {
                    '$set': {'current_act': 'quest_castle_protect', 'stamina': user['stamina'] - 1,
                             'quest_started': time.time(),
                             'last_stamina_regen': staminaregen, 'forest_queue':user['forest_queue']-1}})
                threading.Timer(questtime, castle_protect_quest, args=[user]).start()
                sendm(cwbot, user['id'], text)
        except:
            #pass
            sendm(cwbot, 441399484, traceback.format_exc())

    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


def check_lvlup(user):
    cwusers.update_one({'id': user['id']}, {'$set': {'last_activity': time.time()}})
    if user['exp'] >= need_exp_to_next_lvl(user['lvl']):
        cwusers.update_one({'id': user['id']}, {'$inc': {'lvl': 1, 'lvl_points': 3}})
        stickid = ""
        if user["castle"] == "rat":
            stickid = "CAACAgIAAxkBAAJtQWa8exZMgKgNcrFCxlsrvacogKxCAAI2UAAC24DgSaaH-RPg55-MNQQ"
        elif user["castle"] == "darkcastle":
            stickid = "CAACAgIAAxkBAAJtO2a8exEXREx9KRoggWMCX6jut17TAAL_WwACn_3hSXnaWqQZM4TKNQQ"
        elif user["castle"] == "explosion":
            stickid = "CAACAgIAAxkBAAJtPma8exTTPCiT4_nG_AuuXHdFgaRVAAJpTQACd-rgSTzFeRWIqlQpNQQ"
        elif user["castle"] == "necromant":
            stickid = "CAACAgIAAxkBAAJtRGa8exfvpuRpBIWROuvZ73jupXN_AAIOTAACNnHpSbIrk8C0Y2OKNQQ"
        try:
            cwbot.send_sticker(user['id'], stickid)
        except:
            try:
                sendm(cwbot, 441399484, traceback.format_exc())
            except:
                pass
        user['lvl'] += 1
        superlvl = False
        enbuff = False
        if user['lvl'] == 10:
            superlvl = True
            cwusers.update_one({'id': user['id']},
                               {'$inc': {'hp': 1, 'maxhp': 1, 'dmglimit': 1, 'maxdmglimit': 1, 'max_skills': 1,
                                         'max_items_for_battle': 1, 'energy': 1, 'maxenergy': 1}})
            enbuff = True
        if user['lvl'] == 25:
            superlvl = True
            cwusers.update_one({'id': user['id']}, {
                '$inc': {'hp': 1, 'maxhp': 1, 'dmglimit': 1, 'maxdmglimit': 1, 'max_skills': 1,
                         'max_items_for_battle': 1}})
        if user['lvl'] == 40:
            cwusers.update_one({'id': user['id']}, {
                '$inc': {'hp': 1, 'maxhp': 1, 'dmglimit': 1, 'maxdmglimit': 1, 'max_skills': 1,
                         'max_items_for_battle': 1}})
            superlvl = True
        if not superlvl:
            sendm(cwbot, user['id'], 'üèÖ|–£—Ä–æ–≤–µ–Ω—å –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–≤—ã—à–µ–Ω!')
        else:
            if not enbuff:
                sendm(cwbot, user['id'], 'üèÖ|–£—Ä–æ–≤–µ–Ω—å –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–≤—ã—à–µ–Ω! –ü—Ä–æ–∫–∞—á–∞–Ω—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:' + \
                                   '\n–•–ü: +1;\n–õ–∏–º–∏—Ç —É—Ä–æ–Ω–∞: +1;\n–ú–∞–∫—Å.—Å–∫–∏–ª–ª–æ–≤: +1;\n–ú–∞–∫—Å.–ø—Ä–µ–¥–º–µ—Ç–æ–≤: +1!')
            else:
                sendm(cwbot, user['id'], 'üèÖ|–£—Ä–æ–≤–µ–Ω—å –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–≤—ã—à–µ–Ω! –ü—Ä–æ–∫–∞—á–∞–Ω—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:' + \
                                   '\n–•–ü: +1;\n–õ–∏–º–∏—Ç —É—Ä–æ–Ω–∞: +1;\n–ú–∞–∫—Å.—ç–Ω–µ—Ä–≥–∏—è: 1;\n–ú–∞–∫—Å.—Å–∫–∏–ª–ª–æ–≤: +1;\n–ú–∞–∫—Å.–ø—Ä–µ–¥–º–µ—Ç–æ–≤: +1!')
        try:
            if user['who_invited'] != None:
                if user['lvl'] == 5:
                    cwusers.update_one({'id': user['who_invited']}, {'$inc': {'maxstamina': 1}})
                    sendm(cwbot, user['who_invited'], user[
                        'name'] + ' –ø–æ–≤—ã—Å–∏–ª —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–æ 5! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +1 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏.')
                if user['lvl'] == 10:
                    cwusers.update_one({'id': user['who_invited']}, {'$inc': {'maxstamina': 1}})
                    sendm(cwbot, user['who_invited'], user[
                        'name'] + ' –ø–æ–≤—ã—Å–∏–ª —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–æ 10! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +1 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏.')
                if user['lvl'] == 15:
                    cwusers.update_one({'id': user['who_invited']}, {'$inc': {'maxstamina': 1}})
                    sendm(cwbot, user['who_invited'], user[
                        'name'] + ' –ø–æ–≤—ã—Å–∏–ª —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–æ 15! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +1 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏.')
        except:
            pass
        if user['lvl'] == 8:
            sendm(cwbot, user['id'], '–í—ã —Å—Ç–∞–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—ã—Ç–Ω—ã, —á—Ç–æ–±—ã –º–∞—Å—Ç–µ—Ä–∞ –≤–∞—à–µ–≥–æ –∑–∞–º–∫–∞ –æ–±—É—á–∏–ª–∏ –≤–∞—Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –∏–∑–≤–µ—Å—Ç–Ω–æ–π —Ç–æ–ª—å–∫–æ –∏–º. ' +\
                               "–í–∞—Å –æ—Ç–≤–µ–ª–∏ –≤ –ø–æ–º–µ—â–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–∞—Å –≤—Å—Ç—Ä–µ—Ç–∏–ª –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, –ª–∏—Ü–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –¥–∞–∂–µ –Ω–µ –º–æ–≥–ª–∏ —Ä–∞–∑–≥–ª—è–¥–µ—Ç—å. "+\
                               "–í—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –≤—ã—Å–ª—É—à–∞–ª–∏ –≤—Å–µ —Ç–æ, —á—Ç–æ –æ–Ω –≤–∞–º —Ä–∞—Å—Å–∫–∞–∑–∞–ª...\n\n"+\
                               "–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∑–Ω–∞–ª–∏ - /special_ability")
            cwusers.update_one({'id':user['id']},{'$set':{'know_about_ability':True}})
        sendm(cwbot, pasyuk_id, 'üèÖ|–£—Ä–æ–≤–µ–Ω—å ' + user['name'] + ' –ø–æ–≤—ã—à–µ–Ω –¥–æ ' + str(user['lvl']) + '!')


def get_player_exp_for_rathunt(uid, win, hp=3, rat = None):
    try:
        user = cwusers.find_one({'id': uid})
        rat_type = "–æ–±—ã—á–Ω–∞—è"
        if rat != None:
            if "–ó–æ–ª–æ—Ç–∞—è –∫—Ä—ã—Å–∞" in rat['name']:
                rat_type = "–ó–æ–ª–æ—Ç–∞—è –∫—Ä—ã—Å–∞"
            elif "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è –∫—Ä—ã—Å–∞" in rat['name']:
                rat_type = "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è –∫—Ä—ã—Å–∞"
            else:
                rat_type = "–°—Ç—Ä–∞—à–Ω–∞—è –∫—Ä—ã—Å–∞"


        # –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª
        if win:
            if rat_type == "–ó–æ–ª–æ—Ç–∞—è –∫—Ä—ã—Å–∞":
                taken_exp = 0
                quest_gold = random.randint(10, 25) * 2
                quest_pogs = 0
                if 'greedy' in user['equipped_skills']:
                    if user['equipped_skills']['greedy']['lvl'] == 2:
                        pogchance = 2
                    if user['equipped_skills']['greedy']['lvl'] == 4:
                        pogchance = 4
                    if user['equipped_skills']['greedy']['lvl'] == 6:
                        pogchance = 6
                    if random.randint(1, 100) <= pogchance:
                        quest_pogs += 1
                quest_text = "–í—ã –æ–¥–µ—Ä–∂–∞–ª–∏ –ø–æ–±–µ–¥—É –Ω–∞–¥ –ó–æ–ª–æ—Ç–æ–π –∫—Ä—ã—Å–æ–π!"
            elif rat_type == "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è –∫—Ä—ã—Å–∞":
                middle_exp = exp_for_quest(user['lvl']) * 3.6
                multipler = random.randint(7, 13) / 10
                taken_exp = int(middle_exp * multipler)
                if taken_exp < 1:
                    taken_exp = 1
                quest_gold = 0
                quest_pogs = 0
                if 'greedy' in user['equipped_skills']:
                    if user['equipped_skills']['greedy']['lvl'] == 1:
                        pogchance = 1
                    if user['equipped_skills']['greedy']['lvl'] == 2:
                        pogchance = 2
                    if user['equipped_skills']['greedy']['lvl'] == 3:
                        pogchance = 3
                    if random.randint(1, 100) <= pogchance:
                        quest_pogs += 1
                quest_text = "–í—ã –æ–¥–µ—Ä–∂–∞–ª–∏ –ø–æ–±–µ–¥—É –Ω–∞–¥ –ü—Ä–∏–∑—Ä–∞—á–Ω–æ–π –∫—Ä—ã—Å–æ–π!"
            else:
                middle_exp = exp_for_quest(user['lvl']) * 1.8
                multipler = random.randint(7, 13) / 10
                taken_exp = int(middle_exp * multipler)
                if taken_exp < 1:
                    taken_exp = 1
                quest_gold = random.randint(10, 25)
                x = random.randint(1, 100)
                if x <= 50:
                    quest_gold += random.randint(2, 10)
                if x <= 25:
                    quest_gold += random.randint(2, 10)
                if x <= 5:
                    quest_gold += random.randint(10, 15)
                quest_pogs = 0
                if 'greedy' in user['equipped_skills']:
                    if user['equipped_skills']['greedy']['lvl'] == 1:
                        pogchance = 1
                    if user['equipped_skills']['greedy']['lvl'] == 2:
                        pogchance = 2
                    if user['equipped_skills']['greedy']['lvl'] == 3:
                        pogchance = 3
                    if random.randint(1, 100) <= pogchance:
                        quest_pogs += 1
                quest_text = "–í—ã –æ–¥–µ—Ä–∂–∞–ª–∏ –ø–æ–±–µ–¥—É –Ω–∞–¥ –∫—Ä—ã—Å–æ–π!"

            cwusers.update_one({'id': user['id']}, {'$inc': {'exp': taken_exp}})
            cwusers.update_one({'id': user['id']}, {'$set': {'current_act': None}})
            user['exp'] += taken_exp
            check_lvlup(user)
        else:
            quest_text = "–í—ã –Ω–µ —Å–º–æ–≥–ª–∏ –æ–¥–æ–ª–µ—Ç—å –∫—Ä—ã—Å—É, –∏ –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –∑–∞–º–æ–∫ –∑–∞–ª–µ—á–∏–≤–∞—Ç—å —Ä–∞–Ω—ã."
            quest_gold = 0
            quest_pogs = 0
        if random.randint(1, 100) <= 30:
            quest_text += '\n‚ùóÔ∏è–í—ã —É—Å–ª—ã—à–∞–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–π —à—É–º –≤ –∫—É—Å—Ç–∞—Ö –Ω–µ–ø–æ–¥–∞–ª–µ–∫—É.'
            if user['noise_check'] < user['max_noise_check']:
                cwusers.update_one({'id': user['id']}, {'$inc': {'noise_check': 1}})
        if taken_exp > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –æ–ø—ã—Ç–∞:* üî•' + str(taken_exp)
        if quest_gold > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –∑–æ–ª–æ—Ç–∞:* üí∞' + str(quest_gold)
            cwusers.update_one({'id': user['id']}, {'$inc': {'gold': quest_gold}})
        if quest_pogs > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –º–µ—à–∫–æ–≤ –∑–æ–ª–æ—Ç–∞:* üëù' + str(quest_pogs) + '\n'
            cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': quest_pogs}})
        restext = ''
        if win:
            restext = get_loot_for_quest(quest="rathunt", user=user)
        if restext != '':
            quest_text += restext
        lost_hp = 0

        if not win or hp <= 0:
            if not win:
                lost_hp = random.randint(1, 2)
            elif hp <= 0:
                lost_hp = 1
            difference = user['hp'] - lost_hp
            if difference < 0:
                lost_hp += difference
            quest_text += '\n–ü–æ—Ç–µ—Ä—è–Ω–æ –∂–∏–∑–Ω–µ–π: üíî' + str(lost_hp)
            if user['hp'] >= user['maxhp']:
                cwusers.update_one({'id': user['id']}, {'$set': {'last_hp_regen': time.time()}})
            cwusers.update_one({'id': user['id']}, {'$inc': {'hp': -lost_hp}})

        sendm(cwbot, user['id'], quest_text, parse_mode='markdown')
        sendm(cwbot, pasyuk_id, '[' + str(user['id']) + ' ' + user['name'] + ']:\n' + quest_text,
                           parse_mode='markdown')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())

def count_user_kills(user, kills):
    try:
        if kills <= 0:
            return
        if user == None:
            return
        for ids in user['inventory']:
            item = user['inventory'][ids]
            if item['type'] == 'essence' or (item['type'] == 'weapon' and item['lvl'] == 4):
                cwusers.update_one({'id':user['id']},{'$inc':{'inventory.'+ids+'.kills':kills}})
                user['inventory'][ids]['kills'] += kills
                if user['inventory'][ids]['type'] == 'essence' and user['inventory'][ids]['kills'] >= 100:
                    objectcode = generate_object_code(user)
                    weaponcode = item['code']
                    modification = item['modification']
                    newweapon = get_lvl_weapon(weapon=None, objectcode=objectcode, code=weaponcode, lvl=4,
                                need_create=True, modification = modification)
                    cwusers.update_one({'id':user['id']},{'$set':{'inventory.'+objectcode:newweapon}})
                    cwusers.update_one({'id': user['id']}, {'$unset': {'inventory.' + item['objectcode']: 1}})
                    wname = name_to_weapon(weaponcode)
                    sendm(cwbot, user['id'], 'üåê–≠—Å—Å–µ–Ω—Ü–∏—è –æ—Ä—É–∂–∏—è "'+wname+'" –Ω–∞–±—Ä–∞–ª–∞ 100 –¥—É—à –∏ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —á–µ—Ç–∫–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ—á–µ—Ä—Ç–∞–Ω–∏—è. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ –±–æ—é!')
    except:
        pass

def spent_battle_items(user, items, used_rat_toy = False):
    if user == None:
        return
    wasitems = {}
    wasitems_battle = {}
    userbattleitems = []
    for ids in user['items_for_battle']:
        userbattleitems.append(ids)
    for ids in items:
        if ids not in wasitems_battle:
            wasitems_battle[ids] = 1
        else:
            wasitems_battle[ids] += 1
    items = wasitems_battle
    for ids in userbattleitems:
        if ids not in wasitems:
            wasitems[ids] = 1
        else:
            wasitems[ids] += 1
    #print('items = ' + str(items))
    spent_items = {}
    for ids in wasitems:
        if ids not in items:
            spent_items[ids] = wasitems[ids]
        else:
            spent_items[ids] = wasitems[ids] - items[ids]
    #print('spent_items = ' + str(spent_items))
    for ids in spent_items:
        while spent_items[ids] > 0:
            userbattleitems.remove(ids)
            spent_items[ids] -= 1
    if used_rat_toy:
        cwusers.update_one({'id': user['id']}, {'$inc': {'resources.rat_toys': -1}})
    cwusers.update_one({'id': user['id']}, {'$set': {'items_for_battle': userbattleitems}})


def get_player_exp_for_duel(uid, win, hp=3, quest_gold=0):
    try:
        user = cwusers.find_one({'id': uid})
        if win:
            middle_exp = exp_for_quest(user['lvl']) * 1.5
        else:
            middle_exp = exp_for_quest(user['lvl']) * 0.1
        multipler = random.randint(7, 13)
        multipler = multipler / 10
        taken_exp = int(middle_exp * multipler)
        if taken_exp < 1:
            taken_exp = 1

        cwusers.update_one({'id': user['id']}, {'$inc': {'exp': taken_exp}})
        cwusers.update_one({'id': user['id']}, {'$set': {'current_act': None}})
        user['exp'] += taken_exp
        check_lvlup(user)
        quest_gold = random.randint(5, 15)
        x = random.randint(1, 100)
        if x <= 40:
            quest_gold += random.randint(3, 10)
        if x <= 25:
            quest_gold += random.randint(3, 10)
        if x <= 5:
            quest_gold += random.randint(10, 30)
        pogchance = 0
        quest_pogs = 0
        if 'greedy' in user['equipped_skills']:
            if user['equipped_skills']['greedy']['lvl'] == 1:
                pogchance = 1
            if user['equipped_skills']['greedy']['lvl'] == 2:
                pogchance = 2
            if user['equipped_skills']['greedy']['lvl'] == 3:
                pogchance = 3
        if random.randint(1, 100) <= pogchance:
            quest_pogs += 1
        if win:
            quest_text = "–í—ã –æ–¥–µ—Ä–∂–∞–ª–∏ –ø–æ–±–µ–¥—É –Ω–∞–¥ –≤—Ä–∞–≥–æ–º!"
        else:
            quest_text = "–í—ã –Ω–µ —Å–º–æ–≥–ª–∏ –æ–¥–æ–ª–µ—Ç—å –≤—Ä–∞–≥–∞, –∏ –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –∑–∞–º–æ–∫ –∑–∞–ª–µ—á–∏–≤–∞—Ç—å —Ä–∞–Ω—ã."
            quest_gold = 0
            quest_pogs = 0
        if taken_exp > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –æ–ø—ã—Ç–∞:* üî•' + str(taken_exp)
        if quest_gold > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –∑–æ–ª–æ—Ç–∞:* üí∞' + str(quest_gold)
            cwusers.update_one({'id': user['id']}, {'$inc': {'gold': quest_gold}})
        if quest_pogs > 0:
            quest_text += '\n*–ü–æ–ª—É—á–µ–Ω–æ –º–µ—à–∫–æ–≤ –∑–æ–ª–æ—Ç–∞:* üëù' + str(quest_pogs) + '\n'
            cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': quest_pogs}})
            sendm(cwbot, pasyuk_id, user['name'] + ':' + '\n*–ü–æ–ª—É—á–µ–Ω–æ –º–µ—à–∫–æ–≤ –∑–æ–ª–æ—Ç–∞:* üëù' + str(quest_pogs) + '\n')
        restext = ''
        if win:
            restext = get_loot_for_quest(quest="duel", user=user)
        if restext != '':
            quest_text += restext
        lost_hp = 0
        if not win or hp <= 0:
            if not win:
                lost_hp = random.randint(1, 2)
            elif hp <= 0:
                lost_hp = 1
            difference = user['hp'] - lost_hp
            if difference < 0:
                lost_hp += difference
            quest_text += '\n–ü–æ—Ç–µ—Ä—è–Ω–æ –∂–∏–∑–Ω–µ–π: üíî' + str(lost_hp)
            if user['hp'] >= user['maxhp']:
                cwusers.update_one({'id': user['id']}, {'$set': {'last_hp_regen': time.time()}})
            cwusers.update_one({'id': user['id']}, {'$inc': {'hp': -lost_hp}})
        sendm(cwbot, user['id'], quest_text, parse_mode='markdown')
        sendm(cwbot, pasyuk_id, '[' + user['name'] + ']:\n' + quest_text, parse_mode='markdown')
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


questwaits = []


@cwbot.callback_query_handler(func=lambda call: call.data[:12] == 'quest_select')
def questselectttaaa(call):
    questselecttt(call)


def troll_help(user):
    cwusers.update_one({'id': user['id']}, {'$set': {'current_act': None}})
    sendm(cwbot, user['id'], "–í –∑–∞–º–∫–µ –∑–∞–º–µ—Ç–∏–ª–∏ –≤–∞—à–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –≤—ã—Å–ª–∞–ª–∏ –æ—Ç—Ä—è–¥ –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ø–æ–∏—Å–∫–∏. –ü–æ–¥—Ä–∞–≤—à–∏—Å—å —Å —Ç—Ä–æ–ª–ª–µ–º –∏ —Å–ø—É–≥–Ω—É–≤ –µ–≥–æ, "+
                                   "–≤–∞—Å –≤–µ—Ä–Ω—É–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ –∑–∞–º–æ–∫. –í—ã –∑–∞–¥–æ–ª–∂–∞–ª–∏ 2üëù —Å–ø–∞—Å—à–∏–º –≤–∞—Å —Ä—ã—Ü–∞—Ä—è–º.")
    sendm(cwbot, pasyuk_id, '[' + user[
        'name'] + ']:\n' + "–í –∑–∞–º–∫–µ –∑–∞–º–µ—Ç–∏–ª–∏ –≤–∞—à–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –≤—ã—Å–ª–∞–ª–∏ –æ—Ç—Ä—è–¥ –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ø–æ–∏—Å–∫–∏. –ü–æ–¥—Ä–∞–≤—à–∏—Å—å —Å —Ç—Ä–æ–ª–ª–µ–º –∏ —Å–ø—É–≥–Ω—É–≤ –µ–≥–æ, "+
                                   "–≤–∞—Å –≤–µ—Ä–Ω—É–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ –∑–∞–º–æ–∫. –í—ã –∑–∞–¥–æ–ª–∂–∞–ª–∏ 2üëù —Å–ø–∞—Å—à–∏–º –≤–∞—Å —Ä—ã—Ü–∞—Ä—è–º.", parse_mode='markdown')


def troll_quest(user):
    cwusers.update_one({'id': user['id']}, {'$set': {'current_act': None}})
    if random.randint(1, 100) <= 25:
        troll = cwtroll.find_one({})
        try:
            troll['lastname']
        except:
            cwtroll.update_one({}, {'$set': {'lastname': "–ü–∞—Å—é–∫"}})
            troll['lastname'] = "–ü–∞—Å—é–∫"
        gold = troll['gold']
        pogs = troll['pogs']
        gold += random.randint(30, 50)
        troll['exp'] += 3
        exp = int(exp_for_quest(user['lvl'])*troll['exp'])
        wintext = "–í–∞–º —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º! –í—ã –æ–≥–ª—É—à–∏–ª–∏ –µ–≥–æ –¥—É–±–∏–Ω–∫–æ–π, –∏ –æ–±—ã—Å–∫–∞–ª–∏ –º–æ—Å—Ç, –∑–∞–±—Ä–∞–≤ —Å–µ–±–µ:\n"
        wintext += "üí∞"+str(gold)+'\nüî•'+str(exp)
        if pogs > 0:
            wintext += "\nüëù"+str(pogs)
        else:
            wintext += ''
        wintext += '\n–£—Ö–æ–¥—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –∑–∞–º–æ–∫, –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –Ω–∞–¥–ø–∏—Å—å –Ω–∞ –∫–∞–º–Ω–µ:\n"–ó–¥–µ—Å—å –±—ã–ª '+troll['lastname']+'"'
        sendm(cwbot, user['id'], wintext)
        sendm(cwbot, pasyuk_id, '['+user['name']+']:\n'+wintext)
        cwusers.update_one({'id': user['id']}, {'$inc': {'exp': exp, 'gold':gold, 'pogs':pogs}})
        cwtroll.update_one({},{'$set':{'gold':0, 'pogs':0, 'exp':0, 'lastname':user['name']}})
    else:
        exp_lost = 0
        pogs_lost = 0
        maxgold = user['gold']
        gold_lost = random.randint(30, 50)
        if maxgold < gold_lost:
            gold_lost = maxgold
            if gold_lost < 0:
                gold_lost = 0
            if user['pogs'] < 1:
                exp_lost = int(exp_for_quest(user['lvl'])*5)
                sendm(cwbot, user['id'], "–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º, –∏ –æ–Ω –æ–≥–ª—É—à–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π, –∑–∞–±—Ä–∞–≤ " + str(gold_lost) + "üí∞. " + \
                                   "–£ –≤–∞—Å —Å —Å–æ–±–æ–π –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–æ–ª–æ—Ç–∞, –∏ —Ç—Ä–æ–ª–ª—å —Ä–µ—à–∏–ª –æ–±—ã—Å–∫–∞—Ç—å –≤–∞—Å –ø–æ–ª—É—á—à–µ, –Ω–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤ —É –≤–∞—Å –¥–∞–∂–µ 1üëù, —Ä–∞–∑–æ–∑–ª–∏–ª—Å—è –∏ "+\
                                   "–ø–æ–±–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π —Ç–∞–∫, —á—Ç–æ –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ "+str(exp_lost)+"üî• –∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤ –ø–ª–µ–Ω—É —É —Ç—Ä–æ–ª–ª—è.")
                sendm(cwbot, pasyuk_id, '[' + user['name'] + ']:\n' + "–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º, –∏ –æ–Ω –æ–≥–ª—É—à–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π, –∑–∞–±—Ä–∞–≤ " + str(gold_lost) + "üí∞. " + \
                                   "–£ –≤–∞—Å —Å —Å–æ–±–æ–π –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–æ–ª–æ—Ç–∞, –∏ —Ç—Ä–æ–ª–ª—å —Ä–µ—à–∏–ª –æ–±—ã—Å–∫–∞—Ç—å –≤–∞—Å –ø–æ–ª—É—á—à–µ, –Ω–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤ —É –≤–∞—Å –¥–∞–∂–µ 1üëù, —Ä–∞–∑–æ–∑–ª–∏–ª—Å—è –∏ "+\
                                   "–ø–æ–±–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π —Ç–∞–∫, —á—Ç–æ –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ "+str(exp_lost)+"üî• –∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤ –ø–ª–µ–Ω—É —É —Ç—Ä–æ–ª–ª—è.", parse_mode='markdown')
                cwusers.update_one({'id': user['id']}, {'$set': {'current_act': 'wait_help'}})
                cwusers.update_one({'id': user['id']}, {'$inc': {'pogs': -2}})
                threading.Timer(random.randint(300, 900), troll_help, args=[user]).start()
            else:
                pogs_lost = 1
                sendm(cwbot, user['id'], "–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º, –∏ –æ–Ω –æ–≥–ª—É—à–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π, –∑–∞–±—Ä–∞–≤ " + str(gold_lost) + "üí∞. "+\
                                   "–£ –≤–∞—Å —Å —Å–æ–±–æ–π –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–æ–ª–æ—Ç–∞, –∏ —Ç—Ä–æ–ª–ª—å —Ä–µ—à–∏–ª –æ–±—ã—Å–∫–∞—Ç—å –≤–∞—Å –ø–æ–ª—É—á—à–µ, –∑–∞–±—Ä–∞–≤ –µ—â–µ –∏ 1üëù.")
                sendm(cwbot, pasyuk_id, '[' + user['name'] + ']:\n' + "–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º, –∏ –æ–Ω –æ–≥–ª—É—à–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π, –∑–∞–±—Ä–∞–≤ " + \
                                   str(gold_lost) + "üí∞. "+\
                                   "–£ –≤–∞—Å —Å —Å–æ–±–æ–π –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∑–æ–ª–æ—Ç–∞, –∏ —Ç—Ä–æ–ª–ª—å —Ä–µ—à–∏–ª –æ–±—ã—Å–∫–∞—Ç—å –≤–∞—Å –ø–æ–ª—É—á—à–µ, –∑–∞–±—Ä–∞–≤ –µ—â–µ –∏ 1üëù.",
                                   parse_mode='markdown')
        else:
            sendm(cwbot, user['id'], "–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º, –∏ –æ–Ω –æ–≥–ª—É—à–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π, –∑–∞–±—Ä–∞–≤ "+str(gold_lost)+"üí∞.")
            sendm(cwbot, pasyuk_id, '[' + user[
                'name'] + ']:\n' + "–í–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Å—Ç–∞—Ç—å –≤—Ä–∞—Å–ø–ª–æ—Ö —Ç—Ä–æ–ª–ª—è –ø–æ–¥ –º–æ—Å—Ç–æ–º, –∏ –æ–Ω –æ–≥–ª—É—à–∏–ª –≤–∞—Å –¥—É–±–∏–Ω–∫–æ–π, –∑–∞–±—Ä–∞–≤ "+str(gold_lost)+"üí∞.",parse_mode='markdown')
            
        cwusers.update_one({'id':user['id']},{'$inc':{'gold':-gold_lost, 'pogs':-pogs_lost, 'exp':-exp_lost}})
        cwtroll.update_one({}, {'$inc': {'gold': gold_lost, 'pogs': pogs_lost, 'exp': 1}})



def noise_quest_check():
    while True:
        try:
            users_to_remove = []
            for ids in cw_duel_find:
                user = cw_duel_find[ids]
                find = False
                for idss in cw_duel_find:
                    target = cw_duel_find[idss]
                    target_lvl_category = True
                    if (target['lvl'] < 10 and user['lvl'] >= 10) or (user['lvl'] < 10 and target['lvl'] >= 10):
                        target_lvl_category = False
                    if target['id'] != user['id'] and target['castle'] != user['castle'] and target_lvl_category:
                        users_to_remove.append(ids)
                        users_to_remove.append(idss)
                        game = creategame(chatid=user['id'])
                        cwgames.update(game)
                        game = cwgames[user['id']]
                        game['cwduel'] = True
                        try:
                            photopath = cwbot.get_file(cwbot.get_chat(user['id']).photo.big_file_id)
                            photo = requests.get(
                                'https://api.telegram.org/file/bot' + cwbottoken + '/' + photopath.file_path).content
                        except:
                            photo = None
                        game['players'].update(createplayer(uid=user['id'], name=user['name'], photo=photo))
                        player = game['players'][user['id']]
                        player['team'] = player['id']
                        set_player_battle_stats(player, user)

                        try:
                            photopath = cwbot.get_file(cwbot.get_chat(target['id']).photo.big_file_id)
                            photo = requests.get(
                                'https://api.telegram.org/file/bot' + cwbottoken + '/' + photopath.file_path).content
                        except:
                            photo = None
                        game['players'].update(createplayer(uid=target['id'], name=target['name'], photo=photo))
                        player2 = game['players'][target['id']]
                        player2['team'] = target['id']
                        set_player_battle_stats(player2, target)

                        if spectateallgames:
                            if game['id'] != pasyuk_id and pasyuk_id not in game['players']:
                                game['spectators'].append(pasyuk_id)

                        sendm(cwbot, user['id'],
                                           '–í—ã–π–¥—è –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —à—É–º–∞, –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –±–æ–π—Ü–∞ –≤—Ä–∞–∂–µ—Å–∫–æ–≥–æ –∑–∞–º–∫–∞ - ' + castle_to_emoji(
                                               target['castle']) + target['name'] + \
                                           '! –ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –±–æ—é...')
                        sendm(cwbot, target['id'],
                                           '–í—ã–π–¥—è –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —à—É–º–∞, –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –±–æ–π—Ü–∞ –≤—Ä–∞–∂–µ—Å–∫–æ–≥–æ –∑–∞–º–∫–∞ - ' + castle_to_emoji(
                                               user['castle']) + user['name'] + \
                                           '! –ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –±–æ—é...')
                        threading.Timer(2, goo, args=[None, user['id'], game, cwbot]).start()
                        find = True
                        break
                if find:
                    break
            for ids in users_to_remove:
                cw_duel_find.pop(ids)
            users_to_remove = {}
            for ids in cw_duel_find:
                user = cw_duel_find[ids]
                if time.time() - user['startfindtime'] >= 300:
                    users_to_remove.update({ids: cw_duel_find[ids]})
            for ids in users_to_remove:
                user = users_to_remove[ids]
                game = creategame(chatid=ids)
                cwgames.update(game)
                game = cwgames[ids]
                game['cwduelrats'] = True
                game['players'].update(createplayer(uid=user['id'], name=user['name'], photo=None))
                if spectateallgames:
                    if game['id'] != pasyuk_id and pasyuk_id not in game['players']:
                        game['spectators'].append(pasyuk_id)
                player = game['players'][user['id']]
                player['name'] = user['name']
                player['team'] = player['id']
                player['lvl'] = user['lvl']
                set_player_battle_stats(player, user)

                text = '–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –Ω–∞ –ø–æ–∏—Å–∫–∏ –∫—Ä—ã—Å–∏–Ω–æ–≥–æ –ª–æ–≥–æ–≤–∞. –î–æ–π–¥–µ—Ç–µ —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É.'
                threading.Timer(3, goo, args=[None, user['id'], game, cwbot]).start()
                # cwusers.update_one({'id':ids},{'$set':{'current_act':None}})
                cw_duel_find.pop(ids)
                sendm(cwbot, ids, "–í—ã–π–¥—è –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ —à—É–º–∞, –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –∫—Ä—ã—Å—É! –ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –±–æ—é...")
        except:
            sendm(cwbot, pasyuk_id, traceback.format_exc())
        time.sleep(5)


threading.Thread(target=noise_quest_check, args=[]).start()


@cwbot.message_handler(commands=['players_state'])
def plstatee(m):
    if m.from_user.id != pasyuk_id:
        return
    x = cwusers.find({})
    text = ''
    for ids in x:
        text += str(ids['id']) + ' ' + castle_to_emoji(ids['castle']) + ids['name'] + ': ' + get_player_state(
            ids) + '\n\n'
    texts = []
    while len(text) > 4000:
        textadd = text[:4000]
        text = text[4000:]
        texts.append(textadd)
    for ids in texts:
        sendm(cwbot, m.chat.id, ids)


@cwbot.message_handler(commands=['battle_log'])
def cwme(m):
    user = cwusers.find_one({'id': m.from_user.id})
    if user == None:
        return
    text = ''
    text += 'üí∞: ' + str(user['changebattlegold']) + '\n'
    text += 'üî•: ' + str(user['changebattleexp']) + '\n'
    for ids in user['changebattleres']:
        text += 'üì¶' + resource_to_name(ids) + ': ' + str(user['changebattleres'][ids]) + '\n'
    if len(user['changebattleres']) == 0:
        text += 'üì¶–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.\n'
    for ids in user['lastbattlelogs']:
        text += ids + '\n'
    sendm(cwbot, m.chat.id, "–õ–æ–≥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–æ—è:\n\n" + text)


@cwbot.message_handler(commands=['nextlvl'])
def cwnextlvlvv(m):
    try:
        if m.from_user.id != pasyuk_id:
            return

        try:
            lvl = int(m.text.split(' ')[1])
        except:
            return
        need = need_exp_to_next_lvl(lvl - 1)
        sendm(cwbot, m.chat.id, '–ù–∞–¥–æ –æ–ø—ã—Ç–∞ –¥–ª—è –ª–≤–ª–∞ ' + str(lvl) + ': ' + str(need))
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@cwbot.message_handler(commands=['expforquest'])
def cwnextlvlvv(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        text = ''
        lvl = 1
        while lvl < 40:
            exp = exp_for_quest(lvl)
            text += '–í —Å—Ä–µ–¥–Ω–µ–º –æ–ø—ã—Ç–∞ –∑–∞ –∫–≤–µ—Å—Ç –Ω–∞ ' + str(lvl) + ' –ª–≤–ª–µ: ' + str(exp) + '\n'
            lvl += 1

        sendm(cwbot, m.chat.id, text)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


##################################### CW CALLBACKS ##############################################################################################
##################################### CW CALLBACKS ##############################################################################################
##################################### CW CALLBACKS ##############################################################################################\

@cwbot.callback_query_handler(func=lambda call: time.time() - call.message.date > 125)
def cancelold(call):
    cwbot.answer_callback_query(call.id, '–°–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!')


##################################### CW CALLBACKS END##############################################################################################
##################################### CW CALLBACKS END##############################################################################################
##################################### CW CALLBACKS END##############################################################################################

def check_necrostaff():
    has_necrostaff.clear()
    for ids in users.find({}):
        try:
            if ids['staff_of_necromant']:
                has_necrostaff.append(ids['id'])
        except:
            pass
    threading.Timer(900, check_necrostaff).start()


check_necrostaff()

has_charge = []


def check_charge():
    has_charge.clear()
    for ids in users.find({}):
        try:
            if ids['rhinosoul']:
                has_charge.append(ids['id'])
        except:
            pass
    threading.Timer(900, check_charge).start()


check_charge()


def summon_world_skeleton():
    w = world.find_one({})
    idlist = []
    for ids in w['npc']:
        idlist.append(w['npc'][ids]['id'])
    skeletonuser = newskeletonuser(idlist=idlist)
    skeleton = createplayer(skeletonuser, photo=skeletonphoto)
    for ids in skeleton:
        x = ids
        break
    skeleton[x]['name'] = '–°–∫–µ–ª–µ—Ç|üíÄ'
    skeleton[x]['team'] = skeleton[x]['id']
    skeleton[x]['controller'] = 'bot'
    skeleton[x]['weapon'] = weaponlist.Sword()
    hp = random.randint(2, 4)
    skeleton[x]['hp'] = hp
    skeleton[x]['maxhp'] = hp
    return skeleton[x]


def summon_world_rat():
    w = world.find_one({})
    idlist = []
    for ids in w['npc']:
        idlist.append(w['npc'][ids]['id'])
    newrat = newratuser(idlist=idlist)
    rat = createplayer(newrat, photo=ratphoto)
    for idsss in rat:
        x = idsss
        break
    rat[x]['name'] = '–ö—Ä—ã—Å–∞|üê≠'
    rat[x]['team'] = rat[x]['id']
    rat[x]['controller'] = 'bot'
    return rat[x]


def summon_world_rhino():
    w = world.find_one({})
    idlist = []
    for ids in w['npc']:
        idlist.append(w['npc'][ids]['id'])
    newrhino = newrhinouser(idlist=idlist)
    rhino = createplayer(newrhino, photo=None)
    for idsss in rhino:
        x = idsss
        break
    rhino[x]['name'] = '–ù–æ—Å–æ—Ä–æ–≥|ü¶è'
    rhino[x]['team'] = rhino[x]['id']
    rhino[x]['controller'] = 'bot'
    rhino[x]['hp'] = 5
    rhino[x]['maxhp'] = 5
    rhino[x]['dmglimit'] = 9
    rhino[x]['maxdmglimit'] = 9
    rhino[x]['maxenergy'] = 3
    rhino[x]['energy'] = 3
    rhino[x]['weapon'] = weaponlist.Horn()
    rhino[x]['weapon'].dmgbonus += 1
    rhino[x]['selfarmorchance'] = 60
    rhino[x]['selfarmor'] = 2
    return rhino[x]


def spawn_npc(amount=1):
    w = world.find_one({})
    need = amount - len(w['npc'])
    npcs = []
    if need > 0:
        for i in range(need):
            choicenpc = []
            for i in range(10):
                choicenpc.append('rat')
            for i in range(20):
                choicenpc.append('skeleton')
            for i in range(1):
                choicenpc.append('rhino')
            npc = random.choice(choicenpc)
            if npc == 'skeleton':
                npcs.append(summon_world_skeleton())
            elif npc == 'rat':
                npcs.append(summon_world_rat())
            elif npc == 'rhino':
                npcs.append(summon_world_rhino())
    freelocs = []
    for ids in w['world']:
        loc = w['world'][ids]
        if loc['object'] == 'free' and loc['player'] == None and loc['fight'] == False and loc['home'] == False:
            freelocs.append(ids)
    for ids in npcs:
        loc = random.choice(freelocs)
        npc = ids
        world.update_one({}, {'$set': {'world.' + loc + '.player': npc['id']}})
        world.update_one({}, {'$set': {
            'npc.' + str(npc['id']): {'id': npc['id'], 'amount': 1, 'photo': npc['photo'], 'name': npc['name']}}})
        freelocs.remove(loc)


allowgames = True
games = {}
from keyboards import weapons
from keyboards import allw

# weapons = [weaponlist.Pistol, weaponlist.Baseball, weaponlist.Knife, weaponlist.Obrez,
#           weaponlist.Drobovik, weaponlist.Revolver, weaponlist.Torch, weaponlist.Flamethrower,
#           weaponlist.Rifle, weaponlist.Axe, weaponlist.Bulava, weaponlist.Kastet, weaponlist.Kuvalda, weaponlist.Chain,
#          weaponlist.Spear, weaponlist.Saber, weaponlist.Granatomet, weaponlist.Bow, weaponlist.Claws, weaponlist.Electro]
#
# allw = [weaponlist.Pistol, weaponlist.Baseball, weaponlist.Knife, weaponlist.Obrez,
#           weaponlist.Drobovik, weaponlist.Revolver, weaponlist.Torch, weaponlist.Flamethrower,
#           weaponlist.Rifle, weaponlist.Axe, weaponlist.Bulava, weaponlist.Kastet, weaponlist.Kuvalda, weaponlist.Chain,
#       weaponlist.Narsil, weaponlist.Fist, weaponlist.Spear, weaponlist.BowAsgard, weaponlist.Katana, weaponlist.Saber, weaponlist.Granatomet, weaponlist.Bow, weaponlist.Claws,
#       weaponlist.Electro, weaponlist.Non]

npcweapons = [weaponlist.Baseball, weaponlist.Knife, weaponlist.Revolver, weaponlist.Torch, weaponlist.Flamethrower,
              weaponlist.Axe, weaponlist.Kastet, weaponlist.Bow, weaponlist.Chain, weaponlist.Kuvalda, weaponlist.Molot,
              weaponlist.Obrez, weaponlist.Yatagan]

npcclassicweapons = [weaponlist.Pistol_classic, weaponlist.Baseball_classic, weaponlist.Knife_classic, weaponlist.Obrez_classic,
           weaponlist.Drobovik_classic, weaponlist.Revolver_classic, weaponlist.Torch_classic, weaponlist.Flamethrower_classic,
           weaponlist.Axe_classic, weaponlist.Kastet_classic, weaponlist.Kuvalda_classic, weaponlist.Chain_classic,
           weaponlist.Police_classic]

blockweapons = [weaponlist.MachineGun().name, weaponlist.NecromantStaff_players().name]

npcskills = ['sniper', 'dvuzhil', 'zombie', 'bicepc', 'protivogaz', 'shieldgen', 'medic', 'cherep', 'charge', 'berserk',
             'sadist']
npcclassicskills = ['sniper', 'shieldgen', 'medic', 'dvuzhil', 'zombie',
          'bicepc_classic', 'sadist', 'berserk', 'zapas', 'protivogaz_classic',
         'cherep_classic', 'hypnotist_classic', 'armor_classic']

npcitems = ['grenade', 'adrenaline', 'shield', 'flash', 'molotov', 'hitin']  # 'madpotion']

testweapon = allw[-1]

logs = 735169795
ratphoto = 'AgACAgIAAxkBAAEBRAVhK6Ir1wtXM7Q7BaPnR1aLhgniGgAC9rcxG0uoYUlUUf3xM8YqUQEAAwIAA20AAyAE'
skeletonkingphoto = 'AgACAgIAAxkBAAEB1BFhM7fDkTjhY9eGG5ufVi434gYbYAAC0rkxGzIxoUkVJNEkCFF-DAEAAwIAA3kAAyAE'
vampirephoto = 'AgACAgIAAxkBAAEB1SxhM9ASfBl0IXKtewxMvYsFSSIGWgAC7LkxGzIxoUkNhyaIL3_cWQEAAwIAA3kAAyAE'
demonlordphoto = 'AgACAgIAAxkBAAEB7WBhNLcMWGo8R0iLMyoJBAMzBZjw_wACxbUxG2iKqUmEQck6JVPN_QEAAwIAA3kAAyAE'
rhinophoto = 'AgACAgIAAxkBAAEDMFVhOxPFf5i7nqrBKeKJtd0Qz_ILwwACZrUxG22OoUm6J6ChIb5blAEAAwIAA3gAAyAE'
skeletonphoto = 'AgACAgIAAxkBAAEDZURhPvHc2HU3hb5wlmMnFcEDEjBiCgACIbUxG6Pk-Ulc537VVRrXOwEAAwIAA3gAAyAE'
necromantphoto = 'AgACAgIAAxkBAAESEq9iU0HW907UDeJGu2vqhRHohxS1_AADuDEbUaKQSlhp1WlFDKwHAQADAgADeAADIwQ'
onepunchphoto = 'AgACAgIAAxkBAAEz3edjihudg6z_n2ZK4VwyHhHCv6-T9AACjsMxG63nWEheCAf1zzQQkAEAAwIAA3kAAysE'

skills = ['sniper', 'shieldgen', 'medic', 'dvuzhil', 'zombie',
          'bicepc', 'pyromancer', 'sadist', 'berserk', 'zapas', 'visor', 'protivogaz', 'narkoman',
          'vor', 'ritualist', 'navod', 'oruzh', 'necromant', 'incvizitor', 'pyrotech', 'cherep', 'alchemist',
          'ninja', 'multicast', 'lastchance']

items = ['grenade', 'adrenaline', 'shield', 'flash', 'knife', 'molotov', 'dzet', 'hitin']  # , 'bint']#'madpotion']

class RobotMessage:
    def __init__(self, chat):
        self.chat = chat


class RobotChat:
    def __init__(self, id):
        self.id = id

class RobotCall:
    def __init__(self, from_user, data, message):
        self.from_user = from_user
        self.data = data
        self.message = message

class RobotFromUser:
    def __init__(self, id):
        self.id = id


def questselecttt(call):
    if call.from_user.id in questwaits:
        return
    questwaits.append(call.from_user.id)
    try:
        quest = call.data.split('?')[1]
        if is_battle_near():
            sendm(cwbot, call.message.chat.id, '–ë–∏—Ç–≤–∞ –±–ª–∏–∑–∫–æ. –°–µ–π—á–∞—Å –Ω–µ –¥–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π.')
            questwaits.remove(call.from_user.id)
            return
        user = cwusers.find_one({'id': call.from_user.id})
        if user['current_act'] in busy_acts:
            if user['current_act'] == 'quest_castle_protect' and quest == 'castle_protect':
                try:
                    user['forest_queue']
                except KeyError:
                    cwusers.update_one({'id': user['id']}, {'$set': {'forest_queue': 0}})
                    user['forest_queue'] = 0
                if user['forest_queue'] >= 5:
                    sendm(cwbot, call.message.chat.id, '–ú–∞–∫—Å–∏–º—É–º –∫–≤–µ—Å—Ç–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏ - 5!')
                    questwaits.remove(call.from_user.id)
                    return
                cwusers.update_one({'id': user['id']}, {'$inc': {'forest_queue': 1}})
                sendm(cwbot, call.message.chat.id,
                      f'–ö–≤–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å. –ö–≤–µ—Å—Ç–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏: {user["forest_queue"] + 1}')
                if random.randint(1, 100) <= 5:
                    captcha(user)
                questwaits.remove(call.from_user.id)
                return

            sendm(cwbot, call.message.chat.id, '–í—ã —á–µ–º-—Ç–æ –∑–∞–Ω—è—Ç—ã –∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∑—è—Ç—å —ç—Ç–æ—Ç –∫–≤–µ—Å—Ç.')
            questwaits.remove(call.from_user.id)
            return

        text = '–û—à–∏–±–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ü–∞—Å—é–∫—É.'

        # Castle Protect
        if quest == 'castle_protect':
            if user['stamina'] < 1:
                sendm(cwbot, call.message.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏!')
                questwaits.remove(call.from_user.id)
                return
            questtime = 180
            text = '–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –ø–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏. –í–µ—Ä–Ω–µ—Ç–µ—Å—å —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã.'
            staminaregen = user['last_stamina_regen']
            if user['stamina'] >= user['maxstamina']:
                staminaregen = time.time()
            cwusers.update_one({'id': call.from_user.id}, {
                '$set': {'current_act': 'quest_castle_protect', 'stamina': user['stamina'] - 1,
                         'quest_started': time.time(),
                         'last_stamina_regen': staminaregen}})
            threading.Timer(questtime, castle_protect_quest, args=[user]).start()
            sendm(cwbot, call.message.chat.id, text)
            questwaits.remove(call.from_user.id)
            return

        # Rat Hunt
        if quest == 'rathunt':
            if user['stamina'] < 1:
                sendm(cwbot, call.message.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏!')
                questwaits.remove(call.from_user.id)
                return
            if call.message.chat.id not in cwgames:
                staminaregen = user['last_stamina_regen']
                if user['stamina'] >= user['maxstamina']:
                    staminaregen = time.time()
                cwusers.update_one({'id': call.from_user.id}, {
                    '$set': {'current_act': 'quest_rathunt', 'stamina': user['stamina'] - 1,
                             'quest_started': time.time(),
                             'last_stamina_regen': staminaregen}})
                game = creategame(call.message)
                cwgames.update(game)
                game = cwgames[call.message.chat.id]
                game['cwrats'] = True
                try:
                    photopath = cwbot.get_file(cwbot.get_chat(call.from_user.id).photo.big_file_id)
                    photo = requests.get(
                        'https://api.telegram.org/file/bot' + cwbottoken + '/' + photopath.file_path).content
                except:
                    photo = None
                game['players'].update(createplayer(call.from_user, photo=photo))
                if spectateallgames:
                    if game['id'] != pasyuk_id and pasyuk_id not in game['players']:
                        game['spectators'].append(pasyuk_id)
                player = game['players'][call.from_user.id]
                player['name'] = user['name']
                player['team'] = player['id']
                player['lvl'] = user['lvl']
                set_player_battle_stats(player, user)
                text = '–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –Ω–∞ –ø–æ–∏—Å–∫–∏ –∫—Ä—ã—Å–∏–Ω–æ–≥–æ –ª–æ–≥–æ–≤–∞. –î–æ–π–¥–µ—Ç–µ —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥.'
                threading.Timer(15, goo, args=[None, call.message.chat.id, game, cwbot]).start()
            sendm(cwbot, call.message.chat.id, text)
            questwaits.remove(call.from_user.id)
            return

        # Noise Check
        if quest == 'noise_check':
            if user['noise_check'] <= 0:
                sendm(cwbot, call.message.chat.id, '–í—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª—ã—à–∞–ª–∏!')
                questwaits.remove(call.from_user.id)
                return
            cwusers.update_one({'id': user['id']}, {'$inc': {'noise_check': -1}})
            cwusers.update_one({'id': call.from_user.id}, {'$set': {'current_act': 'quest_noise_check'}})
            user['startfindtime'] = time.time()
            cw_duel_find.update({user['id']: user})
            text = 'üëÄ|–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –Ω–∞ –ø–æ–∏—Å–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —à—É–º–∞.'
            sendm(cwbot, call.message.chat.id, text)
            questwaits.remove(call.from_user.id)
            return

        # Troll
        if quest == 'troll':
            try:
                user['troll']
            except KeyError:
                cwusers.update_one({'id': user['id']}, {'$set': {'troll': 1}})
                user['troll'] = 1
            if user['troll'] <= 0:
                sendm(cwbot, call.message.chat.id, '–í –ª–æ–≥–æ–≤–æ —Ç—Ä–æ–ª–ª—è –º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å –≤—Å–µ–≥–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å!')
                questwaits.remove(call.from_user.id)
                return
            if user['stamina'] < 2:
                sendm(cwbot, call.message.chat.id, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏!')
                questwaits.remove(call.from_user.id)
                return
            cwusers.update_one({'id': user['id']}, {'$inc': {'troll': -1, 'stamina': -2}})
            cwusers.update_one({'id': call.from_user.id}, {'$set': {'current_act': 'troll'}})
            stickid = "CAACAgIAAxkBAAKPa2bpdv-tdcDsu6gPyYuOZK8r2ESgAALqVAACZkkRS98YykCTmuaQNgQ"
            try:
                cwbot.send_sticker(user['id'], stickid)
            except:
                pass
            text = 'üëπ|–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –≤ –ª–æ–≥–æ–≤–æ —Ç—Ä–æ–ª–ª—è, –ø–æ–¥ –º–æ—Å—Ç. –í–µ—Ä–Ω–µ—Ç–µ—Å—å —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã.'
            threading.Timer(random.randint(110, 130), troll_quest, args=[user]).start()
            sendm(cwbot, call.message.chat.id, text)
            questwaits.remove(call.from_user.id)
            return

    except Exception as e:
        sendm(cwbot, pasyuk_id, traceback.format_exc())
        questwaits.remove(call.from_user.id)


def check_robots_acts():
    for ids in users.find({}):
        user = ids
        try:
            if user["robot"]:
                if user["current_act"] == None:
                    from_user = RobotFromUser(user["id"])
                    data = "quest_select?noise_check"
                    chat = RobotChat(user["id"])
                    message = RobotMessage(chat)
                    call = RobotCall(from_user, data, message)
                    questselecttt(call)
        except:
            pass


# def createuser(user):
#    return {
#    'id':user.id,
#    'name':user.first_name,
#    'wins':0,
#    'games':0
#    }

# @bot.message_handler(commands = ['profile'])
# def prrrrr(m):
#    user = users.find_one({'id':m.from_user.id})
#    if user == None:
#        user = users.insert_one(createuser(m.from_user))
#        user = users.find_one({'id':m.from_user.id})
#    text = '–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞ '+user['name']+':\n\n'
#    text += '–ò–≥—Ä: '+str(user['games'])+'\n'
#    text += '–ü–æ–±–µ–¥: '+str(user['wins'])+'\n'
#    try:
#        perc = (user['wins']/user['games'])*100
#        perc = round(perc, 2)
#    except:
#        perc = 0
#    text += '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: '+str(perc)+'%'
#    sendm(bot, m.chat.id, text)

def getstat(m, stat):
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        player = {
            'id': m.from_user.id,
            'name': m.from_user.first_name
        }
        users.insert_one(createuser(player))
        user = users.find_one({'id': m.from_user.id})
    if stat == 'all':
        wins = user['wins']
        loses = user['games'] - user['wins']
        games = user['games']
        try:
            ties = user['ties']
        except:
            ties = 0
        try:
            percent = str(round((user['wins'] / user['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        whatstat = '(–≤—Å–µ –∏–≥—Ä—ã)'

    if stat == 'rats':
        try:
            wins1 = user['ratstats']['diff1']['wins']
            loses1 = user['ratstats']['diff1']['games'] - user['ratstats']['diff1']['wins']
            games1 = user['ratstats']['diff1']['games']
            try:
                percent1 = str(round((wins1 / games1 * 100), 1)) + '%'
            except:
                percent1 = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
            whatstat1 = '–°–ª–æ–∂–Ω–æ—Å—Ç—å 1:\n'

            wins2 = user['ratstats']['diff2']['wins']
            loses2 = user['ratstats']['diff2']['games'] - user['ratstats']['diff2']['wins']
            games2 = user['ratstats']['diff2']['games']
            try:
                percent2 = str(round((wins2 / games2 * 100), 1)) + '%'
            except:
                percent2 = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
            whatstat2 = '–°–ª–æ–∂–Ω–æ—Å—Ç—å 2:\n'

            wins3 = user['ratstats']['diff3']['wins']
            loses3 = user['ratstats']['diff3']['games'] - user['ratstats']['diff3']['wins']
            games3 = user['ratstats']['diff3']['games']
            try:
                percent3 = str(round((wins3 / games3 * 100), 1)) + '%'
            except:
                percent3 = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
            whatstat3 = '–°–ª–æ–∂–Ω–æ—Å—Ç—å 3:\n'

            textall = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ' + m.from_user.first_name + ' –ø–æ –∏–≥—Ä–∞–º —Å –∫—Ä—ã—Å–∞–º–∏:\n\n' + whatstat1 + '' + '–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ' + str(
                games1) + '\n' + \
                      '–ü–æ–±–µ–¥—ã: ' + str(wins1) + '\n' + '–ü–æ—Ä–∞–∂–µ–Ω–∏—è: ' + str(
                loses1) + '\n' + '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ' + percent1 + '\n\n' + \
                      whatstat2 + '' + '–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ' + str(games2) + '\n' + \
                      '–ü–æ–±–µ–¥—ã: ' + str(wins2) + '\n' + '–ü–æ—Ä–∞–∂–µ–Ω–∏—è: ' + str(
                loses2) + '\n' + '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ' + percent2 + '\n\n' + \
                      whatstat3 + '' + '–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ' + str(games3) + '\n' + \
                      '–ü–æ–±–µ–¥—ã: ' + str(wins3) + '\n' + '–ü–æ—Ä–∞–∂–µ–Ω–∏—è: ' + str(
                loses3) + '\n' + '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ' + percent3 + '\n\n'

            sendm(bot, m.chat.id, textall)
            return
        except:
            sendm(bot, m.chat.id, '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã —Å –∫—Ä—ã—Å–∞–º–∏!')
            return

    if stat == 'duel':
        try:
            wins = user['duels']['wins']
            loses = user['duels']['games'] - user['duels']['wins']
            games = user['duels']['games']
            try:
                ties = user['duels']['ties']
            except:
                ties = 0
        except:
            wins = 0
            loses = 0
            games = 0
            ties = 0
        try:
            percent = str(round((user['duels']['wins'] / user['duels']['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        whatstat = '(–¥—É—ç–ª–∏)'
    if stat == 'mass':
        try:
            wins = user['massbattles']['wins']
            loses = user['massbattles']['games'] - user['massbattles']['wins']
            games = user['massbattles']['games']
            try:
                ties = user['massbattles']['ties']
            except:
                ties = 0
        except:
            wins = 0
            loses = 0
            games = 0
            ties = 0
        try:
            percent = str(round((user['massbattles']['wins'] / user['massbattles']['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        whatstat = '(–∫–∞–∂–¥—ã–π –∑–∞ —Å–µ–±—è)'
    if stat == 'pureduels':
        try:
            wins = user['pureduels']['wins']
            loses = user['pureduels']['games'] - user['pureduels']['wins']
            games = user['pureduels']['games']
            try:
                ties = user['pureduels']['ties']
            except:
                ties = 0
        except:
            wins = 0
            loses = 0
            games = 0
            ties = 0
        try:
            percent = str(round((user['pureduels']['wins'] / user['pureduels']['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        whatstat = '(–¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö)'
    if stat == 'teams':
        try:
            wins = user['teams']['wins']
            loses = user['teams']['games'] - user['teams']['wins']
            games = user['teams']['games']
            try:
                ties = user['teams']['ties']
            except:
                ties = 0
        except:
            wins = 0
            loses = 0
            games = 0
            ties = 0
        try:
            percent = str(round((user['teams']['wins'] / user['teams']['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        whatstat = '(–∫–æ–º–∞–Ω–¥–Ω—ã–µ –±–æ–∏)'
    textall = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ' + m.from_user.first_name + ' ' + whatstat + ':\n' + '–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ' + str(games) + '\n' + \
              '–ü–æ–±–µ–¥—ã: ' + str(wins) + '\n' + '–ü–æ—Ä–∞–∂–µ–Ω–∏—è: ' + str(loses) + '\n–ù–∏—á—å–∏: ' + str(
        ties) + '\n' + '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ' + percent

    sendm(bot, m.chat.id, textall)


@bot.callback_query_handler(func=lambda call: call.data[:5] == 'click')
def clicksss(call):
    user = users.find_one({'id': call.from_user.id})
    pos = user['worldpos']
    clickedpos = call.data.split('?')[1]
    w = world.find_one({})
    if clickedpos in w['world']:
        if w['world'][clickedpos]['object'] == 'wall' or w['world'][clickedpos]['player'] != None or \
                w['world'][clickedpos]['fight']:
            bot.answer_callback_query(call.id, '–ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞!')
            return
        users.update_one({'id': call.from_user.id}, {'$set': {'worldpos': clickedpos}})
        user['worldpos'] = clickedpos
        world.update_one({}, {'$set': {'world.' + pos + '.player': None}})
        world.update_one({}, {'$set': {'world.' + clickedpos + '.player': call.from_user.id}})
        w['world'][pos]['player'] = None
        w['world'][clickedpos]['player'] = call.from_user.id
        bot.answer_callback_query(call.id, '‚úÖ')
    else:
        bot.answer_callback_query(call.id, '–≠—Ç–æ –∫—Ä–∞–π –∫–∞—Ä—Ç—ã!')
        return
    kb = get_player_keyboard(user, w)
    medit('–ö–∞—Ä—Ç–∞.', call.message.chat.id, call.message.message_id, reply_markup=kb)


@bot.message_handler(commands=['useramount'])
def uamount(m):
    if m.from_user.id != pasyuk_id:
        return
    x = users.find({})
    z = 0
    for ids in x:
        z += 1
    sendm(bot, m.chat.id, '–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + str(z))


def base_effect(eid):
    return {
        'name': '–ë–µ–∑ –∏–º–µ–Ω–∏',
        'id': eid,
        'effect_chance': '50',
        'effect': 'stun',
        'effect_targets': ['enemy_i_attack']
    }


def base_weapon(wid):
    return {
        'name': '–ë–µ–∑ –∏–º–µ–Ω–∏',
        'id': wid,
        'effects': {},
        'ranged': False,
        'cubes': '3',
        'dmgbonus': '0',
        'accuracybonus': '2',
        'energycost': '2'

    }


@bot.message_handler(commands=['create_weapon'])
def createww(m):
    if m.from_user.id != pasyuk_id:
        return
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        return
    try:
        user['custom_weapons']
    except:
        users.update_one({'id': user['id']}, {'$set': {'custom_weapons': {}}})
        user = users.find_one({'id': m.from_user.id})
    wid = 0
    for ids in user['custom_weapons']:
        wid += 1
    weapon = base_weapon(wid)


@bot.message_handler(commands=['giveEXPLOSION'])
def giveEXPLOSION(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        user = users.find_one({'id': m.reply_to_message.from_user.id})
        users.update_one({'id': user['id']}, {'$set': {'EXPLOSION': True}})
        sendm(bot, m.chat.id, 'Got EXPLOSION')
    except:
        sendm(bot, m.chat.id, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ä–µ–ø–ª–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')


@bot.message_handler(commands=['giveMINER'])
def giveMINER(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        user = users.find_one({'id': m.reply_to_message.from_user.id})
        users.update_one({'id': user['id']}, {'$set': {'miner': True}})
        sendm(bot, m.chat.id, 'Got MINER.')
    except:
        sendm(bot, m.chat.id, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ä–µ–ø–ª–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')


@bot.message_handler(commands=['giveCHARGE'])
def giveCHARGE(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        user = users.find_one({'id': m.reply_to_message.from_user.id})
        users.update_one({'id': user['id']}, {'$set': {'rhinosoul': True}})
        sendm(bot, m.chat.id, 'Got CHARGE')
    except:
        sendm(bot, m.chat.id, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ä–µ–ø–ª–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')


@bot.message_handler(commands=['kirilitsa'])
def kirilitsaa(m):
    try:
        kb = types.InlineKeyboardMarkup()
        kb.add(types.InlineKeyboardButton(text='–î–∞—Ç–∞', callback_data='–î–∞—Ç–∞'))
        sendm(bot, m.chat.id, 'text', reply_markup=kb)
    except:
        sendm(bot, m.chat.id, traceback.format_exc())


@bot.message_handler(commands=['newworld'])
def clearw(m):
    if m.from_user.id != pasyuk_id:
        return
    world.drop({})
    users.update_many({}, {'$set': {'worldpos': None}})
    ow = generate_open_world()
    world.insert_one({'world': ow, 'npc': {}})
    sendm(bot, m.chat.id, 're-created')


@bot.message_handler(commands=['spawnnpc'])
def spawnnpccc(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        amount = int(m.text.split(' ')[1])
    except:
        amount = 1
    spawn_npc(amount)
    sendm(bot, m.chat.id, 'spawned ' + str(amount))


@bot.message_handler(commands=['world'])
def worlddddd(m):
    w = world.find_one({})
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        users.insert_one(createuser2(m.from_user))
        user = users.find_one({'id': m.from_user.id})
    try:
        curpos = user['worldpos']
        if curpos == None:
            raise Exception()
        try:
            kb = get_player_keyboard(user, w)
        except:
            print(traceback.format_exc())
            kb = types.InlineKeyboardMarkup()
        sendm(bot, m.chat.id, '–ö–∞—Ä—Ç–∞.', reply_markup=kb)
    except:
        pos = place_new_player(user, w)
        world.update_one({}, {'$set': {'world.' + pos + '.home': m.from_user.id}})
        users.update_one({'id': m.from_user.id}, {'$set': {'worldpos': pos}})
        sendm(bot, m.chat.id, '–í—ã —Å–æ–∑–¥–∞–ª–∏ –±–∞–∑—É! –ù–∞–∂–º–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –µ—â–µ —Ä–∞–∑, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.')


@bot.message_handler(commands=['newplayer'])
def clearw(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        amount = int(m.text.split(' ')[1])
    except:
        amount = 1
    for i in range(amount):
        pos = place_new_player(users.find_one({'id': m.from_user.id}), world.find_one({}))
        world.update_one({}, {'$set': {'world.' + pos + '.home': m.from_user.id}})
    sendm(bot, m.chat.id, 'added player')


@bot.message_handler(commands=['update'])
def upddd(m):
    if m.from_user.id != pasyuk_id:
        return
    global allowgames
    allowgames = not allowgames
    sendm(bot, m.chat.id, '–†–µ–∂–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç —Ç–µ–ø–µ—Ä—å ' + str(not allowgames))


@bot.message_handler(commands=['v_stats'])
def vegstat(m):
    getstat(m, 'all')


@bot.message_handler(commands=['v_stats_teams'])
def vegstat(m):
    getstat(m, 'teams')


@bot.message_handler(commands=['v_stats_massbattle'])
def vegstat(m):
    getstat(m, 'mass')


@bot.message_handler(commands=['v_stats_duels'])
def vegstat(m):
    getstat(m, 'duel')


@bot.message_handler(commands=['v_stats_rats'])
def vegstat_rats(m):
    getstat(m, 'rats')


@bot.message_handler(commands=['v_stats_pureduels'])
def vegstat_pureduelss(m):
    getstat(m, 'pureduels')


@bot.message_handler(commands=['caster_help'])
def casterhelpp(m):
    text = '–ó–∞–∫–ª–∏–Ω–∞—Ç–µ–ª—å - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Å–∫–∏–ª–ª. –í –≤–∞—à–µ–º –∞—Ä—Å–µ–Ω–∞–ª–µ –µ—Å—Ç—å –æ–±—à–∏—Ä–Ω—ã–π –Ω–∞–±–æ—Ä —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ—á—Ç–∏ –≤–æ –≤—Å–µ—Ö –∏–≥—Ä–æ–≤—ã—Ö ' + \
           '—Å–∏—Ç—É–∞—Ü–∏—è—Ö. –ù–æ –µ—Å—Ç—å –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ - –≤—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–¥–æ —Å–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Å–æ–±–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ. –û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ - ' + \
           '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å!\n\n–í—Å–µ–≥–æ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –µ—Å—Ç—å 21 —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ 13 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–Ω–æ –∑–∞ —Ö–æ–¥ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –≤—Å–µ–≥–æ 9 –∏–∑ –Ω–∏—Ö). –ö–∞–∂–¥–æ–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç ' + \
           '–∏–∑ —Ç—Ä–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∏ —Å—Ä–µ–¥–∏ –Ω–∏—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è. –¢–æ –µ—Å—Ç—å ' + \
           '–∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞, –æ–Ω–æ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –¥–≤—É—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –∏ —Ç—Ä–µ—Ç—å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –¥—Ä—É–≥–æ–≥–æ —Ç–∏–ø–∞. –ù–∞–ø—Ä–∏–º–µ—Ä: ' + \
           '‚ùÑÔ∏è‚ùÑÔ∏èüíß (—Ç–∞–∫–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–∞–∂–µ –Ω–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å). –ò–ª–∏ ‚ùÑÔ∏è‚ùÑÔ∏è‚ùÑÔ∏è. –ê –≤–æ—Ç –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–∂–µ –Ω–µ –≤–∞–∂–µ–Ω. ‚ùÑÔ∏è‚ùÑÔ∏èüíß –∏ ‚ùÑÔ∏èüíß‚ùÑÔ∏è - –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–ª—è –º–∏—Ä–∞ –º–∞–≥–∏–∏. ' + \
           '–¢–∞–∫ –∂–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –±–æ–π—Ü—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥—ã—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.\n\n' + \
           '__P.S.__ "–ó–∞–∫–ª–∏–Ω–∞—Ç–µ–ª—å" –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ—Ö–æ–¥–∞ –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ. –í–æ–∑–º–æ–∂–Ω–æ, —Å–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø–æ–ø–æ–ª–Ω–∏—Ç—Å—è, ' + \
           '–∞ –º–æ–∂–µ—Ç –¥–∞–∂–µ –±—É–¥—É—Ç –∏–≤–µ–Ω—Ç—ã, –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å—Å—è —Ä–µ—Ü–µ–ø—Ç—ã –∫–æ–ª–¥–æ–≤—Å—Ç–≤–∞. ' + \
           '–ù–æ —ç—Ç–æ –≤—Å–µ —Ç–æ–ª—å–∫–æ –≤ –ø–ª–∞–Ω–∞—Ö.\n\n–¢–µ–ø–µ—Ä—å –∑–∞–∫–ª–∏–Ω–∞—Ç–µ–ª–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –∏–≥—Ä—É —Å –æ–¥–Ω–∏–º —Å–∫–∏–ª–ª–æ–º, –∫—É–ª–∞–∫–∞–º–∏ –∏ —Ç—Ä–µ–º—è —ç–Ω–µ—Ä–≥–∏–∏.'
    try:
        sendm(bot, m.chat.id, text, parse_mode='markdown')
    except:
        pass


@bot.message_handler(commands=['getsize'])
def vegdictsize(m):
    if m.from_user.id != pasyuk_id:
        return
    x = createplayer(m.from_user)
    sendm(bot, m.chat.id, str(getsizeof(x)) + ' –±–∞–π—Ç - —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ –∏–≥—Ä–æ–∫–∞')


@bot.message_handler(commands=['spectateall'])
def vegdictsizespectate(m):
    if m.from_user.id != pasyuk_id:
        return
    global spectateallgames
    spectateallgames = not spectateallgames
    sendm(bot, m.chat.id, '–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –≤—Å–µ—Ö –∏–≥—Ä —Ç–µ–ø–µ—Ä—å ' + str(spectateallgames))


@bot.message_handler(commands=['chatid'])
def giveweaponchatid(m):
    sendm(bot, m.chat.id, str(m.chat.id))


@bot.message_handler(commands=['giveweapon'])
def giveweapon(m):
    try:
        if m.from_user.id != pasyuk_id and m.from_user.id != 197216910:
            return
        try:
            game = games[m.chat.id]
        except:
            return
        try:
            player = game['players'][m.reply_to_message.from_user.id]
        except:
            return
        try:
            wname = m.text.split(' ', 1)[1]
        except:
            return
        w = None
        for ids in allw:
            if ids().name == wname:
                w = ids()
                break
        if w == None:
            sendm(bot, m.chat.id, '–û—Ä—É–∂–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
            return
        player['weapon'] = w
        sendm(bot, m.chat.id, '–¢–µ–ø–µ—Ä—å —É ' + player['name'] + ' –æ—Ä—É–∂–∏–µ ' + w.name + '!')
    except:
        sendm(bot, m.chat.id, '–û—à–∏–±–∫–∞!')


@bot.message_handler(commands=['addgametext'])
def giveweapon(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        try:
            game = games[m.chat.id]
        except:
            return
        game['text'] += m.text.split(' ', 1)[1]
        sendm(bot, m.chat.id, '–î–æ–±–∞–≤–∏–ª —Ç–µ–∫—Å—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.')
    except:
        sendm(bot, m.chat.id, '–û—à–∏–±–∫–∞.')


@bot.message_handler(commands=['weaponhits'])
def whitss(m):
    try:
        weapon = m.text.split('?')[1]

    except:
        sendm(bot, m.chat.id, '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –æ—Ä—É–∂–∏—è!')
        return
    try:
        amount = int(m.text.split('?')[3])
    except:
        amount = 10000
    try:
        energy = int(m.text.split('?')[2])
    except:
        energy = 5
    w = None
    for ids in allw:
        if ids().name == weapon:
            w = ids()
            break
    if w == None:
        sendm(bot, m.chat.id, '–û—Ä—É–∂–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    sendm(bot, m.chat.id, '–†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é...')
    dmg, chances = getweaponhits(w, energy, amount)
    chtext = ''
    for ids in chances:
        chtext += str(ids) + ' —É—Ä–æ–Ω–∞: ' + str(round((chances[ids] / amount) * 100, 4)) + '%\n'
    sendm(bot, m.chat.id, '–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–Ω –æ—Ä—É–∂–∏—è ' + w.name + ' —Å ' + str(energy) + '‚ö°Ô∏è —ç–Ω–µ—Ä–≥–∏–∏: ' + str(
        dmg) + '\n\n' + chtext)


@bot.message_handler(commands=['setequip'])
def seteq(m):
    if m.chat.type != 'private':
        sendm(bot, m.chat.id, '–ö–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –õ–°!')
        return
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        users.insert_one(createuser2(m.from_user))
        user = users.find_one({'id': m.from_user.id})
    kb = getallweaponkb()
    sendm(bot, m.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä—É–∂–∏–µ:', reply_markup=kb)


def getallweaponkb():
    kb = types.InlineKeyboardMarkup()
    kbrow = []
    for ids in allw:
        x = ids
        kbrow.append(types.InlineKeyboardButton(text=x.name, callback_data='setuserweapon?' + str(x.id)))
        if len(kbrow) == 2:
            kb.add(*kbrow)
            kbrow = []
    if len(kbrow) > 0:
        kb.add(*kbrow)
    return kb


@bot.callback_query_handler(func=lambda call: call.data[:13] == 'setuserweapon')
def selectuserweapon(call):
    weapon = None


@bot.message_handler(commands=['send_to_all'])
def sendtoall(m):
    if m.from_user.id != pasyuk_id:
        return
    if m.reply_to_message == None:
        sendm(bot, m.chat.id, '–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')
    sendm(bot, m.chat.id, '–ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—Å—ã–ª–∫—É...')
    x = 0
    for ids in users.find({}):
        try:
            bot.forward_message(ids['id'], m.chat.id, message_id=m.reply_to_message.message_id)
            x += 1
            time.sleep(0.3)
        except:
            print(traceback.format_exc())
    sendm(bot, m.chat.id, '–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∏–ª–∏ ' + str(x) + ' —á–µ–ª–æ–≤–µ–∫.')


@bot.message_handler(content_types=['photo'])
def photoss(m):
    if m.chat.id != pasyuk_id:
        return
    sendm(bot, m.chat.id, str(m.photo[-1].file_id))


@bot.message_handler(commands=['drop_stats_confirm_confirm'])
def drrrrrrrrrrrrrrrrrrrrrrr(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        user = users.find_one({'id': m.reply_to_message.from_user.id})
    except:
        sendm(bot, m.chat.id,
                         '–û—Ç–≤–µ—Ç—å—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!\n\n*Warning:* –∫–æ–º–∞–Ω–¥–∞ —Å–±—Ä–æ—Å–∏—Ç —Å—Ç–∞—Ç—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!',
                         parse_mode='markdown')
        return
    if user != None:
        text = 'wins: ' + str(user['wins']) + '\n' + 'games: ' + str(user['games'])
        sendm(bot, pasyuk_id, text)
        users.update_one({'id': user['id']}, {'$set': {'games': 0, 'wins': 0}})
    sendm(bot, m.chat.id,
                     '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª–∑–æ–≤–∞—Ç–µ–ª—è ' + m.reply_to_message.from_user.first_name + ' –æ–±–Ω—É–ª–µ–Ω–∞! –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω–∞ –≤ –õ–°.')


@bot.message_handler(commands=['id'])
def idddd(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        sendm(bot, m.from_user.id, str(m.reply_to_message.from_user.id))
        sendm(bot, m.chat.id, 'Got ID')
    except:
        sendm(bot, m.chat.id, 'Error!')


@bot.message_handler(commands=['currentgames'])
def idddd(m):
    if m.from_user.id != pasyuk_id:
        return
    x = 0
    for ids in games:
        if games[ids]['started']:
            if games[ids]['id'] != botfights:
                x += 1
    try:
        sendm(bot, m.chat.id, '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä: ' + str(x))

    except:
        sendm(bot, m.chat.id, 'Error!')


@bot.message_handler(commands=['allstats'])
def allstats(m):
    if m.from_user.id != pasyuk_id:
        return
    text = ''
    try:
        x = m.text.split(' ')[1]
        if x in ['teamfight', 'team']:
            stats = teamstats
            text = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥–Ω—ã—Ö –∏–≥—Ä:\n\n'
        elif x in ['pvp', 'duel']:
            stats = duelstats
            text = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥—É—ç–ª–µ–π:\n\n'
        elif x in ['mass', 'massbattle']:
            stats = massbattlestats
            text = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Å–æ–≤—ã—Ö –±–∏—Ç–≤:\n\n'
        else:
            stats = duelstats
    except:
        stats = duelstats
        text = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥—É—ç–ª–µ–π:\n\n'
    s = stats.find_one({})
    for ids in s['skills']:
        try:
            percent = str(round((s['skills'][ids]['wins'] / s['skills'][ids]['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        text += getname(s['skills'][ids]['name']) + ':\n'
        text += '–ò–≥—Ä: ' + str(s['skills'][ids]['games']) + '\n'
        text += '–ü–æ–±–µ–¥: ' + str(s['skills'][ids]['wins']) + '\n'
        text += '–ü–æ—Ä–∞–∂–µ–Ω–∏–π: ' + str(s['skills'][ids]['games'] - s['skills'][ids]['wins']) + '\n'
        text += '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ' + percent + '\n'
        text += '\n'
    sendm(bot, m.chat.id, text)
    text = ''
    for ids in s['weapons']:
        try:
            percent = str(round((s['weapons'][ids]['wins'] / s['weapons'][ids]['games'] * 100), 1)) + '%'
        except:
            percent = '–ù–µ –±—ã–ª–æ —Å—ã–≥—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –∏–≥—Ä—ã!'
        text += s['weapons'][ids]['name'] + ':\n'
        text += '–ò–≥—Ä: ' + str(s['weapons'][ids]['games']) + '\n'
        text += '–ü–æ–±–µ–¥: ' + str(s['weapons'][ids]['wins']) + '\n'
        text += '–ü–æ—Ä–∞–∂–µ–Ω–∏–π: ' + str(s['weapons'][ids]['games'] - s['weapons'][ids]['wins']) + '\n'
        text += '–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ' + percent + '\n'
        text += '\n'
    if text != '':
        sendm(bot, m.chat.id, text)


@bot.message_handler(commands=['hitchance'])
def hitchance(m):
    try:
        x = m.text.split(' ')
        cubes = int(x[1])
        energy = int(x[2])
        basechance = 1 - (energy / 10)
        chance = 1
        for i in range(cubes):
            chance = chance * basechance
        naturalchance = (1 - chance) * 100
        naturalchance = round(naturalchance, 0)
        naturalchance = int(naturalchance)
        text = 'üéØ|–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–ø–∞—Å—Ç—å –ø—Ä–∏ üé≤' + str(cubes) + ' –∫—É–±–∞—Ö –∏ ‚ö°Ô∏è' + str(energy) + ' —ç–Ω–µ—Ä–≥–∏–∏ - ' + str(
            naturalchance) + '%'
        sendm(bot, m.chat.id, text)
    except:
        sendm(bot, m.chat.id, '–§–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞:\n' +
                         '/hitchance –∫—É–±—ã —ç–Ω–µ—Ä–≥–∏—è')


@bot.message_handler(commands=['start'])
def start(m):
    sendm(bot, m.chat.id, '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ')


@bot.message_handler(commands=['v_cancel'])
def cancelll(m):
    if m.chat.id not in games:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ –µ—â—ë –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ (/v_prepare)!')
        return
    game = games[m.chat.id]
    if game['started'] == True:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!')
        return
    try:
        if m.chat.type != 'private' and bot.get_chat_member(m.chat.id, m.from_user.id).status not in ['creator',
                                                                                                      'administrator'] and m.from_user.id != \
                game['creator']:
            sendm(bot, m.chat.id, '–í—ã –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞!')
            return
    except:
        pass
    del games[game['id']]
    sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–¥–∞–ª–µ–Ω–∞!')


@bot.message_handler(commands=['v_join'])
def join(m):
    if m.chat.id not in games:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ –µ—â—ë –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ (/v_prepare)!')
        return
    game = games[m.chat.id]
    if game['started'] == True:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!')
        return
    if m.from_user.id in game['players']:
        sendm(bot, m.chat.id, '–í—ã —É–∂–µ –≤ –∏–≥—Ä–µ!')
        return
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        users.insert_one(createuser2(m.from_user))
        user = users.find_one({'id': m.from_user.id})
    if game['pureduel_rats'] and len(game['players']) >= 1:
        sendm(bot, m.chat.id, '–õ–∏–º–∏—Ç –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –¥—É—ç–ª–∏ —Å –∫—Ä—ã—Å–æ–π - 1!', reply_to_message_id=m.message_id)
        return
    if game['pureduel'] and len(game['players']) >= 2 and not game['teamplay']:
        sendm(bot, m.chat.id, '–õ–∏–º–∏—Ç –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –¥—É—ç–ª–∏ - 2!', reply_to_message_id=m.message_id)
        return
    if game['pokemonhunt'] and len(game['players']) >= 1:
        sendm(bot, m.chat.id, '–õ–∏–º–∏—Ç –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –ª–æ–≤–ª–∏ –∫—Ä—ã—Å - 1!', reply_to_message_id=m.message_id)
        return
    if game['dungeon'] and game['dungeon_type'] == 'roulette' and len(game['players']) >= 1:
        sendm(bot, m.chat.id, '–≠—Ç–∞ –∏–≥—Ä–∞ - —Å–º–µ—Ä—Ç–µ–ª—å–Ω–∞—è –¥—É—ç–ª—å –¥–ª—è –î–í–û–ò–•.', reply_to_message_id=m.message_id)
        return
    if game['rp_fight']:
        try:
            user['rp_profile']
        except:
            sendm(bot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç —Ä–ø-–ø—Ä–æ—Ñ–∏–ª—è!')
            return
    try:
        sendm(bot, m.from_user.id, '–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å!')
        sendm(bot, m.chat.id, m.from_user.first_name + ' –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∏–≥—Ä–µ!')
        teams = []
        x = 0
        for ids in game['players']:
            if x > 1:
                break
            teams.append(game['players'][ids])
            x += 1
        try:

            photopath = bot.get_file(bot.get_chat(m.from_user.id).photo.big_file_id)
            photo = requests.get('https://api.telegram.org/file/bot' + token + '/' + photopath.file_path).content


        except:
            print(traceback.format_exc())
            photo = None
        playerslimit = 1000
        if game['bossfight']:
            playerslimit = 1000
        if len(game['players']) >= playerslimit:
            sendm(bot, m.chat.id, '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–æ–≤!')
            return
        game['players'].update(createplayer(m.from_user, photo=photo))
        player = game['players'][m.from_user.id]
        if player['id'] in has_hell_reward:
            player['completed_hell'] = True
        if game['rp_fight']:
            player['rp_fighter'] = True
            player['hp'] = user['rp_profile']['hp']
            player['maxhp'] = user['rp_profile']['maxhp']
            player['energy'] = user['rp_profile']['energy']
            player['maxenergy'] = user['rp_profile']['maxenergy']
            player['inventory'] = user['rp_profile']['inventory']
            player['dmglimit'] = user['rp_profile']['dmglimit']
            player['maxdmglimit'] = user['rp_profile']['maxdmglimit']
            player['rp_weapon'] = user['rp_profile']['weapon']
            player['user'] = user
            if player['hp'] <= 0:
                player['hp'] = 1
                player['energy'] -= 3
                player['maxenergy'] -= 3
                if player['maxenergy'] < 2:
                    player['maxenergy'] = 2
        if len(game['players']) > 2 and game['teamplay']:
            team1 = 0
            team2 = 0
            for ids in game['players']:
                if game['players'][ids]['team'] == teams[0]['team']:
                    team1 += 1
                if game['players'][ids]['team'] == teams[1]['team']:
                    team2 += 1
            kb = types.InlineKeyboardMarkup()
            kb.add(types.InlineKeyboardButton(text=teams[0]['name'] + ' - ' + str(team1),
                                              callback_data='selectteam?' + str(game['id']) + '?' + str(
                                                  teams[0]['id'])))
            kb.add(types.InlineKeyboardButton(text=teams[1]['name'] + ' - ' + str(team2),
                                              callback_data='selectteam?' + str(game['id']) + '?' + str(
                                                  teams[1]['id'])))
            sendm(bot, m.from_user.id, '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É.', reply_markup=kb)
        else:
            player['team'] = player['id']

    except:
        sendm(bot, m.chat.id, '–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –≤ –õ–°!')

@bot.message_handler(commands=['give_dark'])
def giveDARKrewarddd(m):
    if m.from_user.id not in [pasyuk_id, 441399484]:
        return
    try:
        user = users.find_one({'id': m.reply_to_message.from_user.id})
        users.update_one({'id': user['id']}, {'$set': {'dark_reward': True}})
        sendm(bot, m.chat.id, 'Got dark')
    except:
        sendm(bot, m.chat.id, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ä–µ–ø–ª–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')

@bot.message_handler(commands=['give_necromant'])
def giveDARKrewarddd(m):
    if m.from_user.id not in [pasyuk_id, 441399484]:
        return
    try:
        user = users.find_one({'id': m.reply_to_message.from_user.id})
        users.update_one({'id': user['id']}, {'$set': {'necromant_reward': True}})
        sendm(bot, m.chat.id, 'Got necromant')
    except:
        sendm(bot, m.chat.id, '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É —Ä–µ–ø–ª–∞–µ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')


@bot.callback_query_handler(func=lambda call: call.data[:10] == 'selectteam')
def selectteam(call):
    game = int(call.data.split('?')[1])
    team = int(call.data.split('?')[2])
    try:
        game = games[game]
    except:
        return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['team'] != None:
        bot.answer_callback_query(call.id, '–í—ã —É–∂–µ –≤—ã–±—Ä–∞–ª–∏ –∫–æ–º–∞–Ω–¥—É!')
        return
    team_exists = False
    for ids in game['players']:
        if game['players'][ids]['team'] == team:
            team_exists = True
            break
    if not team_exists:
        bot.answer_callback_query(call.id, '–ö–æ–º–∞–Ω–¥—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    player['team'] = team
    player2 = game['players'][team]
    medit('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–ª–∏ –∫–æ–º–∞–Ω–¥—É: ' + player2['name'] + '!', call.message.chat.id, call.message.message_id)
    sendm(bot, game['id'], player['name'] + ' –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É: ' + player2['name'] + '!')

@bot.message_handler(commands = ['removerhino'])
def removerrr(m):
    if m.from_user.id != 441399484:
        return
    users.update_one({'id': 5691781572}, {'$set': {'rhinosoul': False}})
    sendm(bot, m.chat.id, 'Ok')

@bot.callback_query_handler(func=lambda call: call.data[:10] == 'switchtext')
def switchteextss(call):
    text = call.data.split('?')[1]
    user = users.find_one({'id': call.from_user.id})
    try:
        user['customtexts']
    except:
        users.update_one({'id': user['id']}, {'$set': {'customtexts': {}}})
    if text not in user['customtexts']:
        bot.answer_callback_query(call.id, '–û—à–∏–±–∫–∞!')
        return
    users.update_one({'id': user['id']}, {'$set': {'customtexts.' + text: not user['customtexts'][text]}})
    user['customtexts'][text] = not user['customtexts'][text]
    bot.answer_callback_query(call.id, '‚úÖ')
    kb = getswitchkb(user)
    medit('–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –µ–≥–æ.', call.message.chat.id, call.message.message_id,
          reply_markup=kb)


def getswitchkb(user):
    kb = types.InlineKeyboardMarkup()
    for ids in user['customtexts']:
        if user['customtexts'][ids]:
            g = '‚úÖ'
        else:
            g = '‚òëÔ∏è'
        kb.add(types.InlineKeyboardButton(text=g + ids, callback_data='switchtext?' + ids))
    return kb


@bot.message_handler(commands=['selecttexts'])
def selecttexts(m):
    if m.chat.type != 'private':
        sendm(bot, m.chat.id, '–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –õ–°!')
        return
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        users.insert_one(createuser2(m.from_user))
        user = users.find_one({'id': m.from_user.id})
    try:
        user['customtexts']
    except:
        users.update_one({'id': user['id']}, {'$set': {'customtexts': {}}})
    kb = getswitchkb(user)
    sendm(bot, m.chat.id, '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –µ–≥–æ.', reply_markup=kb)


@bot.message_handler(commands=['givetext'])
def givetextt(m):
    try:
        if m.from_user.id not in [pasyuk_id, novice_alex_id]:
            return
        user = users.find_one({'id': m.from_user.id})
        if user == None:
            users.insert_one(createuser2(m.from_user))
            user = users.find_one({'id': m.from_user.id})
        try:
            user['customtexts']
        except:
            users.update_one({'id': user['id']}, {'$set': {'customtexts': {}}})
        try:
            text = m.text.split('?')[1]
            user2 = users.find_one({'id': m.reply_to_message.from_user.id})
        except:
            sendm(bot, m.chat.id,
                             '–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å–ª–µ–¥—É—é—â–∏–º —Å–ø–æ—Å–æ–±–æ–º:\n/givetext ?–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ç–µ–∫—Å—Ç–∞')
            return
        users.update_one({'id': user2['id']}, {'$set': {'customtexts.' + text: True}})
        sendm(bot, m.chat.id, m.reply_to_message.from_user.first_name + ' –ø–æ–ª—É—á–∏–ª ' + text)
    except:
        sendm(bot, pasyuk_id, traceback.format_exc())


@bot.message_handler(commands=['flee'])
def fleee(m):
    if m.chat.id not in games:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ –µ—â—ë –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ (/v_prepare)!')
        return
    game = games[m.chat.id]
    if game['started'] == True:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!')
        return
    if m.from_user.id not in game['players']:
        sendm(bot, m.chat.id, '–í—ã –Ω–µ –≤ –∏–≥—Ä–µ!')
        return
    del game['players'][m.from_user.id]
    newleaderchoice = []
    for ids in game['players']:
        player = game['players'][ids]
        if player['team'] == m.from_user.id:
            newleaderchoice.append(player['id'])
    if len(newleaderchoice) > 0:
        newleader = random.choice(newleaderchoice)
        for ids in game['players']:
            player = game['players'][ids]
            if player['team'] == m.from_user.id:
                player['team'] = newleader
    sendm(bot, m.chat.id, m.from_user.first_name + ' —Å–±–µ–∂–∞–ª!')


@bot.message_handler(commands=['del_game'])
def delgame(m):
    try:
        try:
            chatid = int(m.text.split(' ')[1])
        except:
            chatid = m.chat.id
        if chatid not in games:
            sendm(bot, m.chat.id, '–ò–≥—Ä—ã –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —á–∞—Ç–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
            return
        game = games[chatid]
        if m.from_user.id != game['creator'] and m.from_user.id != pasyuk_id and m.from_user.id != 441399484:
            sendm(bot, m.chat.id, '–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –ø–∞—Ä—Ç–∏–∏ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –µ—ë!')
            return
        if not game['dungeon'] and m.from_user.id != 441399484:
            only_npc = True
            for ids in game["players"]:
                target = game["players"][ids]
                if not target["dead"] and target["controller"] != "bot":
                    only_npc = False
                    break
            if not only_npc:
                sendm(bot, m.chat.id, '–ú–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞–Ω–∂–∏ –∏ –∏–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤!')
                return
        try:
            game['timer'].cancel()
        except:
            pass
        for ids in game['alltimers']:
            try:
                ids.cancel()
            except:
                pass
        del games[game['id']]
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ –≤ —á–∞—Ç–µ ' + str(chatid) + ' —É–¥–∞–ª–µ–Ω–∞!')
    except:
        sendm(bot, m.chat.id, 'Error')
        sendm(bot, pasyuk_id, traceback.format_exc())


@bot.message_handler(commands=['v_prepare'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–≥—Ä–µ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, /v_go –¥–ª—è –∑–∞–ø—É—Å–∫–∞.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['duel_rules'])
def duelrules(m):
    text = ''
    text += '*–ü—Ä–∞–≤–∏–ª–∞ –¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö:*\n\n*1.* –†–∞–ø–∏—Ä–∞ —Ç—Ä–∞—Ç–∏—Ç 2 —ç–Ω–µ—Ä–≥–∏–∏ –∑–∞ –∞—Ç–∞–∫—É. –†–∞–ø–∏—Ä–∞ –Ω–∞–Ω–æ—Å–∏—Ç 1 —É—Ä–æ–Ω –∑–∞ –∫–∞–∂–¥—ã–µ 2 –µ–¥–∏–Ω–∏—Ü—ã —ç–Ω–µ—Ä–≥–∏–∏ –∞—Ç–∞–∫—É—é—â–µ–≥–æ, —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º '
    text += '–≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É. –ü—Ä–∏–º–µ—Ä: –∏–º–µ—è 1 –∏–ª–∏ 2 —ç–Ω–µ—Ä–≥–∏–∏, –≤—ã –Ω–∞–Ω–æ—Å–∏—Ç–µ 1 —É—Ä–æ–Ω. 3 –∏–ª–∏ 4 —ç–Ω–µ—Ä–≥–∏–∏ - 2 —É—Ä–æ–Ω–∞. 5 –∏–ª–∏ 6 —ç–Ω–µ—Ä–≥–∏–∏ - 3 —É—Ä–æ–Ω–∞.\n\n'
    text += '*2.* –ï—Å–ª–∏ –≤–∞–º –Ω–∞–Ω–µ—Å–ª–∏ —É—Ä–æ–Ω–∞ –±–æ–ª—å—à–µ, —á–µ–º –Ω–∞–Ω–µ—Å–ª–∏ –≤—ã, —Ç–æ —Å–æ–ø–µ—Ä–Ω–∏–∫ –Ω–µ —Ç–µ—Ä—è–µ—Ç –•–ü –æ—Ç –≤–∞—à–µ–π –∞—Ç–∞–∫–∏.\n\n'
    text += '*3.* –ï—Å–ª–∏ —É –≤–∞—Å 4 –∏–ª–∏ –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏, –ø–µ—Ä–µ–∫–∞—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞—Å—Ç–∞–≤–∏–≤ –≤–∞—Å –ø—Ä–æ–º–∞—Ö–Ω—É—Ç—å—Å—è. –ò–Ω–∞—á–µ —Å–Ω–∏–∑–∏—Ç –≤–∞—à —É—Ä–æ–Ω –Ω–∞ 2.\n\n'
    text += '*4.* –£ –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏–∑ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –µ—Å—Ç—å –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω –∏ —Ñ–ª—ç—à–∫–∞. –ò–∑ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —â–∏—Ç–æ–≤ –∏ –≤–æ—Ä.\n\n'
    text += '*5.* –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —â–∏—Ç–æ–≤ - 5 —Ö–æ–¥–æ–≤, –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –ø–µ—Ä–µ–∫–∞—Ç–∞ - 5 —Ö–æ–¥–æ–≤, –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –≤–æ—Ä–∞ - 3 —Ö–æ–¥–∞.\n\n'
    text += '*6.* –°–∞–º–∞ –ø–æ —Å–µ–±–µ —Ä–∞–ø–∏—Ä–∞ –Ω–µ –ø—Ä–æ–º–∞—Ö–∏–≤–∞–µ—Ç—Å—è, —Ö–æ—Ç—è –≤ –º–µ–Ω—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞–ø–∏—Å–∞–Ω —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è. –®–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è —Ä–∞–ø–∏—Ä—ã –ø–æ –≤—Ä–∞–≥—É - 100%, –µ—Å–ª–∏ —Ç–æ—Ç –Ω–µ –ø–µ—Ä–µ–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è '
    text += '–∏ –µ—Å–ª–∏ —É –≤–∞—Å –±–æ–ª—å—à–µ, —á–µ–º 0 —ç–Ω–µ—Ä–≥–∏–∏. –ï—Å–ª–∏ –∂–µ –≤—Ä–∞–≥ –ø–µ—Ä–µ–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è - —Å–º–æ—Ç—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç 3.'
    sendm(bot, m.chat.id, text, reply_to_message_id=m.message_id, parse_mode='markdown')


@bot.message_handler(commands=['v_pureduel'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['pureduel'] = True
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∂–∏–º–∞: /duel_rules. –ö–æ–º–∞–Ω–¥–Ω—ã–π —Ä–µ–∂–∏–º: ' +
                         '/v_pureduel_teams. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–∂–∏–º—É: /v_stats_pureduels')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

def get_pokemon_daytime():
    timenow = datetime.now()
    hournow = timenow.hour
    minutenow = timenow.minute
    if minutenow >= 0 and minutenow <= 15:
        daytime = 'morning'
    elif minutenow >= 16 and minutenow <= 30:
        daytime = 'day'
    elif minutenow >= 31 and minutenow <= 45:
        daytime = 'evening'
    elif minutenow >= 46 and minutenow <= 60:
        daytime = 'night'
    return daytime

def get_pokemon_daytime_text(x):
    y = 'None'
    if x == 'morning':
        y = '—É—Ç—Ä–æ'
    elif x == 'day':
        y = '–¥–µ–Ω—å'
    elif x == 'evening':
        y = '–≤–µ—á–µ—Ä'
    elif x == 'night':
        y = '–Ω–æ—á—å'
    return y


@bot.message_handler(commands=['v_pokemonhunt'])
def startgame(m):
    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['pokemonhunt'] = True
        p_daytime = get_pokemon_daytime()
        game['pokemon_daytime'] = p_daytime
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ª–æ–≤–ª–µ –∫—Ä—ã—Å –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –í –º–∏—Ä–µ –∫—Ä—ã—Å —Å–µ–π—á–∞—Å: '+get_pokemon_daytime_text(p_daytime))
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

#import pickle
#from pathlib import Path

actlist = ['attack', 'adrenaline', 'perekat', 'reload', 'flash', 'vor', 'shield']

def createdemons():
    return
    global demon_amount
    demons = {}
    for i in range(demon_amount):
        demon = {}
        demon['pattern'] = {}
        demon['score'] = 0
        demon['number'] = i
        for i1 in range(6):
            for i2 in range(4):
                for i3 in range(2):
                    for i4 in range(2):
                        for i5 in range(2):
                            for i6 in range(2):
                                for i7 in range(2):
                                    for i8 in range(6):
                                        for i9 in range(4):
                                            for i10 in range(2):
                                                for i11 in range(2):
                                                    for i12 in range(2):
                                                        for i13 in range(2):
                                                            for i14 in range(2):
                                                                string = str(i1)+str(i2+1)+str(i3)+str(i4)+str(i5)+str(i6)+str(i7)+str(i8)+str(i9+1)+str(i10)+str(i11)+str(i12)+str(i13)+str(i14)
                                                                demon['pattern'][string] = random.choice(actlist)

        demons.update({i:demon})
        print(i)
    return demons

demon_amount = 10

def infinity_teaching(m):
    global demon_amount
    cycles = 5
    try:
        cycles = int(m.text.split(" ")[1])
    except:
        pass
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['neuralfight'] = True
        game['pureduel_rats'] = True
        game['pureduel'] = True
        game['maxcycle'] = cycles
        i = 1
        while Path('demons_'+str(demon_amount)+'_generation_' + str(i) + '.pickle').is_file():
            i += 1
        if i > 1:
            i -= 1
        if Path('demons_'+str(demon_amount)+'_generation_' + str(i) + '.pickle').is_file():
            with open('demons_'+str(demon_amount)+'_generation_' + str(i) + '.pickle', 'rb') as f:
                demons = pickle.load(f)
        else:
            demons = createdemons()
            with open('demons_'+str(demon_amount)+'_generation_' + str(i) + '.pickle', 'wb') as f:
                pickle.dump(demons, f)
        game['m'] = m
        game['cycle'] = 1
        game['demons'] = demons
        sendm(bot, m.chat.id, '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ–∫—Ä—ã—Å –ø–æ–∫–æ–ª–µ–Ω–∏—è '+str(i+1)+'. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤: ' + str(
            cycles) + '. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–º–æ–Ω–æ–≤: ' + str(demon_amount))
        goo(m)
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_neuralfight'])
def startgame(m):
    return
    if m.from_user.id != 441399484:
        return
    infinity_teaching(m)

@bot.message_handler(commands = ["create_brain"])
def create_brain(m):
    user = users.find_one({"id":m.from_user.id})
    number = 1
    if "brains" not in user:
        users.update_one({"id":user["id"]},{"$set":{"brains":{}}})
    while str(number) in user["brains"]:
        number += 1
    users.update_one({"id":m.from_user.id},{"$set":{"brain_"+str(number):new_brain()}})
    bot.send_message(m.chat.id, "–í—ã —Å–æ–∑–¥–∞–ª–∏ –º–æ–∑–≥! –û–Ω –ª–µ–∂–∏—Ç –≤ –±–∞–Ω–∫–µ –ø–æ–¥ –Ω–æ–º–µ—Ä–æ–º "+str(number)+". –ß—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ, –Ω–∞–∂–º–∏—Ç–µ /edit_brain_"+str(number))

def get_brain_kb():
    kb = types.InlineKeyboardMarkup()

@bot.message_handler(func = lambda m: m.text[:12] == "/edit_brain_")
def editbrainn(m):
    user = users.find_one({"id": m.from_user.id})
    bnumber = m.text.split("_")[2]
    try:
        brain = user["brains"][bnumber]
    except:
        numbers = ""
        for ids in user["brains"]:
            numbers += ids+", "
        numbers = numbers[:len(numbers)-2]
        bot.send_message(m.chat.id, "–£ –≤–∞—Å –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –º–æ–∑–≥–∞! –ù–æ–º–µ—Ä–∞ –±–∞–Ω–æ–∫:\n"+numbers)
    kb = get_brain_kb()

def new_brain():
    return {"conditions":{},
            "triggers":{}}

@bot.message_handler(commands=['v_pureduel_rats_v2'])
def startgame(m):
    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['pureduel'] = True
        game['pureduel_rats'] = True
        game['pureduel_rats_hard'] = True
        i = 1
        while Path('demons_' + str(demon_amount) + '_generation_' + str(i) + '.pickle').is_file():
            i += 1
        if i > 1:
            i -= 1
        #i = 2
        if Path('demons_' + str(demon_amount) + '_generation_' + str(i) + '.pickle').is_file():
            with open('demons_' + str(demon_amount) + '_generation_' + str(i) + '.pickle', 'rb') as f:
                demons = pickle.load(f)
        for ids in demons:
            best_demon = demons[ids]
            break
        game['fullneuraldemon_final'] = best_demon
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö –ø—Ä–æ—Ç–∏–≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤–æ–π –∫—Ä—ã—Å—ã –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∂–∏–º–∞: /duel_rules. –ö–æ–º–∞–Ω–¥–Ω—ã–π —Ä–µ–∂–∏–º: ' +
                         '/v_pureduel_teams. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–∂–∏–º—É: /v_stats_pureduels')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_pureduel_rats'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['pureduel'] = True
        game['pureduel_rats'] = True
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö –ø—Ä–æ—Ç–∏–≤ –∫—Ä—ã—Å—ã –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∂–∏–º–∞: /duel_rules. –ö–æ–º–∞–Ω–¥–Ω—ã–π —Ä–µ–∂–∏–º: ' +
                         '/v_pureduel_teams. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–∂–∏–º—É: /v_stats_pureduels')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_prepare_magic'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.from_user.id != pasyuk_id and m.chat.id != -1001541389947:
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['magictournier'] = True
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç—É—Ä–Ω–∏—Ä—É –∑–∞–∫–ª–∏–Ω–∞—Ç–µ–ª–µ–π –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_prepare_classic'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['classic_game'] = True
        game['teamplay'] = True
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä–µ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_pureduel_teams'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['pureduel'] = True
        game['teamplay'] = True
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π –¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∂–∏–º–∞: /duel_rules')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_prepare_allrandom'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        game['allrandom'] = True
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–≥—Ä–µ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_prepare_tournier'])
def startgametourn(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.from_user.id != pasyuk_id and m.chat.id not in [-1001541389947, -1001923672063, -1001891312421]:
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        game['tournier'] = True
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π –∏–≥—Ä–µ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_prepare_testgame'])
def startgametourn(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        game['testequipgame'] = True
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–≥—Ä–µ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_prepare_anyweapon_tournier'])
def startgametourn(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        game['testequipgame_tournier'] = True
        game['teamplay'] = True
        game['tournier'] = True
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π –∏–≥—Ä–µ —Å –ª—é–±—ã–º –≤—ã–±–æ—Ä–æ–º —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_rathunt'])
def startgamerat(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        game['rats'] = True
        try:
            diff = int(m.text.split(' ', 1)[1])
        except:
            diff = 1
        if diff < 1:
            diff = 1
        if diff > 3:
            diff = 3
        game['rat_difficulty'] = diff
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–≥—Ä–µ —Å –∫—Ä—ã—Å–∞–º–∏ (—Å–ª–æ–∂–Ω–æ—Å—Ç—å: ' + str(
            diff) + ') –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.\n–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Ç–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å ' +
                         '—Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫—Ä—ã—Å (1-3), –¥–æ–±–∞–≤–∏–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —á–∏—Å–ª–æ –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã. –ü—Ä–∏–º–µ—Ä:\n/v_rathunt 3')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return



@bot.message_handler(commands=['v_dungeon'])
def startgameratdung(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ–¥–∑–µ–º–µ–ª—å—é –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.\n–ó–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–∂–µ–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–∫–∏–ª–ª!')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_deathmatch'])
def startgamedm(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dm'] = True
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±–∏—Ç–≤–µ –Ω–∞ —Å–º–µ—Ä—Ç—å –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.\n–ü—Ä–∞–≤–∏–ª–∞: /rules_dm')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['set_skill_amount'])
def setskkamount(m):
    try:
        game = games[m.chat.id]
    except:
        return
    x = bot.get_chat_member(m.chat.id, m.from_user.id)
    if x.status != 'creator' and x.status != 'administrator' and m.from_user.id != pasyuk_id and game[
        'creator'] != m.from_user.id:
        sendm(bot, m.chat.id,
                         '–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏–π –∏–≥—Ä—É, –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞ –º–æ–≥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∏–ª–ª–æ–≤!',
                         reply_to_message_id=m.message_id)
        return
    if game['dungeon']:
        sendm(bot, m.chat.id, '–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —á–∏—Å–ª–æ —Å–∫–∏–ª–ª–æ–≤ –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ!', reply_to_message_id=m.message_id)
        return
    if game['pureduel']:
        sendm(bot, m.chat.id, '–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —á–∏—Å–ª–æ —Å–∫–∏–ª–ª–æ–≤ –≤ –¥—É—ç–ª–∏ –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö!', reply_to_message_id=m.message_id)
        return
    if game['started']:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç!')
        return
    try:
        y = int(m.text.split(' ')[1])
    except:
        sendm(bot, m.chat.id, '–£–∫–∞–∂–∏—Ç–µ —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∏–ª–ª–æ–≤! –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã:\n/set_skill_amount 3',
                         reply_to_message_id=m.message_id)
        return

    if y > 8 and m.from_user.id != pasyuk_id:
        sendm(bot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Å–∫–∏–ª–ª–æ–≤ - 8!', reply_to_message_id=m.message_id)
        return
    game["dop_skills"] = y
    game["new_limit"] = True
    sendm(bot, m.chat.id, '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —á–∏—Å–ª–æ —Å–∫–∏–ª–ª–æ–≤ –¥–ª—è –∏–≥—Ä—ã: '+str(y), reply_to_message_id=m.message_id)
    

@bot.message_handler(commands=['v_dungeon_ghoul'])
def startgameratdung(m):
    # if m.from_user.id != pasyuk_id and m.from_user.id != 197216910:
    #    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        game['dungeon_type'] = 'ghoul'
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ–¥–∑–µ–º–µ–ª—å—é —Å –≤—É—Ä–¥–∞–ª–∞–∫–∞–º–∏ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.\n–ó–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–∂–µ–π –º–æ–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ–ª—É—á–∏—Ç—å.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_dungeon_dark'])
def startgameratdung(m):
    # if m.from_user.id != pasyuk_id and m.from_user.id != 197216910 and m.from_user.id != 94197300:
    #    return
    #if m.chat.id == -1001516877618:
    #    sendm(bot, m.chat.id, '–ü–æ–¥–∑–µ–º–µ–ª—å–µ —Ç—å–º—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç!')
    #    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        game['dungeon_type'] = 'dark'
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ—Ö–æ–¥—É –≤–æ —Ç—å–º—É –∑–∞–ø—É—â–µ–Ω–∞! /v\_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.\n–û–∫–æ–ª–æ –≤—Ö–æ–¥–∞ –≤—ã –≤–∏–¥–∏—Ç–µ —Ç–∞–±–ª–∏—á–∫—É:\n' + \
                         '*–ò–Ω—Ñ–æ.* –ó–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–∂–µ–π... \[–Ω–∞–¥–ø–∏—Å—å —Å–∫—Ä—ã—Ç–∞ —Ç–µ–Ω—å—é]', parse_mode='markdown')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands = ['hell_first_run'])
def hellfrunn(m):
    if m.chat.id not in games:
        return
    game = games[m.chat.id]
    if game['started']:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å!')
        return
    if game['creator'] != m.from_user.id:
        sendm(bot, m.chat.id, '–ù–µ –≤—ã —Å–æ–∑–¥–∞—Ç–µ–ª—å –ª–æ–±–±–∏!')
        return
    if game['simulate_first_run'] == False:
        game['simulate_first_run'] = True
        sendm(bot, m.chat.id, 'üí¨–ê–ª–∞—Å—Ç–æ—Ä|‚ù§Ô∏è‚Äçüî•: –î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å!')

@bot.message_handler(commands=['v_dungeon_hell'])
def startgameratdungh(m):
    # if m.from_user.id != pasyuk_id and m.from_user.id != 197216910 and m.from_user.id != 94197300:
    #    return
    #if m.chat.id == -1001516877618:
    #    sendm(bot, m.chat.id, '–ü–æ–¥–∑–µ–º–µ–ª—å–µ —Ç—å–º—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç!')
    #    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        game['dungeon_type'] = 'hell'
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ—Ö–æ–¥—É –≤ üî•–∞–¥üî• –∑–∞–ø—É—â–µ–Ω–∞! /v\_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.', parse_mode='markdown')
        if m.from_user.id in has_hell_reward:
            sendm(bot, m.chat.id, 'üí¨–ê–ª–∞—Å—Ç–æ—Ä|‚ù§Ô∏è‚Äçüî•: –ò —Å–Ω–æ–≤–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤ –∞–¥—É! –ï—Å–ª–∏ –∂–µ–ª–∞–µ—Ç–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è, –∫–∞–∫ –±—É–¥—Ç–æ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ - –Ω–∞–∂–º–∏—Ç–µ /hell_first_run –∏ —è —Å–¥–µ–ª–∞—é –≤–∏–¥, —á—Ç–æ –º—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å!')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_dungeon_winter'])
def startgameratdung(m):
    return
    # if m.from_user.id != pasyuk_id and m.from_user.id != 197216910 and m.from_user.id != 94197300:
    #    return
    #if m.chat.id == -1001516877618:
    #    sendm(bot, m.chat.id, '–ü–æ–¥–∑–µ–º–µ–ª—å–µ —Ç—å–º—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç!')
    #    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        game['dungeon_type'] = 'winter'
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ—Ö–æ–¥—É –≤ –ª–µ–¥—è–Ω–æ–π –∑–∞–º–æ–∫ –∑–∞–ø—É—â–µ–Ω–∞! /v\_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.', parse_mode='markdown')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_dungeon_dragon'])
def startgameratdungd(m):
    # if m.from_user.id != pasyuk_id and m.from_user.id != 197216910 and m.from_user.id != 94197300:
    #    return
    #if m.chat.id == -1001516877618:
    #    sendm(bot, m.chat.id, '–ü–æ–¥–∑–µ–º–µ–ª—å–µ —Ç—å–º—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç!')
    #    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        game['dungeon_type'] = 'dragon'
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ—Ö–æ–¥—É –≤ –∑–∞–º–æ–∫ –¥—Ä–∞–∫–æ–Ω–∞ –∑–∞–ø—É—â–µ–Ω–∞! /v\_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.', parse_mode='markdown')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return

@bot.message_handler(commands=['v_dungeon_roulette'])
def startgameratdung(m):
    return
    # if m.from_user.id != pasyuk_id and m.from_user.id != 197216910 and m.from_user.id != 94197300:
    #    return
    #if m.chat.id == -1001516877618:
    #    sendm(bot, m.chat.id, '–ü–æ–¥–∑–µ–º–µ–ª—å–µ —Ç—å–º—ã –≤ —ç—Ç–æ–º —á–∞—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç!')
    #    return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        game['dungeon'] = True
        game['dungeon_type'] = 'roulette'
        if game['id'] != pasyuk_id:
            game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–≥—Ä–µ –≤ —Ä—É—Å—Å–∫—É—é —Ä—É–ª–µ—Ç–∫—É –∑–∞–ø—É—â–µ–Ω–∞... /v\_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.', parse_mode='markdown')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


def cancelgame(gid):
    try:
        game = games[gid]
        if not game['started']:
            if not game['botfight']:
                del games[gid]
                sendm(bot, gid, '–ü—Ä–æ—à–ª–æ 5 –º–∏–Ω—É—Ç, –∏–≥—Ä–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞.')
            else:
                goo(chatid=game['id'])
    except:
        print(traceback.format_exc())


@bot.message_handler(commands=['v_prepare_teams'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        game['teamplay'] = True
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π –∏–≥—Ä–µ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_prepare_teams_tournier'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        game['teamplay'] = True
        game['tournier'] = True
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π –∏–≥—Ä–µ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_prepare_allrandom_teams'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        game['teamplay'] = True
        game['allrandom'] = True
        sendm(bot, m.chat.id,
                         '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π –∏–≥—Ä–µ —Å–æ —Å–ª—É—á–∞–π–Ω–æ–π —ç–∫–∏–ø–∏—Ä–æ–≤–∫–æ–π –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_bossfight'])
def startgame(m):
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        game['bossfight'] = True
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±–∏—Ç–≤–µ —Å –±–æ—Å—Å–æ–º –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


@bot.message_handler(commands=['v_rp_fight'])
def startgame(m):
    # sendm(bot, m.chat.id, '–≠—Ç–æ –≥–æ–≤–Ω–æ –±–ª—è—Ç—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ç–æ–º –ø–æ—á–∏–Ω—é —ç—Ç—É —Ö—É–π–Ω—é –µ–±—É—á—É—é, –ø–æ—à–µ–ª –Ω–∞—Ö—É–π —Å–æ —Å–≤–æ–∏–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–æ–º –ü–ò–î–û–†–ê–°')
    # return
    if not allowgames:
        sendm(bot, m.chat.id, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
        return
    if m.chat.id not in games:
        game = creategame(m)
        games.update(game)
        game = games[m.chat.id]
        if spectateallgames:
            if game['id'] != pasyuk_id:
                game['spectators'].append(pasyuk_id)
        t = threading.Timer(300, cancelgame, args=[game['id']])
        t.start()
        game['canceltimer'] = t
        game['rp_fight'] = True
        sendm(bot, m.chat.id, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–ø-–±–æ—é –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
    else:
        sendm(bot, m.chat.id, '–í —ç—Ç–æ–º —á–∞—Ç–µ —É–∂–µ –µ—Å—Ç—å –∏–≥—Ä–∞!')
        return


def getrpprofile():
    return {
        'hp': 8,
        'maxhp': 8,
        'energy': 5,
        'maxenergy': 5,
        'dmglimit': 6,
        'maxdmglimit': 6,
        'inventory': [],
        'skills': [],
        'weapon': None
    }


@bot.message_handler(commands=['give_rp_profile'])
def rpprofilee(m):
    if m.from_user.id != pasyuk_id:
        return
    if m.reply_to_message == None:
        sendm(bot, m.chat.id, '–û—Ç–≤–µ—Ç—å—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!')
        return
    user = users.find_one({'id': m.reply_to_message.from_user.id})
    if user == None:
        sendm(bot, m.chat.id, 'User = None!')
        return
    try:
        user['rp_profile']
        sendm(bot, m.chat.id, '–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –µ—Å—Ç—å –†–ü-–ø—Ä–æ—Ñ–∏–ª—å!')
        return
    except:
        pass
    users.update_one({'id': user['id']}, {'$set': {'rp_profile': getrpprofile()}})
    sendm(bot, m.chat.id,
                     '–¢–µ–ø–µ—Ä—å —É ' + m.reply_to_message.from_user.first_name + ' –µ—Å—Ç—å —Ä–ø-–ø—Ä–æ—Ñ–∏–ª—å! –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å - /rp_profile')


@bot.message_handler(commands=['rp_profile'])
def rpprofilee(m):
    user = users.find_one({'id': m.from_user.id})
    if user == None:
        sendm(bot, m.chat.id, 'User = None!')
        return
    try:
        user['rp_profile']
    except:
        sendm(bot, m.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –†–ü-–ø—Ä–æ—Ñ–∏–ª—è!')
        return
    profile = user['rp_profile']
    text = '–ü—Ä–æ—Ñ–∏–ª—å ' + m.from_user.first_name + ':\n'
    text += '‚ô•Ô∏è–•–ü: ' + str(profile['hp']) + '/' + str(profile['maxhp']) + '\n'
    text += '‚ö°Ô∏è–≠–Ω–µ—Ä–≥–∏—è: ' + str(profile['energy']) + '/' + str(profile['maxenergy']) + '\n'
    text += 'üíî–õ–∏–º–∏—Ç —É—Ä–æ–Ω–∞: ' + str(profile['dmglimit']) + '/' + str(profile['maxdmglimit']) + '\n'
    text += 'üí•–û—Ä—É–∂–∏–µ: ' + str(profile['weapon']) + '\n'
    skilltext = '‚ûï–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: '
    for ids in profile['skills']:
        skilltext += getname[ids] + ', '
    if len(profile['skills']) > 0:
        skilltext = skilltext[:len(skilltext) - 2]
    if m.chat.type != 'private':
        skilltext = '‚ûï–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: —Å–∫—Ä—ã—Ç–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —á–∞—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ –õ–°.'
    inventorytext = 'üì¶–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: '
    for ids in profile['inventory']:
        inventorytext += getname(ids) + ', '
    if len(profile['inventory']) > 0:
        inventorytext = inventorytext[:len(inventorytext) - 2]
    text += skilltext + '\n'
    text += inventorytext + '\n'
    sendm(bot, m.chat.id, text)

@bot.message_handler(commands = ["knight_de"])
def kde(m):
    if m.from_user.id != pasyuk_2_id and m.from_user.id != pasyuk_id:
        return
    try:
        game = games[m.chat.id]
    except:
        bot.send_message(m.chat.id, "no game.")
        return
    game["knight_need_dark_energy"] = True
    game["dungeonlvl"] = 2
    bot.send_message(m.chat.id, "ok")

@bot.message_handler(commands=['set_rp_stat'])
def rpprofileesetstats(m):
    if m.from_user.id != pasyuk_id:
        return
    user = users.find_one({'id': m.reply_to_message.from_user.id})
    if user == None:
        sendm(bot, m.chat.id, 'User = None!')
        return
    try:
        user['rp_profile']
    except:
        sendm(bot, m.chat.id, '–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –†–ü-–ø—Ä–æ—Ñ–∏–ª—è!')
        return
    profile = user['rp_profile']
    try:
        stat = m.text.split(' ')[1]
    except:
        sendm(bot, m.chat.id, '–£–∫–∞–∂–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É!')
        return
    try:
        amount = int(m.text.split(' ')[2])
    except:
        try:
            amount = m.text.split(' ')[2]
        except:
            sendm(bot, m.chat.id, '–£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ!')
            return
    if stat in user['rp_profile']:
        users.update_one({'id': user['id']}, {'$set': {stat: amount}})
        sendm(bot, m.chat.id, '–ó–Ω–∞—á–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ "' + stat + '" —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ ' + str(amount) + '!')
    else:
        sendm(bot, m.chat.id, '–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ "' + stat + '" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')


@bot.message_handler(commands=['set_rp_weapon'])
def rpprofileesetstats(m):
    try:
        if m.from_user.id != pasyuk_id:
            return
        user = users.find_one({'id': m.reply_to_message.from_user.id})
        if user == None:
            sendm(bot, m.chat.id, 'User = None!')
            return
        try:
            user['rp_profile']
        except:
            sendm(bot, m.chat.id, '–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –†–ü-–ø—Ä–æ—Ñ–∏–ª—è!')
            return
        profile = user['rp_profile']
        try:
            w = m.text.split('?')[1]
        except:
            sendm(bot, m.chat.id, '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è! –ü—Ä–∏–º–µ—Ä:\n/set_rp_weapon ?–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è')
            return
        users.update_one({'id': user['id']}, {'$set': {'rp_profile.weapon': w}})
        sendm(bot, m.chat.id, '–¢–µ–ø–µ—Ä—å —É ' + user['name'] + ' –æ—Ä—É–∂–∏–µ ' + w + '!')
    except:
        sendm(bot, m.chat.id, traceback.format_exc())


@bot.message_handler(commands=['dmg'])
def dmggggt(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        game = games[m.chat.id]
        dmg = int(m.text.split(' ')[1])
    except:
        return
    p = []
    for ids in game['players']:
        p.append(game['players'][ids])
    x = random.choice(p)
    x['outgoingdmgs'].append([x['id'], dmg])
    x['incomingdmgs'].append([x['id'], dmg])
    sendm(bot, m.chat.id, 'dmg')


@bot.message_handler(commands=['dmg_to_npc'])
def dmggggt(m):
    if m.from_user.id != pasyuk_id and m.from_user.id != pasyuk_2_id:
        return
    try:
        game = games[m.chat.id]
        dmg = int(m.text.split(' ')[1])
    except:
        return
    for ids in game['players']:
        if game['players'][ids]['controller'] == 'bot':
            game['players'][ids]['outgoingdmgs'].append([game['players'][ids]['id'], dmg])
            game['players'][ids]['incomingdmgs'].append([game['players'][ids]['id'], dmg])
    sendm(bot, m.chat.id, 'dmg')


@bot.message_handler(commands=['death_to_npc'])
def dmggggt(m):
    if m.from_user.id != pasyuk_id and m.from_user.id != pasyuk_2_id:
        return
    try:
        game = games[m.chat.id]
    except:
        return
    for ids in game['players']:
        if game['players'][ids]['controller'] == 'bot':
            game['players'][ids]['dead'] = True
    sendm(bot, m.chat.id, 'dmg')


@bot.message_handler(commands=['getabil'])
def dmggggt(m):
    try:
        if m.from_user.id != pasyuk_id and m.from_user.id != 197216910:
            return
        try:
            game = games[m.chat.id]
            abil = m.text.split(' ')[1]
        except:
            return
        try:
            if m.reply_to_message == None:
                x = game['players'][m.from_user.id]
                x['skills'].append(abil)
                sendm(bot, m.chat.id, abil + ' –ø–æ–ª—É—á–µ–Ω–∞.')
            else:
                x = game['players'][m.reply_to_message.from_user.id]
                x['skills'].append(abil)
                sendm(bot, m.chat.id, abil + ' –ø–æ–ª—É—á–µ–Ω–∞ –¥–ª—è ' + m.reply_to_message.from_user.first_name + '.')
        except:
            pass
    except:
        sendm(bot, m.chat.id, '–û—à–∏–±–∫–∞!')


@bot.message_handler(commands=['test'])
def testttt(m):
    if m.from_user.id not in [pasyuk_id]:
        return
    try:
        game = games[m.chat.id]
        game['test'] = True
        sendm(bot, m.chat.id, 'test')
    except:
        return

@bot.message_handler(commands = ["get_skill_list"])
def skilllllist(m):
    threading.Thread(target = getskilllistfunc, args = [m]).start()

def getskilllistfunc(m):
    try:
        text = ""
        stat = duelstats.find_one({})
        for ids in stat["skills"]:
            text += "`"+ids+"`, "
        text = text[:len(text)-2]
        bot.send_message(m.chat.id, text, parse_mode = "markdown")
    except:
        bot.send_message(m.chat.id, "–û—à–∏–±–∫–∞.")
        bot.send_message(pasyuk_id, traceback.format_exc())

def getstatsfunc(m):
    try:
        stat = duelstats.find_one({})
        msgerror = "–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞. –ü—Ä–∏–º–µ—Ä:\n/get_stats weapon –∫—É–≤–∞–ª–¥–∞\n/get_stats weapon –ö—É–≤–∞–ª–¥–∞\n/get_stats skill bicepc\n\n–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∫–∏–ª–ª–æ–≤ - /get_skill_list"
        try:
            stype = m.text.split(" ")[1]
        except:
            bot.send_message(m.chat.id, msgerror)
            return
        try:
            name = m.text.split(" ", 2)[2]
        except:
            bot.send_message(m.chat.id, msgerror)
            return
        text = ""
        if stype == "weapon":
            for ids in stat["weapons"]:
                if ids.lower() == name.lower():
                    winperc = round((stat["weapons"][ids]["wins"]/stat["weapons"][ids]["games"])*100, 3)
                    text += "‚öîÔ∏è|–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ä—É–∂–∏—è "+ids+":\n"
                    text += "üèÜ|–ü–æ–±–µ–¥—ã: "+str(stat["weapons"][ids]["wins"])+"\n"
                    text += "üíî|–ü–æ—Ä–∞–∂–µ–Ω–∏—è: "+str(stat["weapons"][ids]["games"]-stat["weapons"][ids]["wins"]-stat["weapons"][ids]["ties"])+"\n"
                    text += "‚ùì|–ù–∏—á—å–∏: "+str(stat["weapons"][ids]["ties"])+"\n\n"
                    text += "üé≤|–ß–∏—Å–ª–æ –∏–≥—Ä: "+str(stat["weapons"][ids]["games"])+"\n"
                    text += "‚ûó|–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: "+str(winperc)+"\n"
                    bot.send_message(m.chat.id, text, parse_mode = "markdown")
                    return
            bot.send_message(m.chat.id, "–û—Ä—É–∂–∏–µ "+name+" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!")
            return
        elif stype == "skill":
            for ids in stat["skills"]:
                if ids.lower() == name.lower():
                    winperc = round((stat["skills"][ids]["wins"]/stat["skills"][ids]["games"])*100, 3)
                    text += "‚öîÔ∏è|–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–∏–ª–ª–∞ "+ids.replace("_", "\_")+":\n"
                    text += "üèÜ|–ü–æ–±–µ–¥—ã: "+str(stat["skills"][ids]["wins"])+"\n"
                    text += "üíî|–ü–æ—Ä–∞–∂–µ–Ω–∏—è: "+str(stat["skills"][ids]["games"]-stat["skills"][ids]["wins"]-stat["skills"][ids]["ties"])+"\n"
                    text += "‚ùì|–ù–∏—á—å–∏: "+str(stat["skills"][ids]["ties"])+"\n\n"
                    text += "üé≤|–ß–∏—Å–ª–æ –∏–≥—Ä: "+str(stat["skills"][ids]["games"])+"\n"
                    text += "‚ûó|–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: "+str(winperc)+"\n"
                    bot.send_message(m.chat.id, text, parse_mode = "markdown")
                    return
            bot.send_message(m.chat.id, "–°–∫–∏–ª–ª "+name+" –Ω–µ –Ω–∞–π–¥–µ–Ω!")
            return
    except:
        bot.send_message(m.chat.id, "–û—à–∏–±–∫–∞.")
        bot.send_message(pasyuk_id, traceback.format_exc())

@bot.message_handler(commands = ["get_stats"])
def get_statss(m):
    threading.Thread(target = getstatsfunc, args = [m]).start()


@bot.message_handler(commands=['spectate'])
def spectateee(m):
    if m.from_user.id != pasyuk_id:
        return
    try:
        game = games[int(m.text.split(' ')[1])]
    except:
        sendm(bot, m.chat.id, '–ò–≥—Ä—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    if m.chat.id not in game['spectators']:
        game['spectators'].append(m.chat.id)
        sendm(bot, m.chat.id, '–ó–∞–ø—É—â–µ–Ω–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∏–≥—Ä—ã!', reply_to_message_id=m.message_id)
    else:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è!', reply_to_message_id=m.message_id)


def get_cw_rat_skills(skills_amount, sum_lvl):
    if skills_amount == 0:
        return []
    skills = cwratskills.copy()
    skills_to_return = []
    lvls = {}
    middle = int(sum_lvl / skills_amount)
    doplvl = sum_lvl - (middle * skills_amount)
    for i in range(skills_amount):
        lvls.update({i: middle})
    while doplvl > 0:
        # sendm(cwbot, pasyuk_id, str(lvls))
        # time.sleep(1)
        key = random.choice(list(lvls))
        ii = 0
        while lvls[key] >= 3:
            key = random.choice(list(lvls))
            ii += 1
            if ii > 100:
                break
            # sendm(cwbot, pasyuk_id, "b")
        lvls[key] += 1
        doplvl -= 1
    skillnames = []
    for ids in lvls:
        skill = random.choice(skills)
        skilllvl = int(skill.split('?')[1])
        skillname = skill.split('?')[0]
        ii = 0
        while skill in skills_to_return or skilllvl != lvls[ids] or skillname in skillnames:
            ii += 1
            if ii > 200:
                break
            # sendm(cwbot, pasyuk_id, 'skill='+str(skill)+'\nskills_to_return='+str(skills_to_return)+'\nlvls[ids]='+str(lvls[ids]))
            # time.sleep(1)
            skill = random.choice(skills)
            skilllvl = int(skill.split('?')[1])
            skillname = skill.split('?')[0]
            if len(skills_to_return) >= 8:
                break
        skills_to_return.append(skill)
        skillnames.append(skillname)
    sendm(cwbot, pasyuk_id, 'sum_lvl=' + str(sum_lvl) + ', allskills=\n' + str(skills_to_return))
    return skills_to_return


def get_cw_rat_weapon(rat_weaponlvl, wname = None, blockedw = []):
    ratweapons = cwratweapons.copy()
    ratweapons_allowed = []
    for ids in ratweapons:
        w = ids()
        if w.name not in blockedw:
            if w.lvl == rat_weaponlvl:
                if wname != None:
                    if w.name == wname:
                        ratweapons_allowed.append(ids)
                else:
                    ratweapons_allowed.append(ids)
    ratw = random.choice(ratweapons_allowed)()
    return ratw


def get_cw_rat_items(rat_item_amount):
    ratitems = cwratitems.copy()
    items = []
    ii = 0
    while len(items) < rat_item_amount:
        if len(items) >= len(ratitems):
            break
        ii += 1
        if ii > 200:
            break
        x = random.choice(ratitems)
        if x not in items:
            items.append(x)
    return items


@bot.message_handler(commands=['v_go'])
def go(m):
    goo(m)


def goo(m=None, chatid=None, game=None, bot=bot):
    try:
        if m == None:
            chatid = chatid
        else:
            chatid = m.chat.id
        if game == None:
            if chatid not in games:
                sendm(bot, chatid, '–ò–≥—Ä–∞ –µ—â—ë –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ (/v_prepare)!')
                return
            if not allowgames:
                sendm(bot, chatid, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
                return
            game = games[chatid]
        if not game['castlefight']:
            if game['started']:
                sendm(bot, chatid, '–ò–≥—Ä–∞ —É–∂–µ –∏–¥—ë—Ç!')
                # game['started'] = False
                return
        # game['started'] = True
        if not game['castlefight']:
            for ids in game['players']:
                player = game['players'][ids]
                if player['team'] == None:
                    sendm(bot, chatid, '–ù–µ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—ã–±—Ä–∞–ª–∏ –∫–æ–º–∞–Ω–¥—É!')
                    # game['started'] = False
                    return
        minimum = 2
        if game['rats']:
            minimum = 1
        if game['bossfight']:
            minimum = 2
        if game['dungeon']:
            minimum = 1
        if game['testequipgame']:
            minimum = 1
        if game['testequipgame_tournier']:
            minimum = 2
        if game['botfight']:
            minimum = 0
        if game['castlefight']:
            minimum = 0
        if game['cwrats']:
            minimum = 1
        if game['cwduel']:
            minimum = 2
        if game['cwduelrats']:
            minimum = 1
        if game['cwbar']:
            minimum = 0
        if game['pureduel_rats']:
            minimum = 1
        if game['neuralfight']:
            minimum = 0
        if game['pokemonhunt']:
            minimum = 1

        if len(game['players']) < minimum:
            sendm(bot, chatid, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–∫–æ–≤!')
            # game['started'] = False
            return
        if not game['pureduel_rats']:
            if game['pureduel'] and game['teamplay'] and (len(game['players']) % 2 != 0):
                sendm(bot, chatid, '–î–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π –±–∏—Ç–≤—ã –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö –Ω—É–∂–Ω–æ —á–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ –∏–≥—Ä–æ–∫–æ–≤!')
                # game['started'] = False
                return
        game['started'] = True
        time.sleep(3)
        if game['bossfight']:
            players = []
            for ids in game['players']:
                players.append(game['players'][ids]['id'])
                game['players'][ids]['boss'] = True  ################################
            boss = random.choice(players)
            game['players'][boss]['boss'] = True
        if game['bossfight']:
            team = None
            for ids in game['players']:
                player = game['players'][ids]
                if not player['boss']:
                    team = player['team']
                    break
            for ids in game['players']:
                player = game['players'][ids]
                if not player['boss']:
                    player['team'] = team
        if game['dungeon']:
            for ids in game['players']:
                team = game['players'][ids]['team']
                break
            for ids in game['players']:
                game['players'][ids]['team'] = team
            if game['dungeon_type'] == 'rhino':
                ratamount = 0
                rats = []
                ratamount = len(game['players'])
                i = 0
                while i < ratamount:
                    rat = summon_rat(game, len(rats))
                    rats.append(rat)
                    i += 1
                for ids in rats:
                    game['players'].update(ids)
            elif game['dungeon_type'] == 'ghoul':
                weakskeleamount = 0
                weakskeles = []
                weakskeleamount = len(game['players'])
                i = 0
                while i < weakskeleamount:
                    weakskele = summon_weakskele(game, len(weakskeles))
                    weakskeles.append(weakskele)
                    i += 1
                # if random.randint(1, 100) <= 50:
                #    weakskele = summon_weakskele(game, len(weakskeles))
                #    weakskeles.append(weakskele)
                for ids in weakskeles:
                    game['players'].update(ids)
            elif game['dungeon_type'] == 'dark':
                darkratamount = 0
                darkrats = []
                darkratamount = len(game['players'])
                i = 0
                while i < darkratamount:
                    darkrat = summon_darkrat(game, len(darkrats))
                    darkrats.append(darkrat)
                    i += 1
                for ids in darkrats:
                    game['players'].update(ids)
            elif game['dungeon_type'] == 'winter':
                snowmanamount = 0
                snowmans = []
                snowmanamount = len(game['players'])
                i = 0
                while i < snowmanamount:
                    snowman = summon_eyedemon(game, len(snowmans))
                    snowmans.append(snowman)
                    i += 1
                for ids in snowmans:
                    game['players'].update(ids)
            elif game['dungeon_type'] == 'hell':
                eyedemon = 0
                eyedemons = []
                eyedemonamount = len(game['players'])
                i = 0
                while i < eyedemonamount:
                    eyedemon = summon_eyedemon(game, len(eyedemons))
                    eyedemons.append(eyedemon)
                    i += 1
                for ids in eyedemons:
                    game['players'].update(ids)
            elif game['dungeon_type'] == 'dragon':
                rhino = 0
                rhinos = []
                rhinoamount = len(game['players'])
                i = 0
                while i < rhinoamount:
                    rhino = summon_small_rhino(game, len(rhinos))
                    rhinos.append(rhino)
                    i += 1
                for ids in rhinos:
                    game['players'].update(ids)
            elif game['dungeon_type'] == "roulette":
                demon = summon_demon(game)
                game['players'].update(demon)
        if game['botfight']:
            btypes = ['skelet', 'rat', 'ghoul', 'treant', 'worm', 'demon', 'rhino', 'knight', 'mini-rhino', 'dragon']
            weights = [100, 100, 100, 100, 100, 100, 50, 50, 75, 75]
            botamount = random.randint(2, len(btypes)+2)
            botstogame = []
            skeletss = 0
            ratss = 0
            ghoulss = 0
            rhinoss = 0
            treantss = 0
            wormss = 0
            demonss = 0
            knightss = 0
            mini_rhinoss = 0
            dragonss = 0
            while len(botstogame) < botamount:
                btype = random.choices(btypes, weights, k=1)[0]
                if btype == 'rat':
                    rat = summon_rat(game, ratss, team=getrandomid())
                    for idss in rat:
                        x = idss
                        break
                    rat[x]['team'] = rat[x]['id']
                    botstogame.append(rat)
                    ratss += 1
                if btype == 'skelet':
                    skeleton = summon_dung_skeleton(game, skeletss, team=getrandomid())
                    for idss in skeleton:
                        x = idss
                        break
                    skeleton[x]['team'] = skeleton[x]['id']
                    botstogame.append(skeleton)
                    skeletss += 1
                if btype == 'rhino':
                    rhino = summon_rhino(game, rhinoss, team=getrandomid())
                    for idss in rhino:
                        x = idss
                        break
                    rhino[x]['team'] = rhino[x]['id']
                    botstogame.append(rhino)
                    rhinoss += 1
                if btype == 'ghoul':
                    ghoul = summon_ghoul(game, ghoulss, team=getrandomid(), hp=4)
                    for idss in ghoul:
                        x = idss
                        break
                    ghoul[x]['team'] = ghoul[x]['id']
                    botstogame.append(ghoul)
                    ghoulss += 1
                if btype == 'treant':
                    treant = summon_treant(game, None, treantss, team=getrandomid(), hp=4)
                    for idss in treant:
                        x = idss
                        break
                    treant[x]['team'] = treant[x]['id']
                    botstogame.append(treant)
                    treantss += 1
                if btype == 'worm':
                    worm = summon_magmaworm(game, wormss, hp=4)
                    for idss in worm:
                        x = idss
                        break
                    worm[x]['team'] = worm[x]['id']
                    botstogame.append(worm)
                    wormss += 1
                if btype == 'demon':
                    demon = summon_eyedemon(game, demonss, hp=4)
                    for idss in demon:
                        x = idss
                        break
                    demon[x]['team'] = demon[x]['id']
                    botstogame.append(demon)
                    demonss += 1
                if btype == 'knight':
                    knight = summon_knight(game, knightss, randomid=True)
                    for idss in knight:
                        x = idss
                        break
                    knight[x]['team'] = knight[x]['id']
                    botstogame.append(knight)
                    knightss += 1
                if btype == 'mini-rhino':
                    knight = summon_small_rhino(game, mini_rhinoss)
                    for idss in knight:
                        x = idss
                        break
                    knight[x]['team'] = knight[x]['id']
                    botstogame.append(knight)
                    mini_rhinoss += 1
                if btype == 'dragon':
                    knight = summon_dragon(game, dragonss)
                    for idss in knight:
                        x = idss
                        break
                    knight[x]['team'] = knight[x]['id']
                    botstogame.append(knight)
                    dragonss += 1
            for ids in botstogame:
                game['players'].update(ids)
        if game['classic_game']:
            for ids in game['players']:
                player = game['players'][ids]
                player['customtexts'] = {}
        if game['testequipgame']:
            dummys = []
            dummyamount = len(game['players'])
            i = 0
            while i < dummyamount:
                dummy = summon_dummy(game, len(dummys))
                dummys.append(dummy)
                i += 1
            for ids in dummys:
                game['players'].update(ids)
        if game['cwrats'] or game['cwduelrats']:
            ratamount = 0
            rats = []
            ratamount = 1
            i = 0
            while i < ratamount:
                rat = summon_rat(game, len(rats))
                rats.append(rat)
                i += 1
            for ids in game['players']:
                player = game['players'][ids]
                break
            for ids in rats:
                for idss in ids:
                    rat = ids[idss]
                    break

                ratlvl = player['lvl']
                buff = 0
                buffen = 0
                if ratlvl >= 10:
                    buff += 1
                    buffen += 1
                if ratlvl >= 25:
                    buff += 1
                if ratlvl >= 40:
                    buff += 1
                rat_skillnumber = len(player['skills'])
                rat_weaponlvl = player['weapon'].lvl
                rat_skill_lvl_summary = 0
                for idss in player['skills']:
                    lvl = int(idss.split('?')[1])
                    rat_skill_lvl_summary += lvl
                rat_item_amount = len(player['inventory'])
                rat_skills = get_cw_rat_skills(rat_skillnumber, rat_skill_lvl_summary)
                rat_weapon = get_cw_rat_weapon(rat_weaponlvl)

                rat_items = get_cw_rat_items(rat_item_amount)

                rat_type_chance = random.randint(1, 100)

                if rat_type_chance <= 15:
                    special_rat = random.choice(["–ó–æ–ª–æ—Ç–∞—è –∫—Ä—ã—Å–∞", "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è –∫—Ä—ã—Å–∞"])
                    if special_rat == "–ó–æ–ª–æ—Ç–∞—è –∫—Ä—ã—Å–∞":
                        rat['name'] = "–ó–æ–ª–æ—Ç–∞—è –∫—Ä—ã—Å–∞|üê≠üí∞"
                        rat['hp'] = 3 + buff + 1
                        rat['maxhp'] = 3 + buff + 1
                        rat['dmglimit'] = 5 + buff + 10
                        rat['maxdmglimit'] = 5 + buff + 10
                    else:
                        rat['name'] = "–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è –∫—Ä—ã—Å–∞|üê≠üëª"
                        rat['hp'] = 3 + buff + 2
                        rat['maxhp'] = 3 + buff + 2

                else:
                    rat['name'] = "–°—Ç—Ä–∞—à–Ω–∞—è –∫—Ä—ã—Å–∞|üê≠üéÉ"
                    rat['hp'] = 3 + buff
                    rat['maxhp'] = 3 + buff
                    rat['dmglimit'] = 5 + buff
                    rat['maxdmglimit'] = 5 + buff


                rat['energy'] = 4 + buffen
                rat['maxenergy'] = 4 + buffen
                rat['weapon'] = rat_weapon
                rat['skills'] = rat_skills
                rat['inventory'] = rat_items
                rat['team'] = 'rats'

                game['players'].update(ids)

        if game['cwduel']:
            pass
        if game['dm']:
            game['sum_dm_deaths'] = 0
            for ids in game["players"]:
                game['sum_dm_deaths'] += 3
                game["players"][ids]["count_as_dm"] = True
                
        for ids in game['players']:
            player = game['players'][ids]
            player['stage'] = 'selectweapon'
        if chatid != botfights:
            if not game['castlefight'] and not game['neuralfight']:
                if not game['cwrats'] and not game['cwduel'] and not game['cwduelrats']:
                    try:
                        sendm(bot, pasyuk_id,
                                     '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å –≤ ' + str(m.chat.title) + ' (@' + str(m.chat.username) + ')')
                    except:
                        pass
                    # sendm(bot, pasyuk_id, '/spectate '+str(game['id']))
                else:
                    if game['cwduel']:
                        sendm(bot, pasyuk_id, '–î—É—ç–ª—å –º–µ–∂–¥—É –¥–≤—É–º—è –∏–≥—Ä–æ–∫–∞–º–∏ –Ω–∞—á–∞–ª–∞—Å—å!')
                    if game['cwrats'] or game['cwduelrats']:
                        for ids in game['players']:
                            player = game['players'][ids]
                            break
                        sendm(bot, pasyuk_id,
                                         '–ò–≥—Ä–∞ –ø—Ä–æ—Ç–∏–≤ –∫—Ä—ã—Å—ã –≤ Veganochatwars –Ω–∞—á–∞–ª–∞—Å—å! –ò–≥—Ä–æ–∫: ' + player['name'])
                    # sendm(bot, pasyuk_id, '/spectate '+str(game['id']))
        try:
            game['canceltimer'].cancel()
        except:
            pass
        if not game['neuralfight']:
            if not game['castlefight'] and not game['cwbar']:
                if not game['bossfight']:
                    if game['cwrats'] or game['cwduelrats']:
                        sendm(bot, chatid, '–ë–æ–π —Å –∫—Ä—ã—Å–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è! –°–æ–ø–µ—Ä–Ω–∏–∫–∏ –≥–æ—Ç–æ–≤—è—Ç—Å—è –∫ —Å—Ä–∞–∂–µ–Ω–∏—é...')
                    else:
                        if not game['cwduel']:
                            sendm(bot, chatid, '–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!')
                else:
                    sendm(bot, chatid,
                                     '–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!')  # –¶–µ–ª—å –∏–≥—Ä–æ–∫–æ–≤ - –ø–æ–±–µ–¥–∏—Ç—å –±–æ—Å—Å–∞ '+game['players'][boss]['name']+'!')
        global timefromstart
        # if timefromstart >= 1175:
        #    try:
        #        pass
        #        #bot.send_message(game['id'], '‚ùóÔ∏è‚ùóÔ∏è‚ùóÔ∏è–ë–æ—Ç –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ '+str(1200-timefromstart)+' –º–∏–Ω—É—Ç! –ù–∞—á–∏–Ω–∞–π—Ç–µ –∏–≥—Ä—ã –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫‚ùóÔ∏è‚ùóÔ∏è‚ùóÔ∏è')
        #    except:
        #        pass
        if not game['castlefight']:
            # time.sleep(1)
            if not game['neuralfight']:
                threading.Timer(1, select_weapon, args=[game, bot]).start()
            else:
                try:
                    select_weapon(game)
                except:
                    sendm(bot, pasyuk_id, traceback.format_exc())
        else:
            try:
                select_weapon(game)
            except:
                sendm(cwbot, pasyuk_id, traceback.format_exc())
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


def getrandomid(checklist=None):
    id = random.randint(1, 100000)
    if checklist != None:
        while id in checklist:
            id = random.randint(1, 100000)
    return id


@bot.message_handler(commands=['suicide'])
def suic(m):
    try:
        for ids in games:
            game = games[ids]
            if m.from_user.id in game['players']:
                if game['started'] and game['players'][m.from_user.id]['dead'] == False:
                    if game['dungeon'] and game['dungeon_type'] == 'dark' and game['dungeonlvl'] == 3 and \
                            game['players'][m.from_user.id]['darkness_sleep']:
                        # game['players'][m.from_user.id]['darkness_sleep'] = False
                        game['players'][m.from_user.id]['act'] = ['wake_up', 'self']
                    else:
                        game['players'][m.from_user.id]['suicide'] = True
                    game['players'][m.from_user.id]['ready'] = True
                    game['players'][m.from_user.id]['stage'] = None
    except:
        pass


def newratuser(game=None, idlist=None):
    if game != None:
        checklist = game['players']
    elif idlist != None:
        checklist = idlist
    else:
        checklist = []
    id = random.randint(1, 1000000)
    while id in checklist:
        id = random.randint(1, 1000000)
    user = npclist.NPC(id, '–ö—Ä—ã—Å–∞')
    return user


def newtreantuser(game=None, idlist=None):
    if game != None:
        checklist = game['players']
    elif idlist != None:
        checklist = idlist
    id = random.randint(1, 100000)
    while id in checklist:
        id = random.randint(1, 100000)
    user = npclist.NPC(id, '–¢—Ä–µ–Ω—Ç')
    return user


def newvirususer(game=None, idlist=None):
    if game != None:
        checklist = game['players']
    elif idlist != None:
        checklist = idlist
    id = random.randint(1, 100000)
    while id in checklist:
        id = random.randint(1, 100000)
    user = npclist.NPC(id, '–í–∏—Ä—É—Å-–º—É—Ç–∞–Ω—Ç')
    return user


def newrhinouser(game=None, idlist=None):
    if game != None:
        checklist = game['players']
    elif idlist != None:
        checklist = idlist
    id = random.randint(1, 100000)
    while id in checklist:
        id = random.randint(1, 100000)
    user = npclist.NPC(id, '–ù–æ—Å–æ—Ä–æ–≥')
    return user


def newskeletonuser(game=None, idlist=None):
    if game != None:
        checklist = game['players']
    elif idlist != None:
        checklist = idlist
    id = random.randint(1, 100000)
    while id in checklist:
        id = random.randint(1, 100000)
    user = npclist.NPC(id, '–°–∫–µ–ª–µ—Ç')
    return user


@bot.message_handler(commands=['addrats'])
def addratss(m):
    try:
        game = games[m.chat.id]
    except:
        return
    try:
        need_team = m.text.split(' ')[2]
    except:
        need_team = None
    x = bot.get_chat_member(m.chat.id, m.from_user.id)
    if x.status != 'creator' and x.status != 'administrator' and m.from_user.id != pasyuk_id and game[
        'creator'] != m.from_user.id:
        sendm(bot, m.chat.id,
                         '–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏–π –∏–≥—Ä—É, –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞ –º–æ–≥—É—Ç –ø—Ä–∏–∑—ã–≤–∞—Ç—å –∫—Ä—ã—Å!',
                         reply_to_message_id=m.message_id)
        return
    if game['alreadyaddedrats'] and m.from_user.id != pasyuk_id and m.from_user.id != pasyuk_2_id:
        sendm(bot, m.chat.id, '–í –æ–¥–Ω—É –∏–≥—Ä—É –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä—ã—Å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!',
                         reply_to_message_id=m.message_id)
        return
    if game['dungeon']:
        sendm(bot, m.chat.id, '–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –∫—Ä—ã—Å –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ!', reply_to_message_id=m.message_id)
        return
    if game['pureduel']:
        sendm(bot, m.chat.id, '–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –∫—Ä—ã—Å –≤ –¥—É—ç–ª—å –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö!', reply_to_message_id=m.message_id)
        return
    if game['started']:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç!')
        return
    try:
        y = int(m.text.split(' ')[1])
    except:
        sendm(bot, m.chat.id, '–£–∫–∞–∂–∏—Ç–µ —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—ã—Å! –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã:\n/addrats 3',
                         reply_to_message_id=m.message_id)
        return
    try:
        rat_diff = int(m.text.split(' ')[2])
    except:
        rat_diff = 1
    if y > 15 and m.from_user.id != pasyuk_id and m.from_user.id != pasyuk_2_id:
        sendm(bot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∫—Ä—ã—Å - 15!', reply_to_message_id=m.message_id)
        return
    if y < 1:
        sendm(bot, m.chat.id, '–ë–∞–≥–∞ –∑–¥–µ—Å—å –Ω–µ—Ç, –ø–æ–∏—â–∏—Ç–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ!', reply_to_message_id=m.message_id)
        return
    rats = []
    gameratamount = 0
    randomid = False
    if "random_teams=True" in m.text:
        randomid =  True
    for ids in game['players']:
        target = game['players'][ids]
        if '–ö—Ä—ã—Å–∞' in target['name'] and target['controller'] == 'bot':
            gameratamount += 1
    while len(rats) < y:
        newrat = newratuser(game)
        rat = createplayer(newrat, photo=ratphoto)
        for ids in rat:
            x = ids
            break
        rat[x]['name'] = '–ö—Ä—ã—Å–∞ ' + str(len(rats) + 1 + gameratamount) + '|üê≠'
        if need_team == None:
            rat[x]['team'] = rat[x]['id']
        else:
            rat[x]['team'] = need_team
        if randomid:
            rat[x]['team'] = rat[x]["id"]
        rat[x]['controller'] = 'bot'
        rats.append(rat)
    for ids in rats:
        game['players'].update(ids)
    game['alreadyaddedrats'] = True
    if need_team == None:
        sendm(bot, m.chat.id, '–î–æ–±–∞–≤–ª–µ–Ω–æ ' + str(y) + ' –∫—Ä—ã—Å!\n–¢–µ–ø–µ—Ä—å –≤ –±–æ—Ç–µ –µ—Å—Ç—å –ø–æ—Ö–æ–∂–∞—è –∫–æ–º–∞–Ω–¥–∞: /addknights.\n–ü–æ–¥—Å–∫–∞–∑–∫–∞: —á—Ç–æ–±—ã –≤—Å–µ –∫—Ä—ã—Å—ã –±—ã–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö - –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü –∫–æ–º–∞–Ω–¥—ã —Ç–µ–∫—Å—Ç random_teams=True. –ü—Ä–∏–º–µ—Ä:\n/addrats 10 random_teams=True')
    else:
        sendm(bot, m.chat.id, '–î–æ–±–∞–≤–ª–µ–Ω–æ ' + str(y) + ' –∫—Ä—ã—Å –≤ –∫–æ–º–∞–Ω–¥—É ' + need_team + '!\n–¢–µ–ø–µ—Ä—å –≤ –±–æ—Ç–µ –µ—Å—Ç—å –ø–æ—Ö–æ–∂–∞—è –∫–æ–º–∞–Ω–¥–∞: /addknights.')


@bot.message_handler(commands=['addknights'])
def addratssk(m):
    try:
        game = games[m.chat.id]
    except:
        return
    try:
        need_team = m.text.split(' ')[2]
    except:
        need_team = None
    x = bot.get_chat_member(m.chat.id, m.from_user.id)
    if x.status != 'creator' and x.status != 'administrator' and m.from_user.id != pasyuk_id and game[
        'creator'] != m.from_user.id:
        sendm(bot, m.chat.id,
                         '–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏–π –∏–≥—Ä—É, –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞ –º–æ–≥—É—Ç –ø—Ä–∏–∑—ã–≤–∞—Ç—å —Ä—ã—Ü–∞—Ä–µ–π!',
                         reply_to_message_id=m.message_id)
        return
    if game['alreadyaddedknights'] and m.from_user.id != pasyuk_id and m.from_user.id != pasyuk_2_id:
        sendm(bot, m.chat.id, '–í –æ–¥–Ω—É –∏–≥—Ä—É –¥–æ–±–∞–≤–∏—Ç—å —Ä—ã—Ü–∞—Ä–µ–π –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!',
                         reply_to_message_id=m.message_id)
        return
    if game['dungeon']:
        sendm(bot, m.chat.id, '–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å —Ä—ã—Ü–∞—Ä–µ–π –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ!', reply_to_message_id=m.message_id)
        return
    if game['pureduel']:
        sendm(bot, m.chat.id, '–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å —Ä—ã—Ü–∞—Ä–µ–π –≤ –¥—É—ç–ª—å –Ω–∞ —Ä–∞–ø–∏—Ä–∞—Ö!', reply_to_message_id=m.message_id)
        return
    if game['started']:
        sendm(bot, m.chat.id, '–ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç!')
        return
    try:
        y = int(m.text.split(' ')[1])
    except:
        sendm(bot, m.chat.id, '–£–∫–∞–∂–∏—Ç–µ —Ç—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—ã—Å! –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã:\n/addrats 3',
                         reply_to_message_id=m.message_id)
        return
    if y > 15 and m.from_user.id != pasyuk_id and m.from_user.id != pasyuk_2_id:
        sendm(bot, m.chat.id, '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —Ä—ã—Ü–∞—Ä–µ–π - 15!', reply_to_message_id=m.message_id)
        return
    if y < 1:
        sendm(bot, m.chat.id, '–ë–∞–≥–∞ –∑–¥–µ—Å—å –Ω–µ—Ç, –ø–æ–∏—â–∏—Ç–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ!', reply_to_message_id=m.message_id)
        return
    rats = []
    gameratamount = 0
    for ids in game['players']:
        target = game['players'][ids]
        if '–†—ã—Ü–∞—Ä—å' in target['name'] and target['controller'] == 'bot':
            gameratamount += 1
    randomid = False
    if "random_teams=True" in m.text:
        randomid =  True
    while len(rats) < y:
        knight = summon_knight(game, len(rats), randomid=randomid)
        rats.append(knight)
    for ids in rats:
        game['players'].update(ids)
    game['alreadyaddedknights'] = True
    if need_team == None:
        sendm(bot, m.chat.id, '–î–æ–±–∞–≤–ª–µ–Ω–æ ' + str(y) + ' —Ä—ã—Ü–∞—Ä–µ–π!\n–ü–æ–¥—Å–∫–∞–∑–∫–∞: —á—Ç–æ–±—ã –≤—Å–µ —Ä—ã—Ü–∞—Ä–∏ –±—ã–ª–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö - –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü –∫–æ–º–∞–Ω–¥—ã —Ç–µ–∫—Å—Ç random_teams=True. –ü—Ä–∏–º–µ—Ä:\n/addknights 10 random_teams=True')
    else:
        sendm(bot, m.chat.id, '–î–æ–±–∞–≤–ª–µ–Ω–æ ' + str(y) + ' —Ä—ã—Ü–∞—Ä–µ–π –≤ –∫–æ–º–∞–Ω–¥—É ' + need_team + '!')


def checktourgame(m):
    try:
        game = games[m.chat.id]
    except:
        return False
    if game['tournier'] and m.from_user.id in game['players']:
        return True
    return False


# @bot.message_handler(func = lambda m: checktourgame(m))
# def delmsgs(m):
#    try:
#        bot.delete_message(m.chat.id, m.message_id)
#        sendm(bot, m.chat.id, m.from_user.first_name + ', –≤–æ –≤—Ä–µ–º—è —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π –∏–≥—Ä—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –Ω–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç!')
#    except:
#        pass

def npcweaponselect(game, player):
    if not game['classic_game']:
        x = random.choice(npcweapons)()
        if player['is_rhino']:
            x = weaponlist.Horn()
    else:
        x = random.choice(npcclassicweapons)()
    return x


def getweaponkb(game, player=None):
    global testweapon
    kb = types.InlineKeyboardMarkup()
    w = []
    newweaponlist = weapons.copy()
    if game['classic_game']:
        newweaponlist = weapons_classic.copy()
    allys = []
    for ids in game['players']:
        target = game['players'][ids]
        if target['id'] != player['id'] and target['team'] == player['team']:
            allys.append(target['id'])
    #if not game['dungeon']:
    #    if not game['tournier']:
    #        if player['id'] in has_necrostaff:
    #            if not game['classic_game']:
    #                newweaponlist.append(weaponlist.NecromantStaff_players)
    # else:
    #    if len(allys) == 0:
    #        if game['dungeon_type'] == 'rhino' and player['id'] not in has_charge:
    #            pass
    #        else:
    #            if game['dungeon_type'] != 'dark':
    #                newweaponlist.append(weaponlist.NecromantStaff_players)

    weaponlimit = 4
    if game['classic_game']:
        weaponlimit = 3
    if game['testequipgame']:
        newweaponlist = allw.copy()
        newweaponlist.remove(weaponlist.NecromantStaff_players)
        newweaponlist.remove(weaponlist.Narsil)
        newweaponlist.remove(weaponlist.BowAsgard)
        newweaponlist.remove(weaponlist.Katana)
        newweaponlist.remove(weaponlist.Shield)
        newweaponlist.remove(weaponlist.Flamethrower_narsil)

        for ids in newweaponlist:
            x = ids()
            kb.add(
                types.InlineKeyboardButton(text=x.name,
                                           callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)+"?te%"))
    elif game['testequipgame_tournier']:
        newweaponlist = weapons.copy()
        try:
            newweaponlist.remove(weaponlist.OnePunch)
        except:
            pass
        for ids in newweaponlist:
            x = ids()
            if x.name not in blockweapons:
                kb.add(
                    types.InlineKeyboardButton(text=x.name,
                                            callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)+"?te%"))
    else:
        while len(w) < weaponlimit:
            notallowed = True
            x = random.choice(newweaponlist)()
            # if x.name == '–î—Ä–æ–±–æ–≤–∏–∫' and player['id'] == 1134827568:
            #    notallowed = True
            while x.id in w or (game['tournier'] and x.name in blockweapons) or notallowed:
                notallowed = False
                x = random.choice(newweaponlist)()
                # if x.name == '–î—Ä–æ–±–æ–≤–∏–∫' and player['id'] == 1134827568:
                #    notallowed = True
                new_weapon_chance = False
                if new_weapon_chance:
                    if random.randint(1, 100) <= 15:
                        y = weaponlist.OnePunch()
                        if y.id not in w:
                            x = y
                if (x.name == '–ü—É–ª–µ–º–µ—Ç' or x.name == 'One punch') and game['tournier']:
                    notallowed = True
                if x.name in ['–ü—É–ª–µ–º–µ—Ç', '–ú–æ—Ä–æ–∑–Ω—ã–π –ª—É–∫', 'One punch'] and game['dungeon']:
                    notallowed = True
                if x.name in ['–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç'] and len(game['players']) > 2 and not game['dungeon']:
                    notallowed = True
            if game['test']:
                try:
                    x = testweapon()
                except:
                    pass
            kb.add(types.InlineKeyboardButton(text=x.name,
                                              callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)),
                   types.InlineKeyboardButton(text='–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                                              callback_data='weaponinfo?' + str(game['id']) + '?' + str(x.id)))
            w.append(x.id)
    if player != None and not game['tournier']:
        if player['id'] == 1134827568:
            if game['classic_game']:
                x = weaponlist.Narsil_classic()
            else:
                x = weaponlist.Narsil()
            kb.add(types.InlineKeyboardButton(text=x.name,
                                              callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)))
            if not game['classic_game']:
                x = weaponlist.Shield()
                kb.add(types.InlineKeyboardButton(text=x.name,
                                              callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)))
                x = weaponlist.Flamethrower_narsil()
                kb.add(types.InlineKeyboardButton(text=x.name,
                                              callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)))
        if player['id'] == 52322637:
            x = weaponlist.BowAsgard()
            kb.add(types.InlineKeyboardButton(text=x.name,
                                              callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)))
        if player['id'] == 205959167 or player['id'] == 188314207 or player['id'] == 94197300:
            x = weaponlist.Katana()
            kb.add(types.InlineKeyboardButton(text=x.name,
                                              callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)))
        if player['id'] == 1134827568 or player['id'] == 1891820166:
            if not game['classic_game']:
                x = weaponlist.DuelRapier()
                kb.add(types.InlineKeyboardButton(text=x.name,
                                                  callback_data='selectweapon?' + str(game['id']) + '?' + str(x.id)))
        if not game['classic_game']:
            if player['id'] in has_necrostaff:
                allys = []
                for ids in game['players']:
                    target = game['players'][ids]
                    if target['id'] != player['id'] and target['team'] == player['team']:
                        allys.append(target['id'])
                if not game['dungeon']:
                    x = weaponlist.NecromantStaff_players()
                    kb.add(types.InlineKeyboardButton(text = x.name, callback_data = 'selectweapon?'+str(game['id'])+'?'+str(x.id)))
                else:
                    if game['dungeon_type'] == 'hell' and game['dungeonlvl'] == 3:
                        x = weaponlist.NecromantStaff_players()
                        kb.add(types.InlineKeyboardButton(text=x.name,
                                                          callback_data='selectweapon?' + str(game['id']) + '?' + str(
                                                              x.id)))
                    else:
                        if len(allys) == 0:
                            if (game['dungeon_type'] == 'rhino' and player['id'] not in has_charge) or (game['dungeon_type'] == 'dragon' and player['id'] not in has_dragon_power):
                                pass
                            else:
                                if game['dungeon_type'] != 'dark' and game['dungeon_type'] != 'hell':
                                    x = weaponlist.NecromantStaff_players()
                                    kb.add(types.InlineKeyboardButton(text = x.name, callback_data = 'selectweapon?'+str(game['id'])+'?'+str(x.id)))
    if not game['classic_game']:
        kb.add(types.InlineKeyboardButton(text='–°–ª—É—á–∞–π–Ω–æ–µ –æ—Ä—É–∂–∏–µ', callback_data='selectrandomweapon?' + str(game['id'])))
    return kb


def getnpcskills(game, player, skilllimit=2, banned_skills=[], dopskills=[]):
    x = []
    if game['dungeon'] and not player["is_knight"]:
        banned_skills.append('charge')
    while len(x) < skilllimit:
        notallowed = True
        npcskillscopy = npcskills.copy()
        if game['classic_game']:
            npcskillscopy = npcclassicskills.copy()
        for ids in dopskills:
            npcskillscopy.append(ids)
        y = random.choice(npcskillscopy)
        while y in x or notallowed:
            notallowed = False
            y = random.choice(npcskillscopy)
            if y in ['bicepc', 'berserk', 'charge'] and player['weapon'].ranged:
                notallowed = True
            if y in ['sniper'] and not player['weapon'].ranged:
                notallowed = True
            if y in ['navod', 'necromant', 'defer'] and len(allys) == 0:
                notallowed = True
            if y in banned_skills:
                notallowed = True
        x.append(y)
    if player['is_rhino'] or '–°–∫–µ–ª–µ—Ç' in player['name'] or '–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç' in player['name'] or '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç' in player[
        'name'] or \
            '–ê–º–∞–ª—å–≥–∞–º–∞' in player['name'] or '–¢—å–º–∞' in player['name']:
        x = []
    if player['is_vurdalak']:
        if game['dungeon']:
            x = ['ghoul_vampirism', 'ghoul_bloodlust']
        else:
            x.append('ghoul_vampirism')
            x.append('ghoul_bloodlust')
    if player['is_amalgama']:
        if game['dungeon']:
            x = ['amalgama_mutate', 'scare']
    if player['is_imp']:
        x = ['fire_regen', 'fire_power']
    if player['is_magmaworm']:
        x = ['fire_resistance', 'burrow']
    if player['is_lucifer']:
        x = ['lucifer_hellfire', 'DOOM']
    if player['is_radiodemon']:
        x = ['?']
    if player['is_eyedemon']:
        x = ['fire_touch']
    if player["is_dragon"]:
        x = ["dragon_fireball", "wing_attack"]

    return x

di = 0
for ids in ratdemons.find({'demons':{}}):
    di += 1
print(di)
ratdemons.delete_many({'demons':{}})

def select_weapon(game, bot=bot):
    try:
        if game['rats']:
            for ids in game['players']:
                player = game['players'][ids]
                team = player['team']
                break
            for ids in game['players']:
                player = game['players'][ids]
                if player['team'] != team:
                    player['team'] = team
            ratamount = len(game['players'])
            rats = []
            while len(rats) < ratamount:
                ratuser = newratuser(game)
                rat = createplayer(ratuser, photo=ratphoto)
                for ids in rat:
                    x = ids
                    break
                rat[x]['name'] = '–ö—Ä—ã—Å–∞ ' + str(len(rats) + 1) + '|üê≠'
                rat[x]['team'] = 'rats'
                rat[x]['controller'] = 'bot'
                if game['rat_difficulty'] >= 2:
                    buffs = ['accuracy', 'hp', 'armor', 'energy']  # , '+3shields']
                    getbuffs = []
                    for i in range(3):
                        # getbuffs.append(random.choice(buffs))
                        notallowed = True
                        while notallowed:
                            notallowed = False
                            z = random.choice(buffs)
                            if z == 'accuracy' and z in getbuffs:
                                notallowed = True
                            if z == 'energy' and z in getbuffs:
                                notallowed = True
                            if z == '+3shields' and z in getbuffs:
                                notallowed = True
                        getbuffs.append(z)
                    rat[x]['getbuffs2'] = getbuffs
                if game['rat_difficulty'] >= 3:
                    buffs = ['+1skill', 'hypnotist', 'armor++', 'energy++']
                    getbuffs = []
                    for i in range(2):
                        notallowed = True
                        while notallowed:
                            notallowed = False
                            z = random.choice(buffs)
                            if z == 'hypnotist' and z in getbuffs:
                                notallowed = True
                            if z == 'energy++' and z in getbuffs:
                                notallowed = True
                            if z == '+1skill' and z in getbuffs:
                                notallowed = True
                        getbuffs.append(z)
                    rat[x]['getbuffs3'] = getbuffs
                if game['rat_difficulty'] == 2:
                    rat[x]['name'] += 'üü†'
                if game['rat_difficulty'] == 3:
                    rat[x]['name'] += 'üî¥'
                rats.append(rat)
            for ids in rats:
                game['players'].update(ids)
        if game['teamplay']:
            teams = {}
            for ids in game['players']:
                if game['players'][ids]['team'] not in teams:
                    teams.update({game['players'][ids]['team']: 1})
                else:
                    teams[game['players'][ids]['team']] += 1
            maxplayers = -1
            for ids in teams:
                if teams[ids] > maxplayers:
                    maxplayers = teams[ids]
            rats = []
            gameratamount = 0
            for ids in game['players']:
                target = game['players'][ids]
                if '–ö—Ä—ã—Å–∞' in target['name'] and target['controller'] == 'bot':
                    gameratamount += 1
            for ids in teams:
                if teams[ids] < maxplayers:
                    y = maxplayers - teams[ids]
                    doprats = []
                    while len(doprats) < y:
                        newrat = newratuser(game)
                        rat = createplayer(newrat, photo=ratphoto)
                        for idsss in rat:
                            x = idsss
                            break
                        rat[x]['name'] = '–ö—Ä—ã—Å–∞ ' + str(len(rats) + 1 + gameratamount) + '|üê≠'
                        rat[x]['team'] = ids
                        rat[x]['controller'] = 'bot'
                        doprats.append(rat)
                        rats.append(rat)
            for ids in rats:
                game['players'].update(ids)
        if game['pureduel_rats']:
            if game['neuralfight']:
                ratamount = 2
                rats = []
                while len(rats) < ratamount:
                    ratuser = newratuser(game)
                    rat = createplayer(ratuser, photo=ratphoto)
                    for idss in rat:
                        x = idss
                        break
                    rat[x]['name'] = '–î—É—ç–ª—å–Ω–∞—è –∫—Ä—ã—Å–∞|üê≠'
                    rat[x]['team'] = str(len(rats))
                    rat[x]['controller'] = 'bot'
                    if len(rats) == 0:
                        rat[x]['fullneuraldemon'] = game['fullneuraldemon1']
                    else:
                        rat[x]['fullneuraldemon'] = game['fullneuraldemon2']
                    rat[x]['fullneuraldemonobject'] = game['demons'][rat[x]['fullneuraldemon']]
                    #print("7895: neurodemon1", game['fullneuraldemon1'])
                    rats.append(rat)
                for idss in rats:
                    game['players'].update(idss)
            elif game['pureduel_rats_hard']:
                ratamount = 1
                rats = []
                for ids in game['players']:
                    target = game['players'][ids]
                    break
                while len(rats) < ratamount:
                    ratuser = newratuser(game)
                    rat = createplayer(ratuser, photo=ratphoto)
                    for idss in rat:
                        x = idss
                        break
                    rat[x]['name'] = '–î—É—ç–ª—å–Ω–∞—è –Ω–µ–π—Ä–æ–∫—Ä—ã—Å–∞ v.2|üê≠'
                    rat[x]['team'] = 'rats'
                    rat[x]['controller'] = 'bot'
                    #rat[x]['weights'] = random_duelrat_weights()
                    #rat[x]['fullneuraldemon'] = game['fullneuraldemon_final']
                    rat[x]['fullneuraldemonobject'] = game['fullneuraldemon_final']
                    rats.append(rat)
                for idss in rats:
                    game['players'].update(idss)
            else:
                ratamount = 1
                rats = []
                for ids in game['players']:
                    target = game['players'][ids]
                    break
                while len(rats) < ratamount:
                    ratuser = newratuser(game)
                    rat = createplayer(ratuser, photo=ratphoto)
                    for idss in rat:
                        x = idss
                        break
                    rat[x]['name'] = '–î—É—ç–ª—å–Ω–∞—è –∫—Ä—ã—Å–∞|üê≠'
                    rat[x]['team'] = 'rats'
                    rat[x]['controller'] = 'bot'
                    rat[x]['weights'] = random_duelrat_weights()
                    demons = ratdemons.find_one({'id':target['id']})
                    if demons == None or demons['demons'] == {}:
                        #if demons['demons'] == {}:
                        #    print("none")

                        #maxscore = -9999
                        #topdemon = None
                        #for idss in ratdemons.find({}):
                            #print(idss)
                        #    for idsss in idss['demons']:
                        #        if idss['demons'][idsss]['score'] > maxscore:
                        #            maxscore = idss['demons'][idsss]['score']
                                    #print(maxscore)
                        #            topdemon = idss['demons']
                        if True:#topdemon == None:
                            createddemons = create_demons_for_rat()
                        else:
                            createddemons = topdemon
                        #if demons != None and demons['demons'] == {}:
                        #    ratdemons.update_one({'id': target['id'], 'demons': createddemons})
                        #else:
                        ratdemons.insert_one({'id':target['id'], 'demons':createddemons})
                        demons = ratdemons.find_one({'id':target['id']})

                    rat[x]['rat_demons'] = demons['demons']
                    #print(rat[x]['rat_demons'])
                    #print(demons)
                    rats.append(rat)
                for idss in rats:
                    game['players'].update(idss)
        if game['pokemonhunt']:
            ratamount = 1
            rats = []
            for ids in game['players']:
                target = game['players'][ids]
                break
            while len(rats) < ratamount:
                ratuser = newratuser(game)
                rat = createplayer(ratuser, photo=ratphoto)
                for idss in rat:
                    x = idss
                    break
                rat[x]['name'] = pokemonlist.namegenerator()+'|üê≠'
                rat[x]['team'] = 'rats'
                wtype = 'melee'
                wtype = 'ranged'
                rat[x]['skills'] = pokemonlist.randomskills(wtype)
                hp = pokemonlist.randomhp()
                dmglimit = pokemonlist.randomdmglimit()
                rat[x]['hp'] = hp
                rat[x]['maxhp'] = hp
                rat[x]['dmglimit'] = dmglimit
                rat[x]['maxdmglimit'] = dmglimit
                rat[x]['controller'] = 'bot'
                rats.append(rat)
            for idss in rats:
                game['players'].update(idss)
        for ids in game['players']:
            player = game['players'][ids]
            player['stage'] = 'selectweapon'
            player['ready'] = False
            items_get = []
            limit = 2
            if player['controller'] != 'bot' and game['dungeon'] and game['dungeonlvl'] >= 2:
                limit = 3
            if player['controller'] == 'player':
                which_list = items.copy()
            else:
                which_list = npcitems.copy()
            if game['testequipgame']:
                for ids in which_list:
                    for i in range(100):
                        items_get.append(ids)
            elif game['testequipgame_tournier']:
                items_get = []
            elif game['rp_fight']:
                if player['controller'] == 'player':
                    user = player['user']
                    items_get = user['rp_profile']['inventory']
                else:
                    items_get = []
            else:
                if not game['pureduel_rats']:
                    while len(items_get) < limit:
                        item = random.choice(which_list)
                        notallowed = True
                        while item in items_get or notallowed:
                            notallowed = False
                            item = random.choice(which_list)
                            if item in ['bint'] and game['tournier']:
                                notallowed = True
                        items_get.append(item)
            if game['pureduel']:
                items_get = ['adrenaline', 'flash']
                for idss in game['players']:
                    for idsss in game['players']:
                        game['players'][idss]['nearplayers'].append(game['players'][idsss]['id'])
            items_to_append = items_get.copy()
            if not game['castlefight'] and not game['cwrats'] and not game['cwduel'] and not game['cwduelrats']:
                for idss in items_to_append:
                    if ('–Ω–æ—Å–æ—Ä–æ–≥' in player['name'].lower() or '–°–∫–µ–ª–µ—Ç' in player['name'] or '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç' in player['name'] or \
                        '–í—É—Ä–¥–∞–ª–∞–∫' in player['name'] or '–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç' in player['name'] or '–ê–º–∞–ª—å–≥–∞–º–∞' in player[
                            'name'] or \
                        '–¢—Ä–µ–Ω—Ç' in player['name'] or '–¢—å–º–∞' in player['name'] or player['is_imp'] or player['is_magmaworm'] or player['is_lucifer'] or player['is_eyedemon'] or \
                    player['is_radiodemon'] or player["is_dragon"] or player["is_knight"]) \
                            and player['controller'] == 'bot':
                        pass
                    else:
                        player['inventory'].append(idss)
                        # print('append ',ids)

            itemtext = ''
            for idss in player['inventory']:
                itemtext += getname(idss) + ', '
            if len(itemtext) >= 2:
                itemtext = itemtext[:len(itemtext) - 2]
            if game['testequipgame']:
                itemtext = '—Ö100 –∫–∞–∂–¥–æ–≥–æ.'
            if player['controller'] == 'player':
                try:
                    if not game['cwrats'] and not game['cwduel'] and not game['cwduelrats']:
                        sendm(bot, player['id'], '–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã: ' + itemtext)
                    if not player['boss']:
                        if game['allrandom']:
                            newwlist = weapons.copy()
                            newwlist.remove(weaponlist.OnePunch)
                            weapon = random.choice(newwlist)()
                            w = weapon
                            player['weapon'] = w
                            player['stage'] = None
                            sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω–æ —Å–ª—É—á–∞–π–Ω–æ–µ –æ—Ä—É–∂–∏–µ: ' + w.name + '!')
                            player['ready'] = True
                            readycheck_select_skills(game)
                        elif game['pureduel']:
                            weapon = weaponlist.DuelRapier()
                            w = weapon
                            player['weapon'] = w
                            player['stage'] = None
                            player['ready'] = True
                            sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + w.name + '!')
                            readycheck_select_skills(game)
                        elif game['magictournier']:
                            weapon = weaponlist.MagicStaff()
                            w = weapon
                            player['weapon'] = w
                            player['stage'] = None
                            player['ready'] = True
                            sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + w.name + '!')
                            readycheck_select_skills(game)
                        elif game['rp_fight']:
                            user = player['user']
                            weaponname = user['rp_profile']['weapon']
                            if weaponname == '–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç –æ–≥—Ä–∞':
                                player['weapon'] = weaponlist.OgreGrenadeLauncher()
                            else:
                                player['weapon'] = weaponlist.Fist()
                            player['stage'] = None
                            player['ready'] = True
                            sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + player['weapon'].name + '!')
                            readycheck_select_skills(game)
                        elif game['cwrats'] or game['cwduelrats']:
                            player['stage'] = None
                            player['ready'] = True
                            # sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + player['weapon'].name + '!')
                            readycheck_select_skills(game)

                        elif game['cwduel']:
                            player['stage'] = None
                            player['ready'] = True
                            readycheck_select_skills(game)

                        else:
                            kb = getweaponkb(game, player)
                            sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä—É–∂–∏–µ:', reply_markup=kb)
                        if game['testequipgame_tournier']:
                            kb = getitemskb(game, player)
                            try:
                                sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã (–ª–∏–º–∏—Ç: 2).', reply_markup=kb)
                            except:
                                print(traceback.format_exc())
                    else:
                        kb = getbosskb(game, player)
                        sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫–∏–º –±–æ—Å—Å–æ–º –≤—ã –±—É–¥–µ—Ç–µ:', reply_markup=kb)
                except:
                    sendm(cwbot, pasyuk_id, traceback.format_exc())
            else:
                if game['pureduel_rats']:
                    weapon = weaponlist.DuelRapier()
                    w = weapon
                    player['weapon'] = w
                    player['stage'] = None
                    player['ready'] = True
                    #bot.send_message(player['id'], '–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + w.name + '!')
                    #readycheck_select_skills(game)
                else:
                    if not game['castlefight'] and not game['cwrats'] and not game['cwduel'] and not game['cwduelrats']:
                        if '–Ω–æ—Å–æ—Ä–æ–≥' not in player['name'].lower() and '–°–∫–µ–ª–µ—Ç' not in player['name'] and '–í—É—Ä–¥–∞–ª–∞–∫' not in player[
                            'name'] and \
                                '–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç' not in player['name'] and '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç' not in player[
                            'name'] and '–¢–µ–Ω—å –∫—Ä—ã—Å—ã' not in player['name'] and \
                                '–ê–º–∞–ª—å–≥–∞–º–∞' not in player['name'] and '–¢—Ä–µ–Ω—Ç' not in player['name'] and '–¢—å–º–∞' not in \
                                player['name'] and not player['is_imp'] and not player['is_magmaworm'] and not player['is_lucifer'] and not player['is_snowman'] \
                                and not player['is_eyedemon'] and not player['is_radiodemon'] and not player["is_dragon"] and not player["is_knight"]:
                            player['weapon'] = npcweaponselect(game, player)

                player['stage'] = None
                player['ready'] = True
        game['stage'] = 'weapons'
        if not game['castlefight'] and not game['cwbar'] and not game['neuralfight']:
            # t = threading.Timer(60, select_skills, args = [game, bot])
            # t.start()
            # game['timer'] = t
            # game['alltimers'].append(t)
            game['turntimer'] = time.time()
        else:
            select_skills(game)
    except:
        sendm(cwbot, pasyuk_id, traceback.format_exc())


@bot.callback_query_handler(func=lambda call: call.data[:12] == 'getskillinfo')
def skillllinfo(call):
    try:
        text = skillinfo.getskillinfo(call.data.split('?')[1])
    except:
        text = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
    bot.answer_callback_query(call.id, text, show_alert=True)


@bot.callback_query_handler(func=lambda call: call.data[:11] == 'getbossinfo')
def skillllinfo(call):
    try:
        text = skillinfo.getbossinfo(call.data.split('?')[1])
    except:
        text = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
    bot.answer_callback_query(call.id, text, show_alert=True)


@bot.callback_query_handler(func=lambda call: time.time() - call.message.date > 125)
def cancelold(call):
    bot.answer_callback_query(call.id, '–°–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!')


@bot.callback_query_handler(func=lambda call: call.data[:10] == 'weaponinfo')
def weaponinfo(call):
    weapon = int(call.data.split('?')[2])
    w = None
    for ids in allw:
        if ids().id == weapon:
            w = ids()
            break
    try:
        text = skillinfo.getweaponinfo(w.name)
    except:
        text = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
    bot.answer_callback_query(call.id, text, show_alert=True)


@bot.callback_query_handler(func=lambda call: call.data[:18] == 'selectrandomweapon')
def selectweapon(call):
    game = int(call.data.split('?')[1])
    try:
        game = games[game]
    except:
        return
    notallowed = True
    while notallowed:
        weapon = random.choice(weapons)()
        notallowed = False
        if weapon.name in ['–ü—É–ª–µ–º–µ—Ç', 'One punch'] and game['dungeon']:
            notallowed = True
        if weapon.name in ['–ü—É–ª–µ–º–µ—Ç', 'One punch'] and game['tournier']:
            notallowed = True
        if weapon.name in ['–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç'] and not game['dungeon'] and len(game['players']) > 2:
            notallowed = True
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['stage'] != 'selectweapon':
        return
    w = weapon
    player['weapon'] = w
    player['stage'] = None
    medit('–í—ã–±—Ä–∞–Ω–æ —Å–ª—É—á–∞–π–Ω–æ–µ –æ—Ä—É–∂–∏–µ: ' + w.name + '!', call.message.chat.id, call.message.message_id)
    player['ready'] = True
    readycheck_select_skills(game)


@bot.callback_query_handler(func=lambda call: call.data[:12] == 'selectweapon')
def selectweapon(call):
    game = int(call.data.split('?')[1])
    weapon = int(call.data.split('?')[2])
    try:
        game = games[game]
    except:
        return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['stage'] != 'selectweapon':
        return
    if not game["testequipgame"] and not game["testequipgame_tournier"] and "?te%" in call.data:
        return
    w = None
    for ids in allw:
        if ids().id == weapon:
            w = ids()
            break
    player['weapon'] = w
    player['stage'] = None
    medit('–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ: ' + w.name + '!', call.message.chat.id, call.message.message_id)
    player['ready'] = True
    readycheck_select_skills(game)


@bot.callback_query_handler(func=lambda call: call.data[:10] == 'selectboss')
def selectbosss(call):
    game = int(call.data.split('?')[1])
    boss = call.data.split('?')[2]
    try:
        game = games[game]
    except:
        return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['stage'] != 'selectweapon':
        return
    player['skills'].append(boss)
    player['stage'] = None
    if boss == 'skeletonking':
        player['weapon'] = weaponlist.SkeletonKingSword()
    if boss == 'vampire':
        player['weapon'] = weaponlist.VampireBite()
    if boss == 'demonlord':
        player['weapon'] = weaponlist.DemonlordEye()
    medit('–í—ã–±—Ä–∞–Ω –±–æ—Å—Å: ' + getname(boss) + '!', call.message.chat.id, call.message.message_id)
    player['ready'] = True
    player['name'] = getname(boss) + ' ' + player['name']
    if boss == 'skeletonking':
        player['photo'] = skeletonkingphoto
    if boss == 'vampire':
        player['photo'] = vampirephoto
    if boss == 'demonlord':
        player['photo'] = demonlordphoto
    readycheck_select_skills(game)


@bot.callback_query_handler(func=lambda call: call.data[:17] == 'selectoruzhweapon')
def selectweapon(call):
    game = int(call.data.split('?')[1])
    weapon = int(call.data.split('?')[2])
    try:
        game = games[game]
    except:
        return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['stage'] != 'selectskill':
        return
    w = None
    for ids in allw:
        if ids().id == weapon:
            w = ids()
            break
    player['secondweapon'] = w
    medit('–í—ã–±—Ä–∞–Ω–æ –≤—Ç–æ—Ä–æ–µ –æ—Ä—É–∂–∏–µ: ' + w.name + '!', call.message.chat.id, call.message.message_id)
    limit = 2
    if game['bossfight']:
        limit += 1
    if player['boss']:
        limit += 1
    if game['dungeon'] and game['dungeonlvl'] >= 2:
        limit += 1
    if len(player['skills']) >= limit:
        player['stage'] = None
        player['ready'] = True
        readycheck_next_turn(game)
    else:
        kb = getskillkb(game, player)
        sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–ª–∏–º–∏—Ç: ' + str(limit) + ').', reply_markup=kb)


def readycheck_select_skills(game):
    return
    ready = 0
    for ids in game['players']:
        player = game['players'][ids]
        if player['ready']:
            ready += 1
    if len(game['players']) == ready:
        game['timer'].cancel()
        select_skills(game)


def select_skills(game, bot=bot):
    game['stage'] = None
    # try:
    #    game['timer'].cancel()
    # except:
    #    pass
    # for ids in game['alltimers']:
    #    try:
    #        ids.cancel()
    ##
    #    except:
    #        pass
    for ids in game['players']:
        if game['castlefight'] or game['cwrats'] or game['cwduel'] or game['cwduelrats']:
            if game['players'][ids]['weapon'] == None:
                game['players'][ids]['weapon'] = cw_weaponlist.Fist_1()
        else:
            if game['players'][ids]['weapon'] == None:
                if game['classic_game']:
                    game['players'][ids]['weapon'] = weaponlist.Fist_classic()
                else:
                    game['players'][ids]['weapon'] = weaponlist.Fist()
    addrats = []
    addskeles = []
    alreadyrats = 0
    for ids in game['players']:
        player = game['players'][ids]
        if '–ö—Ä—ã—Å–∞' in player['name'] and player['controller'] == 'bot':
            alreadyrats += 1
    alreadyskeles = 0
    for ids in game['players']:
        player = game['players'][ids]
        if '–°–∫–µ–ª–µ—Ç' in player['name'] and player['controller'] == 'bot':
            alreadyskeles += 1
    for ids in game['players']:
        player = game['players'][ids]
        if player['weapon'].name == 'One punch':
            targets = []
            for idss in game['players']:
                target = game['players'][idss]
                if target['team'] != player['team']:
                    targets.append(target)
            if len(targets) > 0:
                target = random.choice(targets)
                for i in range(1):
                    createdrat = summon_rat(game, len(addrats) + alreadyrats, team=target['team'])
                    for idsss in createdrat:
                        x = idsss
                        break
                    createdrat[x]['weapon'] = npcweaponselect(game, createdrat[x])
                    ratinventory = []
                    which_list = npcitems.copy()
                    for i in range(2):
                        item = random.choice(which_list)
                        while item in ratinventory:
                            item = random.choice(which_list)
                        ratinventory.append(item)
                    createdrat[x]['inventory'] = ratinventory
                    addrats.append(createdrat)
                for i in range(1):
                    createdskele = summon_dung_skeleton(game, skeletons=len(addskeles) + alreadyskeles,
                                                        team=target['team'])
                    for idsss in createdskele:
                        x = idsss
                        break
                    addskeles.append(createdskele)
    for ids in addrats:
        game['players'].update(ids)
    for ids in addskeles:
        game['players'].update(ids)
    game['playersamount'] = len(game['players'])
    tries = 0
    if not game['castlefight'] and not game['cwrats'] and not game['cwduel'] and not game['cwduelrats'] and not game['neuralfight']:
        while True:
            try:
                sendm(bot, game['id'], '–û—Ä—É–∂–∏–µ –≤—ã–±—Ä–∞–Ω–æ.')
                break
            except:
                tries += 1
                if tries > 100:
                    del games[game['id']]
                    return
                time.sleep(3)

    if game['teamplay']:
        teamlist = {}
        for ids in game['players']:
            player = game['players'][ids]
            if player['team'] not in teamlist:
                teamlist.update({player['team']: 1})
            else:
                teamlist[player['team']] += 1
        gl = []
        for ids in teamlist:
            if teamlist[ids] == 2:
                gl.append(ids)
        if random.randint(1, 100) <= 0:
            if len(gl) > 0:
                team = random.choice(gl)
                game['gl'] = team

    for ids in game['players']:
        player = game['players'][ids]
        if not player['suicide']:
            player['ready'] = False
            player['stage'] = 'selectskill'
        skill_limit = 2
        if game['bossfight']:
            skill_limit += 1
        if player['boss']:
            skill_limit += 1
        if game['dungeon'] and game['dungeonlvl'] >= 2:
            skill_limit += 1
        if game["new_limit"]:
            skill_limit = game['dop_skills']
        if player['controller'] == 'player':
            try:
                if game['allrandom']:
                    getrandomskills(game, player)
                    skilltext = ''
                    for idss in player['skills']:
                        skilltext += getname(idss) + ', '
                    skilltext = skilltext[:len(skilltext) - 2]
                    skilltext += '.'
                    sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω—ã —Å–ª—É—á–∞–π–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: ' + skilltext)
                    player['ready'] = True
                    player['stage'] = None
                elif game['pureduel']:
                    player['skills'] = ['shieldgen', 'vor']
                    sendm(bot, player['id'], '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω—ã.')
                    player['ready'] = True
                    player['stage'] = None
                elif game['magictournier']:
                    player['skills'] = ['invoker']
                    sendm(bot, player['id'], '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω—ã.')
                    player['ready'] = True
                    player['stage'] = None
                elif game['rp_fight']:
                    user = player['user']
                    player['skills'] = user['rp_profile']['skills']
                    abiltext = ''
                    for idss in player['skills']:
                        abiltext += getname(idss) + ', '
                    if len(abiltext) >= 2:
                        abiltext = abiltext[:len(abiltext) - 2]
                    sendm(bot, player['id'], '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω—ã: ' + abiltext)
                    player['ready'] = True
                    player['stage'] = None
                elif game['cwrats'] or game['cwduelrats']:
                    player['ready'] = True
                    player['stage'] = None
                elif game['cwduel']:
                    player['ready'] = True
                    player['stage'] = None
                else:
                    kb = getskillkb(game, player)
                    sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–ª–∏–º–∏—Ç: ' + str(skill_limit) + ').',
                                     reply_markup=kb)

            except:
                sendm(bot, pasyuk_id, traceback.format_exc())
        else:
            if game['pureduel_rats']:
                player['skills'] = ['shieldgen', 'vor']
                #bot.send_message(player['id'], '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω—ã.')
                player['ready'] = True
                player['stage'] = None
            else:
                if not game['castlefight'] and not game['cwrats'] and not game['cwduel'] and not game['cwduelrats']:
                    skilllimit = 2
                    for idss in player['getbuffs3']:
                        if idss == '+1skill':
                            skilllimit += 1
                    if game["new_limit"]:
                        skilllimit = game['dop_skills']
                    if not player["is_knight"] and not player["is_dragon"]:
                        player['skills'] = getnpcskills(game, player, skilllimit)
            player['ready'] = True
            player['stage'] = None
    game['stage'] = 'skills'
    if not game['castlefight'] and not game['cwbar'] and not game['neuralfight']:
        # t = threading.Timer(90, next_turn, args = [game, bot])
        # t.start()
        # game['timer'] = t
        # game['alltimers'].append(t)
        game['turntimer'] = time.time()
    else:
        next_turn(game)


def getrandomskills(game, player):
    choiceskills = []
    allys = []
    for ids in game['players']:
        target = game['players'][ids]
        if target['id'] != player['id'] and target['team'] == player['team']:
            allys.append(target['id'])
    while len(choiceskills) < 2:
        x = random.choice(skills)
        notallowed = True
        while x in choiceskills or notallowed:
            notallowed = False
            x = random.choice(skills)
            if x in ['bicepc', 'berserk', 'charge', 'multicast'] and player['weapon'].ranged:
                notallowed = True
            if x in ['invoker', 'bloodseeker'] and game['dungeon']:
                notallowed = True
            # if x in ['robot'] and player['weapon'].name in ['–î—Ä–æ–±–æ–≤–∏–∫', '–û–±—Ä–µ–∑']:
            #    notallowed = True
            if x in ['sniper'] and not player['weapon'].ranged:
                notallowed = True
            if x in ['navod', 'necromant', 'defer'] and len(allys) == 0:
                notallowed = True
            if x in ['sniper', 'visor'] and player['weapon'].name in ['–î—Ä–æ–±–æ–≤–∏–∫']:
                notallowed = True
            if x in blockskills and game['tournier']:
                notallowed = True
            if x in ["ritualist"]:
                notallowed = True
        choiceskills.append(x)
    player['skills'] = choiceskills
    if 'oruzh' in player['skills']:
        r_weapon = random.choice(weapons)()
        
        while r_weapon.name == player['weapon'].name or r_weapon.name == "One punch":
            r_weapon = random.choice(weapons)()
        player['secondweapon'] = r_weapon
        try:
            sendm(bot, player['id'], '–í—ã–±—Ä–∞–Ω–æ –æ—Ä—É–∂–∏–µ –¥–ª—è –æ—Ä—É–∂–µ–π–Ω–∏–∫–∞: ' + player['secondweapon'].name + '!')
        except:
            print(traceback.format_exc())


def readycheck_next_turn(game):
    return
    ready = 0
    for ids in game['players']:
        player = game['players'][ids]
        if player['ready']:
            ready += 1
    if len(game['players']) == ready:
        game['timer'].cancel()
        next_turn(game)

@bot.callback_query_handler(func=lambda call: call.data[:10] == 'selectitem')
def selectitemmm(call):
    game = int(call.data.split('?')[1])
    item = call.data.split('?')[2]
    try:
        game = games[game]
    except:
        return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['stage'] != 'selectskill' and player['stage'] != 'selectweapon':
        return
    limit = 2
    if game['bossfight']:
        limit += 1
    if player['boss']:
        limit += 1
    if game['dungeon'] and game['dungeonlvl'] >= 2:
        limit += 1
    if len(player['inventory']) >= limit:
        return
    player['inventory'].append(item)
    medit('–í—ã–±—Ä–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: ' + getname(item) + '!', call.message.chat.id, call.message.message_id)
    if len(player['inventory']) >= limit:
        return
    else:
        kb = getitemskb(game, player)
        sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã (–ª–∏–º–∏—Ç: ' + str(limit) + ').', reply_markup=kb)


@bot.callback_query_handler(func=lambda call: call.data[:11] == 'selectskill')
def selectskill(call):
    game = int(call.data.split('?')[1])
    skill = call.data.split('?')[2]
    try:
        game = games[game]
    except:
        return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['stage'] != 'selectskill':
        return
    if not game["testequipgame"] and not game["testequipgame_tournier"] and "?te%" in call.data:
        return
    limit = 2
    if 'elmo' in player['skills']:
        limit = 5
    if game['bossfight']:
        limit += 1
    if player['boss']:
        limit += 1
    if game['dungeon'] and game['dungeonlvl'] >= 2:
        limit += 1
    if game["new_limit"]:
        limit = game['dop_skills']
    if len(player['skills']) >= limit:
        return
    player['skills'].append(skill)
    if skill == 'oruzh':
        kb2 = getoruzhkb(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ –æ—Ä—É–∂–∏–µ.', call.message.chat.id, call.message.message_id, reply_markup=kb2)
        return
    else:
        medit('–í—ã–±—Ä–∞–Ω–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: ' + getname(skill) + '!', call.message.chat.id, call.message.message_id)
    if len(player['skills']) >= limit:
        player['stage'] = None
        player['ready'] = True
        readycheck_next_turn(game)
    else:
        kb = getskillkb(game, player)
        sendm(bot, player['id'], '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–ª–∏–º–∏—Ç: ' + str(limit) + ').', reply_markup=kb)


def next_turn(game, bot=bot):
    try:
        # try:
        #    game['timer'].cancel()
        # except:
        #    pass
        # idstoremove = []
        # for ids in game['alltimers']:
        #    try:
        #        ids.cancel()
        # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
        #        idstoremove.append(ids)
        #    except:
        #        pass
        # for ids in idstoremove:
        #    game['alltimers'].remove(ids)

        #print("8550: neurodemon1", game['fullneuraldemon1'])
        game['stage'] = None
        if game['turn'] == 1 and not game['providets'] and not game['was_1_turn']:
            game['was_1_turn'] = True
            if not game['castlefight'] and not game['neuralfight']:
                wps = ''
                customtexts = []
                for ids in game['players']:
                    player = game['players'][ids]
                    xx = player['weapon'].name
                    if player['weapon'].name == '–ú–µ—á –∫–æ—Ä–æ–ª—è':
                        xx = '–ú–µ—á –∫–æ—Ä–æ–ª—è —Å–∫–µ–ª–µ—Ç–æ–≤'
                    if player['weapon'].name == '–ú–µ—á –¥—Ä—è—Ö–ª–æ–≥–æ —Å–∫–µ–ª–µ—Ç–∞':
                        xx = '–ú–µ—á'
                    if player['weapon'].name == '–ü–æ—Å–æ—Ö –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞':
                        xx = '–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞'
                    if 'invoker' in player['skills']:
                        xx = '–ü–æ—Å–æ—Ö'
                    #if player['id'] == 872267409 and player['weapon'].name == '–ë—É–ª–∞–≤–∞':
                    #    xx = '–ë—É–ª–∞–≤–∞-—Ö—É—è–ª–∫–∞'
                    #if player['weapon'].name == '–ë—É–ª–∞–≤–∞' and 'zilch_bulava' in player['customtexts'] and player['customtexts']['zilch_bulava']:
                    #    xx = '–ë—É–ª–∞–≤–∞ –ù–∞—Ä—Å–∏–ª'
                    #if player['weapon'].name == '–û–≥–Ω–µ–º–µ—Ç' and 'zilch_flamethrower' in player['customtexts'] and player['customtexts']['zilch_flamethrower']:
                    #    xx = '–û–≥–Ω–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª'
                    
                    if player['weapon'].name == '–ë—É–ª–∞–≤–∞' and' semw_bulava' in player['customtexts'] and player['customtexts']['semw_bulava']:
                        xx = '–ü–∞–ª–∫–∞-—Ö—É—è–ª–∫–∞'
                    if player['weapon'].name == '–†–µ–≤–æ–ª—å–≤–µ—Ä' and 'zilch_revolver' in player['customtexts'] and player['customtexts']['zilch_revolver']:
                        xx = '–†–µ–≤–æ–ª—å–≤–µ—Ä –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–ü–∏—Å—Ç–æ–ª–µ—Ç' and 'zilch_pistol' in player['customtexts'] and player['customtexts']['zilch_pistol']:
                        xx = '–ü–∏—Å—Ç–æ–ª–µ—Ç –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–ü–∏–ª–æ–º–µ—Ç' and 'zilch_saw' in player['customtexts'] and player['customtexts']['zilch_saw']:
                        xx = '–ü–∏–ª–æ–º–µ—Ç –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–ü—É–ª–µ–º–µ—Ç' and 'zilch_machinegun' in player['customtexts'] and player['customtexts']['zilch_machinegun']:
                        xx = '–ü—É–ª–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–õ—É–∫' and 'zilch_bow' in player['customtexts'] and player['customtexts']['zilch_bow']:
                        xx = '–õ—É–∫ –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫' and 'zilch_drobovik' in player['customtexts'] and player['customtexts']['zilch_drobovik']:
                        xx = '–î—Ä–æ–±–æ–≤–∏–∫ –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–û–±—Ä–µ–∑' and 'zilch_obrez' in player['customtexts'] and player['customtexts']['zilch_obrez']:
                        xx = '–û–±—Ä–µ–∑ –ù–∞—Ä—Å–∏–ª'
                    if player['weapon'].name == '–û–≥–Ω–µ–º–µ—Ç' and 'alex_flamethrower' in player['customtexts'] and player['customtexts']['alex_flamethrower']:
                        xx = '–ü–∞—Å—Ç—å –î—Ä–∞–∫–æ–Ω–∞'
                    if player['weapon'].name == '–¶–µ–ø—å' and 'tuman_chain' in player['customtexts'] and player['customtexts']['tuman_chain']:
                        xx = '–ö–ª–∏–Ω–æ–∫ –¢—É–º–∞–Ω–∞ üåô'
                    if player['weapon'].name == '–®–µ—Å—Ç' and 'bibizyan_shest' in player['customtexts'] and player['customtexts']['bibizyan_shest']:
                        xx = '–®–µ—Å—Ç –ë–∏–±–∏–∑—è–Ω üêµ'
                    dp = ""
                    if "dragon_power" in player["skills"]:
                        dp = "üê¶‚Äçüî•|"
                    if game['cwrats'] or game['cwduel'] or game['cwduelrats']:
                        wps += dp+player['name'] + ': ' + xx + ' lvl.' + str(player['weapon'].lvl) + '\n'
                    else:
                        wps += dp+player['name'] + ': ' + xx + '\n'
                        if xx == 'One punch':
                            wps += '‚ùóÔ∏è–ü—Ä–æ—Ç–∏–≤ ' + player['name'] + ' –ø—Ä–∏—à–ª–∏ —Å—Ä–∞–∂–∞—Ç—å—Å—è —Å–∫–µ–ª–µ—Ç –∏ –∫—Ä—ã—Å–∞!\n'
                            player['photo'] = onepunchphoto
                    if len(player['customtexts']) > 0:
                        for idss in player['customtexts']:
                            if player['customtexts'][idss]:
                                customtexts.append(idss)
                ctextinfo = ''
                textkb = types.InlineKeyboardMarkup()
                if len(customtexts) > 0:
                    textkb.add(types.InlineKeyboardButton(text = '–ò–Ω—Ñ–æ –æ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–µ–∫—Å—Ç–∞—Ö', callback_data = 'customtextinfo?'+str(game['id'])))
                    game['customtextlist'] = customtexts
                    ctextinfo = '\n‚ùóÔ∏è–í –∏–≥—Ä–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –õ–° –º–æ–∂–Ω–æ, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.\n'
                if game['teamplay']:
                    teamtext = ''
                    teams = {}
                    for ids in game['players']:
                        player = game['players'][ids]
                        if player['team'] not in teams:
                            teams.update({player['team']: [player['id']]})
                        else:
                            teams[player['team']].append(player['id'])
                    i = 1
                    for ids in teams:
                        teamtext += '–ö–æ–º–∞–Ω–¥–∞ ' + str(i) + ': '
                        for idss in teams[ids]:
                            teamtext += game['players'][idss]['name'] + ', '
                        teamtext = teamtext[:len(teamtext) - 2]
                        teamtext += '\n'
                        i += 1
                    while True:
                        tries = 0
                        try:
                            sendm(bot, game['id'], teamtext)
                            break
                        except:
                            tries += 1
                            if tries > 100:
                                del games[game['id']]
                                return
                            time.sleep(3)
                if game['cwrats'] or game['cwduel'] or game['cwduelrats'] or game['cwbar']:
                    for ids in game['players']:
                        player = game['players'][ids]
                        if player['controller'] != 'bot':
                            try:
                                sendm(bot, player['id'], '–í—ã–±–æ—Ä –æ—Ä—É–∂–∏—è:\n' + wps)
                            except:
                                pass
                else:
                    while True:
                        tries = 0
                        try:
                            sendm(bot, game['id'], '–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω—ã, –∏–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–æ—Ä –æ—Ä—É–∂–∏—è:\n' + wps+ctextinfo, reply_markup = textkb)
                            break
                        except:
                            tries += 1
                            if tries > 100:
                                del games[game['id']]
                                return
                            time.sleep(3)
            knight_talk = False
            for ids in game['players']:
                player = game['players'][ids]

                # cwratskills = ['armor?1', 'armor?2', 'armor?3', 'resistant?1', 'resistant?2', 'resistant?3', 'dvuzhil?1', 'dvuzhil?2', 'dvuzhil?3',
                #   'zapas?1', 'zapas?2', 'zapas?3', 'enduring?1', 'enduring?2', 'enduring?3']

                if 'resistant?1' in player['skills']:
                    player['dmglimit'] += 1
                    player['maxdmglimit'] += 1
                if 'resistant?2' in player['skills']:
                    player['dmglimit'] += 2
                    player['maxdmglimit'] += 2
                if 'resistant?3' in player['skills']:
                    player['dmglimit'] += 4
                    player['maxdmglimit'] += 4

                if 'dvuzhil?1' in player['skills']:
                    player['hp'] += 1
                    player['maxhp'] += 1
                    player['bloodresist'] += 0
                if 'dvuzhil?2' in player['skills']:
                    player['hp'] += 1
                    player['maxhp'] += 1
                    player['bloodresist'] += 1
                if 'dvuzhil?3' in player['skills']:
                    player['hp'] += 2
                    player['maxhp'] += 2
                    player['bloodresist'] += 1

                if 'enduring?1' in player['skills']:
                    player['energy'] += 0
                    player['maxenergy'] += 0
                if 'enduring?2' in player['skills']:
                    player['energy'] += 1
                    player['maxenergy'] += 1
                if 'enduring?3' in player['skills']:
                    player['energy'] += 2
                    player['maxenergy'] += 2

                if 'zapas?1' in player['skills'] or 'zapas?2' in player['skills'] or 'zapas?3' in player['skills']:
                    if 'zapas?1' in player['skills']:
                        rangeamount = 1
                    if 'zapas?2' in player['skills']:
                        rangeamount = 2
                    if 'zapas?3' in player['skills']:
                        rangeamount = 3
                    lst = cwratitems.copy()
                    if player['controller'] == 'bot':
                        lst = cwratitems.copy()
                    for i in range(rangeamount):
                        notallowed = True
                        x = random.choice(lst)
                        if len(player['inventory']) < len(lst):
                            while x in player['inventory'] or notallowed:
                                x = random.choice(lst)
                                notallowed = False
                        player['inventory'].append(x)

                if 'invoker' in player['skills']:
                    player['skills'] = ['invoker']
                    player['weapon'] = weaponlist.Staff()
                    player['energy'] = 3
                    player['maxenergy'] = 3
                if 'dvuzhil' in player['skills'] or 'dvuzhil_classic' in player['skills']:
                    if player['is_dark_rat']:
                        pass
                    else:
                        player['hp'] += 1
                    player['maxhp'] += 1
                if 'cherep' in player['skills'] or 'cherep_classic' in player['skills']:
                    player['dmglimit'] += 3
                    player['maxdmglimit'] += 3
                    player['chereparmor'] += 3
                if 'cherep?1' in player['skills']:
                    player['dmglimit'] += 1
                    player['maxdmglimit'] += 1
                if 'cherep?2' in player['skills']:
                    player['dmglimit'] += 3
                    player['maxdmglimit'] += 3
                if 'cherep?3' in player['skills']:
                    player['dmglimit'] += 5
                    player['maxdmglimit'] += 5
                if ('medic' in player['skills'] or 'medic?1' in player['skills'] or 'medic?2' in player[
                    'skills'] or 'medic?3' in player['skills']):
                    player['inventory'].append('stimulator')
                if 'berserk' in player['skills'] or 'berserk_classic' in player['skills']:
                    player['maxenergy'] = 3
                    player['energy'] = player['maxenergy']
                if 'elmo' in player['skills']:
                    player['hp'] -= 3
                    game['text'] += '‚ö°Ô∏è|–†–∞–∑—Ä—è–¥ –º–æ–ª–Ω–∏–∏ –±—å–µ—Ç –≤ ' + player['name'] + '.\n'
                    game['text'] += '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç 3 –∂–∏–∑–Ω–∏. –û—Å—Ç–∞–µ—Ç—Å—è ' + str(
                        player['hp']) + ' —Ö–ø.\n'
                    if 'berserk' in player['skills']:
                        hp = 3
                        maxen = 9
                        if 'protivogaz' in player['skills']:
                            maxen += 1
                        if player['maxenergy'] < maxen:
                            player['maxenergy'] += hp
                        if 'alex_berserk' in player['customtexts'] and player['customtexts']['alex_berserk']:
                            game['text'] += 'üëø|–†–∞–∑—É–º –ê—Ä—Ö–∏–¥–µ–º–æ–Ω–∞ '+player['name']+' —Ä–∞–∑—Ä—É—à–∞–µ—Ç—Å—è! –ü–æ–ª—É—á–∞–µ—Ç '+str(hp)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        elif 'tuman_berserk' in player['customtexts'] and player['customtexts']['tuman_berserk']:
                            game['text'] += '‚óºÔ∏è|' +player['name']+ ' –≥–æ—Ä–∏—Ç —á—ë—Ä–Ω—ã–º –ø–ª–∞–º–µ–Ω–µ–º! –ü–æ–ª—É—á–∞–µ—Ç '+str(hp)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        else:
                            game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(hp)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        player['maxenergy'] += hp
                        player['energy'] += hp
                        if player['maxenergy'] > maxen:
                            player['maxenergy'] = maxen
                        if player['hp'] == 1:
                            if 'alex_berserk' in player['customtexts'] and player['customtexts']['alex_berserk']:
                                game['text'] += 'üëø|–†–∞–∑—É–º –ê—Ä—Ö–∏–¥–µ–º–æ–Ω–∞ '+player['name']+' —Ä–∞–∑—Ä—É—à–µ–Ω! –ê—Ä—Ö–∏–¥–µ–º–æ–Ω –≤–ø–∞–¥–∞–µ—Ç –≤ –±–µ–∑—É–º–∏–µ!\n'
                            elif 'tuman_berserk' in player['customtexts'] and player['customtexts']['tuman_berserk']:
                                game['text'] += 'üñ§|' +player['name']+ ' –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç —á–µ—Ä–Ω—ã–º –æ–≥–Ω–µ–º, –∏ –æ–±—Ä–µ—Ç–∞–µ—Ç –ò—Å—Ç–∏–Ω–Ω—É—é —Ñ–æ—Ä–º—É!\n'
                            else:
                                game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –≤—Ö–æ–¥–∏—Ç –≤ –±–æ–µ–≤–æ–π —Ç—Ä–∞–Ω—Å!\n'
                if 'protivogaz' in player['skills']:
                    player['maxenergy'] += 1
                    player['energy'] += 1
                if 'protivogaz?1' in player['skills']:
                    player['maxenergy'] += 0
                    player['energy'] += 0
                if 'protivogaz?2' in player['skills']:
                    player['maxenergy'] += 0
                    player['energy'] += 0
                if 'protivogaz?3' in player['skills']:
                    player['maxenergy'] += 1
                    player['energy'] += 1
                if 'pyrotech' in player['skills'] or 'pyrotech?1' in player['skills'] or 'pyrotech?2' in player[
                    'skills'] or 'pyrotech?3' in player['skills']:
                    player['inventory'].append('bomb')
                if ('alchemist' in player['skills'] or 'alchemist?1' in player['skills'] or 'alchemist?2' in player[
                    'skills'] or 'alchemist?3' in player['skills']):
                    player['inventory'].append('madpotion')
                if 'autist' in player['skills']:
                    player['hp'] += 2
                    player['maxhp'] += 2
                if player['boss']:
                    player['hp'] += 1
                    player['maxhp'] += 1
                if 'vampire' in player['skills']:
                    player['hp'] += 1
                    player['maxhp'] += 1
                if 'demonlord' in player['skills']:
                    player['hp'] -= 1
                    player['maxhp'] -= 1
                # if 'demon' in player['skills']:
                #    player['maxhp'] += 1000
                lst = items.copy()
                if player['controller'] == 'bot':
                    lst = npcitems.copy()
                if ('zapas' in player['skills'] or 'zapas_classic' in player['skills']) and len(player['inventory']) < len(lst):
                    for i in range(2):
                        notallowed = True
                        x = random.choice(lst)
                        while x in player['inventory'] or notallowed:
                            x = random.choice(lst)
                            notallowed = False
                            if x in ['bint'] and game['tournier']:
                                notallowed = True
                        player['inventory'].append(x)
                if 'narkoman' in player['skills'] or 'narkoman_classic' in player['skills']:
                    x = random.choice(['adrenaline', 'dzet', 'hitin'])
                    player['inventory'].append(x)
                if 'narkoman?2' in player['skills']:
                    x = random.choice(['adrenaline', 'dzet', 'hitin'])
                    player['inventory'].append(x)
                if 'narkoman?3' in player['skills']:
                    x = random.choice(['adrenaline', 'dzet', 'hitin'])
                    player['inventory'].append(x)
                if ('berserk' in player['skills'] or 'berserk_classic' in player['skills']) and ('sadist' in player['skills'] or 'sadist_classic' in player['skills']):
                    player['skills'].append('bloodlust')
                    if not game['castlefight']:
                        try:
                            sendm(bot, player['id'],
                                             '–í—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - –∫—Ä–æ–≤–æ–∂–∞–¥–Ω–æ—Å—Ç—å! –®–∞–Ω—Å –ø–æ–ø–∞—Å—Ç—å –ø–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º, —É –∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω—å—à–µ –ø–æ–ª–æ–≤–∏–Ω—ã –•–ü, —É–≤–µ–ª–∏—á–µ–Ω.')
                        except:
                            pass
                if ('dvuzhil' in player['skills'] or 'dvuzhil_classic' in player['skills']) and ('cherep' in player['skills'] or 'cherep_classic' in player['skills']):
                    player['skills'].append('regeneration')
                    if not game['castlefight']:
                        try:
                            sendm(bot, player['id'],
                                             '–í—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è! –ü–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ –•–ü —É –≤–∞—Å –µ—Å—Ç—å —à–∞–Ω—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ.')
                        except:
                            pass
                if 'necromant' in player['skills'] and 'ritualist' in player['skills']:
                    player['skills'].append('warlock')
                    if not game['castlefight']:
                        try:
                            sendm(bot, player['id'],
                                             '–í—ã –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —á–µ—Ä–Ω–æ–∫–Ω–∏–∂–Ω–∏–∫! –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∫—Ç–æ-—Ç–æ –ø–æ–≥–∏–±–Ω–µ—Ç, –≤—ã –º–æ–∂–µ—Ç–µ –≤–∑–æ—Ä–≤–∞—Ç—å –µ–≥–æ —Ç—Ä—É–ø –∏ –Ω–∞–Ω–µ—Å—Ç–∏ 2 —É—Ä–æ–Ω–∞ –≤—Å–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º.')
                        except:
                            pass
                for idss in player['getbuffs2']:
                    if idss == 'accuracy':
                        player['weapon'].accuracybonus += 2
                    if idss == 'hp':
                        player['maxhp'] += 1
                        player['hp'] += 1
                    if idss == 'armor':
                        player['selfarmor'] += 1
                        player['dmglimit'] += 1
                        player['selfarmorchance'] = 50
                    if idss == 'energy':
                        player['maxenergy'] += 1
                        player['energy'] += 1
                    if idss == '+3shields':
                        for i in range(2):
                            player['inventory'].append('shield')
                        for i in range(1):
                            player['inventory'].append('adrenaline')
                            player['inventory'].append('flash')
                            player['weapon'].accuracybonus += 1

                for idss in player['getbuffs3']:
                    if idss == 'hypnotist':
                        player['skills'].append('hypnotist')
                    if idss == 'armor++':
                        player['selfarmor'] += 2
                        player['dmglimit'] += 2
                        player['selfarmorchance'] = 60
                    if idss == 'energy++':
                        player['maxenergy'] += 2
                        player['energy'] += 2
                if not game['castlefight'] and not game['neuralfight']:
                    if '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç' in player['name'] and player['controller'] == 'bot':
                        try:
                            time.sleep(2)
                            sendm(bot, game['id'],
                                             '–í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∞ —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–∂ –ø–æ–¥–∑–µ–º–µ–ª—å—è, –∏ –≤–∏–¥–∏—Ç–µ –∞—Ä–∫—É. –í–∏–¥–∏–º–æ, —Ç–∞–º –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å.')
                            time.sleep(3)
                            sendm(bot, game['id'],
                                             '–í–æ–π–¥—è –≤–Ω—É—Ç—Ä—å, –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç–µ –æ–≥—Ä–æ–º–Ω—ã–π, –º–µ—Å—Ç–∞–º–∏ –æ–±—Ä—É—à–∏–≤—à–∏–π—Å—è –∑–∞–ª, –≤–¥–æ–ª—å –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ—è—Ç –±–µ–ª—ã–µ –∫–æ–ª–æ–Ω–Ω—ã –∏–∑ –º—Ä–∞–º–æ—Ä–∞. ' +
                                             '–í –∫–æ–Ω—Ü–µ –∑–∞–ª–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω —Ç—Ä–æ–Ω, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –≤–æ—Å—Å–µ–¥–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫–æ–ø–æ–¥–æ–±–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ, –ª–∏—Ü–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ —Ä–∞–∑–≥–ª—è–¥–µ—Ç—å.')
                            time.sleep(5)
                            sendm(bot, game['id'],
                                             '–í—ã —Ä–µ—à–∞–µ—Ç–µ –ø–æ–¥–æ–π—Ç–∏ –±–ª–∏–∂–µ. –¢–µ–ø–µ—Ä—å –≤—ã –≤–∏–¥–∏—Ç–µ –¥–≤–∞ —è—Ä–∫–∏—Ö –æ–≥–Ω—è, –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è —Ç–∞–º, ' +
                                             '–≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≥–ª–∞–∑–∞ —Å—É—â–µ—Å—Ç–≤–∞. –í —Ä—É–∫–∞—Ö —É –Ω–µ–≥–æ - ' +
                                             '–ø–æ—Å–æ—Ö, –Ω–∞ –∫–æ–Ω—Ü–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–∏—Å–∏—Ç –ø–æ—Ç—Ä–µ—Å–∫–∞–≤—à–∏–π—Å—è —á–µ—Ä–µ–ø.')
                            time.sleep(5)
                            heroes = 0
                            for idss in game['players']:
                                if player['controller'] != 'bot':
                                    heroes += 1
                            if heroes > 1:
                                sendm(bot, game['id'],
                                                 'üí¨' + player['name'] + ': –ó—Ä—è –≤—ã –ø—Ä–∏—à–ª–∏ —Å—é–¥–∞, —Å–º–µ—Ä—Ç–Ω—ã–µ. –ù–æ —É–∂–µ ' + \
                                                 '—Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ –±–µ–∂–∞—Ç—å - —É–∑—Ä–∏—Ç–µ –∂–µ –º–æ—â—å –º–æ–∏—Ö —Å–∫–µ–ª–µ—Ç–æ–≤-–º—É—Ç–∞–Ω—Ç–æ–≤!')
                            else:
                                sendm(bot, game['id'],
                                                 'üí¨' + player['name'] + ': –ó—Ä—è —Ç—ã –ø—Ä–∏—à–µ–ª —Å—é–¥–∞, —Å–º–µ—Ä—Ç–Ω—ã–π. –ù–æ —É–∂–µ ' + \
                                                 '—Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ –±–µ–∂–∞—Ç—å - —É–∑—Ä–∏ –∂–µ –º–æ—â—å –º–æ–∏—Ö —Å–∫–µ–ª–µ—Ç–æ–≤-–º—É—Ç–∞–Ω—Ç–æ–≤!')
                        except:
                            sendm(bot, pasyuk_id, traceback.format_exc())

                    if player['is_radiodemon']:
                        try:
                            completedhell = True
                            for idss in game['players']:
                                target = game['players'][idss]
                                if target['controller'] == 'player':
                                    if not target['completed_hell']:
                                        completedhell = False
                            if game['simulate_first_run']:
                                completedhell = False
                            if not completedhell:
                                time.sleep(2)
                                sendm(bot, game['id'],
                                                 '–í—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ —Å–≤–æ–π –ø–æ—Ö–æ–¥ –ø–æ –∞–¥—É. –í –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –≤–∞–º–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫ –≤ –∫—Ä–∞—Å–Ω–æ–º –æ–¥–µ—è–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —É–ª—ã–±–∞—Ç—å—Å—è.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                                 'üí¨'+player['name'] + ': –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–æ—Ç –º—ã –∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å... –Ø –≤–∞—Å –Ω–µ –ø–æ–º–Ω—é, –¥–∞ —ç—Ç–æ —É–∂–µ –∏ –Ω–µ –≤–∞–∂–Ω–æ.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                                 'üí¨'+player['name'] + ': –í–µ—Å–µ–ª—å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!')
                                time.sleep(3)
                            else:
                                game['completed_hell'] = True
                                time.sleep(2)
                                sendm(bot, game['id'],
                                                 '–í—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ —Å–≤–æ–π –ø–æ—Ö–æ–¥ –ø–æ –∞–¥—É. –í –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –≤–∞–º–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫ –≤ –∫—Ä–∞—Å–Ω–æ–º –æ–¥–µ—è–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —É–ª—ã–±–∞—Ç—å—Å—è.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                                 'üí¨' + player[
                                                     'name'] + ': –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–æ—Ç –º—ã –∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å... –ü–æ–≥–æ–¥–∏—Ç–µ-–∫–∞, –∞ –≤–∞—Å —è –ø–æ–º–Ω—é! –í–∞–º —É–¥–∞–ª–æ—Å—å –≤—ã–∂–∏—Ç—å, —Å—Ä–∞–∂–∞—è—Å—å –°–û –ú–ù–û–ô!')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                                 'üí¨' + player['name'] + ': –ü–æ–∂–∞–ª—É–π, –≤ —ç—Ç–æ—Ç —Ä–∞–∑ —è –Ω–µ –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –ø—Ä–∏—ë–º—ã, –≤—Ä–æ–¥–µ –∑–∞—Ç—è–≥–∏–≤–∞–Ω–∏—è –≤–∞—à–∏—Ö –¥—É—à –ø—Ä—è–º–∏–∫–æ–º –≤ –≥–ª—É–±–∏–Ω—ã '+\
                                                 '–∞–¥–∞ –∏ –ø—Ä–æ—á–µ–µ... –ü–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ, –Ω–∞ —á—Ç–æ —Å–ø–æ—Å–æ–±–Ω—ã, –±–µ–∑ –≤–∞—à–∏—Ö –ø–æ—Å–æ—Ö–æ–≤, —Ç—ë–º–Ω—ã—Ö —ç–Ω–µ—Ä–≥–∏–π –∏ —Ä—ã–≤–∫–æ–≤!')
                                time.sleep(3)
                        except:
                            sendm(bot, pasyuk_id, traceback.format_exc())

                    if player['is_dark_boss']:
                        try:
                            time.sleep(2)
                            sendm(bot, game['id'],
                                             '–í—ã –≤—Ö–æ–¥–∏—Ç–µ –≤ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–Ω–∞—Ç—É –ø–æ–¥–∑–µ–º–µ–ª—å—è. –ò–∑-–∑–∞ –±–µ—Å–ø—Ä–æ—Å–≤–µ—Ç–Ω–æ–π —Ç—å–º—ã –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, ' + \
                                             '–≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å—Ç–µ–Ω—ã, –∏ –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤–æ–æ–±—â–µ.')
                            time.sleep(3)
                            sendm(bot, game['id'],
                                             '–°–ø—É—Å—Ç—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –≤—ã —Å–º–æ–≥–ª–∏ —Ä–∞–∑–ª–∏—á–∏—Ç—å –≥–ª–∞–∑, –∫–æ—Ç–æ—Ä—ã–π —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤–∞—Å –∏–∑ —Ç–µ–º–Ω–æ—Ç—ã.')
                            time.sleep(3)
                            sendm(bot, game['id'],
                                             '–ê –∑–∞—Ç–µ–º - –µ—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ. –ò –µ—â–µ. –í—Å—è –∫–æ–º–Ω–∞—Ç–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≤–∞—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ –≤–∏—Å—è—â–∏–º–∏' + \
                                             ' –≤ –≤–æ–∑–¥—É—Ö–µ –≥–ª–∞–∑–∞–º–∏. –ò –≤–∑–≥–ª—è–¥ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –≤ –≤–∞—à—É —Å—Ç–æ—Ä–æ–Ω—É.')
                            time.sleep(4)
                            sendm(bot, game['id'],
                                             '–í—ã –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç–µ—Å—å, –∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç–µ –ø–æ–∑–∞–¥–∏ —Å–µ–±—è –¥–≤–µ—Ä–∏. –ù–æ –±—ã–ª–∞ –ª–∏ –æ–Ω–∞ —Ç–∞–º? –í—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã.')
                            time.sleep(3)
                            sendm(bot, game['id'],
                                             '–í—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –∞—Ç–∞–∫–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –ø–∞—Ä—è—â–∏—Ö –≤ –≤–æ–∑–¥—É—Ö–µ –≥–ª–∞–∑, –Ω–æ –≤–∞—à–∏ –¥–∏–∂–µ–Ω–∏—è –æ–∫–∞–∑–∞–ª–∏—Å—å ' + \
                                             '—Å–ª–∏—à–∫–æ–º –∑–∞–º–µ–¥–ª–µ–Ω–Ω—ã. –ì–ª–∞–∑ –ª–µ–≥–∫–æ —É—Ö–æ–¥–∏—Ç –æ—Ç –∞—Ç–∞–∫–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≤–∞—Å... –°—Ç—Ä–∞—Ö –Ω–∞–ø–æ–ª–Ω—è–µ—Ç –≤–∞—Å.')
                            time.sleep(4)
                            sendm(bot, game['id'],
                                             '–¢—å–º–∞ –≤–æ–∫—Ä—É–≥ –Ω–µ–º–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∏–ª–∞, –∏ –≤—ã —É–≤–∏–¥–µ–ª–∏ –Ω–µ—á—Ç–æ, —á—Ç–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –Ω–∞–ø—É–≥–∞–ª–æ –≤–∞—Å. ' + \
                                             '–í—ã –¥–∞–∂–µ –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ, –Ω–æ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –Ω–∞–¥–æ –±–µ–∂–∞—Ç—å.')
                            time.sleep(4)
                            sendm(bot, game['id'],
                                             '–í—ã —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏—Å—å –∏ –ø–æ–±–µ–∂–∞–ª–∏ –ø–æ –ø—É—Å—Ç–æ–º—É –ø–æ–º–µ—â–µ–Ω–∏—é, –Ω–µ –≤–∏–¥—è –Ω–∏—á–µ–≥–æ –¥–∞–ª—å—à–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä—É–∫–∏. ' + \
                                             '–í—ã —Å–ª—ã—à–∏—Ç–µ, –∫–∞–∫ –Ω–µ—á—Ç–æ –±–µ–∂–∏—Ç –∑–∞ –≤–∞–º–∏. –ö–∞–∂–µ—Ç—Å—è, –æ–Ω–æ –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç—å –¥–æ –≤–∞—Å —Å–≤–æ–µ–π –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å—é...')
                            time.sleep(4)
                            for idss in game['players']:
                                target = game['players'][idss]
                                if target['controller'] == 'player' and target['team'] != player['team']:
                                    target['darkness_sleep'] = True

                        except:
                            sendm(bot, pasyuk_id, traceback.format_exc())
                    if player['is_knight'] and not knight_talk and game["dungeon"]:
                        knight_talk = True
                        try:
                            time.sleep(2)
                            sendm(bot, game['id'],
                                             '–í—ã –≤—ã—Ö–æ–¥–∏—Ç–µ –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ä–Ω—É—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –∑–∞–º–∫–∞.')
                            time.sleep(2)
                            sendm(bot, game['id'],
                                  '–í–∞—Å –æ–∫—Ä—É–∂–∞—é—Ç –≤—ã—Å–æ–∫–∏–µ –±–∞—à–Ω–∏ –∏ —Å—Ç–µ–Ω—ã.')
                            time.sleep(3)
                            sendm(bot, game['id'],
                                             '...–ù–æ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–∏—à–µ–ª.')

                            time.sleep(2)
                            sendm(bot, game['id'],
                                  '–í—ã –æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏ –ø—É—Å—Ç–æ–≥–æ –∑–∞–º–∫–∞, –∫–∞–∫ –≤–¥—Ä—É–≥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–æ–º–Ω–∞—Ç—ã –ø–æ—Å–ª—ã—à–∞–ª–∏—Å—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –∑–≤—É–∫–∏.')

                            time.sleep(3)
                            sendm(bot, game['id'],
                                  '–°–ø—É—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –≤–∞–º–∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä—ã—Ü–∞—Ä—å –≤ –∂–µ–ª–µ–∑–Ω—ã—Ö –¥–æ—Å–ø–µ—Ö–∞—Ö.')
                            time.sleep(2)
                            year = datetime.now().year
                            sendm(bot, game['id'],
                                  'üí¨' + player[
                                      "name"] + ': –¢—ã –ø—Ä–æ—à–µ–ª —á–µ—Ä–µ–∑ –º–æ–µ–≥–æ –º–∏–Ω–∏-–Ω–æ—Å–æ—Ä–æ–≥–∞... –ù–µ—É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ. –í–∏–¥–µ–ª –≤–æ–æ–±—â–µ —Ü–µ–Ω—ã –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –Ω–æ—Å–æ—Ä–æ–≥–æ–≤? '+str(year)+" –Ω–∞ –¥–≤–æ—Ä–µ...")
                            time.sleep(3)
                            sendm(bot, game['id'],
                                  'üí¨'+player["name"]+': –ù–æ –Ω–µ –∫–∞–∂–¥–æ–º—É –ø–æ–¥ —Å–∏–ª—É –æ–¥–æ–ª–µ—Ç—å –º–µ–Ω—è –≤ —Ñ–æ—Ä–º–µ –¥—Ä–∞–∫–æ–Ω–∞. –¢–µ–ø–µ—Ä—å —Å—Ä–∞–∑–∏—Å—å —Å–æ –º–Ω–æ–π –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º –æ–±–ª–∏—á—å–µ!')
                            time.sleep(3)
                            if player["weapon"].name == "–ü–æ—Å–æ—Ö –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞":
                                sendm(bot, game['id'],
                                      '–û–Ω –¥–æ—Å—Ç–∞–ª —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ –∏ –ø–æ–∫—Ä—É—Ç–∏–ª –≤ —Ä—É–∫–∞—Ö.')
                                time.sleep(2)
                                sendm(bot, game['id'],
                                      'üí¨' + player[
                                          "name"] + ': –Ø —Ç—É—Ç –Ω–µ–¥–∞–≤–Ω–æ –ø—Ä–æ—à–µ–ª –¥–∞–Ω–∂ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞. –ù–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è –∏—Å–ø—ã—Ç–∞—Ç—å –ø–æ—Å–æ—Ö –≤ –±–æ—é...')
                                time.sleep(3)
                            if player["weapon"].name == "–≠–ª–µ–∫—Ç—Ä–æ—à–æ–∫–µ—Ä":
                                sendm(bot, game['id'],
                                      '–û–Ω –¥–æ—Å—Ç–∞–ª —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ –∏ –ø–æ–∫—Ä—É—Ç–∏–ª –≤ —Ä—É–∫–∞—Ö.')
                                time.sleep(2)
                                sendm(bot, game['id'],
                                      'üí¨' + player[
                                          "name"] + ': –ë—Ä–æ–¥–∏–ª –ø–æ –¥–∞–≤–Ω–æ –∑–∞–±—ã—Ç—ã–º –ø–æ–ª—è–º –±–∏—Ç–≤, –∏ –Ω–∞—à–µ–ª –≤–æ—Ç —Ç–∞–∫–æ–µ –æ—Ä—É–∂–∏–µ. –ù–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è –∏—Å–ø—ã—Ç–∞—Ç—å –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.')
                                time.sleep(3)
                            if player["weapon"].name == "–õ—É–∫ –ê—Å–≥–∞—Ä–¥":
                                sendm(bot, game['id'],
                                      '–û–Ω –¥–æ—Å—Ç–∞–ª —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ –∏ –ø–æ–∫—Ä—É—Ç–∏–ª –≤ —Ä—É–∫–∞—Ö.')
                                time.sleep(2)
                                sendm(bot, game['id'],
                                      'üí¨' + player[
                                          "name"] + ': –ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ª—É–∫–∞, –ø–æ–¥—Å–º–æ—Ç—Ä–µ–ª –µ—ë —É –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞. –ï—Å–ª–∏ —Ö–æ—Ä–æ—à–æ –Ω–∞—Ç—è–Ω—É—Ç—å - –±—å–µ—Ç –±–æ–ª—å–Ω–æ...')
                                time.sleep(3)
                            if player["weapon"].name == "–ö–∞—Ç–∞–Ω–∞":
                                sendm(bot, game['id'],
                                      '–û–Ω –¥–æ—Å—Ç–∞–ª —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ –∏ –ø–æ–∫—Ä—É—Ç–∏–ª –≤ —Ä—É–∫–∞—Ö.')
                                time.sleep(2)
                                sendm(bot, game['id'],
                                      'üí¨' + player[
                                          "name"] + ': –ü–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞–ª—Å—è –Ω–∞ —Ä–∞–∑–±–æ–π–Ω–∏–∫–∞—Ö —Å —ç—Ç–æ–π —à—Ç—É–∫–æ–π. –û–Ω–∏ —Ç–∞–∫ –∏ –Ω–µ –ø–æ–Ω—è–ª–∏, –ø–æ—á–µ–º—É —â–∏—Ç –∏—Ö –Ω–µ —Å–ø–∞—Å.')
                                time.sleep(3)
                            if player["weapon"].name == "–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª":
                                sendm(bot, game['id'],
                                      '–û–Ω –¥–æ—Å—Ç–∞–ª —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ –∏ –ø–æ–∫—Ä—É—Ç–∏–ª –≤ —Ä—É–∫–∞—Ö.')
                                time.sleep(2)
                                sendm(bot, game['id'],
                                      'üí¨' + player[
                                          "name"] + ': –•–æ–¥—è—Ç —Å–ª—É—Ö–∏, —á—Ç–æ —Ä–∞–Ω—å—à–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –º–∞—Ç–µ—Ä–∏–∞–ª, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫ —ç—Ç–æ–≥–æ –∫–æ–ø—å—è –¥–µ–ª–∞–ª–∏ –µ—â–µ –±–æ–ª–µ–µ —Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω—ã–º... –ù–æ –Ω—ã–Ω–µ—à–Ω—è—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∂–µ —Ö–æ—Ä–æ—à–∞.')
                                time.sleep(3)


                        except:
                            sendm(bot, pasyuk_id, traceback.format_exc())

            if game['dungeon'] and game['dungeon_type'] == 'hell' and game['dungeonlvl'] == 2:
                for ids in game['players']:
                    target = game['players'][ids]
                    setfire(game, target, target, 12)
                game['text'] += 'üìú|–ü–æ –∞–¥—É —ç—Ö–æ–º —Ä–∞–∑–¥–∞–µ—Ç—Å—è –≥–æ–ª–æ—Å, –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏–π –Ω–∞ –∑–≤—É–∫ —Ä–∞–¥–∏–æ:\n'
                game['text'] += 'üí¨‚ùì‚ùì: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π –≤ –∞–¥—É! –•–æ–ª–æ–¥–Ω–æ–≤–∞—Ç–æ –∑–¥–µ—Å—å, –Ω–µ –ø—Ä–∞–≤–¥–∞ –ª–∏? –ü–æ—Ä–∞ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å!\n'
                game['text'] += 'üìú|–û–≥–Ω–µ–Ω–Ω—ã–π –≤–∏—Ö—Ä—å –ø—Ä–æ–Ω–æ—Å–∏—Ç—Å—è –ø–æ –ø–æ–ª—é –±–∏—Ç–≤—ã, –ø–æ–¥–∂–∏–≥–∞—è –≤—Å–µ, —á—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç —É —Å–µ–±—è –Ω–∞ –ø—É—Ç–∏.\n'

        if game['gl']:
            gl = []
            for ids in game['players']:
                player = game['players'][ids]
                if 'gurren' in player['skills'] or 'lagann' in player['skills']:
                    gl.append(player)
            if len(gl) == 2:
                p1 = gl[0]
                p2 = gl[1]
                sendm(bot, game['id'], '–ú—É–∂—Å–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ, –ì—É—Ä—Ä–µ–Ω-–õ–∞–≥–∞–Ω–Ω ' + p1['name'] + ' –∏ ' + p2[
                    'name'] + ' –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ –ø–æ–ª–µ –±–æ—è!')

        for ids in game['players']:
            player = game['players'][ids]
            if 'berserk' in player['skills'] or 'berserk?1' in player['skills'] or 'berserk?2' in player[
                'skills'] or 'berserk?3' in player['skills']:
                digit = 4 - player['maxhp']
                player['maxenergy'] = 3 + digit + (player['maxhp'] - player['hp'])
                if player['maxenergy'] < 1:
                    player['maxenergy'] = 1
                if 'protivogaz' in player['skills']:
                    player['maxenergy'] += 1
                player['maxenergy'] -= player['electrolostenergy']
                if player['energy'] > player['maxenergy']:
                    player['energy'] = player['maxenergy']
            if ('inzhener' in player['skills'] or 'inzhener?1' in player['skills'] or 'inzhener?2' in player[
                'skills'] or 'inzhener?3' in player['skills']):
                player['inzheneritems'] = []
                givei = 2
                if 'inzhener?2' in player['skills'] or 'inzhener?3' in player['skills'] or 'inzhener' in player[
                    'skills']:
                    givei = 3
                while len(player['inzheneritems']) < givei:
                    x = random.choice(items)
                    while x in player['inzheneritems']:
                        x = random.choice(items)
                    player['inzheneritems'].append(x)
            if not game['providets']:
                if player['dead'] or player['stun'] > 0:
                    player['ready'] = True
                    player['stage'] = None
                    player['bulavabonus'] = 0
                    player['lasttarget'] = None
            else:
                if player['dead'] or player['stun'] > 0 or not player['providets']:
                    player['ready'] = True
                    player['stage'] = None
        for ids in game['players']:
            player = game['players'][ids]
            if not game['providets']:
                if player['controllable_necrofighter'] != None:
                    player['act'] = ['control_necrofighter', 'self']
                    player['ready'] = True
                    player['stage'] = None
                    continue
                if not player['dead'] and player['stun'] <= 0 and player['meditation'] == None:
                    if player['attack_self']:
                        player['attack_self'] = False
                        player['ready'] = True
                        player['stage'] = None
                        player['act'] = ['attack', player['id']]
                    else:
                        if not player['suicide']:
                            player['ready'] = False
                            player['stage'] = 'turn'
                        if ('vor?3' in player['skills']) and random.randint(1, 100) <= 20:
                            player['passivevor'] = True
                        if player['controller'] == 'player' or player['master'] != None:
                            kb = getfightkb(game, player)
                            text = getplayertext(game, player)
                            try:
                                if player['master'] != None:
                                    if game['players'][player['master']]['stun'] <= 0:
                                        if game['players'][player['master']]["controller"] != "bot":
                                            msg = sendm(bot, player['master'], text, reply_markup=kb)
                                            player['msg'] = msg
                                        else:
                                            npcact(game, player)
                                            player['ready'] = True
                                            player['stage'] = None
                                    else:
                                        player['act'] = ['skip', 'self']
                                        player['ready'] = True
                                        player['stage'] = None
                                else:
                                    if player['controllable_necrofighter'] == None:
                                        if player['EXPLOSION'] == None:
                                            # print(player['id'])
                                            # print(bot)
                                            msg = sendm(bot, player['id'], text, reply_markup=kb)
                                            player['msg'] = msg
                                        else:
                                            player['act'] = ['EXPLOSION2', player['EXPLOSION']]
                                            player['ready'] = True
                                            player['stage'] = None
                                    else:
                                        player['act'] = ['control_necrofighter', 'self']
                                        player['ready'] = True
                                        player['stage'] = None
                            except:
                                sendm(bot, pasyuk_id, traceback.format_exc())

                        else:
                            if not game['castlefight']:
                                if player['is_necromant']:
                                    npcact_necromant(game, player)
                                    player['ready'] = True
                                    player['stage'] = None
                                elif player['is_dark_boss']:
                                    npcact_darkness(game, player)
                                    player['ready'] = True
                                    player['stage'] = None
                                elif player['is_radiodemon']:
                                    npcact_radiodemon(game, player)
                                    player['ready'] = True
                                    player['stage'] = None
                                else:
                                    if game['pureduel_rats']:
                                        if game['neuralfight']:
                                            npcact_fullneural(game, player)
                                        elif game['pureduel_rats_hard']:
                                            npcact_fullneural(game, player)
                                        else:
                                            npcact_duel(game, player)
                                    else:
                                        if player["EXPLOSION"] != None:
                                            player['act'] = ['EXPLOSION2', player['EXPLOSION']]
                                            player['ready'] = True
                                            player['stage'] = None
                                        else:
                                            if player['burrowtarget'] == None:
                                                npcact(game, player)
                                            else:
                                                player['act'] = ['burrow2', player['burrowtarget']]
                                                player['ready'] = True
                                                player['stage'] = None
                                    if player['master'] == None:
                                        player['ready'] = True
                                        player['stage'] = None
                            else:
                                if player['darkcastle_demon']:
                                    npcact_darkdemon(game, player)
                                else:
                                    npcact(game, player)
                                player['ready'] = True
                                player['stage'] = None
            else:
                if player['EXPLOSION'] != None:
                    player['EXPLOSION'] = None
                if not player['dead'] and player['stun'] <= 0 and player['providets']:
                    if not player['suicide']:
                        player['ready'] = False
                        player['stage'] = 'turn'
                    player['dopuseditems'] = []
                    player['createillusion'] = False
                    player['demonform'] = False
                    kb = getfightkb(game, player)
                    text = getplayertext(game, player)
                    msg = sendm(bot, player['id'], text, reply_markup=kb)
                    player['msg'] = msg
        if not game['providets']:
            secs = 120
        else:
            secs = 90
        game['stage'] = 'turn'
        if not game['castlefight'] and not game['neuralfight']:
            # t = threading.Timer(secs, end_turn, args = [game, bot])
            # t.start()
            # game['timer'] = t
            # game['alltimers'].append(t)
            game['turntimer'] = time.time()
        else:
            end_turn(game)
    except:
        sendm(bot, pasyuk_id, traceback.format_exc())


def fightact(call, bot=bot):
    game = int(call.data.split('?')[1])
    act = call.data.split('?')[2]
    if bot == cwbot:
        try:
            game = cwgames[game]
        except:
            return
    else:
        try:
            game = games[game]
        except:
            return
    if call.from_user.id not in game['players']:
        return
    player = game['players'][call.from_user.id]
    if player['controllable_necrofighter'] != None:
        player = game['players'][player['controllable_necrofighter']]
    if player["msg"] == None or player["msg"].message_id != call.message.message_id:
        return
    if player['stage'] != 'turn':
        return
    seetext = None
    if act == 'attackselect':
        sniper = False
        if player['weapon'].name == '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞':
            sniper = True
        kb = gettargetkb(game, player, 'attack', 'enemy', sniper)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –∞—Ç–∞–∫–∏:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'attack':
        target = int(call.data.split('?')[3])
        player['act'] = ['attack', target]
        targetname = game['players'][target]['name']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∞—Ç–∞–∫–∞ ' + targetname
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'lastchance':
        player['act'] = ['lastchance', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–¥–∞—Ä'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'die':
        player['act'] = ['die', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —É–º–µ—Ä–µ—Ç—å'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'perekat_right':
        player['act'] = ['perekat_right', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —É–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤–ø—Ä–∞–≤–æ.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'perekat_left':
        player['act'] = ['perekat_left', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —É–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤–ª–µ–≤–æ.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'sokrush':
        target = int(call.data.split('?')[3])
        player['act'] = ['sokrush', target]
        targetname = game['players'][target]['name']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Å–æ–∫—Ä—É—à–µ–Ω–∏–µ ' + targetname
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'chain':
        target = int(call.data.split('?')[3])
        player['act'] = ['chain', target]
        targetname = game['players'][target]['name']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤—ã–±–∏—Ç—å –æ—Ä—É–∂–∏–µ —É ' + targetname
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'strongshot':
        target = int(call.data.split('?')[3])
        player['act'] = ['strongshot', target]
        targetname = game['players'][target]['name']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –º–æ—â–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª –≤ ' + targetname
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'narsil':
        target = int(call.data.split('?')[3])
        player['act'] = ['narsil', target]
        targetname = game['players'][target]['name']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –º–µ—Ç–Ω—É—Ç—å –∫–æ–ø—å–µ –≤ ' + targetname
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'counterattack':
        player['act'] = ['counterattack', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'wing_attack':
        player['act'] = ['wing_attack', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤–∑–º–∞—Ö –∫—Ä—ã–ª—å—è–º–∏'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'pricel':
        target = int(call.data.split('?')[3])
        player['act'] = ['pricel', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø—Ä–∏—Ü–µ–ª –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'hide_in_door':
        player['act'] = ['hide_in_door', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤—ã–±–µ–∂–∞—Ç—å –∏–∑ –∫–æ–º–Ω–∞—Ç—ã'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'reload':
        player['act'] = ['reload', 'self']
        if 'robot' not in player['skills']:
            seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞.'
        else:
            seetext = '–í—ã–±—Ä–∞–Ω–æ: –æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'perekat':
        if player['perekatcd'] > 0:
            bot.answer_callback_query(call.id, '–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞!')
            return
        player['act'] = ['perekat', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–µ—Ä–µ–∫–∞—Ç.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'grenadeselect':
        kb = getgrenadeselect(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä–∞–Ω–∞—Ç—É –¥–ª—è –≥—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'shurikenamount':
        kb = getshurikenselect(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—é—Ä–∏–∫–µ–Ω–æ–≤ –¥–ª—è –±—Ä–æ—Å–∫–∞:', call.message.chat.id, call.message.message_id,
              reply_markup=kb, bot=bot)
    elif act == 'multicastselect':
        kb = getmulticastselect(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ –º–Ω–æ–∂–∏—Ç–µ–ª—å –º—É–ª—å—Ç–∏–∫–∞—Å—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'minetimerselect':
        kb = getminetimerselect(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ, —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ —Ö–æ–¥–æ–≤ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –≤–∑—Ä—ã–≤:', call.message.chat.id, call.message.message_id,
              reply_markup=kb, bot=bot)
    elif act == 'inzhenerselect':
        kb = getinzhenerselect(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'EXPLOSIONselect':
        kb = gettargetkb(game, player, 'EXPLOSION', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –ú–ê–ì–ò–ò –í–ó–†–´–í–ê:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'selectg':
        grenade = call.data.split('?')[3]
        player['grenade'] = grenade
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–∞ –≥—Ä–∞–Ω–∞—Ç–∞ –¥–ª—è –≥—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç–∞: ' + getname(grenade)+"\n\n"+text, call.message.chat.id, call.message.message_id,
              bot=bot, reply_markup=kb)
    elif act == 'tame_rat':
        player['used_rat_toy'] = True
        player['have_rat_toy'] = False
        medit('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: –∏–≥—Ä—É—à–∫–∞ –¥–ª—è –∫—Ä—ã—Å. –ï—Å–ª–∏ –≤—ã –ø–æ–±–µ–¥–∏—Ç–µ –∫—Ä—ã—Å—É - –≤—ã –ø—Ä–∏—Ä—É—á–∏—Ç–µ –µ—ë.', call.message.chat.id, call.message.message_id, bot=bot)
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        msg = sendm(bot, player['id'], text, reply_markup=kb)
        player['msg'] = msg

    elif act == 'inzhener':
        item = call.data.split('?')[3]
        player['act'] = ['inzhener', item]
        medit('–í—ã–±—Ä–∞–Ω –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è: ' + getname(item), call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'setshurikenamount':
        amount = int(call.data.split('?')[3])
        player['shurikenstothrow'] = amount
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: ' + str(amount) + ' —Å—é—Ä–∏–∫–µ–Ω(–∞)\n\n'+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup=kb)
    elif act == 'setmulticast':
        amount = int(call.data.split('?')[3])
        player['multicast'] = int(amount)
        #medit('–í—ã–±—Ä–∞–Ω–æ: –º—É–ª—å—Ç–∏–∫–∞—Å—Ç —Ö' + str(amount), call.message.chat.id, call.message.message_id, bot=bot)
        player['multicastcd'] = 1
        game['text'] += 'üëÅ|' + player['name'] + ' –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–Ω–µ—Å—Ç–∏ ' + str(
            player['multicast']) + ' —É–¥–∞—Ä(–∞)!\n'
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: –º—É–ª—å—Ç–∏–∫–∞—Å—Ç —Ö' + str(amount)+"\n\n"+text, call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
        #msg = sendm(bot, player['id'], text, reply_markup=kb)
        #player['msg'] = msg
    elif act == 'setminetimer':
        amount = call.data.split('?')[3]
        medit('–í—ã–±—Ä–∞–Ω–æ: –º–∏–Ω–∞ –Ω–∞ ' + str(amount) + ' —Ö–æ–¥(–∞)', call.message.chat.id, call.message.message_id, bot=bot)
        player['act'] = ['setmine', amount]
        player['ready'] = True
        player['stage'] = None
    elif act == 'skip':
        player['act'] = ['skip', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'walk':
        player['act'] = ['walk', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ–¥–æ–π—Ç–∏.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'pickupweapon':
        player['act'] = ['pickupweapon', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ–¥–Ω—è—Ç—å –æ—Ä—É–∂–∏–µ.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'chargebow':
        player['act'] = ['chargebow', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –Ω–∞—Ç—è–Ω—É—Ç—å —Ç–µ—Ç–∏–≤—É.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'eugenwin':
        player['act'] = ['eugenwin', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–∏–≤–Ω–∞—è –ø–æ–±–µ–¥–∞.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'mainmenu':
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        player['selectedelements'] = []
        medit(text, call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'addition':
        kb = getadditionkb(game, player)
        text = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç.'
        medit(text, call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'shieldgenselect':
        kb = gettargetkb(game, player, 'shieldgen', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —â–∏—Ç–∞ (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä):', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'navodselect':
        kb = gettargetkb(game, player, 'navod', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –Ω–∞–≤–æ–¥—á–∏–∫–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'vorselect':
        kb = gettargetkb(game, player, 'vor', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –∫—Ä–∞–∂–∏ –ø—Ä–µ–¥–º–µ—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'visorselect':
        kb = gettargetkb(game, player, 'visor', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –≤–∏–∑–æ—Ä–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'parryselect':
        kb = gettargetkb(game, player, 'parry', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'ritualselect':
        kb = gettargetkb(game, player, 'ritual', 'all')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Ä–∏—Ç—É–∞–ª–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'lightingselect':
        kb = gettargetkb(game, player, 'lighting', 'all')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –º–æ–ª–Ω–∏–∏:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'shieldselect':
        kb = gettargetkb(game, player, 'shield', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —â–∏—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'hypnotistselect':
        kb = gettargetkb(game, player, 'hypnotist', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –≥–∏–ø–Ω–æ–∑–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'blowselect':
        kb = gettargetkb(game, player, 'blow', 'notblowndead')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä—É–ø –¥–ª—è –≤–∑—Ä—ã–≤–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'flashselect':
        kb = gettargetkb(game, player, 'flash', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Å–≤–µ—Ç–æ–≤–æ–π –≥—Ä–∞–Ω–∞—Ç—ã:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'zombieupselect':
        kb = gettargetkb(game, player, 'zombieup', 'deadally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –∑–æ–º–±–∏:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'knifeselect':
        kb = gettargetkb(game, player, 'knife', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –º–µ—Ç–∞—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–∂–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'isaevselect':
        kb = gettargetkb(game, player, 'isaev', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –ò—Å–∞–µ–≤–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'stimulatorselect':
        kb = gettargetkb(game, player, 'stimulator', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'madpotionselect':
        kb = gettargetkb(game, player, 'madpotion', 'all')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Å—ã–≤–æ—Ä–æ—Ç–∫–∏ –±–µ—à–µ–Ω—Å–≤–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'adrenalineselect':
        kb = gettargetkb(game, player, 'adrenaline', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'dzetselect':
        kb = gettargetkb(game, player, 'dzet', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –¥–∂–µ—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'hitinselect':
        if game['classic_game']:
            kb = gettargetkb(game, player, 'hitin', 'ally')
        else:
            kb = gettargetkb(game, player, 'hitin', 'all')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Ö–∏—Ç–∏–Ω–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'incvizitorselect':
        kb = gettargetkb(game, player, 'incvizitor', 'all')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –≤–∑–æ—Ä–∞ –Ω–µ–±–µ—Å:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'pyrotechselect':
        kb = gettargetkb(game, player, 'pyrotech', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –±–æ–º–±—ã:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'watershieldselect':
        kb = gettargetkb(game, player, 'watershield', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –≤–æ–¥—è–Ω–æ–≥–æ —â–∏—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'doomselect':
        kb = gettargetkb(game, player, 'doom', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è DOOM:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'meditationselect':
        kb = meditationselect(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–µ–¥–∏—Ç–∞—Ü–∏–∏:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'skeletonfireselect':
        kb = gettargetkb(game, player, 'skeletonfire', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –∞–¥—Å–∫–æ–≥–æ –æ–≥–Ω—è:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'batselect':
        kb = gettargetkb(game, player, 'bat', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –ª–µ—Ç—É—á–µ–π –º—ã—à–∏:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'energydrainselect':
        kb = gettargetkb(game, player, 'energydrain', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å, —á—Ç–æ–±—ã –≤—ã–ø–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'chargeselect':
        kb = gettargetkb(game, player, 'charge', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Ä—ã–≤–∫–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'dragon_fireballselect':
        kb = gettargetkb(game, player, 'dragon_fireball', 'enemy', only_far=True)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ —à–∞—Ä–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'hitdownselect':
        kb = gettargetkb(game, player, 'hitdown', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —Å–±–∏—Ç–∏—è —Å –Ω–æ–≥:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'priestselect':
        kb = gettargetkb(game, player, 'priest', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –æ—Å–≤—è—â–µ–Ω–∏—è –æ—Ä—É–∂–∏—è:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'bintselect':
        kb = gettargetkb(game, player, 'bint', 'ally')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –±–∏–Ω—Ç–∞:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'liramelodyselect':
        kb = getlirakb(game, player)
        medit('–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–ª–æ–¥–∏—é:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'dark_energyselect':
        kb = gettargetkb(game, player, 'dark_energy', 'all')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ —Ç—å–º—ã:', call.message.chat.id, call.message.message_id, reply_markup=kb,
              bot=bot)
    elif act == 'demonselect':
        kb = gettargetkb(game, player, 'demon', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –∫—Ä–∞–∂–∏ –∂–∏–∑–Ω–∏:', call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
    elif act == 'elementmenu':
        kb = getspellselect(game, player)
        medit(
            '–íÃ¥Õ°ÕúÃáÃêÃûÃü—ãÃ∂Õ†Ã°ÕÑÃôÃ∞Ãü–±“âÃïÕúÕÅÃóÃ±Õö–µÃ¥ÃïÃ¢ÕóÃ†—ÄÃ¥“áÃ¢ÃÜÃ±Ã¨Ã±–∏“âÃõÃ®ÃÉÃãÃ†Ã©—ÇÃ∏ÃõÃ®ÃÜÃ´Ã±ÃÆ–µÃ∂ÃïÕ¢ÕêÕÉÃú —çÃ∑ÃõÃ¢ÕÜÃîÃ≥ÕéÃ¶–ªÃ∂Õ†Õ¢ÃâÕâÕîÕá–µÃ∂Õ†Ã°ÃâÃçÃ™–ºÃ∑Õ†Ã°ÕõÕâ–µ“àÕ†Ã¢ÕÜÃìÃûÕö–Ω“âÕùÃ°ÃøÃ≥Ãù—ÇÃ∂“áÃßÃöÕÄÃò—ãÃ∏ÕûÃ¢ÃçÃ†Õâ:Ã¥ÕùÕúÃÉÕóÃú',
            call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)

    elif act == 'meditationstoikost':
        # player['act'] = ['meditation', 'self']
        player['domeditation'] = True
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –º–µ–¥–∏—Ç–∞—Ü–∏—è - —Å—Ç–æ–π–∫–æ—Å—Ç—å'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        if player['master'] == None:
            msg = sendm(bot, player['id'], text, reply_markup=kb)
        else:
            msg = sendm(bot, player['master'], text, reply_markup=kb)
        player['msg'] = msg
    elif act == 'meditationconcselect':
        kb = gettargetkb(game, player, 'meditationconc', 'enemy')
        medit('–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –¥–ª—è –º–µ–¥–∏—Ç–∞—Ü–∏–∏ - –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è:', call.message.chat.id, call.message.message_id,
              reply_markup=kb, bot=bot)
    elif act == 'energydrain':
        target = int(call.data.split('?')[3])
        player['act'] = ['energydrain', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤—ã–ø–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é –∏–∑ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'EXPLOSION':
        target = int(call.data.split('?')[3])
        player['act'] = ['EXPLOSION', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –í–ó–†–´–í –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'doom':
        target = int(call.data.split('?')[3])
        player['act'] = ['doom', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: DOOM –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'charge':
        target = int(call.data.split('?')[3])
        player['act'] = ['charge', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Ä—ã–≤–æ–∫ –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'dragon_fireball':
        target = int(call.data.split('?')[3])
        player['act'] = ['dragon_fireball', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'hellfire':
        player['act'] = ['hellfire', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∞–¥—Å–∫–æ–µ –ø–ª–∞–º—è'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'meditationconc':
        target = int(call.data.split('?')[3])
        # player['act'] = ['meditation', target]
        player['domeditation'] = True
        player['meditationtarget'] = target
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –º–µ–¥–∏—Ç–∞—Ü–∏—è - –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        if player['master'] == None:
            msg = sendm(bot, player['id'], text, reply_markup=kb)
        else:
            msg = sendm(bot, player['master'], text, reply_markup=kb)
        player['msg'] = msg
    elif act == 'bicepc':
        player['bicepc'] = True
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –±–∏—Ü–µ–ø—Å'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        if player['master'] == None:
            msg = sendm(bot, player['id'], text, reply_markup=kb)
        else:
            msg = sendm(bot, player['master'], text, reply_markup=kb)
        player['msg'] = msg
    elif act == 'shieldgen':
        target = int(call.data.split('?')[3])
        player['act'] = ['shieldgen', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —â–∏—Ç|–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'skeletonfire':
        target = int(call.data.split('?')[3])
        player['act'] = ['skeletonfire', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∞–¥—Å–∫–∏–π –æ–≥–æ–Ω—å –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'bat':
        target = int(call.data.split('?')[3])
        player['bat'] = target
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ª–µ—Ç—É—á–∞—è –º—ã—à—å –Ω–∞ ' + game['players'][target]['name']
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit(seetext+"\n\n"+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup=kb)
        #if player['master'] == None:
        #    msg = sendm(bot, player['id'], text, reply_markup=kb)
        #else:
        #    msg = sendm(bot, player['master'], text, reply_markup=kb)
        #player['msg'] = msg
    elif act == 'vor':
        target = int(call.data.split('?')[3])
        player['act'] = ['vor', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —É–∫—Ä–∞—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç —É ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'ritual':
        target = int(call.data.split('?')[3])
        player['act'] = ['ritual', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Ä–∏—Ç—É–∞–ª –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'blow':
        target = int(call.data.split('?')[3])
        player['act'] = ['blow', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤–∑—Ä—ã–≤ —Ç—Ä—É–ø–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'lighting':
        target = int(call.data.split('?')[3])
        player['act'] = ['lighting', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –º–æ–ª–Ω–∏—è –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'isaev':
        target = int(call.data.split('?')[3])
        player['act'] = ['isaev', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ò—Å–∞–µ–≤ –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'shield':
        target = int(call.data.split('?')[3])
        player['act'] = ['shield', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —â–∏—Ç –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'navod':
        target = int(call.data.split('?')[3])
        player['act'] = ['navod', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –Ω–∞–≤–æ–¥—á–∏–∫ –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'hypnotist':
        target = int(call.data.split('?')[3])
        player['act'] = ['hypnotist', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≥–∏–ø–Ω–æ–∑ –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'flash':
        target = int(call.data.split('?')[3])
        player['act'] = ['flash', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Å–≤–µ—Ç–æ–≤–∞—è –≥—Ä–∞–Ω–∞—Ç–∞ –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'knife':
        target = int(call.data.split('?')[3])
        player['act'] = ['knife', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'stimulator':
        target = int(call.data.split('?')[3])
        player['act'] = ['stimulator', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'grenade':
        player['act'] = ['grenade', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≥—Ä–∞–Ω–∞—Ç–∞'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'molotov':
        player['act'] = ['molotov', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∫–æ–∫—Ç–µ–π–ª—å –ú–æ–ª–æ—Ç–æ–≤–∞'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'adrenaline':
        player['adrenaline'] = True
        target = game['players'][int(call.data.split('?')[3])]
        player['dopuseditems'].append(['adrenaline', target['id']])
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω –Ω–∞ ' + target['name']+"\n\n"+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup = kb)
        #if player['master'] == None:
        #    msg = sendm(bot, player['id'], text, reply_markup=kb)
        #else:
        #    msg = sendm(bot, player['master'], text, reply_markup=kb)
        #player['msg'] = msg
    elif act == 'illusion':
        player['createillusion'] = True
        medit('–í—ã–±—Ä–∞–Ω–æ: —Å–æ–∑–¥–∞—Ç—å –∏–ª–ª—é–∑–∏—é', call.message.chat.id, call.message.message_id, bot=bot)
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        if player['master'] == None:
            msg = sendm(bot, player['id'], text, reply_markup=kb)
        else:
            msg = sendm(bot, player['master'], text, reply_markup=kb)
        player['msg'] = msg
    elif act == 'changeweapon':
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: —Å–º–µ–Ω–∞ –æ—Ä—É–∂–∏—è –Ω–∞ ' + player['secondweapon'].name+"\n\n"+text, call.message.chat.id, call.message.message_id,
              bot=bot, reply_markup = kb)
        game['text'] += 'üòè|' + player['name'] + ' –¥–æ—Å—Ç–∞—ë—Ç ' + player['secondweapon'].name + '!\n'
        x = player['secondweapon']
        player['secondweapon'] = player['weapon']
        player['weapon'] = x
        player['changeweaponcd'] = 1
       
    elif act == 'clawson':
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: –≤—ã–¥–≤–∏–Ω—É—Ç—å –∫–æ–≥—Ç–∏\n\n'+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup=kb)
        game['text'] += '‚öôÔ∏è|' + player['name'] + ' –≤—ã–¥–≤–∏–≥–∞–µ—Ç –∫–æ–≥—Ç–∏!\n'
        player['clawscd'] = 1
        player['claws'] = True
        try:
            if player['weapon'].lvl == 1:
                player['weapon'].cubes = 3
                player['weapon'].dmgbonus = 1
                player['weapon'].energycost = 3
                player['weapon'].accuracybonus = 2
            if player['weapon'].lvl == 2:
                player['weapon'].cubes = 4
                player['weapon'].dmgbonus = 1
                player['weapon'].energycost = 3
                player['weapon'].accuracybonus = 1
            if player['weapon'].lvl == 3:
                player['weapon'].cubes = 3
                player['weapon'].dmgbonus = 2
                player['weapon'].energycost = 3
                player['weapon'].accuracybonus = 2
            if player['weapon'].lvl == 4:
                player['weapon'].cubes = 3
                player['weapon'].dmgbonus = 2
                player['weapon'].energycost = 3
                player['weapon'].accuracybonus = 2
                if player['weapon'].modification == 2:
                    player['weapon'].cubes = 5
                    player['weapon'].accuracybonus = 1

        except:
            pass
        if player['weapon'].lvl == 0:
            player['weapon'].cubes = 4
            player['weapon'].dmgbonus = 1
            player['weapon'].energycost = 3
            player['weapon'].accuracybonus = 1
        
    elif act == 'clawsoff':
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: —Å–ø—Ä—è—Ç–∞—Ç—å –∫–æ–≥—Ç–∏\n\n'+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup=kb)
        game['text'] += '‚öôÔ∏è|' + player['name'] + ' –ø—Ä—è—á–µ—Ç –∫–æ–≥—Ç–∏!\n'
        player['clawscd'] = 1
        player['claws'] = False
        player['weapon'].cubes = 3
        player['weapon'].dmgbonus = 0
        player['weapon'].energycost = 2
        if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
            player['weapon'].dmgbonus = 1
        try:
            if player['weapon'].lvl == 1:
                player['weapon'].accuracybonus = 1
            if player['weapon'].lvl == 2:
                player['weapon'].accuracybonus = 2
            if player['weapon'].lvl == 3:
                player['weapon'].accuracybonus = 2
            if player['weapon'].lvl == 4:
                player['weapon'].accuracybonus = 2
        except:
            pass
        if player['weapon'].lvl == 0:
            player['weapon'].accuracybonus = 2
        
    elif act == 'dzet':
        target = game['players'][int(call.data.split('?')[3])]
        player['dopuseditems'].append(['dzet', target['id']])
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: –¥–∂–µ—Ç –Ω–∞ ' + target['name']+"\n\n"+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup=kb)
        
    elif act == 'priest':
        target = game['players'][int(call.data.split('?')[3])]
        player['dopriest'] = target['id']
        medit('–í—ã–±—Ä–∞–Ω–æ: –æ—Å–≤—è—â–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è ' + target['name'], call.message.chat.id, call.message.message_id, bot=bot)
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        if player['master'] == None:
            msg = sendm(bot, player['id'], text, reply_markup=kb)
        else:
            msg = sendm(bot, player['master'], text, reply_markup=kb)
        player['msg'] = msg
    elif act == 'hitin':
        target = game['players'][int(call.data.split('?')[3])]
        player['dopuseditems'].append(['hitin', target['id']])
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: —Ö–∏—Ç–∏–Ω –Ω–∞ ' + target['name']+"\n\n"+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup=kb)

    elif act == 'madpotion':
        target = game['players'][int(call.data.split('?')[3])]
        player['dopuseditems'].append(['madpotion', target['id']])
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        medit('–í—ã–±—Ä–∞–Ω–æ: —Å—ã–≤–æ—Ä–æ—Ç–∫–∞ –±–µ—à–µ–Ω—Å—Ç–≤–∞ –Ω–∞ ' + target['name']+"\n\n"+text, call.message.chat.id, call.message.message_id,
              bot=bot, reply_markup=kb)

    elif act == 'zombieup':
        target = int(call.data.split('?')[3])
        player['act'] = ['zombieup', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ–¥–Ω—è—Ç—å –∑–æ–º–±–∏ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'execution':
        target = int(call.data.split('?')[3])
        player['act'] = ['execution', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∫–∞–∑–Ω—å ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'incvizitor':
        target = int(call.data.split('?')[3])
        player['act'] = ['incvizitor', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ—Å–ª–∞—Ç—å –≥–Ω–µ–≤ –Ω–µ–±–µ—Å –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'parry':
        target = int(call.data.split('?')[3])
        player['act'] = ['parry', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ç–∞–∫ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'firearrow':
        target = int(call.data.split('?')[3])
        player['act'] = ['firearrow', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –æ–≥–Ω–µ–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∞ –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'hitdown':
        target = int(call.data.split('?')[3])
        player['act'] = ['hitdown', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Å–±–∏—Ç—å —Å –Ω–æ–≥ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'truestrike':
        target = int(call.data.split('?')[3])
        player['act'] = ['truestrike', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Ç–æ—á–Ω—ã–π —É–¥–∞—Ä –ø–æ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'demon':
        target = int(call.data.split('?')[3])
        # player['demonform'] = True
        player['act'] = ['demon_steal', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∫—Ä–∞–∂–∞ –∂–∏–∑–Ω–∏ —É ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
        # kb = getfightkb(game, player)
        # text = getplayertext(game, player)
        # if player['master'] == None:
        #    msg = sendm(bot, player['id'], text, reply_markup = kb)
        # else:
        #    msg = sendm(bot, player['master'], text, reply_markup = kb)
        # player['msg'] = msg
    elif act == 'pyrotechcharge':
        player['act'] = ['pyrotechcharge', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —É–ª—É—á—à–µ–Ω–∏–µ –±–æ–º–±—ã'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'pyrotech':
        target = int(call.data.split('?')[3])
        player['act'] = ['pyrotech', target]
        player['dopuseditems'].append(['bomb', target])
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –±—Ä–æ—Å–∏—Ç—å –±–æ–º–±—É –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'watershield':
        target = int(call.data.split('?')[3])
        player['act'] = ['watershield', target]
        # player['dopuseditems'].append(['bomb', target])
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤–æ–¥—è–Ω–æ–π —â–∏—Ç –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'blockshieldweapon':
        player['act'] = ['blockshield', 'self']
        # player['dopuseditems'].append(['bomb', target])
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –±–ª–æ–∫ —â–∏—Ç–æ–º'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'standup':
        player['act'] = ['standup', 'self']
        # player['dopuseditems'].append(['bomb', target])
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ–¥–Ω—è—Ç—å—Å—è'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None
    elif act == 'machinegun_charge':
        player['act'] = ['machinegun_charge', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∑–∞—Ä—è–¥–∏—Ç—å –ø—É–ª–µ–º–µ—Ç'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'blow_flamethrower':
        player['act'] = ['blow_flamethrower', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤–∑–æ—Ä–≤–∞—Ç—å –æ–≥–Ω–µ–º–µ—Ç'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'necrostaffability':
        player['act'] = ['necrostaffability', 'self']
        # player['dopuseditems'].append(['bomb', target])
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –ø–æ–¥–Ω—è—Ç—å –º–µ—Ä—Ç–≤–µ—Ü–∞'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'bint':
        target = int(call.data.split('?')[3])
        player['act'] = ['bint', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –±–∏–Ω—Ç –Ω–∞ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'invoker_charge':
        player['act'] = ['invoker_charge', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞–Ω—É'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'run':
        player['act'] = ['run', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —Å–±–µ–∂–∞—Ç—å'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'info' and game['dungeon'] and game['dungeon_type'] == 'dark' and game['dungeonlvl'] == 2:
        player['act'] = ['amalgama_info', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∞–Ω–∞–ª–∏–∑ –∞–º–∞–ª—å–≥–∞–º—ã.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'info' and game['dungeon'] and game['dungeon_type'] == 'dark' and game['dungeonlvl'] == 3:
        player['act'] = ['get_calm', 'self']
        seetext = '–í—ã–±—Ä–∞–Ω–æ: –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Å—Ç—Ä–∞—Ö–∞.'
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'info' and (not game['dungeon'] or (game['dungeon'] and game["dungeon_type"] == "dragon")):
        if not game['classic_game']:
            player['act'] = ['get_calm_pvp', 'self']
            seetext = '–í—ã–±—Ä–∞–Ω–æ: –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Å—Ç—Ä–∞—Ö–∞.'
            medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
            player['ready'] = True
            player['stage'] = None
        else:
            infotext = getplayerpodrobno(game, player)
            kb = getfightkb(game, player)
            text = getplayertext(game, player)
            medit(infotext+"\n\n"+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup = kb)
            

    elif act == 'dark_energy':
        target = int(call.data.split('?')[3])
        player['act'] = ['dark_energy', target]
        seetext = '–í—ã–±—Ä–∞–Ω–æ: —ç–Ω–µ—Ä–≥–∏—è —Ç—å–º—ã –≤ ' + game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'break_weapons':
        target = int(call.data.split('?')[3])
        player['act'] = ['break_weapons', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'blood_to_enemy':
        target = int(call.data.split('?')[3])
        player['act'] = ['blood_to_enemy', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'roots':
        target = int(call.data.split('?')[3])
        player['act'] = ['roots', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'target_lighting':
        target = int(call.data.split('?')[3])
        player['act'] = ['target_lighting', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'light_sword':
        target = int(call.data.split('?')[3])
        player['act'] = ['light_sword', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'sunstrike':
        target = int(call.data.split('?')[3])
        player['act'] = ['sunstrike', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'drink_energy':
        target = int(call.data.split('?')[3])
        player['act'] = ['drink_energy', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'infection':
        target = int(call.data.split('?')[3])
        player['act'] = ['infection', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'infect_weapon':
        target = int(call.data.split('?')[3])
        player['act'] = ['infect_weapon', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'inc_energy':
        target = int(call.data.split('?')[3])
        player['act'] = ['inc_energy', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'invoker_water_shield':
        target = int(call.data.split('?')[3])
        player['act'] = ['invoker_water_shield', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'iceheart':
        target = int(call.data.split('?')[3])
        player['act'] = ['iceheart', target]
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ') –ΩÃ∑“áÃßÃèÃîÕöÃó–∞“à“áÃßÕëÕÇÕîÕö ' + \
                  game['players'][target]['name']
        medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
        player['ready'] = True
        player['stage'] = None

    elif act == 'selectelement':
        element = call.data.split('?')[3]
        if len(player['selectedelements']) >= 3:
            return
        player['selectedelements'].append(element)
        elemtext = ''
        for ids in player['selectedelements']:
            elemtext += elem_to_emoji(ids)
        if len(player['selectedelements']) == 3:
            spell = spell_exists(player['selectedelements'])
            if spell:
                if spell == 'freeze_energy':
                    player['act'] = ['freeze_energy', 'self']
                if spell == 'random_lighting':
                    player['act'] = ['random_lighting', 'self']
                if spell == 'summon_treant':
                    player['act'] = ['summon_treant', 'self']
                if spell == 'blood_to_all':
                    player['act'] = ['blood_to_all', 'self']
                if spell == 'change_skill':
                    player['act'] = ['change_skill', 'self']
                if spell == 'big_light_strike':
                    player['act'] = ['big_light_strike', 'self']
                if spell == 'big_virus_mutant':
                    player['act'] = ['big_virus_mutant', 'self']
                if spell == 'fire_all':
                    player['act'] = ['fire_all', 'self']
                if spell == 'roots':
                    kb = gettargetkb(game, player, 'roots', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'target_lighting':
                    kb = gettargetkb(game, player, 'target_lighting', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'blood_to_enemy':
                    kb = gettargetkb(game, player, 'blood_to_enemy', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'break_weapons':
                    kb = gettargetkb(game, player, 'break_weapons', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'light_sword':
                    kb = gettargetkb(game, player, 'light_sword', 'ally')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'sunstrike':
                    kb = gettargetkb(game, player, 'sunstrike', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'drink_energy':
                    kb = gettargetkb(game, player, 'drink_energy', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'infection':
                    kb = gettargetkb(game, player, 'infection', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'infect_weapon':
                    kb = gettargetkb(game, player, 'infect_weapon', 'enemy')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'inc_energy':
                    kb = gettargetkb(game, player, 'inc_energy', 'ally')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'invoker_water_shield':
                    kb = gettargetkb(game, player, 'invoker_water_shield', 'ally')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'iceheart':
                    kb = gettargetkb(game, player, 'iceheart', 'ally')
                    medit(
                        '–íÃ∏ÕûÃßÃçÃÅÃ´Ã†—ã“àÃõÕ¢ÃæÃÉÃ©Ãû–±“â“áÃ°ÕÉÃíÕÅÕñÕéÃñ–µÃ¥ÃõÃ¢ÃÜÃÇÃ©Ã±—Ä“âÃõÃ®ÃøÃäÃÉÃúÕéÃ©–∏Ã∏ÃïÕúÃøÃàÃÆÃ™—ÇÃµÃõÃ¢ÃÇÕï–µÃ∏ÃïÕúÕåÃ£ÕôÃ± —ÜÃ¥“áÃ°ÕÄÃùÃóÕö–µÃ¥ÃõÃ®ÃåÃ≠ÕàÃ™–ªÃµÕ°Ã®ÃèÃèÕâ—å“âÕ°Ã¢ÕÜÃù –¥“àÕùÃ®ÃîÃÄÃôÕñ–ª“âÃõÕ¢ÃÅÕîÃ†ÕÖ—èÃµÕ°ÕúÕåÕåÃ¶Õñ –∑Ã∂Õ†Ã¢ÕêÕíÃ£Õà–∞Ã¥Õ†ÃßÕÑÕçÃ™–∫Ã∂ÃïÃ¢ÃÅÕÉÕÖÃ£Ã±–ªÃ∏“áÃ®ÃöÕì–∏“àÕ°Ã°ÃöÃåÕé–ΩÃµ“áÃ°ÃéÕÉÕóÕÖÃ™–∞ÃµÃõÃßÕåÕï–Ω“àÕûÃ¢ÃäÕëÃÆÃû–∏Ã∏Õ†ÕúÃçÃéÃäÃÆÕçÃó—èÃ∑ÃïÕ¢ÕõÃøÕëÃü:Ã∏ÃõÃßÃêÕÜÕàÃûÃ≤',
                        call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)
                    return
                if spell == 'suicide':
                    player['act'] = ['invoker_suicide', 'self']
            else:
                player['act'] = ['falsespell', 'self']
            seetext = '–í“àÃïÕúÃëÕâÕÖÃü—ãÃ∏ÕùÃ¢ÕãÃÜÃæÃñÃû–±“àÕùÃ¢ÃçÃ¶—ÄÃ∂Õ°Õ¢ÃãÕÉÕäÃ•Ã£–∞“àÃõÃ®ÃÜÕÑÃìÕçÃü–Ω“âÃïÃßÕÄÕÜÕÖ–æÃ∂Õ†Ã°ÃÇÃÑÃåÕâÕö:Ã∏ÃïÃ¢ÃÉÃîÃãÃò –∑“âÕûÃ°ÕóÃ©ÃùÕî–∞Ãµ“áÃßÃçÃéÃÇÕì–∫Ã∂“áÃ®ÃàÕáÃ¶Ãú–ªÃ¥ÃïÃßÃÜÃ©–∏ÃµÕûÕ¢ÃæÃâÕçÕéÃ±–Ω“àÃõÃßÕõÃóÃ∞Ãü–∞Ã∂ÕùÕ¢ÃΩÕáÃ´–ΩÃ∏“áÃßÃáÃÄÃèÕÖ–∏Ã∂“áÃßÃäÃØÃú–µÃ∏Õ†Õ¢ÕäÕãÃéÃ¨Ã≠ (' + elemtext + ')'
            medit(seetext, call.message.chat.id, call.message.message_id, bot=bot)
            player['ready'] = True
            player['stage'] = None
        else:
            bot.answer_callback_query(call.id, '–í—ã–±—Ä–∞–Ω —ç–ª–µ–º–µ–Ω—Ç: ' + elem_to_emoji(element))
            kb = getspellselect(game, player)
            elemtext = ''
            for ids in player['selectedelements']:
                elemtext += elem_to_emoji(ids)
            medit(
                '–íÃ¥Õ°ÕúÃáÃêÃûÃü—ãÃ∂Õ†Ã°ÕÑÃôÃ∞Ãü–±“âÃïÕúÕÅÃóÃ±Õö–µÃ¥ÃïÃ¢ÕóÃ†—ÄÃ¥“áÃ¢ÃÜÃ±Ã¨Ã±–∏“âÃõÃ®ÃÉÃãÃ†Ã©—ÇÃ∏ÃõÃ®ÃÜÃ´Ã±ÃÆ–µÃ∂ÃïÕ¢ÕêÕÉÃú —çÃ∑ÃõÃ¢ÕÜÃîÃ≥ÕéÃ¶–ªÃ∂Õ†Õ¢ÃâÕâÕîÕá–µÃ∂Õ†Ã°ÃâÃçÃ™–ºÃ∑Õ†Ã°ÕõÕâ–µ“àÕ†Ã¢ÕÜÃìÃûÕö–Ω“âÕùÃ°ÃøÃ≥Ãù—ÇÃ∂“áÃßÃöÕÄÃò—ãÃ∏ÕûÃ¢ÃçÃ†Õâ:Ã¥ÕùÕúÃÉÕóÃú\n' + elemtext,
                call.message.chat.id, call.message.message_id, reply_markup=kb, bot=bot)

    elif act == 'visor':
        target = game['players'][int(call.data.split('?')[3])]
        kb = getfightkb(game, player)
        text = getplayertext(game, player)
        if player['visorcd'] <= 0:
            targetinfo = getplayerpodrobno(game, target)
            medit('–í—ã–±—Ä–∞–Ω–æ: –≤–∏–∑–æ—Ä –Ω–∞ ' + target['name']+"\n\n"+targetinfo+"\n\n"+text, call.message.chat.id, call.message.message_id, bot=bot, reply_markup = kb)
            player['visorcd'] = 3
        
        
    if seetext != None:
        player['seetext'] = seetext


@bot.callback_query_handler(func=lambda call: call.data[:8] == 'fightact')
def fightacttttt(call):
    fightact(call, bot=bot)


@bot.callback_query_handler(func=lambda call: call.data[:14] == 'customtextinfo')
def ctextinfoss(call):
    gameid = int(call.data.split('?')[1])
    try:
        game = games[gameid]
    except:
        bot.answer_callback_query(call.id, '–ò–≥—Ä—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!')
        return
    text = ''
    for ids in game['customtextlist']:
        textinfo = getcustomtext(ids)
        text += textinfo+'\n\n'
    try:
        sendm(bot, call.from_user.id, text)
    except:
        pass


@cwbot.callback_query_handler(func=lambda call: call.data[:8] == 'fightact')
def fightacttttt(call):
    fightact(call, bot=cwbot)


def readycheck_end_turn(game):
    return
    ready = 0
    for ids in game['players']:
        player = game['players'][ids]
        if player['ready']:
            ready += 1
    if len(game['players']) == ready:
        game['timer'].cancel()
        end_turn(game)


def setfire(game, player, target, strength=1, duration=3):
    firetext = ''
    target['fireticks'] = duration
    target['who_fired'] = player['id']
    target['who_fireds'].append(player['id'])
    if ('protivogaz' in target['skills'] or 'protivogaz?1' in target['skills'] or 'protivogaz?2' in target[
        'skills'] or 'protivogaz?3' in target['skills'] or 'protivogaz_classic' in target['skills']) \
            or target['is_rhino'] or target['is_mad_skele'] or \
            target['is_vurdalak'] or is_dark_boss(target) or target["is_dragon"]:
        target['fireticks'] = 2
    if target['firestrength'] > 0:
        firetext += 'üî•'*strength+'|–û–≥–æ–Ω—å —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è! ('+str(target['fireticks']-1)+'üïë)'
    else:
        firetext += 'üî•'*strength+'|' + target['name'] + ' –∑–∞–≥–æ—Ä–µ–ª—Å—è! ('+str(target['fireticks']-1)+'üïë)'
    target['firestrength'] += strength
    return firetext


def get_target_dvuzhil(target):
    x = 0
    if 'dvuzhil?1' in target['skills']:
        x = 0
    if 'dvuzhil?2' in target['skills']:
        x = 1
    if 'dvuzhil?3' in target['skills']:
        x = 1
    return x


def generate_cube_hit_damage(game, player, target, sokrush=False, chain=False, narsil=False, counterattack=False, execution=False,
              granatomet=False, cubes=None, accuracy=None):
        damage = 0
        weapon = player['weapon']
        chance = player['energy']
        if cubes != None:
            weaponcubes = cubes
        else:
            weaponcubes = weapon.cubes
        if accuracy != None:
            weaponaccuracy = accuracy
        else:
            weaponaccuracy = weapon.accuracybonus
        if player['weapon'].name == '–î–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Å–∏–ª–∞':
            player['energy'] = player['maxenergy']
        if player['weapon'].name == "–ü–∞—Å—Ç—å —Å–æ–±–∞–∫–∏":
            player['dark_dog_attacks'] += 1
            if player['dark_dog_attacks'] == 2:
                player['amalgama_must_mutate'] = True
        elif player['weapon'].name == '–¢–µ–Ω–µ–≤–∞—è –ø—É—à–∫–∞':
            player['amalgama_must_mutate'] = True
        elif player['weapon'].name == '–û–≥—Ä–æ–º–Ω—ã–π —Ç–µ—Å–∞–∫':
            player['amalgama_must_mutate'] = True
        if 'robot' in player['skills']:
            chance = player['hp']
        chance += weaponaccuracy
        if 'sniper' in player['skills']:
            chance += 2
        if 'sniper_classic' in player['skills']:
            chance += 2
        if 'pricel?1' in player['skills']:
            chance -= 2
        if 'pricel?2' in player['skills']:
            chance -= 1
        if 'pricel?3' in player['skills']:
            chance -= 1
        if 'visor' in player['skills'] and player['weapon'].ranged:
            chance += 1
        if 'visor_classic' in player['skills'] and player['weapon'].ranged:
            chance += 1
        if ('vor' in player['skills'] or 'vor?2' in player['skills'] or 'vor?3' in player['skills']) and player[
            'weapon'].ranged:
            chance += 1
        if 'vor_classic' in player['skills'] and player['weapon'].ranged:
            chance += 1
        if 'multicast' in player['skills'] and player['multicast'] == 2:
            chance -= 2
        if 'multicast' in player['skills'] and player['multicast'] == 3:
            chance -= 2
        if 'multicast' in player['skills'] and player['multicast'] == 4:
            chance -= 3
        chance -= player['hypnodebuff']
        # if player['weapon'].name == '–ú–æ–ª–æ—Ç' and player['energy'] == 1:
        #    chance += 1
        # chance += target['cuts']
        chaintext = False
        sokrushtext = False
        narsiltext = False
        if player['weapon'].name == '–ö—É–≤–∞–ª–¥–∞' and player['sokrushenie']:
            ecostt = 4
            try:
                if player['weapon'].lvl == 1:
                    ecostt = 5
                if player['weapon'].lvl == 2:
                    ecostt = 4
                if player['weapon'].lvl == 3:
                    ecostt = 3
                if player['weapon'].lvl == 4:
                    ecostt = 3
            except:
                pass
            chance += ecostt
            sokrushtext = True
        if player['weapon'].name == '–¶–µ–ø—å' and player['chain']:
            chance += 2
            chaintext = True

        half = target['maxhp'] / 2
        if 'bloodlust' in player['skills'] and target['hp'] < half:
            chance += 1
        if player['truestrike']:
            chance += 15
            try:
                if player['weapon'].lvl == 1 or player['weapon'].lvl == 2 or player['weapon'].lvl == 3 or player['weapon'].lvl == 4:
                    chance += 1500
            except:
                pass
        # if player['demonheal'] > 0:
        #    chance += 1
        if player['weapon'].name == '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª' and player['narsil']:
            narsiltext = True
        if 'narkoman' in player['skills'] or 'narkoman?1' in player['skills'] or 'narkoman?2' in player[
            'skills'] or 'narkoman?3' in player['skills']:
            chance -= 1
            if 'narkoman?1' in player['skills']:
                chance -= 1
            if not player['attackedthisturn']:
                for ids in game['players']:
                    target2 = game['players'][ids]
                    for idss in target2['dopuseditems']:
                        itemtarget = game['players'][idss[1]]
                        if itemtarget['id'] == player['id']:
                            chance += 2
                    if target2['act'] != None and target2['act'][0] in ['stimulator'] and target2['act'][1] == player[
                        'id']:
                        chance += 2
        if 'narkoman_classic' in player['skills']:
            chance -= 1
            for ids in game['players']:
                target2 = game['players'][ids]
                for idss in target2['dopuseditems']:
                    itemtarget = game['players'][idss[1]]
                    if itemtarget['id'] == player['id']:
                        chance += 2
                if target2['act'] != None and target2['act'][0] in ['stimulator'] and target2['act'][1] == player['id']:
                    chance += 2
        if not player['weapon'].classic:
            snipermult = 6
        else:
            snipermult = 5
        if player['maintarget'] != None and player['maintarget']['target'] == target['id'] and player['weapon'].name == '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞':
            chance += (player['maintarget']['power'] * snipermult)
        if player['weapon'].name == '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞' and player['weapon'].lvl == 4 and player['weapon'].modification == 1 and random.randint(1, 100) <= 60:
            chance += (1 * snipermult)
            game['text'] += 'üé≤üéØ|'+player['name']+' —Ü–µ–ª–∏—Ç—Å—è.\n'
        if target['act'] != None:
            if target['act'][0] == 'perekat':
                chance -= 5
                if ('ninja' in target['skills'] or 'ninja?1' in target['skills'] or 'ninja?2' in target[
                    'skills'] or 'ninja?3' in target['skills']):
                    chance -= 95
        if 'ninja?3' in target['skills']:
            chance -= 1
        if player['bowcharge'] > 0 and player['weapon'].name == '–õ—É–∫ –ê—Å–≥–∞—Ä–¥':
            chance += (player['bowcharge'])
        if 'robot' not in player['skills']:
            if player['weapon'].name != '–ö—É–≤–∞–ª–¥–∞' and player['weapon'].name != '–¶–µ–ø—å':
                if player['energy'] <= 0:
                    chance = 0
            else:
                if player['sokrushenie'] or player['chain']:
                    if player['waszero']:
                        chance = 0
                else:
                    if player['energy'] <= 0:
                        chance = 0

        if player['weapon'].name == '–£–∫—É—Å –∑–æ–º–±–∏':
            chance = 7
            chance -= (player['necrozombie'] * 2)
            if player['maxnecrozombie'] == 2:
                chance = 3
            if target['act'] != None:
                if target['act'][0] == 'perekat':
                    chance -= 5

        # if weapon.name in ['–¶–µ–ø—å', '–ö—É–≤–∞–ª–¥–∞']:
        #    sendm(bot, pasyuk_id, player['name']+' –±—å—ë—Ç —Ü–µ–ø—å—é/–∫—É–≤–∞–ª–¥–æ–π —Å —à–∞–Ω—Å–æ–º '+str(chance))
        if player['weapon'].name == '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞' and player['multicast'] > 1:
            maxchance = 999999
            if player['multicast'] == 2:
                maxchance = 5
            elif player['multicast'] == 3:
                maxchance = 4
            elif player['multicast'] == 4:
                maxchance = 3
            if chance > maxchance:
                chance = maxchance
        if 'ghoul_bloodlust' in player['skills'] and player['master'] != None:
            losthp = target['maxhp'] - target['hp']
            chance += losthp
        if player['weapon'].name in ['–ö–æ–ø—å–µ', '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª'] and counterattack:
            try:
                if player['weapon'].lvl == 3:
                    chance += 1
            except:
                pass
        if player['weapon'].name == '–ß–∞—Å—Ç–∏—Ü–∞ —Ç—å–º—ã':
            chance = 10
        for i in range(weaponcubes):
            x = random.randint(1, 10)
            if x <= chance:
                damage += 1
        drobovik_hasnocharges = False
        # if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫' and player['drobovik_charges'] <= 0:
        #    damage = 0
        #    drobovik_hasnocharges = True
        # if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫':
        #    if player['drobovik_charges'] > 0:
        #        player['drobovik_charges'] -= 1
        if player['weapon'].name == '–î—É—ç–ª—å–Ω–∞—è —Ä–∞–ø–∏—Ä–∞':
            en = player['energy']
            rapierdmg = 0
            while en >= 2:
                rapierdmg += 1
                en -= 2
            if en > 0:
                rapierdmg += 1
            if target['act'] != None:
                if target['act'][0] == 'perekat':
                    if player['energy'] <= 4:
                        rapierdmg = 0
                    else:
                        rapierdmg -= 2
            damage = rapierdmg
        #if player['burrowstrike']:
        #    if target['act'] != None and target['act'][0] == 'perekat':
        #        damage = 0
        lastsnipertarget = None
        if player['weapon'].name == '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞' and player['weapon'].lvl == 4 and player['weapon'].modification == 2 and damage <= 0:
            dopt = None
            enemylist = []
            for idss in game['players']:
                if game['players'][idss]['team'] != player['team'] and not game['players'][idss]['dead'] and game['players'][idss]['id'] != target['id']:
                    enemylist.append(game['players'][idss])
            if len(enemylist) > 0:
                newenemy = random.choice(enemylist)
                lastsnipertarget = target
                target = newenemy
                damage = 1
        if player['weapon'].name == "–¢–µ—Å–∞–∫" and not player['first_hit'] and player['weapon'].lvl == 4 and player['weapon'].modification == 2:
            damage = random.randint(1, 3)
            player['set_first_hit'] = True
        return damage, chaintext, sokrushtext, narsiltext, drobovik_hasnocharges, lastsnipertarget


def attackact(game, player, target, sokrush=False, chain=False, narsil=False, counterattack=False, execution=False,
              granatomet=False):
    if player['id'] not in target['who_attacked']:
        target['who_attacked'].append(player['id'])
    if not sokrush and not chain:
        damage, chaintext, sokrushtext, narsiltext, drobovik_hasnocharges, lastsnipertarget = generate_cube_hit_damage(game, player, target, sokrush, chain, narsil, counterattack, execution, granatomet)
        weapon = player['weapon']
        if damage > 0:
            basegdmg = 0
            player['demon'] = True
            if weapon.name == '–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç':
                if player['grenade'] == 'grenade':
                    # damage = random.randint(2, 3)
                    basegdmg = damage
                else:
                    damage = 0
            if weapon.name in ['–û–≥–Ω–µ–º–µ—Ç', '–û–≥–Ω–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª']:  #:, '–ü–∏–ª–æ–º–µ—Ç']:
                damage = 1
                if weapon.lvl == 4 and weapon.modification == 2:
                    damage = 0
            if weapon.name == '–†–µ–≤–æ–ª—å–≤–µ—Ä':
                damage = 3
            if weapon.name == '–õ—É–∫ –ê—Å–≥–∞—Ä–¥':
                damage = 1
            if weapon.name == '–°—é—Ä–∏–∫–µ–Ω—ã':
                damage = 2
            if weapon.name == '–ú–µ—á –¥—Ä—è—Ö–ª–æ–≥–æ —Å–∫–µ–ª–µ—Ç–∞':
                damage = 1
            if weapon.name == '–ö–ª—ã–∫–∏ —á–µ—Ä–≤—è':
                damage = 3
            if weapon.name == "–≠–ª–µ–∫—Ç—Ä–æ—à–æ–∫–µ—Ä":
                damage = player["energy"]
            #if weapon.name == '–¢—Ä–µ–∑—É–±–µ—Ü':
            #    damage = 3
            if weapon.name == 'One punch':
                damage = random.randint(999999999, 9999999999999)
            # if 'pricel?3' in player['skills']:
            #    damage += 1
            damage += player['nextturndamage']
            damage += int(player['luciferpower']*1.5)
            if player['loosedamage'] > 0:
                damage += player['loosedamage']
            if weapon.name == '–¢–µ—Å–∞–∫':
                # damage = 1
                damage += player['tesak_bonus']
            if 'fire_power' in player['skills']:
                for idss in game['players']:
                    if game['players'][idss]['fireticks'] > 0:
                        damage += 1
            if 'dark_energy' in player['skills']:
                bdmg = 0
                for idss in game['players']:
                    if game['players'][idss]['dark_counter'] > 0:
                        bdmg += 1
                damage += bdmg
            # if player['weapon'].name == '–ü–æ—Å–æ—Ö –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞':
            #    damage = 1
            tbbase = 4
            try:
                if player['weapon'].lvl == 1:
                    tbbase = 3
                if player['weapon'].lvl == 2:
                    tbbase = 4
                if player['weapon'].lvl == 3:
                    tbbase = 5
                if player['weapon'].lvl == 4:
                    tbbase = 5
                    if player['weapon'].modification == 1:
                        tbbase = 10
            except:
                pass
            if player['weapon'].name == '–¢–µ—Å–∞–∫':
                if player['tesak_bonus'] > 0:
                    if player['tesak_bonus'] == tbbase:
                        if tbbase == 10:
                            player['tesak_bonus'] = 4
                        else:
                            player['tesak_bonus'] -= 2
                    else:
                        player['tesak_bonus'] -= 1
                    if player['tesak_bonus'] < 0:
                        player['tesak_bonus'] = 0
            damage += target['cuts']
            strongshot = False
            if player['strongshot']:
                strongshot = True
                try:
                    if player['weapon'].lvl == 1:
                        damage += 1
                    if player['weapon'].lvl == 2:
                        damage += 1
                    if player['weapon'].lvl == 3:
                        damage += 2
                    if player['weapon'].lvl == 4:
                        damage += 2
                except:
                    pass
            if player['weapon'].name == '–ú–æ–ª–æ—Ç':
                dopd = 1
                try:
                    if player['weapon'].lvl == 3:
                        dopd = 2
                    if player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                        dopd = 3
                except:
                    pass
                cenergy = player['maxenergy'] - player['energy']
                while cenergy >= 2:
                    cenergy -= 2
                    damage += dopd
            if 'ghoul_bloodlust' in player['skills'] or player['weapon'].name == '–ó—É–±—ã –≤—É—Ä–¥–∞–ª–∞–∫–∞':
                losthp = target['maxhp'] - target['hp']
                damage += losthp
            if player['charge']:
                damage += 1
            if player['demonheal'] > 0:
                damage += 1
            if target['stun'] > 0 and '–Ω–æ—Å–æ—Ä–æ–≥' in player['name'].lower() and player['controller'] == 'bot':
                damage += 2
            if 'autist' in player['skills']:
                damage += 1
            sokrushtext = False
            if player['weapon'].name == '–ö—É–≤–∞–ª–¥–∞' and player['sokrushenie']:
                if player['weapon'].classic:
                    damage = 1
                else:
                    damage = 2
                try:
                    if player['weapon'].lvl == 1:
                        damage = 1
                    if player['weapon'].lvl == 2:
                        damage = 1
                    if player['weapon'].lvl == 3:
                        damage = 2
                    if player['weapon'].lvl == 4:
                        damage = 2
                except:
                    pass
                if player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                    damage += (target['maxenergy'] - target['energy'])*2
                else:
                    damage += (target['maxenergy'] - target['energy'])
                sokrushtext = True
            if 'berserk' in player['skills'] and player['hp'] == 1:
                damage += 2
            if 'berserk?1' in player['skills'] and player['hp'] == 1:
                damage += 1
            if 'berserk?2' in player['skills'] and player['hp'] == 1:
                damage += 2
            if 'berserk?3' in player['skills'] and player['hp'] == 1:
                damage += 3
            if player['weapon'].name in ['–ö–æ–ø—å–µ', '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª'] and counterattack:
                if not game['classic_game']:
                    damage += 1
                try:
                    if player['weapon'].lvl == 2:
                        damage += 1
                    if player['weapon'].lvl == 3:
                        damage += 2
                    if player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                        damage += 3
                    if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                        damage += 3

                except:
                    pass
            if player['weapon'].name == '–ë—É–ª–∞–≤–∞':
                if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                    damage += player['bulavabonus']*4
                else:
                    damage += player['bulavabonus']
            if player['weapon'].name == '–ì–ª–∞–∑ –¥–µ–º–æ–Ω–∞':
                damage += player['maxhp'] - player['hp']
            if player['watershield'] > 0:
                damage += 1
            if weapon.name == "–ß–∞—Å—Ç–∏—Ü–∞ —Ç—å–º—ã":
                damage = 0
            executiontext = False
            if player['weapon'].name == '–ö–∞—Ç–∞–Ω–∞':
                if target['hp'] == 1:
                    target['hp'] -= 1
                    executiontext = True

            #if player['weapon'].name == '–ü—ã–ª–∞—é—â–∏–π –∫–ª–∏–Ω–æ–∫' and random.randint(1, 100) <= 20:
            #    if target['hp'] > 1:
            #        target['hp'] -= 1
            #        execution2text = True
            if player['weapon'].name == '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª' and player['narsil']:
                damage += 1
                if player['weapon'].classic:
                    stunchance = 20 * player['energy']
                else:
                    stunchance = 20 * player['energy']
                if random.randint(1, 100) <= stunchance:
                    if target['stun'] > 0:
                        target['stun'] += 1
                    else:
                        target['stun'] = 2
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
            if player['bowcharge'] > 0 and player['weapon'].name == '–õ—É–∫ –ê—Å–≥–∞—Ä–¥':
                damage += (player['bowcharge'] * 2)
            if player['weapon'].name == '–õ—É–∫ –ê—Å–≥–∞—Ä–¥':
                xx = random.randint(1, 10)
                if xx < (player['bowcharge']+3):
                    if target['blood'] <= 0:
                        target['blood'] = 4

                        if 'dvuzhil' in target['skills']:
                            target['blood'] += 2
                        target['blood'] += get_target_dvuzhil(target)
                        game['text'] += '‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                    else:
                        if target['blood'] > 1:
                            target['blood'] -= 1
                        game['text'] += '‚ù£Ô∏è|' + target['name'] + ' –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'

            if player['weapon'].name == '–õ—É–∫ –ê—Å–≥–∞—Ä–¥':
                xx = random.randint(1, 10)
                if xx < ((player['bowcharge']-1)*6):
                    if target['stun'] > 0:
                        target['stun'] += 1
                    else:
                        target['stun'] = 2
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'

            narkomantext = False
            if 'narkoman' in player['skills'] or 'narkoman?1' in player['skills'] or 'narkoman?2' in player[
                'skills'] or 'narkoman?3' in player['skills']:
                if not player['attackedthisturn']:
                    for ids in game['players']:
                        target2 = game['players'][ids]
                        for idss in target2['dopuseditems']:
                            itemtarget = game['players'][idss[1]]
                            if itemtarget['id'] == player['id'] and idss[0] not in ['bomb']:
                                damage += 1
                                if 'narkoman?3' in player['skills']:
                                    damage += 1
                                narkomantext = True
                        if target2['act'] != None and target2['act'][0] in ['stimulator'] and target2['act'][1] == \
                                player['id']:
                            damage += 1
                            if 'narkoman?3' in player['skills']:
                                damage += 1
                            narkomantext = True

            if 'narkoman_classic' in player['skills']:
                for ids in game['players']:
                    target2 = game['players'][ids]
                    for idss in target2['dopuseditems']:
                        itemtarget = game['players'][idss[1]]
                        if itemtarget['id'] == player['id'] and idss[0] not in ['bomb']:
                            damage += 1
                            narkomantext = True
                    if target2['act'] != None and target2['act'][0] in ['stimulator'] and target2['act'][1] == \
                            player['id']:
                        damage += 1
                        narkomantext = True

            if narkomantext:
                game['effecttext'] += 'üôÉ|' + player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –∏ —É—Ä–æ–Ω!\n'

            chaintext = False
            if player['weapon'].name == '–¶–µ–ø—å' and player['chain']:
                chaintext = True
                if not game['classic_game']:
                    wthrowchance = 10
                    dopwthchance = ((target['maxenergy'] - target['energy']) * 10)
                    try:
                        if player['weapon'].lvl == 1:
                            wthrowchance = 10
                            dopwthchance = ((target['maxenergy'] - target['energy']) * 10)
                        if player['weapon'].lvl == 2:
                            wthrowchance = 20
                            dopwthchance = ((target['maxenergy'] - target['energy']) * 15)
                        if player['weapon'].lvl == 3:
                            wthrowchance = 30
                            dopwthchance = ((target['maxenergy'] - target['energy']) * 20)
                        if player['weapon'].lvl == 4:
                            wthrowchance = 30
                            dopwthchance = ((target['maxenergy'] - target['energy']) * 20)
                            if player['weapon'].modification == 1:
                                wthrowchance = 100
                            elif player["weapon"].modification == 2:
                                pass
                    except:
                        pass
                else:
                    wthrowchance = 30
                if target['act'] != None and target['act'][0] == 'reload':
                    wthrowchance = 100
                if game['classic_game']:
                    if target['act'] != None and target['act'][0] == 'attack':
                        wthrowchance = 100
                if target['weapon'].name in ['–ö—É–ª–∞–∫–∏', '–£–∫—É—Å –∑–æ–º–±–∏', '–†–æ–≥', '–†—É–∫–∞ —Ç—Ä–µ–Ω—Ç–∞', '–ö–æ–Ω–µ—á–Ω–æ—Å—Ç—å –≤–∏—Ä—É—Å–∞',
                                             '–ó—É–±—ã –≤—É—Ä–¥–∞–ª–∞–∫–∞', '–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞', 'One punch', "–©—É–ø–∞–ª—å—Ü–∞", "–î–µ–º–æ–Ω–∏—á–µ—Å–∫–∞—è —Å–∏–ª–∞"]:
                    wthrowchance = 0
                if target['team'] == 'dark' and target['controller'] == 'bot' and (
                        '–ê–º–∞–ª—å–≥–∞–º–∞' in target['name'] or '–¢–µ–Ω—å –∫—Ä—ã—Å—ã' in target['name'] or '–¢—å–º–∞' in target['name']) \
                        and game['dungeon']:
                    wthrowchance = 0
                if random.randint(1, 100) <= wthrowchance:
                    game['effecttext'] += 'üëê|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ!\n'
                    target['lostweapon'] = True

            if player['weapon'].name == '–¶–µ–ø—å' and player['weapon'].lvl == 4 and player['weapon'].modification == 1 and not player['chain']:
                wthrowchance = 40
                if target['weapon'].name in ['–ö—É–ª–∞–∫–∏', '–£–∫—É—Å –∑–æ–º–±–∏', '–†–æ–≥', '–†—É–∫–∞ —Ç—Ä–µ–Ω—Ç–∞', '–ö–æ–Ω–µ—á–Ω–æ—Å—Ç—å –≤–∏—Ä—É—Å–∞',
                                             '–ó—É–±—ã –≤—É—Ä–¥–∞–ª–∞–∫–∞', '–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞', 'One punch']:
                    wthrowchance = 0
                if target['team'] == 'dark' and target['controller'] == 'bot' and (
                        '–ê–º–∞–ª—å–≥–∞–º–∞' in target['name'] or '–¢–µ–Ω—å –∫—Ä—ã—Å—ã' in target['name'] or '–¢—å–º–∞' in target['name']) \
                        and game['dungeon']:
                    wthrowchance = 0
                if random.randint(1, 100) <= wthrowchance:
                    game['effecttext'] += 'üëê|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ!\n'
                    target['lostweapon'] = True

            if player["weapon"].name == "–Ø—Ç–∞–≥–∞–Ω":
                armordecchance = 50
                if random.randint(1, 100) <= armordecchance:
                    game['effecttext'] += '‚õìÔ∏è‚Äçüí•|–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±—Ä–æ–Ω–∏ ' + target['name'] + ' —Å–Ω–∏–∂–µ–Ω–∞! (üïë3)\n'
                    code = 0
                    while code in target["armor_debuff_set"]:
                        code += 1
                    target["armor_debuff_set"][code] = {"duration":3, "power":1}

            hitdowntext = False
            if player['weapon'].name == '–®–µ—Å—Ç' and (player['hitdown'] or (player['weapon'].lvl == 4 and player['weapon'].modification == 1 and random.randint(1, 100) <= 40)):
                can_fell = True
                try:
                    if player['weapon'].lvl == 1:
                        if target['shield'] or (target['act'] != None and target['act'][0] == 'perekat'):
                            can_fell = False
                    if player['weapon'].lvl == 2:
                        if target['shield']:
                            can_fell = False
                except:
                    pass
                hitdowntext = True
                if not target['shield']:
                    if (target['is_rhino'] or target['is_necromant']) and target['controller'] == 'bot':
                        pass
                    else:
                        if (target['act'] == None or (target['act'] != None and target['act'][0] != 'perekat')):
                            if not target['fell']:
                                game['effecttext'] += 'üö∑|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –∏ –ø–∞–¥–∞–µ—Ç!\n'
                                target['fell'] = True
                                if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                                    if target['stun'] > 0:
                                        target['stun'] += 1
                                    else:
                                        target['stun'] = 2
                                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'

                if not target['fell']:
                    if can_fell:
                        game['effecttext'] += 'üö∑|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –∏ –ø–∞–¥–∞–µ—Ç!\n'
                        target['fell'] = True
                        if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                            if target['stun'] > 0:
                                target['stun'] += 1
                            else:
                                target['stun'] = 2
                            game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
            firearrow = False
            if player['weapon'].name == '–õ—É–∫' and player['firearrow']:
                damage = 0
                firearrow = True
            bicepc = False
            multicast = False
            damage += weapon.dmgbonus
            if player['weapon'].name == '–û–±—Ä–µ–∑' or player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫':
                if target['id'] in player['nearplayers']:
                    damage += 1
                    try:
                        if player['weapon'].lvl == 3 and player['weapon'].name == '–û–±—Ä–µ–∑':
                            damage += 1
                    except:
                        pass
                    if player['weapon'].name == '–û–±—Ä–µ–∑' and player['weapon'].lvl == 4 and player['weapon'].modification == 2 and random.randint(1, 100) <= 75:
                        if target['blood'] <= 0:
                            target['blood'] = 4
                            if 'dvuzhil' in target['skills']:
                                target['blood'] += 2
                            target['blood'] += get_target_dvuzhil(target)
                            game['text'] += '‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                        else:
                            if target['blood'] > 1:
                                target['blood'] -= 1
                            game['text'] += '‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ ' + target['name'] + ' —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'
            if player['weapon'].name == '–ö–∞—Å—Ç–µ—Ç' and target['act'] != None and target['act'][0] == 'reload':
                if target['is_vurdalak']:
                    game['effecttext'] += '‚ö°Ô∏è' + target['name'] + ' –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —É–¥–∞—Ä –∫–∞—Å—Ç–µ—Ç–æ–º.\n'
                    # target['energy'] = target['maxenergy']
                else:
                    en = 4
                    try:
                        if player['weapon'].lvl == 1:
                            en = 3
                        if player['weapon'].lvl == 2:
                            en = 4
                        if player['weapon'].lvl == 3:
                            en = 5
                        if player['weapon'].lvl == 4:
                            en = 5
                    except:
                        pass
                    game['effecttext'] += '‚ö°Ô∏è' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(en) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                    target['lostenergy'] += en
            if player['weapon'].name == '–ü–æ–ª–∏—Ü–µ–π—Å–∫–∞—è –¥—É–±–∏–Ω–∫–∞' and random.randint(1, 100) <= 100:
                losten = 1
                try:
                    if player['weapon'].lvl == 3 or player['weapon'].lvl == 4:
                        losten = 2
                except:
                    pass
                target['lostenergy'] += losten
                if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                    target['policestun'] = True
                game['effecttext'] += '‚ö°Ô∏è' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(losten) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n'
            if player['weapon'].name == '–ö–∞—Å—Ç–µ—Ç' and player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                target['lostenergy'] += 1
                game['effecttext'] += '‚ö°Ô∏è' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(1) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n'
            if player['weapon'].name == '–†—É–∫–∞ —Ç—Ä–µ–Ω—Ç–∞':
                target['roots'].append([player['id'], 2])

            bchance = 30
            if game['classic_game']:
                bchance = 25
            if 'bicepc?1' in player['skills']:
                bchance = 15
            if 'bicepc?2' in player['skills']:
                bchance = 25
            if 'bicepc?3' in player['skills']:
                bchance = 40
            if ('bicepc' in player['skills'] or 'bicepc?1' in player['skills'] or 'bicepc?2' in player[
                'skills'] or 'bicepc?3' in player['skills'] or 'bicepc_classic' in player['skills']) \
                    and not player['weapon'].ranged and random.randint(1, 100) <= bchance:
                damage = damage * 2
                bicepc = True
                # player['bicepc'] = False
            if 'multicast' in player['skills'] and player['multicast'] == 2 and random.randint(1, 100) <= 75:
                damage = damage * 2
                multicast = True
            if 'multicast' in player['skills'] and player['multicast'] == 3 and random.randint(1, 100) <= 50:
                damage = damage * 3
                multicast = True
            if 'multicast' in player['skills'] and player['multicast'] == 4 and random.randint(1, 100) <= 25:
                damage = damage * 4
                multicast = True
            claws_biceps = False
            if player['weapon'].name == '–°—Ç–∞–ª—å–Ω—ã–µ –∫–æ–≥—Ç–∏' and player['weapon'].lvl == 4 and player['weapon'].modification == 1 and random.randint(1, 100) <= 25:
                claws_biceps = True
                damage = damage*2
            parry = False
            if target['act'] != None and target['act'][0] == 'parry' and target['act'][1] == player[
                'id'] and damage > 0:
                damage -= 1000
                parry = True
                if target['weapon'].lvl == 4 and target['weapon'].modification == 2:
                    set_energy(game, target, target['maxenergy'])
                    game['effecttext'] += 'üò§|–≠–Ω–µ—Ä–≥–∏—è ' + target['name'] + ' –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!\n'
                minusen = player['energy']
                try:
                    if target['weapon'].lvl == 1:
                        minusen = 4
                    if target['weapon'].lvl == 2:
                        minusen = player['energy']
                    if target['weapon'].lvl == 3:
                        minusen = player['energy']
                        if player['stun'] > 0:
                            player['stun'] += 1
                        else:
                            player['stun'] = 2
                        game['effecttext'] += 'üåÄ|' + player['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'

                except:
                    pass
                player['energy'] -= minusen
                if damage < 0:
                    target['saberblock'] = [player['id'], abs(damage)]
            pdamage = True
            vampiretext = ''
            firetext = ''
            if player['weapon'].name == '–ö–ª—ã–∫–∏ –≤–∞–º–ø–∏—Ä–∞':
                if random.randint(1, 100) <= 50:
                    # if player['vampirebites'] >= 1:
                    target['hp'] -= 1
                    player['hp'] += 1
                    # if player['hp'] > player['maxhp']:
                    #    player['hp'] = player['maxhp']
                    vampiretext = 'ü©∏|' + player['name'] + ' –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç –∂–∏–∑–Ω—å –∏–∑ ' + target['name'] + '!\n'
                    vampiretext += '‚ô•' * target['hp'] + '|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç 1 –∂–∏–∑–Ω—å. –û—Å—Ç–∞—ë—Ç—Å—è ' + str(
                        target['hp']) + ' —Ö–ø.\n'
                    vampiretext += '‚ô•' * player['hp'] + '|' + player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç 1 –∂–∏–∑–Ω—å. –û—Å—Ç–∞—ë—Ç—Å—è ' + str(
                        player['hp']) + ' —Ö–ø.'
            frozenaddtext = ''
            if player['weapon'].name == '–ú–æ—Ä–æ–∑–Ω—ã–π –ª—É–∫':
                if random.randint(1, 100) <= 100:
                    all_buttons = ["attack", "reload", "perekat", "addition"]
                    frozen_button = random.choice(all_buttons)
                    target['frozen_buttons'].append([frozen_button, 2])
                    frozentext = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
                    if frozen_button == "attack":
                        frozentext = "–ê—Ç–∞–∫–∞"
                    if frozen_button == "reload":
                        frozentext = "–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞"
                    if frozen_button == "skip":
                        frozentext = "–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ (–ø–æ—Ç—É—à–∏—Ç—å—Å—è)"
                    if frozen_button == "perekat":
                        frozentext = "–ü–µ—Ä–µ–∫–∞—Ç"
                    if frozen_button == "addition":
                        frozentext = "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"
                    if target['controller'] == 'bot':
                        frozenaddtext += "üî•‚ùÑÔ∏è" + target[
                            'name'] + ' —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–µ—Ç—Å—è –∑–∞–º–æ—Ä–æ–∑–∫–µ.\n'
                    else:
                        frozenaddtext += "‚ùÑÔ∏è" + target[
                        'name'] + ' –∑–∞–º–µ—Ä–∑–∞–µ—Ç! –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ: "(üîí)' + frozentext + '".\n'
                    # player['vampirebites'] = 0
                # else:
                #    player['vampirebites'] += 1
            lightsword = False
            lightaspect = False
            if player['weapon'].name == '–ú–µ—á –°–≤–µ—Ç–∞':
                if random.randint(1, 100) <= 51:
                    damage += 3
                    lightsword = True
                    target['recoverydebuff'].append([2, 3])  # [0] - —Å–∏–ª–∞ –¥–µ–±–∞—Ñ—Ñ–∞, [1] - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

            if player['light_aspect'] > 0:
                can_aspect = True
                # if '–ö—Ä—ã—Å–∞' in target['name'] and target['controller'] == 'bot':
                #     can_aspect = False
                if target['is_rhino']:
                    can_aspect = False
                if can_aspect:
                    target['recoverydebuff'].append([1, 2])  # [0] - —Å–∏–ª–∞ –¥–µ–±–∞—Ñ—Ñ–∞, [1] - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                    lightaspect = True

            if player['weapon'].name in ['–§–∞–∫–µ–ª', '–û–≥–Ω–µ–º–µ—Ç', '–û–≥–Ω–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª', '–©—É–ø–∞–ª—å—Ü–∞']:
                firechance = 0
                fstrength = 1
                if player['weapon'].name == '–§–∞–∫–µ–ª':
                    if player['weapon'].classic:
                        firechance = 70
                    else:
                        firechance = 50
                    try:
                        if player['weapon'].lvl == 1:
                            firechance = 25
                        if player['weapon'].lvl == 2:
                            firechance = 40
                        if player['weapon'].lvl == 3:
                            firechance = 60
                            if random.randint(1, 100) <= 15:
                                fstrength += 1
                        if player['weapon'].lvl == 4:
                            firechance = 60
                            if player['weapon'].modification == 1:
                                fstrength = 3
                            if player['weapon'].modification == 2:
                                fstrength = 5
                    except:
                        pass
                if player['weapon'].name in ['–©—É–ø–∞–ª—å—Ü–∞']:
                    firechance = 100
                if player['weapon'].name in ['–û–≥–Ω–µ–º–µ—Ç', '–û–≥–Ω–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª']:
                    firechance = 100
                    try:
                        if player['weapon'].lvl == 1:
                            firechance = 75
                        if player['weapon'].lvl == 2:
                            firechance = 100
                        if player['weapon'].lvl == 3:
                            firechance = 100
                            # if random.randint(1, 100) <= 15:
                            #    fstrength += 1
                        if player['weapon'].lvl == 4:
                            firechance = 100
                            if player['weapon'].modification == 2:
                                fstrength += 1
                    except:
                        pass
                if player['weapon'].name == '–û–≥–Ω–µ–º–µ—Ç' and player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                    damage = 0
                if random.randint(1, 100) <= firechance:
                    firetext += setfire(game, player, target, strength=fstrength, duration=3)
                    if player['weapon'].name == '–§–∞–∫–µ–ª' and player['weapon'].modification == 2:
                        firetext += setfire(game, player, player, strength=2, duration=3)

            if firearrow:
                fires = 2
                try:
                    if player['weapon'].lvl == 1:
                        fires = 1
                    if player['weapon'].lvl == 2:
                        fires = 2
                    if player['weapon'].lvl == 3:
                        fires = 3
                    if player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                        fires = 6
                except:
                    pass
                firetext += setfire(game, player, target, strength=fires, duration=3)
                pdamage = False

            if player['weapon'].name == '–õ—É–∫' and player['weapon'].lvl == 4 and player['weapon'].modification == 2 and not firearrow and random.randint(1, 100) <= 40:
                firetext += setfire(game, player, target, strength=3, duration=3)

            if not parry:
                showdmg = damage
            else:
                showdmg = damage + 1000
            if lightsword:
                showdmg -= 3
            if player['weapon'].name == '–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç':
                grenade = player['grenade']
            else:
                grenade = None
            addtarget = None
            doptargets = []
            if grenade != None:
                for ids in game['players']:
                    target2 = game['players'][ids]
                    if target['team'] == player['team']:
                        if target2['team'] == target['team'] and target2['id'] != target['id'] and not target2['dead']:
                            doptargets.append(target2['id'])
                    else:
                        if target2['team'] != player['team'] and target2['id'] != target['id'] and not target2['dead']:
                            doptargets.append(target2['id'])
            if len(doptargets) > 0:
                addtarget = game['players'][random.choice(doptargets)]

            if weapon.name == '–ö–∞–º–µ–Ω—å':
                showdmg = 0
                damage = -1000
            burrowstrike = False
            if player['burrowstrike']:
                burrowstrike = True
            luciferblade = False
            if player['weapon'].name == '–ü—ã–ª–∞—é—â–∏–π –∫–ª–∏–Ω–æ–∫' and player['luciferbladecd'] <= 0:
                luciferblade = True
                damage = 0
                player['luciferbladecd'] = 6
            if lastsnipertarget != None:
                game['text'] += 'üí®‚ùóÔ∏è|'+player['name']+' —Å—Ç—Ä–µ–ª—è–µ—Ç –≤ '+lastsnipertarget['name']+' –∏–∑ —Å–Ω–∞–π–ø–µ—Ä—Å–∫–æ–π –≤–∏–Ω—Ç–æ–≤–∫–∏, –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç. –ü—É–ª—è –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç –≤ –¥—Ä—É–≥—É—é —Ü–µ–ª—å!\n'
            attacktext = getattacktext(game, player, target, showdmg, bicepc, firetext, sokrushtext, chaintext,
                                       narsiltext,
                                       counterattack, execution, executiontext, grenade, addtarget, firearrow,
                                       vampiretext, multicast, lightsword, hitdowntext,
                                       lightaspect, strongshot, burrowstrike, luciferblade, claws_biceps)
            game['text'] += attacktext
            game['text'] += frozenaddtext
            if player["is_knight"] and not player["knight_rifle_talk"] and player["weapon"].name == "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞" and game["dungeon"]:
                player["knight_rifle_talk"] = True
                game['text'] += "üí¨"+player["name"]+": –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è –≤–∏–Ω—Ç–æ–≤–∫–∏ –Ω–µ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–∞, –ø–æ—ç—Ç–æ–º—É —è –Ω–µ–º–Ω–æ–≥–æ –º–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–ª –µ—ë.\n"
            if luciferblade:
                game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
                if target['stun'] > 0:
                    target['stun'] += 1
                else:
                    target['stun'] = 2
                setfire(game, player, target, 4+(player['luciferpower']*2))
            if burrowstrike:
                if not target['fell']:
                    game['effecttext'] += 'üö∑|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –∏ –ø–∞–¥–∞–µ—Ç!\n'
                    target['fell'] = True
            if player['weapon'].name == "–¢–µ–Ω–µ–≤–∞—è –ø—É—à–∫–∞":
                target['hp'] -= 1
                game['text'] += '‚ô•' * target['hp'] + '|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç 1 —Ö–ø. –û—Å—Ç–∞—ë—Ç—Å—è ' + str(
                    target['hp']) + ' —Ö–ø.\n'
                if target['stun'] <= 0:
                    target['stun'] = 2
                else:
                    target['stun'] += 1
                game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
            if player['weapon'].name == '–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç –æ–≥—Ä–∞' and random.randint(1, 100) <= 35:
                ogretarget = None
                ogretargets = []
                if player['weapon'].name == '–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç –æ–≥—Ä–∞':
                    for ids in game['players']:
                        target2 = game['players'][ids]
                        if not target2['dead']:
                            ogretargets.append(target2['id'])
                if len(ogretargets) > 0:
                    ogretarget = game['players'][random.choice(ogretargets)]
                    ogredmg = random.randint(2, 4)
                    game['text'] += 'üí£|–ì—Ä–∞–Ω–∞—Ç–æ–º–µ—Ç –æ–≥—Ä–∞ —Å–ª—É—á–∞–π–Ω–æ –≤—ã—Å—Ç—Ä–µ–ª–∏–≤–∞–µ—Ç –≤ ' + ogretarget[
                        'name'] + '! –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ' + str(ogredmg) + ' —É—Ä–æ–Ω–∞.\n'
                    ogreshowdmg, ogrearmortext = takedamage(game, player, ogretarget, ogredmg)
                    game['text'] += ogrearmortext
            if parry:
                game['text'] += 'üó°|' + target['name'] + ' –ø–∞—Ä–∏—Ä—É–µ—Ç –∞—Ç–∞–∫—É ' + player['name'] + '! –£—Ä–æ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, ' + \
                                player['name'] + ' —Ç–µ—Ä—è–µ—Ç –≤—Å—é —ç–Ω–µ—Ä–≥–∏—é!\n'
            if player['weapon'].name == '–ü–∏–ª–æ–º–µ—Ç':
                # if player['sawhits'] >= 1:
                sawchance = 60
                addcuts = 1
                try:
                    if player['weapon'].lvl == 1:
                        sawchance = 50
                    if player['weapon'].lvl == 2:
                        sawchance = 60
                    if player['weapon'].lvl == 3:
                        sawchance = 70
                        addcuts = 2
                    if player['weapon'].lvl == 4:
                        sawchance = 70
                        addcuts = 2
                        if player['weapon'].modification == 1:
                            addcuts = random.randint(2, 4)
                except:
                    pass
                if random.randint(1, 100) <= sawchance:
                    target['addcuts'] += addcuts
                    game['text'] += 'ü©∏|' + target['name'] + ' —Ä–∞–Ω–µ–Ω! (' + str(
                        target['cuts'] + target['addcuts']) + ')\n'
                    player['sawhits'] = 0
                # else:
                #    player['sawhits'] += 1
            if 'robot' in player['skills']:
                player['addperegrev'] += (damage * 7)
            if player['weapon'].name in ['–ù–æ–∂', '–ö–∞—Ç–∞–Ω–∞', "–ö–æ–≥—Ç–∏ –¥—Ä–∞–∫–æ–Ω–∞"]:
                if player['weapon'].name == '–ù–æ–∂':
                    bloodchance = 75
                    if player['weapon'].classic:
                        bloodchance = 50

                if player['weapon'].name == '–ö–∞—Ç–∞–Ω–∞':
                    bloodchance = 99
                    if player['weapon'].classic:
                        bloodchance = 20
                    # player['knifehits'] = 0
                    # else:
                    #   player['knifehits'] += 1
                if player["weapon"].name == "–ö–æ–≥—Ç–∏ –¥—Ä–∞–∫–æ–Ω–∞":
                    bloodchance = 50
                if random.randint(1, 100) <= bloodchance:
                    if target['blood'] <= 0:
                        target['blood'] = 4
                        if 'dvuzhil' in target['skills']:
                            target['blood'] += 2
                        target['blood'] += get_target_dvuzhil(target)
                        game['text'] += '‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                    else:
                        if target['blood'] > 1:
                            target['blood'] -= 1
                        game['text'] += '‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ ' + target['name'] + ' —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'
                    try:
                        if player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                            target['blood'] = 1
                            target['blood'] += get_target_dvuzhil(target)

                    except:
                        pass

            if player['weapon'].name == '–ú—Ä–∞–º–æ—Ä–Ω–∞—è –∫–æ–ª–æ–Ω–Ω–∞':
                if target['blood'] <= 0:
                    target['blood'] = 4

                    if 'dvuzhil' in target['skills']:
                        target['blood'] += 2
                    target['blood'] += get_target_dvuzhil(target)
                    game['text'] += '‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                else:
                    if target['blood'] > 1:
                        target['blood'] -= 1
                    game['text'] += '‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ ' + target['name'] + ' —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'
                if random.randint(1, 100) <= 100:
                    if target['stun'] <= 0:
                        target['stun'] = 2
                    else:
                        target['stun'] += 1
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
                if not target['fell']:
                    game['effecttext'] += 'üö∑|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –∏ –ø–∞–¥–∞–µ—Ç!\n'
                    target['fell'] = True

            if player['weapon'].name == '–ë–∏—Ç–∞':
                stunchance = 30
                if player['weapon'].classic:
                    stunchance = 20
                try:
                    if player['weapon'].lvl == 1:
                        stunchance = 10
                    if player['weapon'].lvl == 2:
                        stunchance = 20
                    if player['weapon'].lvl == 3:
                        stunchance = 35
                    if player['weapon'].lvl == 4:
                        if player['weapon'].modification == 1:
                            stunchance = 50
                        elif player['weapon'].modification == 2:
                            stunchance = 35
                except:
                    pass
                if random.randint(1, 100) <= stunchance:
                    # if player['baseballhits'] >= 3:
                    if target['stun'] <= 0:
                        target['stun'] = 2
                    else:
                        target['stun'] += 1
                    dt = ''
                    if player['weapon'].modification == 2:
                        target['stun'] += 1
                        dt = ' (2)'
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!'+dt+'\n'
                    player['baseballhits'] = 0

            if player['charge']:
                if player['weapon'].name == '–†–æ–≥' and random.randint(1, 100) <= 70:
                    if target['stun'] <= 0:
                        target['stun'] = 2
                    else:
                        target['stun'] += 1
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
            if player['weapon'].name == '–ö–∞–º–µ–Ω—å':
                if random.randint(1, 100) <= 100:
                    if target['stun'] <= 0:
                        target['stun'] = 2
                    else:
                        target['stun'] += 1
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
            # if player['weapon'].name == '–≠–ª–µ–∫—Ç—Ä–æ—à–æ–∫–µ—Ä':
            #    if target['act'] != None and target['act'][0] == 'skip':
            #       if target['stun'] <= 0:
            #            target['stun'] = 2
            #        else:
            #            target['stun'] += 1
            #       game['effecttext'] += 'üåÄ|'+target['name']+' –æ–≥–ª—É—à–µ–Ω!\n'
            if player['weapon'].name == '–≠–ª–µ–∫—Ç—Ä–æ—à–æ–∫–µ—Ä' and random.randint(1, 100) <= 75:
                # target['energy'] -= 1
                target['maxenergy'] -= 1
                target['electrolostenergy'] += 1
                game['effecttext'] += '‚ö°Ô∏è|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç 1 –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.\n'
            if player['weapon'].name == '–¢–æ–ø–æ—Ä':
                # if player['axehits'] >= 1:
                cchance = 70
                if player['weapon'].classic:
                    cchance = 70
                am = 1
                try:
                    am = 1
                    if player['weapon'].lvl == 1:
                        cchance = 40
                    if player['weapon'].lvl == 2:
                        cchance = 60
                    if player['weapon'].lvl == 3:
                        cchance = 80
                        am = 2
                    if player['weapon'].lvl == 4:
                        am = 2
                        cchance = 80
                        if player['weapon'].modification == 1:
                            am = 4
                except:
                    pass
                if random.randint(1, 100) <= cchance:
                    if '–í—É—Ä–¥–∞–ª–∞–∫' in target['name'] and target['controller'] == 'bot' and game['dungeon']:
                        maxdlimit = 3
                    else:
                        maxdlimit = 2
                    if target['dmglimit'] > maxdlimit:
                        target['dmglimit'] -= am
                        if target['dmglimit'] < maxdlimit:
                            target['dmglimit'] = maxdlimit
                        game['effecttext'] += 'ü§ï|' + target['name'] + ' –ø–æ–∫–∞–ª–µ—á–µ–Ω! (' + str(am) + ')\n'
                        player['axehits'] = 0
                # else:
                #    player['axehits'] += 1
            if addtarget != None:
                if grenade == 'grenade':
                    adddmg = damage
                    if parry:
                        adddmg += 1000
                    armor, text = getarmor(game, addtarget, damage)
                    adddmg -= armor
                    game['text'] += text
                    if addtarget['shield']:
                        adddmg = 0
                    if adddmg > 0:
                        addtarget['incomingdmgs'].append([player['id'], adddmg])
                        player['outgoingdmgs'].append([addtarget['id'], adddmg])
                elif grenade == 'molotov':
                    setfire(game, player, addtarget, strength=1, duration=3)
                if 'pyromancer' in player['skills']:
                    # if grenade != "molotov":
                    player['pyrodamage'] = True
            if grenade != 'molotov':
                if player['weapon'].name == "–¢–µ—Å–∞–∫" and not player['first_hit'] and player['weapon'].lvl == 4 and \
                        player['weapon'].modification == 2:
                    pass
                else:
                    armor, text = getarmor(game, target, damage)
                    damage -= armor
                    game['text'] += text
                if target['shield']:
                    if player['weapon'].name == "–¢–µ—Å–∞–∫" and not player['first_hit'] and player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                        pass
                    else:
                        damage = 0
                if damage > 0:
                    target['incomingdmgs'].append([player['id'], damage])
                    player['outgoingdmgs'].append([target['id'], damage])
                    if player['weapon'].name == 'One punch':
                        target['punchdead'] = True
            else:
                setfire(game, player, target, strength=1, duration=3)
                pdamage = True
            if 'pyromancer' in player['skills'] and pdamage:
                player['pyrodamage'] = True


        else:
            burrowstrike = False
            if player['burrowstrike']:
                burrowstrike = True
            luciferblade = False
            if player['weapon'].name == '–ü—ã–ª–∞—é—â–∏–π –∫–ª–∏–Ω–æ–∫' and player['luciferbladecd'] <= 0:
                luciferblade = True
                player['luciferbladecd'] = 6
            if granatomet:
                parry = False
                return damage, parry
            if drobovik_hasnocharges:
                game['text'] += 'üí®|' + player[
                    'name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã—Å—Ç—Ä–µ–ª–∏—Ç—å –∏–∑ –¥—Ä–æ–±–æ–≤–∏–∫–∞, –Ω–æ –≤ –æ–±–æ–π–º–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ç—Ä–æ–Ω—ã.\n'
            else:
                misstext = getmisstext(game, player, target, sokrushtext, chaintext, narsiltext, burrowstrike=burrowstrike, luciferblade = luciferblade)
                game['text'] += misstext
        player['attackedthisturn'] = True
        for ids in player['infected_weapon']:
            player['energy'] -= 1
            if player['energy'] < 0:
                player['energy'] = 0
        if player['weapon'].name == '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª' and player['narsil']:
            game['effecttext'] += 'üëê|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ!\n'
            player['lostweapon'] = True
        if 'robot' in player['skills']:
            if random.randint(1, 100) <= player['peregrev']:
                player['hp'] -= 1
                game['text'] += '‚ô®Ô∏è|–ò–∑-–∑–∞ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞ ' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç –∂–∏–∑–Ω—å!\n'
                game['text'] += '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                    1) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(player['hp']) + ' —Ö–ø.\n'

    if player['energy'] <= 0:
        player['waszero'] = True
    if not sokrush and not chain:
        if not player['sokrushenie'] and not player['chain']:
            if not counterattack:
                ecost = weapon.energycost
                if player['weapon'].name == '–õ—É–∫ –ê—Å–≥–∞—Ä–¥':
                    ecost += (player['bowcharge'])
                    if ecost > 5:
                        ecost = 5
                if player['weapon'].name == '–ö–∞—Ç–∞–Ω–∞' and execution:
                    ecost += 3
                if player['weapon'].name == '–û–±—Ä–µ–∑' and player['strongshot']:
                    ecost += 100
                    player['obrezcd'] = 4
                if player['truestrike']:
                    dopecost = 2
                    try:
                        if player['weapon'].lvl == 1:
                            dopecost = 3
                    except:
                        pass
                    ecost += dopecost
                player['energy'] -= ecost
                if player['weapon'].name == '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª' and player['narsil']:
                    player['energy'] -= 1
                    player['narsilcd'] = 6
    else:
        if player['sokrushenie']:
            ecost = 4
            try:
                if player['weapon'].lvl == 1:
                    ecost = 5
                if player['weapon'].lvl == 2:
                    ecost = 4
                if player['weapon'].lvl == 3:
                    ecost = 3
            except:
                pass
            player['energy'] -= ecost
            player['sokrusheniecd'] = sokrushcd
            if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                player['sokrusheniecd'] = 0
        elif player['chain']:
            player['energy'] -= 2
            player['chaincd'] = chaincd
            if player['weapon'].lvl == 4 and player['weapon'].modification == 1:
                player['chaincd'] -= 1
    player['maintarget'] = None
    player['lasttarget'] = target['id']


def getarmor(game, player, damage, ignore_armor = False):
    armor = 0
    if not ignore_armor:
        if 'armor' in player['skills'] and random.randint(1, 100) <= 40 and not player['wasarmor_from_armorskill']:
            armor += 1
            player['wasarmor_from_armorskill'] = True
        if 'armor?1' in player['skills'] and random.randint(1, 100) <= 10 and not player['wasarmor_from_armorskill']:
            armor += 1
            player['wasarmor_from_armorskill'] = True
        if 'armor?2' in player['skills'] and random.randint(1, 100) <= 15 and not player['wasarmor_from_armorskill']:
            armor += 1
            player['wasarmor_from_armorskill'] = True
        if 'armor?3' in player['skills'] and random.randint(1, 100) <= 20 and not player['wasarmor_from_armorskill']:
            armor += random.randint(1, 2)
            player['wasarmor_from_armorskill'] = True
        if 'armor_classic' in player['skills'] and random.randint(1, 100) <= 25 and not player['wasarmor_from_armorskill']:
            armor += 1
            player['wasarmor_from_armorskill'] = True
        if player['selfarmor'] > 0 and random.randint(1, 100) <= player['selfarmorchance'] and not player[
            'wasarmor_from_selfarmor']:
            armor += player['selfarmor']
            player['wasarmor_from_selfarmor'] = True
    if not ignore_armor:
        if not game['classic_game']:
            for idss in player['hitins']:
                armor += 2
        else:
            if not player['wasarmor_from_hitin']:
                for idss in player['hitins']:
                    armor += 2
                player['wasarmor_from_hitin'] = True
    if not ignore_armor:
        if 'cherep' in player['skills'] and random.randint(1, 100) <= 50 and not player['wasarmor_from_cherep']:
            armor += 1
            player['wasarmor_from_cherep'] = True
        if ('cherep?1' in player['skills'] or 'cherep?2' in player['skills'] or 'cherep?3' in player['skills']):
            chance = 20
            blk = 1
            if 'cherep?2' in player['skills']:
                chance = 30
            if 'cherep?3' in player['skills']:
                chance = 40
                blk = random.randint(1, 2)
            if random.randint(1, 100) <= chance:
                armor += blk
                player['wasarmor_from_cherep'] = True
    for ids in player["armor_debuff"]:
        armor -= player["armor_debuff"][ids]["power"]
    if armor > damage:
        doparmor = armor - damage
        if doparmor > 0:
            player['dopblock'] += doparmor
        armor = damage
    #print('armor1=' + str(armor))
    shieldarmor = 0
    iceheartarmor = 0
    brokenshield = False
    if damage > armor:
        dblock = damage - armor
        if dblock > player['dopblock']:
            dblock = player['dopblock']
        player['dopblock'] -= dblock
        armor += dblock
    if damage > armor and player['shieldarmor'] > 0 and player['weaponshield']:
        shieldarmor = damage - armor
        if shieldarmor > player['shieldarmor']:
            shieldarmor = player['shieldarmor']
        player['shieldarmor'] -= shieldarmor
        if player['shieldarmor'] <= 0:
            brokenshield = True
    armor += shieldarmor
    brokenheart = False
    if damage > armor and player['iceheart'] > 0 and not player['shield']:
        iceheartarmor = damage - armor
        if iceheartarmor > player['iceheart']:
            iceheartarmor = player['iceheart']
        player['iceheart'] -= iceheartarmor
        if player['iceheart'] <= 0:
            brokenheart = True
    armor += iceheartarmor
    if armor > 0:
        if 'semw_armor' in player['customtexts'] and player['customtexts']['semw_armor']:
            text = 'ü™ñ|' + player['name'] + ' –≤ —Å–≤–æ–µ–π –±—Ä–æ–Ω–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º—ã–º, —Å–Ω–∏–º–∞—è –≤—Å–µ–≥–æ ' + str(armor) + ' —É—Ä–æ–Ω–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–±–µ–∂–¥–∞—Ç—å –≤—Ä–∞–≥–æ–≤!\n'
        else:
            text = 'üõ°| –ë—Ä–æ–Ω—è ' + player['name'] + ' —Å–Ω–∏–º–∞–µ—Ç ' + str(armor) + ' —É—Ä–æ–Ω–∞!\n'
        if brokenshield:
            text += 'üî¥|–©–∏—Ç ' + player['name'] + ' —Å–ª–æ–º–∞–ª—Å—è!\n'
            player['weapon'] = weaponlist.Fist()
        if brokenheart:
            text += 'üíî|–õ–µ–¥—è–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ ' + player['name'] + ' —Ç—Ä–µ—Å–Ω—É–ª–æ! –ë–æ–µ—Ü —Ç–µ—Ä—è–µ—Ç 1‚ô•Ô∏è.\n'
            player['iceheart'] = 0
            player['hp'] -= 1
        # player['washitin'] = True
    else:
        text = ''
    #print('armor2=' + str(armor))
    return armor, text


def takedamage(game, player, target, dmg, ignoreshield = False):
    showdmg = dmg
    if dmg > 0:
        player['demon'] = True
    if not target['washitin']:
        ignore_armor = False
        if player['weapon'].name == '–ê—Ä–±–∞–ª–µ—Ç':
            ignore_armor = True
        armor, text = getarmor(game, target, dmg, ignore_armor)
    else:
        print('–°–Æ–î–ê –ù–ï –î–û–õ–ñ–ù–û –ë–´–õ–û –î–û–ô–¢–ò –ù–ê–•–£–ô, def takedamage(), –î–û–î–ï–õ–´–í–ê–ô –§–£–ù–ö–¶–ò–Æ')
        armor = target['dopblock']
        if armor < 0:
            armor = 0
        if dmg < armor:
            armor = dmg
        shieldarmor = 0
        iceheartarmor = 0
        brokenshield = False
        if dmg > armor and player['shieldarmor'] > 0 and player['weaponshield']:
            shieldarmor = dmg - armor
            if shieldarmor > player['shieldarmor']:
                shieldarmor = player['shieldarmor']
            player['shieldarmor'] -= shieldarmor
            if player['shieldarmor'] <= 0:
                brokenshield = True
        armor += shieldarmor
        brokenheart = False
        if dmg > armor and player['iceheart'] > 0 and not player['shield']:
            iceheartarmor = dmg - armor
            if iceheartarmor > player['iceheart']:
                iceheartarmor = player['iceheart']
            player['iceheart'] -= iceheartarmor
            if player['iceheart'] <= 0:
                brokenheart = True
        armor += iceheartarmor
        text = ''
        if armor > 0:
            if 'semw_armor' in player['customtexts'] and player['customtexts']['semw_armor']:
                text = 'ü™ñ|' + target['name'] + ' –≤ —Å–≤–æ–µ–π –±—Ä–æ–Ω–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º—ã–º, —Å–Ω–∏–º–∞—è –≤—Å–µ–≥–æ ' + str(armor) + ' —É—Ä–æ–Ω–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–±–µ–∂–¥–∞—Ç—å –≤—Ä–∞–≥–æ–≤!\n'
            else:
                text = 'üõ°| –ë—Ä–æ–Ω—è ' + target['name'] + ' —Å–Ω–∏–º–∞–µ—Ç ' + str(armor) + ' —É—Ä–æ–Ω–∞!\n'
        if brokenshield:
            text += 'üî¥|–©–∏—Ç ' + player['name'] + ' —Å–ª–æ–º–∞–ª—Å—è!\n'
            player['weapon'] = weaponlist.Fist()
        if brokenheart:
            text += 'üíî|–õ–µ–¥—è–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ ' + player['name'] + ' —Ç—Ä–µ—Å–Ω—É–ª–æ! –ë–æ–µ—Ü —Ç–µ—Ä—è–µ—Ç 1‚ô•Ô∏è.\n'
            player['iceheart'] = 0
            player['hp'] -= 1
    dmg -= armor
    # target['dopblock'] -= armor
    if (not target['shield']) or ignoreshield:
        if dmg > 0:
            # print('dmg to '+target['name']+': '+str(dmg))
            player['outgoingdmgs'].append([target['id'], dmg])
            target['incomingdmgs'].append([player['id'], dmg])
    return showdmg, text

def get_remain_dm_deaths(game):
    deaths_left = game["sum_dm_deaths"]
    for ids in game["players"]:
        player = game["players"][ids]
        if player["count_as_dm"]:
            deaths_left -= player["dm_deaths"]
    return deaths_left

def reborn_player(game, player):
    player["dm_deaths"] += 1
    player["hp"] = player["maxhp"]
    player["energy"] = player["maxenergy"]
    player["blood"] = 0
    player["stun"] = 0
    deaths_left = get_remain_dm_deaths(game)
    game["text"] += "üëª"+player["name"]+ " –≤–æ–∑—Ä–æ–∂–¥–∞–µ—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –∑–¥–æ—Ä–æ–≤—å–µ–º! –û—Å—Ç–∞–ª–æ—Å—å —Å–º–µ—Ä—Ç–µ–π –¥–æ –∫–æ–Ω—Ü–∞ –º–∞—Ç—á–∞: "+str(deaths_left)+"\n"

def deadplayer(game, player, enemys_sadist, skeletons):
    if player['team'] == 'dummys':
        player['hp'] = 6
        return
    if game["dm"]:
        reborn_player(game, player)
        return
    if player['team'] == 'dark' and '–ê–º–∞–ª—å–≥–∞–º–∞' in player['name'] and player['controller'] == 'bot':
        ttt = 'üò±|' + player['name'] + ' –∏–∑–¥–∞–µ—Ç –ø—Ä–µ–¥—Å–º–µ—Ä—Ç–Ω—ã–π –≤–æ–π.\n'
        game['text'] += ttt
        for idss in game['players']:
            target = game['players'][idss]
            if target['team'] != player['team']:
                if target['pressed_info']:
                    dc = 4
                    h = 'üíú'
                else:
                    dc = 10
                    h = 'üñ§'
                target['dark_counter'] = dc
                darktext = h + '|Ã∏Õ°Õ¢ÃÄÃùÕà' + player[
                    'name'] + ' –øÃ∑ÃõÕúÃÇÕíÃ£ÃØ–æÃ∑Õ†ÕúÃäÃåÃäÃ©Ã•–≥Ã∑“áÕ¢ÕõÃ±Õö—ÄÃ∂ÕùÕúÕõÃâÃ§ÃôÃó—ÉÃ∏ÕûÕúÃãÕõÃñ–∂Ã∏Õ†ÕúÃÇÃΩÃ¨–∞ÃµÕùÃ°ÕõÕöÃ≥–µ“à“áÃ°ÕÅÕäÕéÃ≠Ãô—ÇÃ∑“áÃ°ÕÑÃáÃæÃÆÕà —ÄÃ∏Õ†ÃßÕóÃêÃÆÃó–∞Ã∑ÕûÃ°ÕÅÃ¨–∑Ã∏ÃõÃ®ÕÅÃÖÃ£Ã¶—ÉÃ∏Õ†ÃßÃÅÃáÃ´Ã†Ã≥–º“àÕ°ÕúÕíÕâÃ©Õé ' + \
                           target['name'] + ' –≤Ã∑“áÃ¢ÃæÕçÃ¶ÕÖ–æ“àÃõÃ¢ÕõÕô —ÇÃ∂Õ†Ã®ÕãÃÖÕóÕï—åÃ¥Õ†ÃßÕëÃ¨–ºÃµÕ°ÕúÕÅÃéÃÆÃ§Ã≠—ÉÃ∏ÃõÃ°ÃíÕîÕâÃØ.Ã∑Õ°Ã°ÃÜÃçÃâÕà ' + target[
                               'name'] + \
                           ' —á“âÃõÕ¢ÃÉÃÄÕâÃúÕà—ÉÃµÕûÃßÕÇÃñÃ≠–≤“âÕùÕúÕÇÕáÃ£Ã∞—ÅÃ∏ÕùÃ®ÕãÃçÕÇÕöÕö—Ç“àÕûÃ¢ÃÑÃéÕÑÃò–≤Ãµ“áÕúÃîÃèÃ±—ÉÃ∂Õ°Õ¢ÕÑÃù–µÃµÃïÃ®ÃÜÃÅÃò—Ç“â“áÃ®ÕÜÃöÕïÕéÃ• —ÅÃ∑ÃõÕúÃàÕóÃ´—Ç“âÕ†ÃßÕÉÃãÃ´—Ä“âÕûÃ°ÃøÃöÃçÃúÕöÃ§–∞Ã∂“áÕ¢ÕÅÃöÃÄÕâÃó—ÖÃ∂Õ†Ã®ÕÄÃçÃåÕôÃû (' + str(
                    target['dark_counter']) + \
                           ').\n'
                game['text'] += darktext
                if target['dark_counter'] >= 5:
                    if not target['dead']:
                        game['text'] += 'üíÄ|' + target[
                            'name'] + ' —Å–ª–∏—à–∫–æ–º –Ω–∞–ø—É–≥–∞–Ω, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–æ—Ö–æ–¥. –û–Ω –∫–æ–Ω—á–∞–µ—Ç –∂–∏–∑–Ω—å —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ–º.\n'
                        target['dead'] = True
    if player['team'] == 'dark' and player['controller'] == 'bot' and player['cant_die'] and '–¢–µ–Ω—å –∫—Ä—ã—Å—ã' in player[
        'name']:
        return
    if player['team'] == 'dark' and player['controller'] == 'bot' and '–¢—å–º–∞' in player['name']:
        if player['dark_die_stage'] > 0:
            return
        else:
            player['dark_die_stage'] = 3
            game['text'] += 'üìú|–£ ' + player['name'] + ' –æ—Å—Ç–∞–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–ª–∞–∑ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ, –∞ –∏–∑ —Ç–µ—Ö –º–µ—Å—Ç, –≥–¥–µ ' + \
                            '—Ä–∞–Ω—å—à–µ –±—ã–ª–∏ –≥–ª–∞–∑–∞ –ø–æ–º–µ–Ω—å—à–µ, —Å—Ç—Ä—É–∏—Ç—Å—è —Ç–µ–º–Ω—ã–π –¥—ã–º. –ù–µ—á—Ç–æ –∑–∞–º–µ–¥–ª–∏–ª–æ—Å—å, –∫–∞–∫ –±—É–¥—Ç–æ —ç—Ç–æ –≤—ã—Ç–µ–∫–∞—é—Ç –µ–≥–æ —Å–∏–ª—ã.\n' + \
                            'üìú–í—ã —Å–æ–±—Ä–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–ª—ã –∏ –Ω–∞–Ω–µ—Å–ª–∏ —É–¥–∞—Ä –ø–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–º—É —Ç—É–ª–æ–≤–∏—â—É —Å—É—â–µ—Å—Ç–≤–∞.\n' + \
                            '–°—É—â–µ—Å—Ç–≤–æ –≤–∑–¥—Ä–æ–≥–Ω—É–ª–æ, –∏ –µ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Å—Ç–∞–≤—à–∏–π—Å—è –≥–ª–∞–∑ –Ω–∞—á–∞–ª –∏—Å–ø—É—Å–∫–∞—Ç—å —á–µ—Ä–Ω—ã–π —Å–≤–µ—Ç. –ò–º–µ–Ω–Ω–æ —Å–≤–µ—Ç - ' + \
                            '–≤—Å–µ, —á–µ–≥–æ –∫–∞—Å–∞–ª–∏—Å—å "–ª—É—á–∏" —ç—Ç–æ–≥–æ —Å–≤–µ—Ç–∞, –ø–æ–≥—Ä—É–∂–∞–ª–æ—Å—å –≤–æ –º—Ä–∞–∫, –∏ –≤—ã –Ω–µ –≤–∏–¥–µ–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–∏—á–µ–≥–æ –≤ —ç—Ç–∏—Ö –º–µ—Å—Ç–∞—Ö.' + \
                            ' –ù–µ—á—Ç–æ –Ω–∞—á–∞–ª–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä—è—Å—Ç–∏—Å—å, –∏—Å–ø—É—Å–∫–∞—è –≤—Å–µ –±–æ–ª—å—à–µ —Ç–µ–º–Ω—ã—Ö –ª—É—á–µ–π –≤–æ –≤—Å–µ —Å—Ç–æ—Ä–æ–Ω—ã, —è–≤–Ω–æ –ø—Ä–µ–¥–≤–µ—â–∞—è –Ω–µ—á—Ç–æ –Ω–µ—Ö–æ—Ä–æ—à–µ–µ. ' + \
                            '–í—ã —Ä–µ—à–∞–µ—Ç–µ, —á—Ç–æ –Ω–∞–¥–æ —á—Ç–æ-—Ç–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—å.\n'
            game['can_hide_dark'] = True
            return
    if 'demonlord' in player['skills'] and player['demonlordform'] == False:
        player['demonlordform'] = True
        game['text'] += '‚ù§Ô∏è‚Äçüî•|' + player['name'] + ' –æ–±—Ä–µ—Ç–∞–µ—Ç –∏—Å—Ç–∏–Ω–Ω—É—é —Ñ–æ—Ä–º—É!\n'
        player['dmglimit'] = 10000
        player['maxdmglimit'] = 10000
        player['hp'] = 4
        player['maxhp'] = 6
        player['energy'] = player['maxenergy']

    else:
        player['dead'] = True
        if '–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç' in player['name'] and player['controller'] == 'bot':
            game['dead_skeletons'] += 1
        if '–í—É—Ä–¥–∞–ª–∞–∫' in player['name'] and player['controller'] == 'bot' and player['team'] == 'necromant':
            alive_ghouls = False
            for idss in game['players']:
                target = game['players'][idss]
                if '–í—É—Ä–¥–∞–ª–∞–∫' in target['name'] and target['controller'] == 'bot' and target[
                    'team'] == 'necromant' and not target['dead']:
                    alive_ghouls = True
                    break
            if not alive_ghouls:
                for idss in game['players']:
                    target = game['players'][idss]
                    # if target['controller'] != 'bot':
                    #    target['can_regen_hp_by_reload'] = 1

        for idss in player['ritualists']:
            game['players'][idss[0]]['ritual_ability'] = True
        player['ritualists'] = []

        if 'alex_death' in player['customtexts'] and player['customtexts']['alex_death']:
            game['text'] += 'üåë|' + player['name'] + ' –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤–æ —Ç—å–º—É, —á—Ç–æ–±—ã –æ–±—Ä–µ—Å—Ç–∏ –ø–æ–∫–æ–π –∏ —Å–≤–µ—Ç –≤ –¥—É—à–µ —Ä–∞–∑–∂–µ—á—å —Å–≤–æ–π –≤–Ω–æ–≤—å, –ø—Ä–µ–æ–¥–æ–ª–µ–≤ —Ç–µ–º–Ω–æ—Ç—É –∏ –±–æ–ª—å.\n'
        elif 'valera_death' in player['customtexts'] and player['customtexts']['valera_death']:
            game['text'] += 'üîã| –£ —Å–∏—Å—Ç–µ–º—ã ' + player['name'] + ' –∫–æ–Ω—á–∏–ª—Å—è –∑–∞—Ä—è–¥. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ...\n'
        elif 'kirill_death' in player['customtexts'] and player['customtexts']['kirill_death']:
            game['text'] += 'üîÆl–í–æ–∫—Ä—É–≥ ' + player['name'] + ' –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–π –±–∞—Ä—å–µ—Ä. –°–ø—É—Å—Ç—è –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –±–∞—Ä—å–µ—Ä –ø—Ä–æ–ø–∞–¥–∞–µ—Ç. ' + player['name'] + ' –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç –ø–æ–¥ –Ω–∏–º IüíÄ\n'
        elif "death_hellfire" in player["skills"]:
            game['text'] += '‚ò†Ô∏èüî•|–í—Ä–µ–º—è ' + player['name'] + ' –≤—ã—à–ª–æ, –∏ –æ–Ω –∑–∞—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–æ–≥–æ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –∞–¥, –∞ –∏–∑ –æ–±—Ä–∞–∑–æ–≤–∞–≤—à–µ–π—Å—è –ø—Ä–æ–ø–∞—Å—Ç–∏ –Ω–∞ –ø–æ–ª–µ –±–æ—è –≤—ã–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Ç–æ–∫–∏ –∞–¥—Å–∫–æ–≥–æ –ø–ª–∞–º–µ–Ω–∏.\n'
            for idss in game["players"]:
                target = game["players"][idss]
                setfire(game, player, target, strength=2, duration=3)
        else:
            game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'
        pretendents = []
        for idss in player['incomingdmgs']:
            target = game['players'][idss[0]]
            if (target['weapon'].lvl == 4 or target['collecting_souls']):
                pretendents.append(target)
        if len(pretendents) > 0:
            try:
                soulowner = random.choice(pretendents)
                soulowner['kills'] += 1
                if soulowner['weapon'].lvl == 4:
                    game['text'] += 'üåê|–û—Ä—É–∂–∏–µ ' + soulowner['name'] + ' –∑–∞–±–∏—Ä–∞–µ—Ç –¥—É—à—É ' + player['name'] + '.\n'
                else:
                    game['text'] += 'üåê|–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ ' + soulowner['name'] + ' –∑–∞–±–∏—Ä–∞–µ—Ç –¥—É—à—É ' + player['name'] + '.\n'
            except:
                pass
        if player['is_imp']:
            if player['maxhp'] > 1:
                imps = 0
                for idss in game['players']:
                    if game['players'][idss]['is_imp']:
                        imps += 1
                imp = summon_imp(game, imps, hp=player['maxhp']-1, nps = player['nearplayers'])
                for idsss in imp:
                    x = idsss
                    break
                game['text'] += '‚ùóÔ∏è–ù–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥–∏—Ç '+imp[x]['name']+'!\n'
                game['summon_imps'].append(imp)
        if game['necromant_reborn_buff'] > 0 and not player['was_castlenecromant_skele']:
            skele = summon_castlefight_skeleton(game, player)
            game['summon_castlefight_skeles'].append(skele)
            game['text'] += 'üíÄ|'+player['name']+' —Å—Ç–∞–ª —Å–∫–µ–ª–µ—Ç–æ–º!\n'
        if '–ó–æ–º–±–∏-–∫—Ä—ã—Å–∞' in player['name'] and player['controller'] == 'bot' and player['team'] == 'necromant':
            alive_zombierats = False
            for idss in game['players']:
                target = game['players'][idss]
                if '–ó–æ–º–±–∏-–∫—Ä—ã—Å–∞' in target['name'] and target['controller'] == 'bot' and target[
                    'team'] == 'necromant' and not target['dead']:
                    alive_zombierats = True
                    break
            if not alive_zombierats:
                game[
                    'text'] += 'üìú|–ú–∞–≥–∏—á–µ—Å–∫–∏–π –±–∞—Ä—å–µ—Ä –≤–æ–∫—Ä—É–≥ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ —Ä–∞—Å—Å–µ—è–ª—Å—è. –û–Ω –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫ –≤—ã –ø–æ–±–µ–¥–∏–ª–∏ –µ–≥–æ –∞—Ä–º–∏—é –º–µ—Ä—Ç–≤–µ—Ü–æ–≤, –∏ –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, ' + \
                               '–ø—ã—Ç–∞—è—Å—å –ø—Ä–∏–∑–≤–∞—Ç—å —Å–µ–±–µ –Ω–∞ –ø–æ–º–æ—â—å –µ—â–µ –∫–æ–≥–æ-–Ω–∏–±—É–¥—å.\n'
        if player['master'] != None:
            necromaster = game['players'][player['master']]
            necromaster['controllable_necrofighter'] = None
            game['text'] += 'üìú|–ú–∞–≥–∏—á–µ—Å–∫–∏–π –±–∞—Ä—å–µ—Ä –≤–æ–∫—Ä—É–≥ ' + necromaster['name'] + ' —Ä–∞—Å—Å–µ—è–ª—Å—è.\n'
        if '–û–≥—Ä–æ–º–Ω—ã–π –∑–ª–æ–±–Ω—ã–π —Å–∫–µ–ª–µ—Ç' in player['name'] and player['controller'] == 'bot':
            game['text'] += '‚ÅâÔ∏è|' + '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç —Å–∏–ª—å–Ω–æ —É–¥–∏–≤–ª–µ–Ω —Ç–µ–º, —á—Ç–æ –≤—ã —É–±–∏–ª–∏ –µ–≥–æ —Å–∫–µ–ª–µ—Ç–∞.\n'
        for idss in enemys_sadist:
            enemy = game['players'][idss]
            if enemy['weapon'].name == '–ú–µ—á –∫–æ—Ä–æ–ª—è' and not player['iamillusion'] and (
                    enemy['act'] != None and enemy['act'][0] == 'attack' and enemy['act'][1] == player['id']):
                skeleton = summon_skeleton(game, enemy, skeletons, write_text=False)
                skeletons.append(skeleton)
                game['text'] += 'üíÄ|' + enemy['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Å–∫–µ–ª–µ—Ç–∞ –∏–∑ —Ç—Ä—É–ø–∞ ' + player['name'] + '!\n'


def summon_skeleton(game, player, skeletons, write_text=True):
    skeletonuser = newskeletonuser(game)
    skeleton = createplayer(skeletonuser, photo=None)
    for ids in skeleton:
        x = ids
        break
    number = 1
    for idss in game['players']:
        if '–°–∫–µ–ª–µ—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
            number += 1
    number += len(skeletons)
    skeleton[x]['name'] = '–°–∫–µ–ª–µ—Ç ' + str(number) + '|üíÄ'
    skeleton[x]['team'] = player['team']
    skeleton[x]['controller'] = 'bot'
    skeleton[x]['weapon'] = weaponlist.Sword()
    skeleton[x]['hp'] = 1
    skeleton[x]['maxhp'] = 1
    for idss in game['players']:
        skeleton[x]['nearplayers'].append(game['players'][idss]['id'])
        game['players'][idss]['nearplayers'].append(skeleton[x]['id'])
    if write_text:
        game['text'] += 'üíÄ|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Å–∫–µ–ª–µ—Ç–∞!\n'
    return skeleton


def summon_dung_skeleton(game, skeletons, hp=4, team='rats', full_control=False, player=None):
    skeletonuser = newskeletonuser(game)
    skeleton = createplayer(skeletonuser, photo=None)
    for ids in skeleton:
        x = ids
        break
    number = 1
    # for idss in game['players']:
    #    if '–°–∫–µ–ª–µ—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
    #        number += 1
    try:
        number += len(skeletons)
    except:
        number += skeletons
    skeleton[x]['name'] = '–°–∫–µ–ª–µ—Ç ' + str(number) + '|üíÄ'
    skeleton[x]['team'] = team
    skeleton[x]['controller'] = 'bot'
    skeleton[x]['weapon'] = weaponlist.Sword2()
    skeleton[x]['hp'] = hp
    skeleton[x]['maxhp'] = hp
    if full_control:
        skeleton[x]['zombie'] = 3
        if player != None:
            skeleton[x]['master'] = player['id']
            # skeleton[x]['id'] = player['id']
            # skeleton[x]['controller'] = 'player'
    return skeleton

def summon_hell_rhino(game, skeletons, hp=6, team='rats', full_control=False, player=None):
    skeletonuser = newskeletonuser(game)
    rhino = createplayer(skeletonuser, photo=None)
    for ids in rhino:
        x = ids
        break
    number = 1
    # for idss in game['players']:
    #    if '–°–∫–µ–ª–µ—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
    #        number += 1
    try:
        number += len(skeletons)
    except:
        number += skeletons
    rhino[x]['name'] = '–ù–æ—Å–æ—Ä–æ–≥ ' + str(number) + '|ü¶èüî•'
    rhino[x]['team'] = team
    rhino[x]['controller'] = 'bot'
    rhino[x]['hp'] = hp
    rhino[x]['maxhp'] = hp
    rhino[x]['skills'] = ["charge", "death_hellfire"]
    rhino[x]["weapon"] = weaponlist.Horn()
    
    if full_control:
        rhino[x]['zombie'] = 3
        if player != None:
            rhino[x]['master'] = player['id']
            # skeleton[x]['id'] = player['id']
            # skeleton[x]['controller'] = 'player'
    rhino[x]['madness'] = True 
    rhino[x]['energy'] += len(game['players'])
    rhino[x]['maxenergy'] += len(game['players'])
    rhino[x]['weapon'].dmgbonus += len(game['players']) 
    game['text'] += '‚ùóÔ∏è|' + rhino[x]['name'] + ' –≤ —è—Ä–æ—Å—Ç–∏!\n' 
    return rhino

def summon_dragon(game, skeletons, hp=6, team='dragon', full_control=False, player=None):
    skeletonuser = newskeletonuser(game)
    dragon = createplayer(skeletonuser, photo=None)
    for ids in dragon:
        x = ids
        break
    number = 1
    # for idss in game['players']:
    #    if '–°–∫–µ–ª–µ—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
    #        number += 1
    try:
        number += len(skeletons)
    except:
        number += skeletons
    dragon[x]['name'] = '–î—Ä–∞–∫–æ–Ω ' + str(number) + '|üê¶‚Äçüî•'
    dragon[x]['team'] = team
    dragon[x]['controller'] = 'bot'
    dragon[x]['weapon'] = weaponlist.DragonClaws()
    dragon[x]['hp'] = hp
    dragon[x]['maxhp'] = hp
    dragon[x]["dmglimit"] = 7
    dragon[x]["maxdmglimit"] = 7
    dragon[x]["is_dragon"] = True
    dragon[x]["skills"] = ["dragon_fireball", "wing_attack"]
    if full_control:
        dragon[x]['zombie'] = 3
        if player != None:
            dragon[x]['master'] = player['id']
    return dragon

def summon_knight(game, skeletons, hp=6, team='knight', full_control=False, player=None, randomid=False):
    skeletonuser = newskeletonuser(game)
    knight = createplayer(skeletonuser, photo=knight_photo)
    for ids in knight:
        x = ids
        break
    number = 1
    # for idss in game['players']:
    #    if '–°–∫–µ–ª–µ—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
    #        number += 1
    try:
        number += len(skeletons)
    except:
        number += skeletons
    if number == 1:
        knight[x]['name'] = '–†—ã—Ü–∞—Ä—å|‚öîÔ∏è'
    else:
        knight[x]['name'] = '–û—Ä—É–∂–µ–Ω–æ—Å–µ—Ü —Ä—ã—Ü–∞—Ä—è ' + str(number-1) + '|‚öîÔ∏è'
    knight[x]['team'] = team
    if randomid:
        knight[x]['team'] = knight[x]['id']
    knight[x]['controller'] = 'bot'
    knight[x]['hp'] = hp
    knight[x]['maxhp'] = hp
    knight[x]["dmglimit"] = 8
    knight[x]["maxdmglimit"] = 8
    knight[x]["is_knight"] = True
    knight[x]['selfarmorchance'] = 60
    knight[x]['selfarmor'] = 1
    #knight[x]["photo"] = knight_photo

    weights = []
    knightweapons = npcweapons.copy()
    knightweapons = []
    for ids in knightweapons:
        weights.append(100)
    knightweapons.append(weaponlist.Rifle)
    weights.append(600)
    knightweapons.append(weaponlist.NecromantStaff_players)
    weights.append(600)
    knightweapons.append(weaponlist.Electro)
    weights.append(600)
    knightweapons.append(weaponlist.BowAsgard)
    weights.append(600)
    knightweapons.append(weaponlist.Narsil)
    weights.append(600)
    knightweapons.append(weaponlist.Katana)
    weights.append(600)
    
    knight[x]['weapon'] = random.choices(knightweapons, weights, k=1)[0]()
    if knight[x]['weapon'].name == "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞":
        knight[x]['weapon'].dmgbonus += 10
        knight[x]['weapon'].accuracybonus += 8
    skilllimit = 2
    inventorylimit = 3
    addskills = ["add_tentacles", "bomber", "demon", "miner", "doom", "charge", "hypnotist", "dark_energy"]
    if knight[x]['weapon'].name == "–ö–∞—Ç–∞–Ω–∞":
        addskills.remove("bomber")
        addskills.remove("miner")
        if random.randint(1, 100) <= 50:
            addskills.remove("doom")
        if random.randint(1, 100) <= 50:
            addskills.remove("hypnotist")
    if full_control:
        ratskills = getnpcskills(game, knight[x], skilllimit=skilllimit, banned_skills=['medic'], dopskills=[])
    else:
        ratskills = getnpcskills(game, knight[x], skilllimit=skilllimit, dopskills = addskills, banned_skills=["berserk"])
    addskills.remove("charge")
    dskill = random.choice(addskills)
    while dskill in ratskills:
        dskill = random.choice(addskills)
    ratskills.append(dskill)
    if game["knight_need_dark_energy"]:
        ratskills.append("dark_energy")
    ratinventory = []
    which_list = npcitems.copy()
    for i in range(inventorylimit):
        item = random.choice(which_list)
        while item in ratinventory:
            item = random.choice(which_list)
        ratinventory.append(item)
    knight[x]['skills'] = ratskills
    knight[x]['inventory'] = ratinventory
    
    if full_control:
        knight[x]['zombie'] = 3
        if player != None:
            knight[x]['master'] = player['id']
    return knight



def summon_treant(game, player, treants, hp=1, team=None):
    treantuser = newtreantuser(game)
    treant = createplayer(treantuser, photo=None)
    for ids in treant:
        x = ids
        break
    number = 1
    for idss in game['players']:
        if '–¢—Ä–µ–Ω—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
            number += 1
    try:
        number += len(treants)
    except:
        number += treants
    treant[x]['name'] = '–¢—Ä–µ–Ω—Ç ' + str(number) + '|üå≥'
    if player != None:
        treant[x]['team'] = player['team']
    treant[x]['controller'] = 'bot'
    treant[x]['weapon'] = weaponlist.Treant_hand()
    treant[x]['hp'] = hp
    treant[x]['maxhp'] = hp
    if team != None:
        treant[x]['team'] = team
    # for idss in game['players']:
    #    treant[x]['nearplayers'].append(game['players'][idss]['id'])
    #    game['players'][idss]['nearplayers'].append(skeleton[x]['id'])
    return treant


def summon_virus(game, player, viruses):
    virususer = newvirususer(game)
    virus = createplayer(virususer, photo=None)
    for ids in virus:
        x = ids
        break
    number = 1
    for idss in game['players']:
        if '–í–∏—Ä—É—Å-–º—É—Ç–∞–Ω—Ç' in game['players'][idss]['name'] and game['players'][idss]['controller'] == 'bot':
            number += 1
    number += len(viruses)
    virus[x]['name'] = '–í–∏—Ä—É—Å-–º—É—Ç–∞–Ω—Ç ' + str(number) + '|ü¶†'
    virus[x]['team'] = 'virus'
    virus[x]['controller'] = 'bot'
    virus[x]['weapon'] = weaponlist.VirusHit()
    virus[x]['hp'] = 6
    virus[x]['maxhp'] = 6
    virus[x]['energy'] = 5
    virus[x]['maxenergy'] = 5
    virus[x]['skills'] = ['protivogaz']
    # for idss in game['players']:
    #    treant[x]['nearplayers'].append(game['players'][idss]['id'])
    #    game['players'][idss]['nearplayers'].append(skeleton[x]['id'])
    return virus


def summon_rat(game, rats, team='rats'):
    newrat = newratuser(game)
    rat = createplayer(newrat, photo=ratphoto)
    for idsss in rat:
        x = idsss
        break
    rat[x]['name'] = '–ö—Ä—ã—Å–∞ ' + str(rats + 1) + '|üê≠'
    rat[x]['team'] = team
    rat[x]['controller'] = 'bot'
    return rat


def summon_dummy(game, dummyamount):
    newdummy = newratuser(game)
    dummy = createplayer(newdummy, photo=None)
    for idsss in dummy:
        x = idsss
        break
    dummy[x]['name'] = '–ú–∞–Ω–µ–∫–µ–Ω ' + str(dummyamount + 1) + '|üéÉ'
    dummy[x]['team'] = 'dummys'
    dummy[x]['controller'] = 'bot'
    dummy[x]['hp'] = 6
    dummy[x]['maxhp'] = 6
    dummy[x]['weapon'] = random.choice(weapons)()
    return dummy

def summon_darkcastle_demon(game):
    strength = game['darkcastle_demon']
    newdarkdemon = newratuser(game)
    darkdemon = createplayer(newdarkdemon, photo=None)
    for idsss in darkdemon:
        x = idsss
        break
    darkdemon[x]['name'] = '–î–µ–º–æ–Ω —Ç—å–º—ã|üëÅ'
    darkdemon[x]['team'] = 'darkcastle'
    darkdemon[x]['full_npc'] = True
    darkdemon[x]['controller'] = 'bot'
    darkdemon[x]['hp'] = 1
    darkdemon[x]['maxhp'] = 1

    darkdemon[x]['darkcastle_demon'] = True

    darkdemon[x]['hp'] += round(strength/4)
    darkdemon[x]['maxhp'] += round(strength/4)

    darkdemon[x]['dmglimit'] = 6
    darkdemon[x]['maxdmglimit'] = 6

    darkdemon[x]['dmglimit'] += round(strength/5)
    darkdemon[x]['maxdmglimit'] += round(strength/5)

    darkdemon[x]['darkdemon_strenght'] = strength

    darkdemon[x]['energy'] = 4
    darkdemon[x]['maxenergy'] = 4

    darkdemon[x]['energy'] += round(strength/8)
    darkdemon[x]['maxenergy'] += round(strength/8)

    darkdemon[x]['skills'] = ['protivogaz?3']

    darkplayer = None
    for ids in game['players']:
        target = game['players'][ids]
        if target['team'] == 'darkcastle':
            darkplayer = target
            break
    darkdemon[x]['castlefightrole'] = darkplayer['castlefightrole']
    darkdemon[x]['castle'] = darkplayer['castle']
    darkdemon[x]['allies'] = darkplayer['allies']
    darkdemon[x]['weapon'] = cw_weaponlist.DarkDemonWeapon()

    return darkdemon

def summon_castlefight_skeleton(game, player):
    newweakskele = newratuser(game)
    weakskele = createplayer(newweakskele, photo=None)
    for idsss in weakskele:
        x = idsss
        break
    weakskele[x]['name'] = '–ü—Ä–æ–∫–ª—è—Ç—ã–π —Å–∫–µ–ª–µ—Ç['+player['name']+']|üíÄ'
    weakskele[x]['team'] = 'necromant'
    weakskele[x]['full_npc'] = True
    weakskele[x]['controller'] = 'bot'
    weakskele[x]['was_castlenecromant_skele'] = True
    weakskele[x]['hp'] = 1
    weakskele[x]['maxhp'] = 1
    weakskele[x]['zombie'] = 2+game['summoned_castlefight_skeletons']
    game['summoned_castlefight_skeletons'] += 1
    game['necromant_reborn_buff'] -= 1
    necroplayer = None
    for ids in game['players']:
        target = game['players'][ids]
        if target['team'] == 'necromant':
            necroplayer = target
            break
    weakskele[x]['castlefightrole'] = necroplayer['castlefightrole']
    weakskele[x]['castle'] = necroplayer['castle']
    weakskele[x]['allies'] = necroplayer['allies']
    weakskele[x]['weapon'] = player['weapon']#cw_weaponlist.SkeleSword()
    weakskele[x]['skills'] = player['skills']

    for ids in game['players']:
        target = game['players'][ids]
        if target['id'] not in weakskele[x]['nearplayers']:
            weakskele[x]['nearplayers'].append(target['id'])
        if weakskele[x]['id'] not in target['nearplayers']:
            target['nearplayers'].append(weakskele[x]['id'])

    return weakskele

def summon_weakskele(game, weakskeles, weakskeletype='normal'):
    newweakskele = newratuser(game)
    weakskele = createplayer(newweakskele, photo=None)
    for idsss in weakskele:
        x = idsss
        break
    weakskele[x]['name'] = '–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç ' + str(weakskeles + 1) + '|ü¶¥'
    weakskele[x]['team'] = 'ghoul'
    weakskele[x]['controller'] = 'bot'
    weakskele[x]['hp'] = 1
    weakskele[x]['maxhp'] = 1
    weakskele[x]['weapon'] = weaponlist.WeakSkeleSword()
    weakskele[x]['weakskeletype'] = weakskeletype
    if weakskeletype == 'afraid_of_loneliness':
        weakskele[x]['weapon'].accuracybonus -= 3
        weakskele[x]['weapon'].cubes -= 1
        weakskele[x]['maxenergy'] -= 2
        weakskele[x]['energy'] -= 2
    return weakskele

def summon_demon(game):
    newdemon = newratuser(game)
    demon = createplayer(newdemon, photo=None)
    for idsss in demon:
        x = idsss
        break
    demon[x]['name'] = '–ù–µ–∑–Ω–∞–∫–æ–º–µ—Ü|üë§'
    demon[x]['team'] = 'demon'
    demon[x]['controller'] = 'bot'
    demon[x]['hp'] = 2
    demon[x]['maxhp'] = 2
    demon[x]['weapon'] = weaponlist.Buckshot()
    return demon


def summon_darkrat(game, darkrats):
    newdarkrat = newratuser(game)
    darkrat = createplayer(newdarkrat, photo=None)
    for idsss in darkrat:
        x = idsss
        break
    code = game['code1']
    darkrat[x]['name'] = '–¢–µ–Ω—å –∫—Ä—ã—Å—ã ' + code + '|üê≠üåë'
    darkrat[x]['team'] = 'dark'
    darkrat[x]['controller'] = 'bot'
    darkrat[x]['hp'] = 0
    darkrat[x]['maxhp'] = 4
    darkrat[x]['weapon'] = weaponlist.DarkRatWeapon()
    darkrat[x]['is_dark_rat'] = True
    return darkrat

def summon_eyedemon(game, eyedemons, hp=4):
    neweyedemon = newratuser(game)
    eyedemon = createplayer(neweyedemon, photo=None)
    for idsss in eyedemon:
        x = idsss
        break
    eyedemon[x]['name'] = '–¢—Ä–µ—Ö–≥–ª–∞–∑—ã–π –¥–µ–º–æ–Ω ' + str(eyedemons+1) + '|üëÅüëÅüëÅ'
    eyedemon[x]['team'] = 'hell'
    eyedemon[x]['controller'] = 'bot'
    eyedemon[x]['hp'] = 4
    eyedemon[x]['maxhp'] = 4
    eyedemon[x]['weapon'] = weaponlist.EyedemonWeapon()
    eyedemon[x]['is_eyedemon'] = True
    return eyedemon


def summon_amalgama(game, amalgamas):
    newamalgama = newratuser(game)
    amalgama = createplayer(newamalgama, photo=None)
    for idsss in amalgama:
        x = idsss
        break
    code = game['code2']
    amalgama[x]['name'] = '–ê–º–∞–ª—å–≥–∞–º–∞ ' + code + '|üßø'
    amalgama[x]['team'] = 'dark'
    amalgama[x]['controller'] = 'bot'
    amalgama[x]['hp'] = 6
    amalgama[x]['maxhp'] = 6
    amalgama[x]['dmglimit'] = 38
    amalgama[x]['maxdmglimit'] = 38
    amalgama[x]['weapon'] = weaponlist.AmalgamaNoneWeapon()
    amalgama[x]['is_amalgama'] = True
    return amalgama

def summon_imp(game, imps, hp=2, nps = []):
    try:
        imps = len(imps)
    except:
        pass
    newimp = newratuser(game)
    imp = createplayer(newimp, photo=None)
    for idsss in imp:
        x = idsss
        break
    imp[x]['name'] = '–ò–º–ø ' + str(imps+1) + '|üëø'
    imp[x]['team'] = 'hell'
    imp[x]['controller'] = 'bot'
    imp[x]['hp'] = hp
    imp[x]['maxhp'] = hp
    imp[x]['dmglimit'] = 6
    imp[x]['maxdmglimit'] = 6
    imp[x]['weapon'] = weaponlist.ImpSpear()
    imp[x]['is_imp'] = True
    imp[x]['nearplayers'] = nps
    imp[x]['skills'] = ['fire_regen', 'fire_power']
    for ids in nps:
        game['players'][ids]['nearplayers'].append(imp[x]['id'])
    #print('nearp=',imp[x]['nearplayers'])
    return imp


def summon_magmaworm(game, magmaworms, hp=3):
    try:
        magmaworms = len(magmaworms)
    except:
        pass
    newmagmaworm = newratuser(game)
    magmaworm = createplayer(newmagmaworm, photo=None)
    for idsss in magmaworm:
        x = idsss
        break
    magmaworm[x]['name'] = '–ú–∞–≥–º–æ–≤—ã–π —á–µ—Ä–≤—å ' + str(magmaworms+1) + '|ü™±'
    magmaworm[x]['team'] = 'hell'
    magmaworm[x]['controller'] = 'bot'
    magmaworm[x]['hp'] = hp
    magmaworm[x]['maxhp'] = hp
    magmaworm[x]['dmglimit'] = 4
    magmaworm[x]['maxdmglimit'] = 4
    magmaworm[x]['weapon'] = weaponlist.MagmawormClaws()
    magmaworm[x]['is_magmaworm'] = True
    magmaworm[x]['skills'] = ['fire_resistance', 'burrow']
    return magmaworm

def summon_lucifer(game, hp=5):
    playeramount = len(game['players'])
    if playeramount == 1:
        playeramount += 1
    newlucifer = newratuser(game)
    lucifer = createplayer(newlucifer, photo=None)
    for idsss in lucifer:
        x = idsss
        break
    lucifer[x]['name'] = '–õ—é—Ü–∏—Ñ–µ—Ä' + '|‚ù§Ô∏è‚Äçüî•'
    lucifer[x]['team'] = 'hell'
    lucifer[x]['controller'] = 'bot'
    lucifer[x]['hp'] = hp+(playeramount*4)
    lucifer[x]['maxhp'] = hp+(playeramount*4)
    lucifer[x]['luciferpower'] = playeramount-1
    lucifer[x]['dmglimit'] = 4 + playeramount*2
    lucifer[x]['maxdmglimit'] = 4 + playeramount*2
    lucifer[x]['weapon'] = weaponlist.LuciferBlade()
    lucifer[x]['is_lucifer'] = True
    return lucifer

def summon_radiodemon(game, hp=5):
    playeramount = len(game['players'])
    newradiodemon = newratuser(game)
    radiodemon = createplayer(newradiodemon, photo=None)
    for idsss in radiodemon:
        x = idsss
        break
    radiodemon[x]['name'] = '–ê–ª–∞—Å—Ç–æ—Ä' + '|‚ù§Ô∏è‚Äçüî•'
    radiodemon[x]['team'] = 'hell'
    radiodemon[x]['controller'] = 'bot'
    radiodemon[x]['hp'] = hp+(playeramount*5)
    radiodemon[x]['maxhp'] = hp+(playeramount*5)
    radiodemon[x]['radiodemonpower'] = playeramount
    radiodemon[x]['dmglimit'] = 6 + playeramount*2
    radiodemon[x]['maxdmglimit'] = 6 + playeramount*2
    radiodemon[x]['weapon'] = weaponlist.AlastorRod()
    radiodemon[x]['weapon'].dmgbonus += (radiodemon[x]['radiodemonpower']-1)
    radiodemon[x]['is_radiodemon'] = True
    return radiodemon

def summon_darkness(game, darknesss):
    playeramount = len(game['players'])
    newdarkness = newratuser(game)
    darkness = createplayer(newdarkness, photo=None)
    for idsss in darkness:
        x = idsss
        break
    try:
        if len(darknesss) == 0 or len(darknesss) == 1:
            darkness[x]['name'] = '–¢—å–º–∞|üëÅüåëüåëüëÅ'
        else:
            darkness[x]['name'] = '–¢—å–º–∞ ' + str(len(darkness)) + '|üëÅüåëüåëüëÅ'
    except:
        if darknesss == 0 or darknesss == 1:
            darkness[x]['name'] = '–¢—å–º–∞|üëÅüåëüåëüëÅ'
        else:
            darkness[x]['name'] = '–¢—å–º–∞ ' + str(darkness) + '|üëÅüåëüåëüëÅ'
    darkness[x]['team'] = 'dark'
    darkness[x]['controller'] = 'bot'
    darkness[x]['hp'] = 5 + (playeramount * 5)
    darkness[x]['maxhp'] = 5 + (playeramount * 5)
    darkness[x]['darknessspelldmgbonus'] = playeramount - 1
    darkness[x]['weapon'] = weaponlist.DarknessWeapon()
    darkness[x]['dmglimit'] = 1000000
    darkness[x]['maxdmglimit'] = 1000000
    darkness[x]['is_dark_boss'] = True
    return darkness


def summon_mad_skeleton(game, player, madskeles):
    newmadskele = newratuser(game)
    madskele = createplayer(newmadskele, photo=None)
    for idsss in madskele:
        x = idsss
        break
    madskele[x]['name'] = '–û–≥—Ä–æ–º–Ω—ã–π –∑–ª–æ–±–Ω—ã–π —Å–∫–µ–ª–µ—Ç ' + str(madskeles + 1) + '|üíÄ'
    madskele[x]['team'] = player['team']
    madskele[x]['controller'] = 'bot'
    madskele[x]['hp'] = 12
    madskele[x]['maxhp'] = 12
    madskele[x]['weapon'] = weaponlist.MadSkeleWeapon()
    madskele[x]['dmglimit'] = 100
    madskele[x]['maxdmglimit'] = 100
    madskele[x]['energy'] = 5
    madskele[x]['maxenergy'] = 5
    madskele[x]['is_mad_skele'] = True
    madskele[x]['skills'] = ['bicepc']
    return madskele

def summon_angry_rhino(game, team, target):
    newrhino = newratuser(game)
    rhino = createplayer(newrhino, photo=None)
    for idsss in rhino:
        x = idsss
        break
    rhino[x]['name'] = '–ù–æ—Å–æ—Ä–æ–≥|ü¶è'
    rhino[x]['team'] = team
    rhino[x]['controller'] = 'bot'
    rhino[x]['hp'] = 1
    rhino[x]['maxhp'] = 1
    rhino[x]['dmglimit'] = 10
    rhino[x]['maxdmglimit'] = 10
    rhino[x]['energy'] = 5
    rhino[x]['maxenergy'] = 5
    rhino[x]['weapon'] = weaponlist.Horn()
    rhino[x]['zombie'] = 1
    rhino[x]['lastattacktarget'] = target
    return rhino

def summon_ghoul(game, ghouls, hp=6, energy=5, team='ghoul', full_control=False, player=None, dmglimit=4):
    newghoul = newratuser(game)
    ghoul = createplayer(newghoul, photo=None)
    for idsss in ghoul:
        x = idsss
        break
    ghoul[x]['name'] = '–í—É—Ä–¥–∞–ª–∞–∫ ' + str(ghouls + 1) + '|üëπ'
    ghoul[x]['team'] = team
    ghoul[x]['controller'] = 'bot'
    ghoul[x]['hp'] = hp
    ghoul[x]['maxhp'] = hp
    ghoul[x]['dmglimit'] = dmglimit
    ghoul[x]['maxdmglimit'] = dmglimit
    ghoul[x]['energy'] = energy
    ghoul[x]['maxenergy'] = energy
    ghoul[x]['is_ghoul'] = True
    ghoul[x]['weapon'] = weaponlist.GhoulTeeth()
    ghoul[x]['skills'] = ['ghoul_vampirism', 'ghoul_bloodlust']
    ghoul[x]['is_vurdalak'] = True
    if full_control:
        ghoul[x]['zombie'] = 3
        if player != None:
            ghoul[x]['master'] = player['id']
            # ghoul[x]['id'] = player['id']
            # ghoul[x]['controller'] = 'player'
    return ghoul


def summon_zombierat(game, zombierats, team='necromant', full_control=False, player=None):
    newzombierat = newratuser(game)
    zombierat = createplayer(newzombierat, photo=None)
    for idsss in zombierat:
        x = idsss
        break
    zombierat[x]['name'] = '–ó–æ–º–±–∏-–∫—Ä—ã—Å–∞ ' + str(zombierats + 1) + '|üê≠'
    zombierat[x]['team'] = team
    zombierat[x]['controller'] = 'bot'
    zombierat[x]['hp'] = 4
    zombierat[x]['maxhp'] = 4
    zombierat[x]['dmglimit'] = 6
    zombierat[x]['maxdmglimit'] = 6
    zombierat[x]['energy'] = 5
    zombierat[x]['maxenergy'] = 5
    zombierat[x]['weapon'] = random.choice(npcweapons)()
    skilllimit = 3
    inventorylimit = 3
    if full_control:
        ratskills = getnpcskills(game, zombierat[x], skilllimit=skilllimit, banned_skills=['medic'], dopskills=[])
    else:
        ratskills = getnpcskills(game, zombierat[x], skilllimit=skilllimit)
    ratinventory = []
    which_list = npcitems.copy()
    for i in range(inventorylimit):
        item = random.choice(which_list)
        while item in ratinventory:
            item = random.choice(which_list)
        ratinventory.append(item)
    zombierat[x]['skills'] = ratskills
    for ids in zombierat[x]['skills']:
        if ids == 'cherep':
            zombierat[x]['dmglimit'] += 3
        if ids == 'dvuzhil':
            zombierat[x]['hp'] += 1
            zombierat[x]['maxhp'] += 1
        if ids == 'protivogaz':
            zombierat[x]['energy'] += 1
            zombierat[x]['maxenergy'] += 1
        if ids == 'medic':
            ratinventory.append('stimulator')
        if ids == 'berserk':
            zombierat[x]['maxenergy'] -= 2
            zombierat[x]['energy'] -= 2
    zombierat[x]['inventory'] = ratinventory
    if full_control:
        zombierat[x]['zombie'] = 3
        if player != None:
            zombierat[x]['master'] = player['id']
            # zombierat[x]['id'] = player['id']
            # zombierat[x]['controller'] = 'player'
    return zombierat


def summon_necromant(game, amount):
    newnecromant = newrhinouser(game)
    necromant = createplayer(newnecromant, photo=None)
    for idsss in necromant:
        x = idsss
        break
    if amount > 1:
        z = ' ' + str(amount)
    else:
        z = ''
    necromant[x]['name'] = '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç' + z + '|üñ§'
    necromant[x]['team'] = 'necromant'
    necromant[x]['controller'] = 'bot'
    necromant[x]['hp'] = 4
    necromant[x]['maxhp'] = 4
    necromant[x]['dmglimit'] = 1000
    necromant[x]['maxdmglimit'] = 1000
    necromant[x]['maxenergy'] = 4
    necromant[x]['energy'] = 4
    necromant[x]['is_necromant'] = True
    necromant[x]['weapon'] = weaponlist.NecromantStaff()
    # for ids in game['players']:
    #    necromant[x]['hp'] += 1
    #    necromant[x]['maxhp'] += 1
    en = 0
    for ids in game['players']:
        en += 1
    necromant[x]['energy'] += int(en)
    necromant[x]['maxenergy'] += int(en)
    necromant[x]['weapon'].dmgbonus += len(game['players'])
    necromant[x]['skills'] = ['necromant_up_mad_skeletons', 'necromant_summon_simple_skeletons',
                              'necromant_summon_ghouls', 'necromant_summon_zombie_rats']
    # necromant[x]['selfarmorchance'] = 60
    # necromant[x]['selfarmor'] = 1+len(game['players'])
    return necromant


def summon_rhino(game, amount, team='rhino'):
    newrhino = newrhinouser(game)
    amount += 1
    rhino = createplayer(newrhino, photo=None)
    for idsss in rhino:
        x = idsss
        break
    if amount > 1:
        z = ' ' + str(amount)
    else:
        z = ''
    rhino[x]['name'] = '–ù–æ—Å–æ—Ä–æ–≥' + z + '|ü¶è'
    rhino[x]['team'] = team
    rhino[x]['controller'] = 'bot'
    rhino[x]['hp'] = 4
    rhino[x]['maxhp'] = 4
    rhino[x]['dmglimit'] = 9
    rhino[x]['maxdmglimit'] = 9
    rhino[x]['maxenergy'] = 3
    rhino[x]['energy'] = 3
    rhino[x]['is_rhino'] = True
    rhino[x]['weapon'] = weaponlist.Horn()
    for ids in game['players']:
        rhino[x]['hp'] += 1
        rhino[x]['maxhp'] += 1
    en = 0
    for ids in game['players']:
        en += 1
    if team == 'rhino':
        rhino[x]['energy'] += int(en / 2)
        rhino[x]['maxenergy'] += int(en / 2)
        rhino[x]['weapon'].dmgbonus += en
        rhino[x]['selfarmorchance'] = 60
        rhino[x]['selfarmor'] = 1 + en
    return rhino

def summon_small_rhino(game, amount, team='rhino'):
    amount += 1
    newrhino = newrhinouser(game)
    rhino = createplayer(newrhino, photo=None)
    for idsss in rhino:
        x = idsss
        break
    if amount > 1:
        z = ' ' + str(amount)
    else:
        z = ''
    rhino[x]['name'] = '–ú–∏–Ω–∏-–Ω–æ—Å–æ—Ä–æ–≥' + z + '|ü¶è'
    rhino[x]['team'] = team
    rhino[x]['controller'] = 'bot'
    rhino[x]['hp'] = 3
    rhino[x]['maxhp'] = 3
    rhino[x]['dmglimit'] = 5
    rhino[x]['maxdmglimit'] = 5
    rhino[x]['maxenergy'] = 3
    rhino[x]['energy'] = 3
    rhino[x]['is_rhino'] = True
    rhino[x]['weapon'] = weaponlist.Horn()
    i = True
    for ids in game['players']:
        if i:
            rhino[x]['hp'] += 1
            rhino[x]['maxhp'] += 1
        i = not i
    en = 0
    for ids in game['players']:
        en += 1
    if team == 'rhino':
        rhino[x]['energy'] += int(en / 4)
        rhino[x]['maxenergy'] += int(en / 4)
        rhino[x]['weapon'].dmgbonus += int(en/3)
        rhino[x]['selfarmorchance'] = 50
        rhino[x]['selfarmor'] = 1+int(en/2)
    return rhino


def end_turn(game, bot=bot):
    try:
        game['stage'] = None
        #print("11858: neurodemon1", game['fullneuraldemon1'])
        # try:
        #    game['timer'].cancel()
        # except:
        #    pass
        # idstoremove = []
        # for ids in game['alltimers']:
        #    try:
        #        ids.cancel()
        # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
        #        idstoremove.append(ids)
        #    except:
        #        pass
        # for ids in idstoremove:
        #    game['alltimers'].remove(ids)
        prov = False
        provtext = ''
        for ids in game['players']:
            player = game['players'][ids]
            if game['pureduel_rats'] and not game['neuralfight'] and not game['pureduel_rats_hard']:
                if player['controller'] == 'bot':
                    for idss in game['players']:
                        if game['players'][idss]['controller'] == 'player':
                            target = game['players'][idss]
                            break
                    weights_table = get_act_weights(player, target)
                    try:
                        target_act = target['act'][0]
                    except:
                        target_act = 'skip'
                    has_adrenaline = False
                    for idss in target['dopuseditems']:
                        if idss[0] == "adrenaline":
                            has_adrenaline = True
                    if target_act == "attack" and has_adrenaline:
                        target_act = "adrenaline"
                    my_act = player['act'][0]
                    has_adrenaline = False
                    for idss in player['dopuseditems']:
                        if idss[0] == "adrenaline":
                            has_adrenaline = True
                    if my_act == "attack" and has_adrenaline:
                        my_act = "adrenaline"
                    if my_act == "shieldgen":
                        my_act = "shield"
                    if target_act == "shieldgen":
                        target_act = "shield"
                    choicen_acts = player['my_potential_acts']
                    if target_act not in player['target_potential_acts']:
                        print('target act not in possible: ',target_act)
                    else:
                        target_act = 'player_'+target_act
                        for idss in player['rat_demons']:
                            choicenact_weights = []
                            choicen_demon = player['rat_demons'][idss]
                            if idss == player['choicen_demon']:
                                currentact = my_act
                            else:
                                for idsss in choicen_acts:
                                    choicenact_weights.append(choicen_demon['pattern'][idsss.replace('rat_', '')])
                                currentact = random.choices(choicen_acts, weights=choicenact_weights)[0]
                                #currentact = currentact.replace('rat_', '')
                            if "player_" not in target_act:
                                target_act = "player_"+target_act
                            if 'shieldgen' in target_act:
                                target_act = target_act.replace("shieldgen", "shield")

                            if "rat_" not in currentact:
                                currentact = "rat_"+currentact
                            if 'shieldgen' in currentact:
                                currentact = currentact.replace("shieldgen", "shield")
                            turn_value = weights_table[target_act][currentact]
                            player['rat_demons'][idss]['score'] += turn_value





            if not game['castlefight']:
                if player['is_necromant']:
                    invulnerable = False
                    for idss in game['players']:
                        target = game['players'][idss]
                        if ('–í—É—Ä–¥–∞–ª–∞–∫' in target['name'] or '–°–∫–µ–ª–µ—Ç' in target['name'] or '–û–≥—Ä–æ–º–Ω—ã–π –∑–ª–æ–±–Ω—ã–π —Å–∫–µ–ª–µ—Ç' in
                            target['name'] or \
                            '–ó–æ–º–±–∏-–∫—Ä—ã—Å–∞' in target['name']) and target['team'] == 'necromant' and not target['dead']:
                            invulnerable = True
                    if invulnerable:
                        player['shield'] = True
                        player['magic_strong_shield'] = True
            duitems = {}
            alreadycheck = []
            toremove = []
            for idss in player['dopuseditems']:
                if idss[0] not in duitems:
                    duitems.update({idss[0]: 1})
                else:
                    duitems[idss[0]] += 1
            for idss in duitems:
                if idss not in alreadycheck:
                    alreadycheck.append(idss)
                    itemamount = player['inventory'].count(idss)
                    # print('itemamount for '+idss+': '+str(itemamount))
                    how_many_remove = duitems[idss] - itemamount
                    # print('howmanyremove for ' + idss + ': ' + str(how_many_remove))
                    # print(player['dopuseditems'])
                    if how_many_remove > 0:
                        for i in range(how_many_remove):
                            for idsss in player['dopuseditems']:
                                if idsss[0] == idss:
                                    toremove.append(idsss)
                                    break
            for idss in toremove:
                try:
                    player['dopuseditems'].remove(idss)
                except:
                    print(traceback.format_exc())

            # for idss in duitems:
            #    idssamount = duitems.count(idss)
            # for idss in dellist:
            #    player['dopuseditems'].remove(idss)
            if 'autist' in player['skills']:
                if player['act'] == 'chain':
                    player['chaincd'] = chaincd
                if player['act'] == 'sokrush':
                    player['sokrusheniecd'] = sokrushcd
                if player['act'] == 'narsil':
                    player['narsilcd'] = narsilcd
                if player['act'] == 'firearrow':
                    player['firearrowcd'] = firearrowcd
                if player['act'] == 'watershield':
                    player['watershieldcd'] = watershieldcd

                lact = player['lastact']
                player['lastact'] = player['act']
                player['act'] = lact

                duseditems = player['lastdopuseditems']
                player['lastdopuseditems'] = player['dopuseditems']
                player['dopuseditems'] = duseditems

            seetext = ''
            if not game['providets'] and 'providets' in player['skills'] and not player['dead'] and player[
                'stun'] <= 0 and random.randint(1, 100) <= 20:
                prov = True
                player['providets'] = True
                player['changeweaponcd'] -= 1
                player['clawscd'] -= 1
                provtext += 'üë≥‚Äç‚ôÇ|' + player['name'] + ' –≤–∏–¥–∏—Ç –±—É–¥—É—â–µ–µ –∏ —Ö–æ–¥–∏—Ç —Å–Ω–∞—á–∞–ª–∞!\n'
                for idss in game['players']:
                    if game['players'][idss]['id'] != player['id'] and not game['players'][idss]['dead']:
                        seetext += game['players'][idss]['name'] + ':\n' + game['players'][idss]['seetext'] + '\n'
                        if len(game['players'][idss]['dopuseditems']) > 0:
                            seetext += '–ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:\n'
                            for idsss in game['players'][idss]['dopuseditems']:
                                seetext += getname(idsss[0]) + ' –Ω–∞ ' + game['players'][idsss[1]]['name'] + ', '
                            seetext = seetext[:len(seetext) - 2]
                            seetext += '\n'
                    seetext += '\n'
                sendm(bot, player['id'], seetext)

        if prov:
            game['providets'] = True
            tries = 0
            while True:
                try:
                    sendm(bot, game['id'], provtext)
                    break
                except:
                    tries += 1
                    if tries > 100:
                        del games[game['id']]
                        return
                    time.sleep(3)
            next_turn(game)
            return
        game['providets'] = False
        changewtext = game['text']
        if '–•–æ–¥ ' + str(game['turn']) + ':' not in changewtext:
            game['text'] = '–•–æ–¥ ' + str(game['turn']) + ':\n'
        else:
            game['text'] = ''
        if game['turn'] == 1 and game['necromant_reborn_buff'] > 0:
            game['text'] += 'üñ§|–ù–µ–∫—Ä–æ–º–∞–Ω—Ç—ã –Ω–∞–ª–æ–∂–∏–ª–∏ –Ω–∞ –ø–æ–ª–µ –±–æ—è –ø—Ä–æ–∫–ª—è—Ç—å–µ '+str(game['necromant_reborn_buff'])+'–≥–æ —É—Ä–æ–≤–Ω—è.\n'
        game['text'] += changewtext
        game['turn'] += 1

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue

        for ids in game['players']:
            player = game['players'][ids]
            armor_debuff = 0
            for idss in player["armor_debuff"]:
                armor_debuff += player["armor_debuff"][idss]["power"]
            if armor_debuff > 0:
                game["effecttext"] += "‚õìÔ∏è‚Äçüí•|–ë—Ä–æ–Ω—è "+player["name"]+" –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞! ("+str(armor_debuff)+"üí•)\n"
            if player['dopriest'] != None:
                target = game['players'][player['dopriest']]
                if target['light_aspect'] < 0:
                    target['light_aspect'] = 0
                target['light_aspect'] += 3
                if target['id'] == player['id']:
                    game['text'] += '‚òÄÔ∏è|' + player[
                        'name'] + ' –æ—Å–≤—è—â–∞–µ—Ç —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ! –û–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∞—Å–ø–µ–∫—Ç —Å–≤–µ—Ç–∞ (1) –Ω–∞ 3 —Ö–æ–¥–∞.\n'
                else:
                    game['text'] += '‚òÄÔ∏è|' + player['name'] + ' –æ—Å–≤—è—â–∞–µ—Ç –æ—Ä—É–∂–∏–µ ' + target[
                        'name'] + '! –û–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∞—Å–ø–µ–∫—Ç —Å–≤–µ—Ç–∞ (1) –Ω–∞ 3 —Ö–æ–¥–∞.\n'
                player['dopriest'] = None
                player['priestcd'] = 6
            if player['createillusion']:
                game['text'] += 'üé≠|–ò–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç ' + player['name'] + ' —Å–æ–∑–¥–∞—ë—Ç —Ç–æ—á–Ω—É—é –∫–æ–ø–∏—é —Å–µ–±—è!\n'
            if player['demonform']:
                game['text'] += 'üëπ|Bloodseeker ' + player[
                    'name'] + ' –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–µ–º–æ–Ω–∞, —Ç–µ—Ä—è–µ—Ç 1 –∂–∏–∑–Ω—å –∏ –ø–æ–ª—É—á–∞–µ—Ç –≤–∞–º–ø–∏—Ä–∏–∑–º!\n'
                player['hp'] -= 1
                player['can_summon_zombie'] = True
                game['text'] += '‚ô•' * player['hp'] + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç 1 —Ö–ø. –û—Å—Ç–∞—ë—Ç—Å—è ' + str(
                    player['hp']) + ' —Ö–ø.\n'
                player['demonheal'] = 2
                player['demoncd'] = 7
            if player['bat'] != False:
                game['players'][player['bat']]['waitbats'].append([player['id'], 2])
                game['text'] += 'ü¶á|' + player['name'] + ' –≤—ã–ø—É—Å–∫–∞–µ—Ç –ª–µ—Ç—É—á—É—é –º—ã—à—å!\n'
                player['batcd'] = 3
            if player['act'] == None:
                continue
            if player['act'][0] == 'blockshield':
                game['text'] += 'üõ°|' + player['name'] + ' –±–ª–æ–∫–∏—Ä—É–µ—Ç —É—Ä–æ–Ω —â–∏—Ç–æ–º.\n'
                player['weaponshield'] = True
            if player['act'][0] == 'control_necrofighter':
                controllable_npc = game['players'][player['controllable_necrofighter']]
                game['text'] += 'üß†|' + player['name'] + ' –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–∞–∑—É–º ' + controllable_npc['name'] + '.\n'
                player['shield'] = True
            if player['act'][0] == 'summon_dark_demon':
                interrupt = False
                for idss in game['players']:
                    target = game['players'][idss]
                    if target['act'] != None and target['act'][0] == 'castle_explosion' and target['act'][1] == player['id']:
                        interrupt = True
                        break
                if interrupt:
                    game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player[
                            'name'] + ' –ø—ã—Ç–∞–ª—Å—è –≤–æ–∑–∑–≤–∞—Ç—å –∫ —Å–∏–ª–∞–º —Ç—å–º—ã, –Ω–æ –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –æ–≥—Ä–æ–º–Ω–æ–π –≤–æ–ª–Ω–æ–π –æ–≥–Ω—è.\n'
                else:
                    game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' –≤–∑—ã–≤–∞–µ—Ç –∫ —Å–∏–ª–∞–º —Ç—å–º—ã, –ø–æ–∑–≤–æ–ª—è—è –¥–µ–º–æ–Ω—É –∑–∞–±—Ä–∞—Ç—å —Å–≤–æ–µ —Ç–µ–ª–æ...\n'
                    skillvalue = 0
                    for idsss in player['skills']:
                        try:
                            skillvalue += int(idsss.split('?')[1])
                        except:
                            skillvalue += 1
                    weaponvalue = player['weapon'].lvl * 3
                    lvlvalue = int(player['lvl']*0.5)
                    game['darkcastle_demon'] += skillvalue
                    game['darkcastle_demon'] += weaponvalue
                    game['darkcastle_demon'] += lvlvalue
                    player['dead_from_dark'] = True
            if player['act'][0] == 'hypnotist' or (player['act'][0] == 'demonattack' and player['demonbeam'] == 'violet'):
                game['hypnotists'].append(player['id'])
                player['hypnotistcd'] = 6
                player['energy'] -= 3
                target = game['players'][player['act'][1]]
                maint = False
                secondt = False
                if not game['classic_game']:
                    if (target['act'] != None and not isinstance(target['act'][1], str) and target['act'][0] not in [
                        'pricel', 'ritual', 'lighting', 'zombieup']) or len(target['dopuseditems']) > 0:
                        if target['act'] != None and not isinstance(target['act'][1], str) and target['act'][0] != 'pricel':
                            hypnotargets = []
                            target_target = game['players'][target['act'][1]]
                            for idss in game['players']:
                                if target['team'] == target_target['team']:
                                    if game['players'][idss]['team'] != target['team'] and not game['players'][idss][
                                        'dead']:
                                        hypnotargets.append(game['players'][idss])
                                else:
                                    if game['players'][idss]['team'] == target['team'] and not game['players'][idss][
                                        'dead']:
                                        hypnotargets.append(game['players'][idss])
                            newtarget = random.choice(hypnotargets)
                            maint = True
                            target['act'][1] = newtarget['id']
                        if len(target['dopuseditems']) > 0:
                            for idss in target['dopuseditems']:
                                target_target = game['players'][idss[1]]
                                hypnotargets = []
                                for idsss in game['players']:
                                    if target['team'] == target_target['team']:
                                        if game['players'][idsss]['team'] != target['team'] and not game['players'][idsss][
                                            'dead']:
                                            hypnotargets.append(game['players'][idsss])
                                    else:
                                        if game['players'][idsss]['team'] == target['team'] and not game['players'][idsss][
                                            'dead']:
                                            hypnotargets.append(game['players'][idsss])
                                newtarget = random.choice(hypnotargets)
                                secondt = True
                                idss[1] = newtarget['id']
                        if (player['act'][0] == 'demonattack' and player['demonbeam'] == 'violet'):
                            game['text'] += 'üü£|–§–∏–æ–ª–µ—Ç–æ–≤—ã–π –ª—É—á ' + player['name'] + ' —Å–±–∏–≤–∞–µ—Ç –ø—Ä–∏—Ü–µ–ª ' + target[
                                'name'] + '!\n'
                        else:
                            if maint and not secondt:
                                game['text'] += 'üåö|–ì–∏–ø–Ω–æ—Ç–∏–∑—ë—Ä ' + player['name'] + ' —Å–±–∏–≤–∞–µ—Ç –ø—Ä–∏—Ü–µ–ª ' + target[
                                    'name'] + '. –ù–æ–≤–∞—è —Ü–µ–ª—å - ' + newtarget['name'] + '!\n'
                            if secondt and not maint:
                                game['text'] += 'üåö|–ì–∏–ø–Ω–æ—Ç–∏–∑—ë—Ä ' + player['name'] + ' —Å–±–∏–≤–∞–µ—Ç –ø—Ä–∏—Ü–µ–ª ' + target['name'] + '!\n'
                            if maint and secondt:
                                game['text'] += 'üåö|–ì–∏–ø–Ω–æ—Ç–∏–∑—ë—Ä ' + player['name'] + ' —Å–±–∏–≤–∞–µ—Ç –ø—Ä–∏—Ü–µ–ª ' + target['name'] + '!\n'

                    else:
                        if (player['act'][0] == 'demonattack' and player['demonbeam'] == 'violet'):
                            game['text'] += 'üí®|–§–∏–æ–ª–µ—Ç–æ–≤—ã–π –ª—É—á ' + player['name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è —Å–±–∏—Ç—å –ø—Ä–∏—Ü–µ–ª ' + target[
                                'name'] + ', –Ω–æ –±–µ–∑—É—Å–ø–µ—à–Ω–æ.\n'
                        else:
                            game['text'] += 'üåù|–ì–∏–ø–Ω–æ—Ç–∏–∑—ë—Ä—É ' + player['name'] + ' –Ω–µ —É–¥–∞—ë—Ç—Å—è —Å–±–∏—Ç—å –ø—Ä–∏—Ü–µ–ª ' + target[
                                'name'] + '.\n'
                else:
                    if (target['act'] != None and target['act'][0] in ['attack', 'chain', 'sokrush']):
                        target['act'][1] = target['id']
                        target['hypnodebuff'] = -2
                        game['text'] += 'üåö|–ì–∏–ø–Ω–æ—Ç–∏–∑—ë—Ä ' + player['name'] + ' —Å–±–∏–≤–∞–µ—Ç –ø—Ä–∏—Ü–µ–ª ' + target[
                            'name'] + '. –ù–æ–≤–∞—è —Ü–µ–ª—å - ' + target['name'] + '!\n'
                    else:
                        game['text'] += 'üåù|–ì–∏–ø–Ω–æ—Ç–∏–∑—ë—Ä—É ' + player['name'] + ' –Ω–µ —É–¥–∞—ë—Ç—Å—è —Å–±–∏—Ç—å –ø—Ä–∏—Ü–µ–ª ' + target[
                            'name'] + '.\n'

            elif player['act'][0] == 'freeze_energy':
                game['text'] += '‚ùÑÔ∏è|' + player[
                    'name'] + ' –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç –≤–æ–∑–¥—É—Ö –Ω–∞ –ø–æ–ª–µ –±–æ—è. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 2 —Ö–æ–¥–∞!\n'
                game['freeze_energy'] = 2
                player['invokercd'] = 3

            # elif player['act'][0] == 'sunstrike':
            #    target['recoverydebuff'].append([2, 2])    #[0] - —Å–∏–ª–∞ –¥–µ–±–∞—Ñ—Ñ–∞, [1] - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

        for ids in game['players']:
            player = game['players'][ids]

            if player["act"] == None:
                continue

            if player['act'][0] == 'drink_energy':
                player['invokercd'] = 4
                target = game['players'][player['act'][1]]
                target['energy'] -= 3
                actualenergy = regen_energy(game, player, 3)
                game['text'] += 'üîã|' + player['name'] + ' –≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç 3‚ö°Ô∏è –∏–∑ ' + target['name'] + '!\n'

            elif player['act'][0] == 'doom':
                player['doomcd'] = 9
                target = game['players'][player['act'][1]]
                target['bigdooms'].append([player['id'], 3])
                if target['doomedskills'] != []:
                    pass
                else:
                    target['need_to_doom'] = True
                    target['doomedskills'] = target['skills']
                    #target['doomedinventory'] = target['inventory']
                    target['skills'] = []
                #target['inventory'] = []
                game['text'] += 'üî•üíÄüî•|' +player['name']+' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DOOM –Ω–∞ '+ target['name'] + ', —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã —Ü–µ–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 3 —Ö–æ–¥–∞!\n'
                player['energy'] -= 1

            elif player['act'][0] == 'lighting_to_heroes':
                for idss in game['players']:
                    targett = game['players'][idss]
                    if targett['team'] == 'necromant' and '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç' in targett['name']:
                        pass
                    else:
                        targett['dead'] = True
                        targett['hp'] = -1000
                game['text'] += 'üí¨|' + player[
                    'name'] + ': –£ –º–µ–Ω—è –∑–∞–∫–æ–Ω—á–∏–ª—Å—è —á–∞–π —Å –∫–æ–Ω—Ñ–µ—Ç–∞–º–∏, –Ω–µ –∂–µ–ª–∞—é –±–æ–ª—å—à–µ –∂–¥–∞—Ç—å. –£–º—Ä–∏—Ç–µ –∂–µ!\n'
                game[
                    'effecttext'] += 'üí•‚ö°Ô∏è|–ó–∞–ª —Å–æ–¥—Ä–æ–≥–Ω—É–ª—Å—è. –í–µ—Å—å –ø–æ—Ç–æ–ª–æ–∫ –ø–æ–∫—Ä—ã–ª—Å—è —á–µ—Ä–Ω—ã–º–∏ —Ç—É—á–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø—É—Å—Ç—è —Å–µ–∫—É–Ω–¥—É –Ω–∞—á–∞–ª–∏ –æ—Å—ã–ø–∞—Ç—å –∑–∞–ª –º–æ–ª–Ω–∏—è–º–∏. ' + \
                                     '–í—Å–µ –≥–µ—Ä–æ–∏ –º–µ—Ä—Ç–≤—ã, –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.\n'

            elif player['act'][0] == 'infect_weapon':
                player['invokercd'] = 2
                target = game['players'][player['act'][1]]
                target['infected_weapon'].append([1, 3])  # [0] - —Å–∏–ª–∞ –¥–µ–±–∞—Ñ—Ñ–∞, [1] - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                game['text'] += 'ü¶†|' + player['name'] + ' –æ—Ç—Ä–∞–≤–ª—è–µ—Ç –æ—Ä—É–∂–∏–µ ' + target[
                    'name'] + ' –Ω–∞ 2 —Ö–æ–¥–∞! –¶–µ–ª—å –±—É–¥–µ—Ç —Ç–µ—Ä—è—Ç—å 1‚ö°Ô∏è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∞—Ç–∞–∫—É–µ—Ç.\n'

            elif player['act'][0] == 'big_light_strike':
                player['invokercd'] = 4
                game['light_strikes'].append([5, 3])  # [0] - —Å–∏–ª–∞ —É–¥–∞—Ä–∞, [1] - –∑–∞–¥–µ—Ä–∂–∫–∞
                game['text'] += '‚ö†Ô∏è|' + player['name'] + ' —ç–ª–µ–∫—Ç—Ä–∏–∑—É–µ—Ç –ø–æ–ª–µ –±–æ—è, —á–µ—Ä–µ–∑ 3 —Ö–æ–¥–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –≤–∑—Ä—ã–≤!\n'

            elif player['act'][0] == 'iceheart':
                player['invokercd'] = 6
                target = game['players'][player['act'][1]]
                arm = 5
                target['iceheart'] = arm
                game['text'] += 'üíô|' + player['name'] + ' –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ ' + target[
                    'name'] + '! –û–Ω –ø–æ–ª—É—á–∞–µ—Ç ' + str(arm) + ' –±—Ä–æ–Ω–∏.\n'

            elif player['act'][0] == 'use_doom':
                doomtext = ''
                for idss in game['players']:
                    target = game['players'][idss]
                    if not target['is_lucifer']:
                        if not target['dead']:
                            target['bigdooms'].append([player['id'], 666])
                            target['doomedskills'] = target['skills']
                            target['skills'] = []
                            doomtext += 'üî•üíÄüî•|'+target['name']+' –ø—Ä–æ–∫–ª—è—Ç –Ω–∞ 666 —Ö–æ–¥–æ–≤!\n'

                game['text'] += 'üí¨'+player['name']+': –ë—É–¥—å—Ç–µ –∂–µ –≤—ã –≤—Å–µ –ü–†–û–ö–õ–Ø–¢–´!!!\n'
                game['text'] += 'üìú|–ü–æ –ø–æ–ª—é –±–æ—è —ç—Ö–æ–º —Ä–∞–∑–¥–∞–ª–∏—Å—å —Å–ª–æ–≤–∞ –õ—é—Ü–∏—Ñ–µ—Ä–∞, –æ—Ç —á–µ–≥–æ –∫–∞–º–µ–Ω—å –ø–æ–¥ –Ω–æ–≥–∞–º–∏ –Ω–∞—á–∞–ª —Ç—Ä–µ—Å–∫–∞—Ç—å—Å—è, –∞ –ª–∞–≤–æ–≤—ã–µ –æ–∑–µ—Ä–∞ —Å—Ç–∞–ª–∏ –±—É—Ä–ª–∏—Ç—å.\n'
                game['text'] += 'üìú|–ö–∞–∂–¥—ã–π, –∫—Ç–æ –µ—â–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è –∂–∏–≤, –ø–æ–∂–∞–ª–µ–ª –æ–± —ç—Ç–æ–º. –°–∏–Ω–µ–µ –ø–ª–∞–º—è –æ—Ö–≤–∞—Ç–∏–ª–æ –≤—Å–µ—Ö - –∏ –∞–¥—Å–∫–∏—Ö —Å–æ–∑–¥–∞–Ω–∏–π, –∏ –ª—é–¥–µ–π, –ª–∏—à–∞—è –¥–∞—Ä–∞ —Ä–µ—á–∏ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π.\n'
                game['text'] += 'üìú|–õ—é—Ü–∏—Ñ–µ—Ä –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —Å–≤–æ–π –∫–ª–∏–Ω–æ–∫, –ø—ã—Ç–∞—è—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—ã –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ—â–Ω–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è.\n'
                player['rest_after_doom'] = 3
                game['effecttext'] += doomtext

            elif player['act'][0] == 'rest_after_doom':
                player['rest_after_doom'] -= 1
                if player['rest_after_doom'] > 0:
                    game['text'] += 'üò§|'+player['name']+' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏–ª—ã ('+str(player['rest_after_doom'])+')\n'
                else:
                    game['text'] += '‚ù§Ô∏è‚Äçüî•|'+player['name']+' –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª —Å–∏–ª—ã –∏ –≥–æ—Ç–æ–≤ —É–Ω–∏—á—Ç–æ–∂–∏—Ç—å –≤—Å–µ—Ö, –∫—Ç–æ –≤—Ç–æ—Ä–≥—Å—è –Ω–∞ –µ–≥–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é.\n'
                    player['luciferpower'] = player['luciferpower']*100

            elif player['act'][0] == 'inzhener':
                item = player['act'][1]
                player['inventory'].append(item)
                if 'inzhener?2' in player['skills']:
                    player['grenadedmgbonus'] += 1
                if 'inzhener?3' in player['skills']:
                    player['grenadedmgbonus'] += 2
                game['text'] += 'üîß|' + player['name'] + ' —Å–æ–∑–¥–∞–µ—Ç ' + getname(item) + '!\n'
                player['inzhenercd'] = 6
                if 'inzhener?1' in player['skills']:
                    player['inzhenercd'] = 6
                if 'inzhener?2' in player['skills']:
                    player['inzhenercd'] = 5
                if 'inzhener?3' in player['skills']:
                    player['inzhenercd'] = 4

            if player['act'][0] == 'tentacles':
                target = game['players'][player['act'][1]]
                game['text'] += '‚ô®Ô∏è|' + player['name'] + ' —â–µ–ª–∫–∞–µ—Ç –ø–∞–ª—å—Ü–∞–º–∏. '+target['name']+' —á—É–≤—Å—Ç–≤—É–µ—Ç –¥—Ä–æ–∂–∞–Ω–∏–µ –∑–µ–º–ª–∏ –ø–æ–¥ –Ω–æ–≥–∞–º–∏...\n'
                player['tentacles_turn'] =  True
                player['tentacles_target'] = player['act'][1]

            if player['act'][0] == 'tentacles2':
                player['tentaclescd'] = 4
                target = game['players'][player['act'][1]]
                if not game['completed_hell']:
                    if target['act'] != None and target['act'][0] == 'dark_energy':
                        game['text'] += '‚ô®Ô∏è|–ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –æ–∫–æ–ª–æ ' + player[
                            'name'] + ' –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –≥–æ—Ç–æ–≤—ã–µ –ø–æ–≥–ª–æ—Ç–∏—Ç—å —Ü–µ–ª—å, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –∏–º —Ç—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –¥–µ–∑–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∞ –∏—Ö.\n'
                        target['act'] = ['noneact', 'self']
                    else:
                        game['text'] += '‚ô®Ô∏è|–ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –æ–∫–æ–ª–æ ' + target[
                            'name'] + ' –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ —É—Ç—è–≥–∏–≤–∞—é—Ç —Ü–µ–ª—å –≤ –≥–ª—É–±–∏–Ω—ã –ø—Ä–µ–∏—Å–ø–æ–¥–Ω–µ–π.\n'
                        target['dead'] = True
                        target['eliminated'] = True
                else:
                    if target['act'] != None and target['act'][0] == 'dark_energy':
                        game['text'] += '‚ô®Ô∏è|–ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –æ–∫–æ–ª–æ ' + player[
                            'name'] + ' –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –≥–æ—Ç–æ–≤—ã–µ –ø–æ–≥–ª–æ—Ç–∏—Ç—å —Ü–µ–ª—å, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –∏–º —Ç—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –¥–µ–∑–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∞ –∏—Ö.\n'
                        target['act'] = ['noneact', 'self']
                    else:
                        maxdmg = 6
                        maxdmg += player['radiodemonpower']*4
                        dmg = random.randint(3, maxdmg)
                        game['text'] += '‚ô®Ô∏è|–ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –æ–∫–æ–ª–æ ' + target[
                            'name'] + ' –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–Ω–∑–∞—é—Ç —Ç—É –Ω–∞—Å–∫–≤–æ–∑—å! –ù–∞–Ω–µ—Å–µ–Ω–æ '+str(dmg)+' —É—Ä–æ–Ω–∞.\n'
                        takedamage(game, player, target, dmg)
                        if target['blood'] <= 0:
                            target['blood'] = 4
                            if 'dvuzhil' in target['skills']:
                                target['blood'] += 2
                            target['blood'] += get_target_dvuzhil(target)
                            game['text'] += '‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                        else:
                            if target['blood'] > 1:
                                target['blood'] -= 1
                            game['text'] += '‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ ' + target['name'] + ' —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'

            elif player['act'][0] == 'virus_wait':
                game['text'] += 'üëÅ‚Äçüó®|' + player['name'] + ' –∏—â–µ—Ç —Ü–µ–ª—å —Å —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —ç–Ω–µ—Ä–≥–∏–∏...\n'

            elif player['act'][0] == 'change_skill':
                randomskilllist = skills.copy()
                if 'invoker' in randomskilllist:
                    randomskilllist.remove('invoker')
                if not player['weapon'].ranged:
                    randomskilllist.remove('sniper')
                if player['weapon'].ranged:
                    randomskilllist.remove('bicepc')
                if 'ritualist' in randomskilllist:
                    randomskilllist.remove('ritualist')
                if 'navod' in randomskilllist:
                    randomskilllist.remove('navod')
                if 'oruzh' in randomskilllist:
                    randomskilllist.remove('oruzh')
                if 'necromant' in randomskilllist:
                    randomskilllist.remove('necromant')
                if 'invoker' in player['skills']:
                    player['skills'].remove('invoker')
                newskill = random.choice(randomskilllist)
                player['skills'].append(newskill)
                game['text'] += 'üòà|' + player['name'] + ' –æ—Ç—Ä–µ–∫–∞–µ—Ç—Å—è –æ—Ç –º–∞–≥–∏–∏, –ø–æ–ª—É—á–∞—è –≤–∑–∞–º–µ–Ω —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å "' + getname(
                    newskill) + '"!\n'
                if newskill == 'dvuzhil':
                    player['hp'] += 1
                    player['maxhp'] += 1
                if newskill == 'cherep':
                    player['dmglimit'] += 3
                    player['maxdmglimit'] += 3
                    player['chereparmor'] += 3
                if newskill == 'medic':
                    player['inventory'].append('stimulator')
                if newskill == 'berserk':
                    player['maxenergy'] = 3
                    player['energy'] = player['maxenergy']
                if newskill == 'protivogaz':
                    player['maxenergy'] += 1
                    player['energy'] += 1
                if newskill == 'pyrotech':
                    player['inventory'].append('bomb')
                if newskill == 'alchemist':
                    player['inventory'].append('madpotion')
                if newskill == 'zapas':
                    for i in range(2):
                        lst = items.copy()
                        if player['controller'] == 'bot':
                            lst = npcitems.copy()
                        x = random.choice(lst)
                        while x in player['inventory']:
                            x = random.choice(lst)
                        player['inventory'].append(x)
                if newskill == 'narkoman':
                    x = random.choice(['adrenaline', 'dzet', 'hitin'])
                    player['inventory'].append(x)

            elif player['act'][0] == 'madskele_prepare':
                game['text'] += 'üíà|' + player['name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞–¥ —Å–æ–±–æ–π –∫–æ–ª–æ–Ω–Ω—É.\n'
                player['madskele_attack'] = 1

            elif player['act'][0] == 'madskele_wait':
                game['text'] += '‚ùì|' + player['name'] + ' —Å—Ç–æ–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ —Å –ø–æ–¥–Ω—è—Ç–æ–π –∫–æ–ª–æ–Ω–Ω–æ–π.\n'

            elif player['act'][0] == 'drink_tea':
                if random.randint(1, 100) <= 75:
                    game['text'] += '‚òïÔ∏è|' + player['name'] + ' –ø—å–µ—Ç —á–∞–π.\n'
                else:
                    game['text'] += 'üç¨|' + player['name'] + ' –µ—Å—Ç –∫–æ–Ω—Ñ–µ—Ç—ã.\n'

            elif player['act'][0] == 'amalgama_info':
                game['text'] += '‚ù§Ô∏è‚Äçü©π' + player[
                    'name'] + ' –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞ –∏ –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è, —Ä–∞–∑–º—ã—à–ª—è—è –æ–± –∞–º–∞–ª—å–≥–∞–º–µ. –°—Ç—Ä–∞—Ö –æ—Ç—Å—Ç—É–ø–∞–µ—Ç!\n'
                player['dark_counter'] = 0
                player['pressed_info'] = True

            elif player['act'][0] == 'get_calm':
                game['text'] += '‚ù§Ô∏è‚Äçü©π' + player['name'] + ' –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞ –∏ –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è. –°—Ç—Ä–∞—Ö –æ—Ç—Å—Ç—É–ø–∞–µ—Ç!\n'
                player['dark_counter'] = 0
                player['pressed_info'] = True

            elif player['act'][0] == 'perekat_right':
                game['text'] += 'üí®' + player['name'] + ' –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–µ–∫–∞—Ç –≤–ø—Ä–∞–≤–æ!\n'
                player['darkness_uvorot'] += 1
                if player['darkness_uvorot'] == 4:
                    player['dead'] = True
                    game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'

            elif player['act'][0] == 'perekat_left':
                game['text'] += 'üí®' + player['name'] + ' –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–µ–∫–∞—Ç –≤–ª–µ–≤–æ!\n'
                player['darkness_uvorot'] += 1
                if player['darkness_uvorot'] == 4:
                    player['dead'] = True
                    game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'

            elif player['act'][0] == 'wake_up':
                wakeup_amount = 1
                for idss in game['players']:
                    target = game['players'][idss]
                    target['darkness_sleep'] = False
                w_up = wakeups.find_one({})['wakeups']
                if player['id'] not in w_up:
                    wakeups.update_one({}, {'$push': {'wakeups': player['id']}})
                    w_up.append(player['id'])
                wakeup_amount = len(w_up)
                game['text'] += '‚ò†Ô∏è' + player['name'] + ' —Å–æ–≤–µ—Ä—à–∞–µ—Ç —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ.\n'
                if not game['dark_said']:
                    game[
                        'text'] += 'üìú|–í—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –≥–ª–∞–∑–∞ –∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç–µ, —á—Ç–æ –ª–µ–∂–∏—Ç–µ –Ω–∞ –ø–æ–ª—É. –í—ã –∂–∏–≤—ã –∏ –∑–¥–æ—Ä–æ–≤—ã, —Ö–æ—Ç—è —Å–µ–∫—É–Ω–¥—É –Ω–∞–∑–∞–¥ –ø—ã—Ç–∞–ª–∏—Å—å ' + \
                                   '—É–±–∏—Ç—å —Å–µ–±—è, –∏ —É –≤–∞—Å –≤—Ä–æ–¥–µ –∫–∞–∫ –ø–æ–ª—É—á–∏–ª–æ—Å—å. ' + \
                                   '–ù–∞–¥ —Å–æ–±–æ–π –≤—ã –≤–∏–¥–∏—Ç–µ —Å–≥—É—Å—Ç–æ–∫ –º—Ä–∞–∫–∞, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–≤–∏–∂—É—â–∏–π—Å—è —Ç—É–º–∞–Ω, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –¥–µ—Ä–∂–∞—Ç—Å—è –≤—Å–µ —Ç–µ –≥–ª–∞–∑–∞, –∫–æ—Ç–æ—Ä—ã–µ ' + \
                                   '–≤—ã –≤–∏–¥–µ–ª–∏ —Ä–∞–Ω–µ–µ. –ù–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç—Ä–æ—Å—Ç–∫–æ–≤ —Ç—É–º–∞–Ω–∞ –∫–∞–∫ –±—É–¥—Ç–æ —Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å —Å –≤–∞—à–∏–º —Ç–µ–ª–æ–º, –ø—Ä–æ–Ω–∏–∫–∞—è –≤ –≥–æ–ª–æ–≤—É –∏ –≤ —Å–µ—Ä–¥—Ü–µ.\n'
                    game[
                        'text'] += '‚¨ÜÔ∏è|' + '–í—ã –≤—Å–∫–æ—á–∏–ª–∏ –∏ –æ–±–æ—Ä–≤–∞–ª–∏ —Å–≤—è–∑—å —Ç–µ–º–Ω–æ–≥–æ –Ω–µ—á—Ç–æ —Å –≤–∞–º–∏. –û–±–µ—Ä–Ω—É–≤—à–∏—Å—å, –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç–µ —Ç—É —Å–∞–º—É—é –¥–≤–µ—Ä—å, –≤ –∫–æ—Ç–æ—Ä—É—é –≤–æ—à–ª–∏ —Ä–∞–Ω–µ–µ. ' + \
                                   '–í—ã —Å–ª—ã—à–∏—Ç–µ —à–µ–ø–æ—Ç, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –æ—Ç–∫—É–¥–∞ –æ–Ω —Ä–∞–∑–¥–∞–µ—Ç—Å—è, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω –≤ –≤–∞—à–µ–π –≥–æ–ª–æ–≤–µ:\n'
                    pos_text = '–ø–µ—Ä–≤—ã–π'
                    if wakeup_amount == 1:
                        pos_text = '–ø–µ—Ä–≤—ã–π'
                    if wakeup_amount == 2:
                        pos_text = '–≤—Ç–æ—Ä–æ–π'
                    if wakeup_amount == 3:
                        pos_text = '—Ç—Ä–µ—Ç–∏–π'
                    if wakeup_amount == 4:
                        pos_text = '—á–µ—Ç–≤–µ—Ä—Ç—ã–π'
                    if wakeup_amount == 5:
                        pos_text = '–ø—è—Ç—ã–π'
                    if wakeup_amount == 6:
                        pos_text = '—à–µ—Å—Ç–æ–π'
                    if wakeup_amount == 7:
                        pos_text = '—Å–µ–¥—å–º–æ–π'
                    if wakeup_amount == 8:
                        pos_text = '–≤–æ—Å—å–º–æ–π'
                    if wakeup_amount == 9:
                        pos_text = '–¥–µ–≤—è—Ç—ã–π'
                    if wakeup_amount == 10:
                        pos_text = '–¥–µ—Å—è—Ç—ã–π'
                    if wakeup_amount > 10:
                        pos_text = '–¥–∞–ª–µ–∫–æ –Ω–µ –ø–µ—Ä–≤—ã–π'
                    game[
                        'text'] += 'üí¨–¢—å–º–∞|üëÅüåëüåëüëÅ: –¢—ã ' + pos_text + ', –∫—Ç–æ —Å–º–æ–≥ –ø—Ä–µ—Ä–≤–∞—Ç—å –º–æ—é –º–∞–≥–∏—é —É—Å—ã–ø–ª–µ–Ω–∏—è... –ü—Ä–∏–¥–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å —Å–≤–æ—é ' + \
                                   '–∏—Å—Ç–∏–Ω–Ω—É—é —Ñ–æ—Ä–º—É, —á—Ç–æ–±—ã –ø–æ–≥–ª–æ—Ç–∏—Ç—å —Ç–≤–æ–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏–ª—ã.\n'
                    game[
                        'effecttext'] += '–¢—å–º–∞ –≤—ã–ø—É—Å–∫–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–µ–π, –Ω–∞ –∫–æ–Ω—Ü–∞—Ö –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≥–ª–∞–∑–∞. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≥–ª–∞–∑–∞ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —è—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–º–∏, ' + \
                                         '–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ - –º–æ—Ä–æ–∑–Ω–æ-—Å–∏–Ω–∏–º–∏. –û—Å—Ç–∞–ª—å–Ω—ã–µ –≥–ª–∞–∑–∞ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ "—Ç—É–ª–æ–≤–∏—â–∞" —Ç—å–º—ã, –æ–±—Ä–∞–∑—É—è –æ–¥–∏–Ω –æ–≥—Ä–æ–º–Ω—ã–π –≥–ª–∞–∑.\n'
                    allys = []
                    for idss in game['players']:
                        target = game['players'][idss]
                        if target['team'] == player['team'] and target['id'] != player['id']:
                            target['darkness_sleep'] = False
                            allys.append(target['id'])
                    if len(allys) > 0:
                        game['text'] += '‚¨ÜÔ∏è|–î–æ —Ç–æ–≥–æ, –∫–∞–∫ —Ç—å–º–∞ –∞—Ç–∞–∫–æ–≤–∞–ª–∞, –≤—ã —É—Å–ø–µ–≤–∞–µ—Ç–µ —Ä–∞–∑–±—É–¥–∏—Ç—å —Å–≤–æ–∏—Ö —Å–æ—é–∑–Ω–∏–∫–æ–≤.\n'
                    for idss in game['players']:
                        target = game['players'][idss]
                        if '–¢—å–º–∞' in target['name'] and target['team'] == 'dark' and target['controller'] == 'bot':
                            target['dark_true_form'] = True
                    game['dark_said'] = True

            elif player['act'][0] == 'run_to_player':
                if not player['dark_true_form']:
                    game['text'] += '‚ùì|–ù–µ—á—Ç–æ –≥–æ–Ω–∏—Ç—Å—è –∑–∞ –≤–∞–º–∏...\n'

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'vor':
                target = game['players'][player['act'][1]]
                target['who_steal'].append(player['id'])

        for ids in game['players']:
            player = game['players'][ids]
            if len(player['who_steal']) > 0:
                who = random.choice(player['who_steal'])
                player['who_steal'] = [who]

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'vor' or player['passivevor']:
                target = None
                if player['passivevor']:
                    player['passivevor'] = False
                    targets = []
                    for idss in game['players']:
                        tg = game['players'][idss]
                        if tg['team'] != player['team'] and not tg['dead'] and tg['stun'] <= 0:
                            targets.append(tg)
                    if len(targets) > 0:
                        target = random.choice(targets)
                        target['who_steal'] = [player['id']]
                else:
                    target = game['players'][player['act'][1]]
                if target != None:
                    player['vorcd'] = 3
                    vor = False
                    if player['id'] in target['who_steal']:
                        if target['act'] != None and target['act'][0] in ['stimulator', 'grenade', 'molotov', 'flash',
                                                                          'shield', 'knife', 'bint']:
                            player['inventory'].append(target['act'][0])
                            target['inventory'].remove(target['act'][0])
                            
                            if 'alex_vor' in player['customtexts'] and player['customtexts']['alex_vor']:
                                game['text'] += 'üôÇ|' + target['name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ' + getname(target['act'][0])+ ' –Ω–æ, ' + player['name'] + ' –∏–∑—ã–º–∞–µ—Ç –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –µ–≥–æ —Ä—É–∫ –∏ —Ä–∞—Å—Å–µ–∏–≤–∞–µ—Ç –≤ –ø—ã–ª—å! ' + '\n'
                            else:
                                game['text'] += 'üòè|' + target['name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ' + getname(target['act'][0]) + ', –Ω–æ –ø—Ä–µ–¥–º–µ—Ç –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫–∞—Ö —É ' + player['name'] + '!\n'
                            
                            vor = True
                            target['act'] = ['notext', 'self']
                        for idss in target['dopuseditems']:
                            player['inventory'].append(idss[0])
                            try:
                                target['inventory'].remove(idss[0])
                            except:
                                pass
                            game['text'] += 'üòè|' + target['name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ' + getname(
                                idss[0]) + ', –Ω–æ –ø—Ä–µ–¥–º–µ—Ç –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫–∞—Ö —É ' + player['name'] + '!\n'
                            vor = True
                        target['dopuseditems'] = []
                    if not vor:
                        if 'alex_vor' in player['customtexts'] and player['customtexts']['alex_vor']:
                            game['text'] += 'üôÉ|–í–æ—Ä—É ' + player['name'] + ' –Ω–µ—á–µ–≥–æ –≤–∑—è—Ç—å –∫—Ä–æ–º–µ –¥—É—à–∏ '+ target[
                            'name'] + '!\n'
                        else:
                            game['text'] += 'üòí|–í–æ—Ä—É ' + player['name'] + ' –Ω–µ —É–¥–∞–µ—Ç—Å—è –Ω–∏—á–µ–≥–æ —É–∫—Ä–∞—Å—Ç—å —É ' + target[
                            'name'] + '!\n'

            elif player['act'][0] == 'lighting':
                target = game['players'][player['act'][1]]
                if target['is_necromant']:
                    game['text'] += 'üëø|' + player[
                        'name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ä—É–∫–∏ –∫ –Ω–µ–±—É. –†–∞–∑—Ä—è–¥ –º–æ–ª–Ω–∏–∏ –±—å–µ—Ç –≤ –±–ª–∏–∂–∞–π—à—É—é –∫–æ–ª–æ–Ω–Ω—É.\n'
                    game['text'] += 'üí¨|' + target['name'] + ': –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—ë–º–Ω—É—é –º–∞–≥–∏—é –ø—Ä–æ—Ç–∏–≤ –ú–ï–ù–Ø!? –ì–ª—É–ø–æ.\n'
                else:
                    target['hp'] -= 2
                    game['text'] += 'üëø|' + player['name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ä—É–∫–∏ –∫ –Ω–µ–±—É. –†–∞–∑—Ä—è–¥ –º–æ–ª–Ω–∏–∏ –±—å–µ—Ç –≤ ' + target[
                        'name'] + '!\n'
                    game['text'] += '‚ô•Ô∏è' * target['hp'] + '|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                        2) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(target['hp']) + ' —Ö–ø.\n'
                player['ritual_ability'] = False

            elif player['act'][0] == 'chargebow':
                player['lastcharge'] = True
                player['bowcharge'] += 1
                game['text'] += 'üèπ|' + player['name'] + ' –Ω–∞—Ç—è–≥–∏–≤–∞–µ—Ç —Ç–µ—Ç–∏–≤—É –õ—É–∫–∞ –ê—Å–≥–∞—Ä–¥.\n'

            elif player['act'][0] == 'eugenwin':
                if random.randint(1, 100) <= 50:
                    for idss in game['players']:
                        target = game['players'][idss]
                        if target['id'] != player['id']:
                            target['dead'] = True
                    game['text'] += 'üç∫‚úÖ|' + ' –ø–∏–≤–Ω–∞—è –ø–æ–±–µ–¥–∞!\n'
                else:
                    game['text'] += 'üç∫‚ùå|' + ' –ø–∏–≤–Ω–æ–π –ª—É–∑.\n'
                    for idss in game['players']:
                        target = game['players'][idss]
                        if target['team'] == player['team']:
                            target['dead'] = True

            elif player['act'][0] == 'amalgama_mutate':
                player['dark_gun_charges'] = 0
                player['dark_dog_attacks'] = 0
                if player['fireticks'] > 1:
                    player['fireticks'] = 1
                    player['firestrength'] = 0
                player['amalgama_must_mutate'] = False
                player['energy'] = player['maxenergy']
                mutates = ['dark_dog', 'dark_gun', 'dark_man']
                currentmutate = ''
                if player['weapon'].name == "–û–≥—Ä–æ–º–Ω—ã–π —Ç–µ—Å–∞–∫":
                    currentmutate = 'dark_man'
                elif player['weapon'].name == "–¢–µ–Ω–µ–≤–∞—è –ø—É—à–∫–∞":
                    currentmutate = 'dark_gun'
                elif player['weapon'].name == "–ü–∞—Å—Ç—å —Å–æ–±–∞–∫–∏":
                    currentmutate = 'dark_dog'
                mutate = random.choice(mutates)
                while mutate == currentmutate:
                    mutate = random.choice(mutates)
                if mutate == 'dark_dog':
                    game['text'] += 'üß¨|–ë–µ—Å—Ñ–æ—Ä–º–µ–Ω–Ω–æ–µ —Ç–µ–ª–æ ' + player[
                        'name'] + ' –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–µ—á—Ç–æ, –Ω–∞–ø–æ–º–∏–Ω–∞—é—â–µ–µ –æ–≥—Ä–æ–º–Ω—É—é –∏ –æ—á–µ–Ω—å –∑–ª—É—é —Å–æ–±–∞–∫—É.\n'
                    player['weapon'] = weaponlist.AmalgamaThirdWeapon()
                elif mutate == 'dark_gun':
                    game['text'] += 'üß¨|–¢–µ–ª–æ ' + player['name'] + ' –∏–∑–≥–∏–±–∞–µ—Ç—Å—è, –ø—Ä–µ–≤—Ä–∞—â–∞—è—Å—å –≤ –ø—É—à–∫—É.\n'
                    player['weapon'] = weaponlist.AmalgamaSecondWeapon()
                elif mutate == 'dark_man':
                    game['text'] += 'üß¨|' + player[
                        'name'] + ' –ø—Ä–∏–æ–±—Ä–µ—Ç–∞–µ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É. –í —Ä—É–∫–∞—Ö –æ–Ω–∞ –¥–µ—Ä–∂–∏—Ç –æ–≥—Ä–æ–º–Ω—ã–π —Ç–µ—Å–∞–∫.\n'
                    player['weapon'] = weaponlist.AmalgamaFirstWeapon()
                targets = []
                for idss in game['players']:
                    target = game['players'][idss]
                    if target['team'] != player['team'] and not target['dead']:
                        targets.append(target)
                if len(targets) > 0:
                    target = random.choice(targets)
                    dark = 2
                    if target['pressed_info']:
                        dark = 1
                    target['dark_counter'] += dark
                    h = 'üñ§'
                    if target['dark_counter'] == 1:
                        h = 'üíö'
                    elif target['dark_counter'] == 2:
                        h = 'üß°'
                    elif target['dark_counter'] == 3:
                        h = 'üíô'
                    elif target['dark_counter'] == 4:
                        h = 'üíú'
                    elif target['dark_counter'] == 5:
                        h = 'üñ§'
                    if target['dark_counter'] < 3:
                        darktext = h + '|' + player['name'] + ' –ø–æ–≥—Ä—É–∂–∞–µ—Ç —Ä–∞–∑—É–º ' + target['name'] + ' –≤–æ —Ç—å–º—É. ' + \
                                   target['name'] + \
                                   ' —á—É–≤—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞—Ö (' + str(target['dark_counter']) + ').\n'
                    else:
                        darktext = h + '|Ã∏Õ°Õ¢ÃÄÃùÕà' + player[
                            'name'] + ' –øÃ∑ÃõÕúÃÇÕíÃ£ÃØ–æÃ∑Õ†ÕúÃäÃåÃäÃ©Ã•–≥Ã∑“áÕ¢ÕõÃ±Õö—ÄÃ∂ÕùÕúÕõÃâÃ§ÃôÃó—ÉÃ∏ÕûÕúÃãÕõÃñ–∂Ã∏Õ†ÕúÃÇÃΩÃ¨–∞ÃµÕùÃ°ÕõÕöÃ≥–µ“à“áÃ°ÕÅÕäÕéÃ≠Ãô—ÇÃ∑“áÃ°ÕÑÃáÃæÃÆÕà —ÄÃ∏Õ†ÃßÕóÃêÃÆÃó–∞Ã∑ÕûÃ°ÕÅÃ¨–∑Ã∏ÃõÃ®ÕÅÃÖÃ£Ã¶—ÉÃ∏Õ†ÃßÃÅÃáÃ´Ã†Ã≥–º“àÕ°ÕúÕíÕâÃ©Õé ' + \
                                   target['name'] + ' –≤Ã∑“áÃ¢ÃæÕçÃ¶ÕÖ–æ“àÃõÃ¢ÕõÕô —ÇÃ∂Õ†Ã®ÕãÃÖÕóÕï—åÃ¥Õ†ÃßÕëÃ¨–ºÃµÕ°ÕúÕÅÃéÃÆÃ§Ã≠—ÉÃ∏ÃõÃ°ÃíÕîÕâÃØ.Ã∑Õ°Ã°ÃÜÃçÃâÕà ' + target[
                                       'name'] + \
                                   ' —á“âÃõÕ¢ÃÉÃÄÕâÃúÕà—ÉÃµÕûÃßÕÇÃñÃ≠–≤“âÕùÕúÕÇÕáÃ£Ã∞—ÅÃ∏ÕùÃ®ÕãÃçÕÇÕöÕö—Ç“àÕûÃ¢ÃÑÃéÕÑÃò–≤Ãµ“áÕúÃîÃèÃ±—ÉÃ∂Õ°Õ¢ÕÑÃù–µÃµÃïÃ®ÃÜÃÅÃò—Ç“â“áÃ®ÕÜÃöÕïÕéÃ• —ÅÃ∑ÃõÕúÃàÕóÃ´—Ç“âÕ†ÃßÕÉÃãÃ´—Ä“âÕûÃ°ÃøÃöÃçÃúÕöÃ§–∞Ã∂“áÕ¢ÕÅÃöÃÄÕâÃó—ÖÃ∂Õ†Ã®ÕÄÃçÃåÕôÃû (' + str(
                            target['dark_counter']) + \
                                   ').\n'
                    game['text'] += darktext

            elif player['act'][0] == 'charge_dark_gun':
                player['dark_gun_charges'] += 1
                game['text'] += 'üåë|' + player['name'] + ' "–∑–∞—Ä—è–∂–∞–µ—Ç" –≤ —Å–µ–±—è —Å–≥—É—Å—Ç–æ–∫ –º—Ä–∞–∫–∞.\n'

            elif player['act'][0] == 'parry':
                target = game['players'][player['act'][1]]
                player['parrycd'] = 5
                player['energy'] -= 0
                game['text'] += 'üó°|' + player['name'] + ' –≥–æ—Ç–æ–≤–∏—Ç—Å—è –ø–∞—Ä–∏—Ä–æ–≤–∞—Ç—å ' + target['name'] + '.\n'
            elif player['act'][0] == 'pyrotechcharge':
                game['text'] += '‚öí|–ü–∏—Ä–æ—Ç–µ—Ö–Ω–∏–∫ ' + player['name'] + ' —É–ª—É—á—à–∞–µ—Ç —Å–∞–º–æ–¥–µ–ª—å–Ω—É—é –±–æ–º–±—É.\n'
                player['bombcharge'] += 1
                for idss in game['players']:
                    target = game['players'][idss]
                    if target['is_necromant']:
                        game[
                            'text'] += '‚ö´Ô∏è|–ù–µ–∫—Ä–æ–º–∞–Ω—Ç –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, —Å—Ç—Ä–µ–ª—è—è —á–µ—Ä–Ω—ã–º–∏ –∏—Å–∫—Ä–∞–º–∏ –ø–æ —Å–∞–º–æ–¥–µ–ª—å–Ω–æ–π –±–æ–º–±–µ. –¢–∞ –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è –≤ —Ä—É–∫–∞—Ö ' + \
                                       player['name'] + ', ' + \
                                       '–Ω–∞–Ω–æ—Å—è 3 —É—Ä–æ–Ω–∞ –≤–ª–∞–¥–µ–ª—å—Ü—É.\n'
                        takedamage(game, player, player, 3)
                        if 'bomb' in player['inventory']:
                            player['inventory'].remove('bomb')
            elif player['act'][0] == 'weakskele_surrender':
                game['text'] += '‚ö∞Ô∏è|' + player['name'] + ' —É—Å—Ç–∞–ª —Å—Ä–∞–∂–∞—Ç—å—Å—è –∏ –ª–µ–≥ –≤ –≥—Ä–æ–±.\n'
                player['dead'] = True
            elif player['act'][0] == 'weakskele_lone_surrender':
                game['text'] += '‚ö∞Ô∏è|' + player['name'] + ' –Ω–µ —Ö–æ—á–µ—Ç —Å—Ä–∞–∂–∞—Ç—å—Å—è –±–µ–∑ –≤—É—Ä–¥–∞–ª–∞–∫–æ–≤ –∏ –ª–æ–∂–∏—Ç—Å—è –≤ –≥—Ä–æ–±.\n'
                player['dead'] = True

            elif player['act'][0] == 'hide_in_door':
                game['text'] += 'üö™|' + player['name'] + ' –≤—ã–±–µ–≥–∞–µ—Ç –∏–∑ –∫–æ–º–Ω–∞—Ç—ã, –ø—Ä—è—á–∞—Å—å –∑–∞ –¥–≤–µ—Ä—å—é.\n'
                player['hide_in_door'] = True
                player['stun'] = 10

            if player['bicepc']:
                player['bicepccd'] = 4

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['weapon'].name == '–ë—É–ª–∞–≤–∞' and (player['act'][0] == 'attack' or player['act'][0] == 'charge'):
                if player['act'][1] == player['lasttarget']:
                    player['bulavabonus'] += 1
                    try:
                        if player['weapon'].lvl == 3:
                            player['bulavabonus'] += 1
                    except:
                        pass
                else:
                    player['bulavabonus'] = 0
                    player['lasttarget'] = None
            else:
                player['bulavabonus'] = 0
                player['lasttarget'] = None

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'shield' or player['act'][0] == 'shieldgen':
                if player['act'][0] == 'shieldgen':
                    player['shieldgencd'] = 5
                    if 'shieldgen?1' in player['skills']:
                        player['shieldgencd'] = 7 + 1
                    if 'shieldgen?2' in player['skills']:
                        player['shieldgencd'] = 5 + 1
                    if 'shieldgen?3' in player['skills']:
                        player['shieldgencd'] = 3 + 1
                elif player['act'][0] == 'shield':
                    player['inventory'].remove('shield')
                target = game['players'][player['act'][1]]
                if target['id'] == player['id']:
                    if 'alex_shield' in player['customtexts'] and player['customtexts']['alex_shield']:
                        game['text'] += 'üéá|' + player['name'] + ', –ø—Ä–æ–¥–æ–ª–∂–∞—è –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –∫–æ—Ñ–µ–º, –º–∞—Ö–Ω—É–ª —Ä—É–∫–æ–π –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –∞—Ç–∞–∫—É –≤ –ø—É—Å—Ç–æ—Ç—É.\n'
                        
                    elif 'probel_shield' in player['customtexts'] and player['customtexts']['probel_shield']:
                        game['text'] += 'üè†|' + player['name'] + ' –≤ –¥–æ–º–∏–∫–µ.\n'
                        
                    elif 'tuman_shield' in player['customtexts'] and player['customtexts']['tuman_shield']:
                        game['text'] += 'üëÅ‚Äçüó®|' + player['name'] + ' –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, —Å–ø–∞—Å–∞—è—Å—å –≤ –≤–µ—á–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂–µ–Ω! \n'
                        
                    elif 'semw_shield' in player['customtexts'] and player['customtexts']['semw_shield']:
                        game['text'] += '‚åõÔ∏è|' + player['name'] + ' –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å "–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–µ—Ç–ª—è", –∑–∞–º–µ–¥–ª—è—é—â—É—é –≤—Ä–µ–º—è –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ. –í—Ä–∞–≥, –æ–∫–∞–∑–∞–≤—à–∏—Å—å –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –ø–µ—Ç–ª–∏, —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–º –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ –º–æ–∂–µ—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è. \n'
                        
                    elif 'brun_shield' in player['customtexts'] and player['customtexts']['brun_shield']:
                        game['text'] += 'üåø|' + player['name'] + ' –ø—Ä–∏–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–µ–ª–æ–º Es Tra Gon! –°–ª–∞–≤–æ–Ω –≤–ø–∏—Ç—ã–≤–∞–µ—Ç –≤ —Å–µ–±—è –≤–µ—Å—å –¥–∞–º–∞–≥ (–ë–µ–¥–Ω—ã–π –°–ª–∞–≤–æ–Ω)\n'

                    elif 'calimator_shield' in player['customtexts'] and player['customtexts']['calimator_shield']:
                        game['text'] += 'üß¨|–¢–µ–ª–æ ' + player['name'] + ' –º–µ–Ω—è–µ—Ç—Å—è, —Å—Ç–∞–Ω–æ–≤—è—Å—å –Ω–∞ –≤—Ä–µ–º—è –∞—Ç–∞–∫–∏ –≤—Ä–∞–≥–∞ —Å–≤–µ—Ä—Ö–ø—Ä–æ—á–Ω—ã–º. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂—ë–Ω.\n'

                    else:
                        game['text'] += 'üîµ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —â–∏—Ç. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂–µ–Ω!\n'
                else:
                    if 'alex_shield' in player['customtexts'] and player['customtexts']['alex_shield']:
                        game['text'] += 'üéá|' + player['name'] + ', –ø—Ä–æ–¥–æ–ª–∂–∞—è –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –∫–æ—Ñ–µ–º, –º–∞—Ö–Ω—É–ª —Ä—É–∫–æ–π –∏ –º–∞—Ö–Ω—É–ª —Ä—É–∫–æ–π –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–∞–≤—à—É—é—Å—è –∞—Ç–∞–∫—É –ø–æ ' + target['name'] + ' –≤ –ø—É—Å—Ç–æ—Ç—É.\n'
                        
                    elif 'probel_shield' in player['customtexts'] and player['customtexts']['probel_shield']:
                        game['text'] += 'üè†|' + player['name'] + ' —É–∫—Ä—ã–≤–∞–µ—Ç –≤ –¥–æ–º–∏–∫–µ '  + target['name'] + ', –∏–≥—Ä–æ–∫–∞ –Ω–µ —Å–º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –∏ —É—à–ª–∏\n'
                        
                    elif 'tuman_shield' in player['customtexts'] and player['customtexts']['tuman_shield']:
                        game['text'] += 'üëÅ‚Äçüó®|' + player['name'] + ' –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, ' + target['name'] + ' —Å–ø–∞—Å–µ–Ω –≤–µ—á–Ω–æ—Å—Ç—å—é –≤—Ä–µ–º–µ–Ω–∏. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂–µ–Ω!\n'

                    elif 'brun_shield' in player['customtexts'] and player['customtexts']['brun_shield']:
                        game['text'] += 'üåø|' + player['name'] + ' –ø—Ä–∏–∫—Ä—ã–≤–∞–µ—Ç ' + target['name'] + ' Es Tra Gon! –°–ª–∞–≤–æ–Ω –ø–æ—Å—Ç—Ä–∞–¥–∞–ª –∏–∑-–∑–∞ —á—É–∂–æ–π –æ—à–∏–±–∫–∏...\n'

                    elif 'calimator_shield' in player['customtexts'] and player['customtexts']['calimator_shield']:
                        game['text'] += 'üß¨|–¢–µ–ª–æ ' + player['name'] + ' –æ—Ç–¥–µ–ª—è–µ—Ç –∫—É—Å–æ—á–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ –≤—Ä–µ–º—è –∞—Ç–∞–∫–∏ –≤—Ä–∞–≥–∞ —Å–≤–µ—Ä—Ö–ø—Ä–æ—á–Ω—ã–º –∏ –∑–∞—â–∏—â–∞–µ—Ç ' + target['name'] + '. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂—ë–Ω.\n'

                    else:
                        game['text'] += 'üîµ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —â–∏—Ç –Ω–∞ ' + target['name'] + '. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂–µ–Ω!\n'
                target['shield'] = True

            if player['act'][0] == 'parry' and player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                player['shield'] = True
                game['text'] += 'üîµ|–°–∞–±–ª—è ' + player['name'] + ' –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —É–¥–∞—Ä—ã. –£—Ä–æ–Ω –æ—Ç—Ä–∞–∂–µ–Ω!\n'

            if player['act'][0] == 'burrow':
                game['text'] += 'üï≥|' + player['name'] + ' –∑–∞—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –∑–µ–º–ª—é.\n'
                player['shield'] = True
                target = game['players'][player['act'][1]]
                player['burrowtarget'] = target['id']

            elif player['act'][0] == 'rhino_eliminate':
                player['rhino_eliminatecd'] = 4
                target = game['players'][player['act'][1]]
                game['text'] += 'ü¶è|' + player['name'] + ' —â–µ–ª–∫–∞–µ—Ç –ø–∞–ª—å—Ü–∞–º–∏. –ò–∑ –≥–ª—É–±–∏–Ω –∞–¥–∞ –Ω–∞ –ø–æ–ª–µ –±–æ—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ä–∞–∑—å—è—Ä–µ–Ω–Ω—ã–π –Ω–æ—Å–æ—Ä–æ–≥ –∏ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ '+target['name']+'.\n'
                if 'charge' in target['skills']:
                    rdtext = '–ü–æ –∫—Ä–∞—Å–Ω—ã–º –≥–ª–∞–∑–∞–º —ç—Ç–æ–≥–æ –∑–≤–µ—Ä—å–∫–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ –≤—ã –∑–Ω–∞–∫–æ–º—ã. –¢–µ–ø–µ—Ä—å –ø–æ–Ω—è—Ç–Ω–æ, –∫—Ç–æ –µ–≥–æ —Å—é–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª!'
                else:
                    rdtext = '–ë—ã–ª–æ –ø—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, '+target['name']+'!'
                if not game['rhinotext1']:
                    if not game['completed_hell']:
                        game['text'] += 'üí¨|' + player[
                            'name'] + ': '+rdtext+'\n'
                    else:
                        game['text'] += 'üí¨|' + player[
                            'name'] + ': –í—ã —É–∂–µ –∑–Ω–∞–∫–æ–º—ã —Å —ç—Ç–∏–º –∑–≤–µ—Ä–µ–º, –≥–æ—Å–ø–æ–¥–∞!\n'
                    game['rhinotext1'] = True

                player['summon_angry_rhino'] = True
                player['angry_rhino_target'] = target['id']

            elif player['act'][0] == 'demonshield':
                if player['darkdemon_strenght'] < 80:
                    game['text'] += '‚ö´Ô∏è|' + player['name'] + ' –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π —É—Ä–æ–Ω.\n'
                else:
                    game['text'] += '‚ö´Ô∏è|' + player['name'] + ' –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π —É—Ä–æ–Ω –∏ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ª—É—á —Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.\n'
                player['demonshieldcd'] = 10-round(player['darkdemon_strenght']/20)
                if player['demonshieldcd'] < 2:
                    player['demonshieldcd'] = 2
                player['demonshield'] = True

            elif player['act'][0] == 'setmine':
                amount = int(player['act'][1])
                player['minetimer'] = int(amount) + 1
                player['minercd'] = 4
                player['energy'] -= 2
                game['text'] += 'üß®|' + player['name'] + ' —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∏–Ω—É.\n'

            elif player['act'][0] == 'necrostaffability':
                player['necrostaffabilitycd'] = 10
                zombietype = random.choice(['ghoul', 'rat', 'weakskele'])
                if player["id"] == novice_alex_id:
                    ws = [50, 50, 50, 100]
                    zombietype = random.choices(['ghoul', 'rat', 'weakskele', 'rhino'], ws, k=1)[0]
                if zombietype == 'ghoul':
                    zombiename = '–í—É—Ä–¥–∞–ª–∞–∫|üëπ'
                elif zombietype == 'rat':
                    zombiename = '–ó–æ–º–±–∏-–∫—Ä—ã—Å–∞|üê≠'
                elif zombietype == 'weakskele':
                    zombiename = '–°–∫–µ–ª–µ—Ç|üíÄ'
                elif zombietype == 'rhino':
                    zombiename = '–ù–æ—Å–æ—Ä–æ–≥|ü¶èüî•'

                player['summon_necrofighter'] = zombietype
                player['shield'] = True
                # player['can_summon_zombie'] = False
                if zombietype != 'rhino':
                    game['text'] += 'üîÆ|' + player[
                    'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –Ω–∞ –ø–æ–ª–µ –±–æ—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è ' + zombiename + '!\n'
                else:
                    game['text'] += 'üîÆ|' + player[
                    'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ò–∑ –∞–¥–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä–∂–µ–Ω–Ω—ã–π –∏–º —Ä–∞–Ω–µ–µ ' + zombiename + '!\n'

            elif player['act'][0] == 'wait_in_magic_barrier':
                # player['shield'] = True
                if not player['summoned_weak_skeletons']:
                    if random.randint(1, 100) <= 75:
                        game['text'] += '‚òïÔ∏è|' + player['name'] + ' –ø—å–µ—Ç —á–∞–π.\n'
                    else:
                        game['text'] += 'üç¨|' + player['name'] + ' –µ—Å—Ç –∫–æ–Ω—Ñ–µ—Ç—ã.\n'
                elif player['summoned_weak_skeletons'] and not player['summoned_weak_ghouls']:
                    if random.randint(1, 100) <= 75:
                        game['text'] += '‚òïÔ∏è|' + player['name'] + ' –ø—å–µ—Ç —á–∞–π.\n'
                    else:
                        game['text'] += 'üç¨|' + player['name'] + ' –µ—Å—Ç –∫–æ–Ω—Ñ–µ—Ç—ã.\n'

                elif player['summoned_weak_ghouls'] and not player['summoned_zombie_rats']:
                    if random.randint(1, 100) <= 75:
                        game['text'] += '‚òïÔ∏è|' + player['name'] + ' –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ –ø—å–µ—Ç —á–∞–π.\n'
                    else:
                        game['text'] += 'üç¨|' + player['name'] + ' –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ –µ—Å—Ç –∫–æ–Ω—Ñ–µ—Ç—ã.\n'

                elif player['summoned_zombie_rats']:
                    game['text'] += 'üëÅ|' + player['name'] + ' –æ–±–µ—Å–ø–æ–∫–æ–µ–Ω–Ω–æ —Å–ª–µ–¥–∏—Ç –∑–∞ –±–æ–µ–º.\n'

            elif player['act'][0] == 'dark_die':
                player['dark_die_stage'] -= 1
                if player['dark_die_stage'] > 0:
                    game['text'] += '‚ö´Ô∏è|' + player['name'] + ' –∏–∑–≤–µ—Ä–≥–∞–µ—Ç —Ç–µ–º–Ω—ã–π —Å–≤–µ—Ç (' + str(
                        player['dark_die_stage']) + ')\n'
                else:
                    game['text'] += '‚ö´Ô∏è|' + player['name'] + ' –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –ø–æ–≥—Ä—É–∂–∞—è –≤–æ —Ç—å–º—É –≤—Å–µ –ø–æ–º–µ—â–µ–Ω–∏–µ.\n'
                    for idss in game['players']:
                        target = game['players'][idss]
                        if not target['hide_in_door']:
                            target['dead'] = True

            elif player['act'][0] == 'flash':
                player['inventory'].remove('flash')
                target = game['players'][player['act'][1]]

                if ('protivogaz' not in target['skills'] and 'protivogaz?2' not in target[
                    'skills'] and 'protivogaz?3' not in target['skills'] and 'protivogaz_classic' not in target['skills']):
                    game['text'] += 'üòµ|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç —Å–≤–µ—Ç–æ–≤—É—é –≥—Ä–∞–Ω–∞—Ç—É –≤ ' + target[
                        'name'] + '. (-8 –≠–Ω–µ—Ä–≥–∏–∏)\n'
                    target['energy'] -= 8
                else:
                    if target['is_rhino']:
                        game['text'] += '‚ùå|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç —Å–≤–µ—Ç–æ–≤—É—é –≥—Ä–∞–Ω–∞—Ç—É –≤ ' + target[
                            'name'] + ', –Ω–æ –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—Å–ø—ã—à–∫—É.\n'
                    elif target['is_dark_rat']:
                        game['text'] += '‚ùå|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç —Å–≤–µ—Ç–æ–≤—É—é –≥—Ä–∞–Ω–∞—Ç—É –≤ ' + target[
                            'name'] + '. –£ —Ç–µ–Ω–∏ –Ω–µ—Ç –≥–ª–∞–∑.\n'
                    else:
                        game['text'] += '‚ùå|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç —Å–≤–µ—Ç–æ–≤—É—é –≥—Ä–∞–Ω–∞—Ç—É –≤ ' + target[
                            'name'] + ', –Ω–æ –ø—Ä–æ—Ç–∏–≤–æ–≥–∞–∑ –∑–∞—â–∏—â–∞–µ—Ç –µ–≥–æ. (-1 –≠–Ω–µ—Ä–≥–∏–∏)\n'
                        target['energy'] -= 1
            elif player['act'][0] == 'pickupweapon':
                weapon = player['droppedweapon']
                player['weapon'] = weapon
                player['droppedweapon'] = None
                player['shurikens'] = 4
                try:
                    if player['weapon'].lvl == 1:
                        player['shurikens'] = 2
                    if player['weapon'].lvl == 2:
                        player['shurikens'] = 4
                    if player['weapon'].lvl == 3:
                        player['shurikens'] = 6
                except:
                    pass
                game['text'] += '‚úã|' + player['name'] + ' –ø–æ–¥–±–∏—Ä–∞–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –æ—Ä—É–∂–∏–µ.\n'

            elif player['act'][0] == 'invoker_charge':
                player['invokercd'] -= 1
                player['energy'] -= 2
                game['text'] += 'üñ≤|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–∞—Å—ã –º–∞–Ω—ã.\n'

            elif player['act'][0] == 'ritual':
                target = game['players'][player['act'][1]]
                if target['zombie'] > 0:
                    player['ritual_ability'] = True
                else:
                    target['ritualists'].append([player['id'], 4])
                player['ritualistamount'] -= 1
                game['text'] += 'üëø|' + player['name'] + ' —á–µ—Ä—Ç–∏—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞ –∑–µ–º–ª–µ.\n'
            elif player['act'][0] == 'watershield':
                target = game['players'][player['act'][1]]
                target['watershield'] = 3
                player['watershieldcd'] = watershieldcd
                game['text'] += 'üíß|' + player['name'] + ' —Å–æ–∑–¥–∞—ë—Ç –≤–æ–¥—è–Ω–æ–π —â–∏—Ç –≤–æ–∫—Ä—É–≥ ' + target['name'] + '.\n'
            elif player['act'][0] == 'invoker_water_shield':
                target = game['players'][player['act'][1]]
                target['watershield'] = 3
                player['invokercd'] = 4
                game['text'] += 'üíß|' + player['name'] + ' —Å–æ–∑–¥–∞—ë—Ç –≤–æ–¥—è–Ω–æ–π —â–∏—Ç –≤–æ–∫—Ä—É–≥ ' + target[
                    'name'] + ' —Å –ø–æ–º–æ—â—å—é –º–∞–≥–∏–∏.\n'
            elif player['act'][0] == 'energydrain':
                player['energydraincd'] = 4
                target = game['players'][player['act'][1]]
                game['text'] += '‚ö°Ô∏è|' + player['name'] + ' –≤—ã–ø–∏–≤–∞–µ—Ç –≤—Å—é —ç–Ω–µ—Ä–≥–∏—é –∏–∑ ' + target['name'] + '!\n'
                regen_energy(game, player, target['energy'])
                target['energy'] -= target['energy']
            elif player['act'][0] == 'demon_steal':
                player['demoncd'] = 11
                target = game['players'][player['act'][1]]
                damage, chaintext, sokrushtext, narsiltext, drobovik_hasnocharges, lastsnipertarget = generate_cube_hit_damage(game, player, target, cubes=3, accuracy=2)
                if damage > 0:
                    player['hp'] += 1
                    if player['hp'] > player['maxhp']:
                        player['hp'] = player['maxhp']
                    target['hp'] -= 1
                    game['text'] += 'üëπ|–î–µ–º–æ–Ω ' + player['name'] + ' —Å–æ–∑–¥–∞–µ—Ç –∫–∞–Ω–∞–ª —ç–Ω–µ—Ä–≥–∏–∏ –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ '+target["name"]+', –≤—ã—Å–∞—Å—ã–≤–∞—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏–ª—ã —Ü–µ–ª–∏!\n'
                    game['text'] += '‚ô•Ô∏è' * target['hp'] + '|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                        1) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(target['hp']) + ' —Ö–ø.\n'
                    game['text'] += '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ' + str(
                        1) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(player['hp']) + ' —Ö–ø.\n'
                else:
                    game['text'] += 'üëπüí®|–î–µ–º–æ–Ω ' + player['name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª —ç–Ω–µ—Ä–≥–∏–∏ –º–µ–∂–¥—É —Å–æ–±–æ–π –∏ '+target["name"]+', –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.\n'
                player['energy'] -= 3
            elif player['act'][0] == 'charge':
                if player['is_rhino']:
                    player['chargecd'] = 6
                else:
                    player['chargecd'] = 4
                for ids in game['players']:
                    target = game['players'][ids]
                    if target['team'] != player['team']:
                        if target['id'] not in player['nearplayers']:
                            player['nearplayers'].append(target['id'])
                        if player['id'] not in target['nearplayers']:
                            target['nearplayers'].append(player['id'])

            elif player['act'][0] == 'blue_beam_prepare':
                target = game['players'][player['act'][1]]
                player['last_dark_acts'].append('blue_beam_prepare')
                game['text'] += 'üîµ|–°–∏–Ω–∏–µ –≥–ª–∞–∑–∞ —Ç—å–º—ã –∑–∞–≥–æ—Ä–µ–ª–∏—Å—å –∏ –Ω–∞—Ü–µ–ª–∏–ª–∏—Å—å –Ω–∞ ' + target['name'] + '.\n'
                player['prepared_beam'] = ['blue_beam', player['act'][1]]

            elif player['act'][0] == 'red_beam_prepare':
                target = game['players'][player['act'][1]]
                player['last_dark_acts'].append('red_beam_prepare')
                game['text'] += 'üî¥|–ö—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ —Ç—å–º—ã –∑–∞–≥–æ—Ä–µ–ª–∏—Å—å –∏ –Ω–∞—Ü–µ–ª–∏–ª–∏—Å—å –Ω–∞ ' + target['name'] + '.\n'
                player['prepared_beam'] = ['red_beam', player['act'][1]]

            elif player['act'][0] == 'violet_beam_prepare':
                target = game['players'][player['act'][1]]
                player['last_dark_acts'].append('violet_beam_prepare')
                game['text'] += 'üü£|–í—Å–µ –≥–ª–∞–∑–∞ —Ç—å–º—ã –∑–∞–≥–æ—Ä–µ–ª–∏—Å—å –∏ –Ω–∞—Ü–µ–ª–∏–ª–∏—Å—å –Ω–∞ ' + target['name'] + '.\n'
                player['prepared_beam'] = ['violet_beam', player['act'][1]]

            elif player['act'][0] == 'lastchance':
                targets = 2
                enemys = []
                enemys_hitten = []
                alive = 0
                for idss in game['players']:
                    enemy = game['players'][idss]
                    if enemy['team'] != player['team'] and enemy['dead'] == False:
                        enemys.append(enemy)
                while True:
                    if len(enemys_hitten) < targets and len(enemys) > len(enemys_hitten):
                        target = random.choice(enemys)
                        while target in enemys_hitten:
                            target = random.choice(enemys)
                        enemys_hitten.append(target)
                    else:
                        break
                doptt = ''
                for idss in enemys_hitten:
                    target = idss
                    if target['zombie'] > 0:
                        target['zombie'] = 1
                    if target['necrozombie'] > 0:
                        target['necrozombie'] = 1
                        target['getlasthit'] = True
                    if target['is_necromant']:
                        doptt += 'üí¨' + target[
                            'name'] + ': –í–ø—É—Å—Ç—É—é –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è –∂–∏–∑–Ω—å. –ù–∞ –ú–ï–ù–Ø —Ç–∞–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç.\n'
                    else:
                        # doptt = ''
                        target['hp'] -= 1
                player['lasthit'] = 2

                targettext = ''
                for idss in enemys_hitten:
                    targettext += idss['name'] + ' –∏ '
                targettext = targettext[:len(targettext) - 3]
                # targettext += '.'
                if len(enemys_hitten) > 1:
                    b = '–∏'
                    e = '—é'
                else:
                    b = '—å'
                    e = '–µ'
                game['text'] += '‚ù§Ô∏è‚Äçüî•|' + player[
                    'name'] + ' –¥–æ—Å—Ç–∞—ë—Ç –∫–ª–∏–Ω–æ–∫, —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–ª—ã –∏ –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –º–æ—â–Ω—É—é —Å–µ—Ä–∏—é —É–¥–∞—Ä–æ–≤ –ø–æ ' + targettext + ', ' + \
                                '–ø–æ–ª—É—á–∞—è —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Ç—Ä–∞–≤–º—ã. –¶–µ–ª' + b + ' —Ç–µ—Ä—è' + e + '—Ç 1‚ô•Ô∏è, –∞ ' + player[
                                    'name'] + ' —É–º—Ä—ë—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ö–æ–¥—É.\n'
                game['text'] += doptt

            elif player['act'][0] == 'die':
                game['text'] += '‚ù§Ô∏è‚Äçüî•|' + player['name'] + ' —É–º–∏—Ä–∞–µ—Ç.\n'

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'navod':
                player['navodcd'] = 4
                target = game['players'][player['act'][1]]
                target['energy'] = target['maxenergy']
                game['text'] += 'üîß|' + player['name'] + ' –ø–µ—Ä–µ–∑–∞—Ä—è–∂–∞–µ—Ç –æ—Ä—É–∂–∏–µ ' + target[
                    'name'] + '. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π! (' + str(target['energy']) + ')\n'
            elif player['act'][0] == 'demonreload':
                if random.randint(1, 100) <= player['darkdemon_strenght']:
                    enemys = []
                    for idss in game['players']:
                        target = game['players'][idss]
                        if target['team'] != player['team'] and not target['dead'] and target['team'] not in player['allies']:
                            enemys.append(target)
                    target = random.choice(enemys)
                    dark_counter = 3
                    target['dark_counter_set'] += dark_counter
                    game['text'] += 'üíú|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–∞—Å—ã –¥–µ–º–æ–Ω–∏—á–µ—Å–∫–∏—Ö —Å–∏–ª –¥–æ –º–∞–∫—Å–∏–º—É–º–∞, –ø–æ–≥—Ä—É–∂–∞—è '+\
                            '—Ä–∞–∑—É–º '+target['name']+' –≤–æ —Ç—å–º—É. '+target['name']+' —á—É–≤—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞—Ö ('+str(dark_counter)+').\n'
                else:
                    game['text'] += 'üïë|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–∞—Å—ã –¥–µ–º–æ–Ω–∏—á–µ—Å–∫–∏—Ö —Å–∏–ª –¥–æ –º–∞–∫—Å–∏–º—É–º–∞.\n'
                actualenergy = set_energy(game, player, player['maxenergy'])

            elif player['act'][0] == 'reload':
                if 'robot' not in player['skills']:
                    actualenergy = set_energy(game, player, player['maxenergy'])
                    if actualenergy == player['maxenergy']:
                        reloadtext = ' –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π! (' + str(player['maxenergy']) + ')'
                        zilchtext = '(' + str(player['maxenergy']) + ')'
                        semw_zh_text = '(' + str(player['maxenergy']) + ')'
                        togzhan_text = '(' + str(player['maxenergy']) + ')'
                        alex_text = '(' + str(player['maxenergy']) + ')'
                        soonnatillo_text = '(' + str(player['maxenergy']) + ')'
                    else:
                        reloadtext = '! (' + str(player['energy']) + '/' + str(player['maxenergy']) + ')'
                        zilchtext = '(' + str(player['energy']) + '/' + str(player['maxenergy']) + ')'
                        semw_zh_text = '(' + str(player['energy']) + '/' + str(player['maxenergy']) + ')'
                        togzhan_text = '(' + str(player['energy']) + '/' + str(player['maxenergy']) + ')'
                        alex_text = '(' + str(player['energy']) + '/' + str(player['maxenergy']) + ')'
                        soonnatillo_text = '(' + str(player['energy']) + '/' + str(player['maxenergy']) + ')'
                    reloadtext2 = reloadtext
                    if 'zilch_reload' in player['customtexts'] and player['customtexts']['zilch_reload']:
                        game['text'] += 'üëæ|' + player[
                            'name'] + ' –ª–æ–º–∞–µ—Ç –∏–≥—Ä—É. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + zilchtext + '\n'
                    elif 'semw_zh_reload' in player['customtexts'] and player['customtexts']['semw_zh_reload']:
                        game['text'] += 'üö¨|' + player[
                            'name'] + ' –¥–µ–ª–∞–µ—Ç –∂—ë—Å—Ç–∫—É—é —Ç—è–∂–∫—É. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + semw_zh_text + '\n'
                    elif 'togzhan_reload' in player['customtexts'] and player['customtexts']['togzhan_reload']:
                        game['text'] += 'üö¨|' + player[
                            'name'] + ' –æ—Ç–æ—à–ª–∞ –ø–æ–∫—É—Ä–∏—Ç—å. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + togzhan_text + '\n'
                    elif 'alex_reload' in player['customtexts'] and player['customtexts']['alex_reload']:
                        game['text'] += '‚òïÔ∏è|' + player['name'] + ' –Ω–∞—Å–ª–∞–∂–¥–∞–µ—Ç—Å—è –∫–æ—Ñ–µ–º, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∫—Ä–∏–∫–∏ —Å—Ç—Ä–∞–¥–∞—é—â–∏—Ö. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + alex_text + '\n'
                    elif 'tuman_reload' in player['customtexts'] and player['customtexts']['tuman_reload']:
                        game['text'] += '‚ô†Ô∏è|' + player[
                            'name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ—â—å, –ø–æ–≥—Ä—É–∂–∞—è—Å—å –≤ –±–µ–∑–¥–Ω—É —Å–≤–æ–∏—Ö –º—ã—Å–ª–µ–π. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + alex_text + '\n'
                    elif 'prorok_reload' in player['customtexts'] and player['customtexts']['prorok_reload']:
                        game['text'] += 'üòà|' + player['name'] + ' –≤–∏–¥—è, –∫–∞–∫ –≤—Ä–∞–≥–∞ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ö, –∑–ª–æ—Ä–∞–¥–Ω–æ —É—Ö–º—ã–ª—è–µ—Ç—Å—è.–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + alex_text +'\n'

                    elif 'soonnatillo_reload' in player['customtexts'] and player['customtexts']['soonnatillo_reload']:
                        game['text'] += 'üë®üèª‚Äçüî¨|' + ' –ê–º—Ñ–µ—Ç–∞–º–∏–Ω –±—ã–ª –≤–≤–µ–¥—ë–Ω, –º–∏—Ä –Ω–∞—á–∞–ª –≤—Ä–∞—â–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ, –∏ –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ –≤—Å–ø—ã—à–∫–∞! ' + soonnatillo_text +'\n'
                            
                    elif 'chokopie_reload' in player['customtexts'] and player['customtexts']['chokopie_reload']:
                        game['text'] += 'üíâ|' +player['name'] + ' –≤–∫–æ–ª–æ–ª –¥–æ–∑—É –≤ –≤–µ–Ω—É. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! ' + alex_text + '\n'
                    else:
                        # if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫':
                        #    game['text'] += 'üß∞|' + player['name'] + ' –∑–∞—Ä—è–∂–∞–µ—Ç 1 –ø–∞—Ç—Ä–æ–Ω –≤ –¥—Ä–æ–±–æ–≤–∏–∫.\n'
                        # else:
                        if player['weapon'].ranged:
                            game['text'] += 'üïì|' + player[
                                'name'] + ' –ø–µ—Ä–µ–∑–∞—Ä—è–∂–∞–µ—Ç—Å—è. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' + reloadtext + '\n'
                        else:
                            if '–Ω–æ—Å–æ—Ä–æ–≥' in player['name'].lower() and player['controller'] == 'bot':
                                game['text'] += 'üò§|' + player[
                                    'name'] + ' —à—É–º–Ω–æ —Ä–∞–∑–¥—É–≤–∞–µ—Ç –Ω–æ–∑–¥—Ä–∏, –≥–æ—Ç–æ–≤—è—Å—å –∞—Ç–∞–∫–æ–≤–∞—Ç—å. –≠–Ω–µ—Ä–≥–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.\n'
                            else:
                                game['text'] += 'üò§|' + player[
                                    'name'] + ' –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥—É—Ö. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' + reloadtext + '\n'
                    if player['infected']:
                        player['infected'] = False
                    player['maxenergy'] += player['electrolostenergy']
                    if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫':
                        if player['drobovik_charges'] < 2:
                            player['drobovik_charges'] += 1

                    player['electrolostenergy'] = 0
                    if player['can_regen_hp_by_reload'] > 0:
                        player['hp'] += player['can_regen_hp_by_reload']
                        if player['hp'] > player['maxhp']:
                            player['hp'] = player['maxhp']
                        game['text'] += '‚ùóÔ∏è|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ' + '‚ô•Ô∏è' * player[
                            'can_regen_hp_by_reload'] + '—Ö–ø –≤–æ –≤—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞.\n'
                        player['can_regen_hp_by_reload'] = 0
                else:
                    game['text'] += 'ü§ñ|' + player['name'] + ' –æ—Ö–ª–∞–∂–¥–∞–µ—Ç —Å–µ–±—è.\n'
                    player['peregrev'] = 0

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'isaev':
                target = game['players'][player['act'][1]]
                if random.randint(1, 100) <= 8:
                    game['text'] += 'üñïüíî|' + player['name'] + ' –ø–æ—Å—ã–ª–∞–µ—Ç ' + target['name'] + ' –Ω–∞—Ö—É–π. ' + target[
                        'name'] + ' —Ç–µ—Ä—è–µ—Ç –≤–µ—Ä—É –≤ —Å–µ–±—è!\n'
                    target['suicide'] = True
                else:
                    game['text'] += 'üñï|' + player['name'] + ' –ø–æ—Å—ã–ª–∞–µ—Ç ' + target['name'] + ' –Ω–∞—Ö—É–π.\n'
            if player['act'][0] == 'pricel':
                target = game['players'][player['act'][1]]
                game['text'] += 'üéØ|' + player['name'] + ' —Ü–µ–ª–∏—Ç—Å—è.\n'
                if player['maintarget'] == None or player['maintarget']['target'] != target['id']:
                    player['maintarget'] = {'target': target['id'], 'power': 1}
                else:
                    player['maintarget']['power'] += 1

            if player['act'][0] == 'lucifer_hellfire':
                game['text'] += '‚ô®Ô∏è|–õ—é—Ü–∏—Ñ–µ—Ä –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–æ–∫—Ä—É–≥ –Ω–µ–≥–æ –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –∫–æ–ª—å—Ü–æ –æ–≥–Ω—è.\n'
                player['lucifer_hellfire'] = 3

            elif player['act'][0] == 'wing_attack':
                 if "–¥—Ä–∞–∫–æ–Ω" not in player["name"].lower():
                     game["text"] += "üå™|" + player[
                         "name"] + " –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∫—Ä—ã–ª—å—è –∏ —Å–æ–∑–¥–∞–µ—Ç –≤–æ–ª–Ω—É –≤–æ–∑–¥—É—Ö–∞, –æ—Ç—Ç–∞–ª–∫–∏–≤–∞—è –æ—Ç —Å–µ–±—è –≤—Å–µ—Ö —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤!\n"
                 else:
                    game["text"] += "üå™|"+player["name"]+" –∫—Ä—ã–ª—å—è–º–∏ —Å–æ–∑–¥–∞–µ—Ç –≤–æ–ª–Ω—É –≤–æ–∑–¥—É—Ö–∞, –æ—Ç—Ç–∞–ª–∫–∏–≤–∞—è –æ—Ç —Å–µ–±—è –≤—Å–µ—Ö —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤!\n"
                 for idss in game["players"]:
                     target = game["players"][idss]
                     if target["team"] != player["team"]:
                         if player["id"] in target["nearplayers"]:
                             if target["is_knight"]:
                                 game["text"] += "üõ°|–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –±—Ä–æ–Ω—è –¥–µ–ª–∞–µ—Ç "+target["name"]+" —Å–ª–∏—à–∫–æ–º —Ç—è–∂–µ–ª—ã–º –¥–ª—è –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏—è.\n"
                             else:
                                 try:
                                     player["nearplayers"].remove(target["id"])
                                 except:
                                     pass
                                 target["nearplayers"].remove(player["id"])
                 player["wing_attackcd"] = 5
                 if "dragon_power" in player["skills"]:
                     player["wing_attackcd"] = 6
                     player["energy"] -= 2

            for idss in player['dopuseditems']:
                adrenaline_amount = 0
                target = game['players'][idss[1]]
                if idss[0] == 'adrenaline':
                    if 'adrenaline' in player['inventory']:
                        if game['pureduel_rats'] and adrenaline_amount > 0:
                            pass
                        else:
                            adrenaline_amount += 1
                            actualenergy = regen_energy(game, target, 3)
                            if 'semw_adrenaline' in player['customtexts'] and player['customtexts']['semw_adrenaline']:
                                if target['id'] != player['id']:
                                    game['text'] += 'üçæ|' + player['name'] + ' –ø–µ—Ä–µ–¥–∞–µ—Ç 1,5 –ª–∏—Ç—Ä–∞ –ñ–∏–≥—É–ª–µ–≤—Å–∫–æ–≥–æ –∏–≥—Ä–æ–∫—É ' + target[
                                        'name'] + '! –ï–≥–æ —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ ' + str(actualenergy) + '.\n'
                                else:
                                    game['text'] += 'üçæ|' + player['name'] + ' –≤—ã–ø–∏–≤–∞–µ—Ç 1.5–∫—É –ñ–∏–≥—É–ª–µ–≤—Å–∫–æ–≥–æ! '+\
                                                    '–ï–≥–æ —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ ' + str(actualenergy) + '.\n'
                            else:
                                game['text'] += 'üíâ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω –Ω–∞ ' + target[
                                    'name'] + '! –ï–≥–æ —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ ' + str(actualenergy) + '.\n'
                            player['inventory'].remove('adrenaline')

                elif idss[0] == 'dzet':
                    if 'dzet' in player['inventory']:
                        num = random.randint(1, 1000)
                        while num in target['dzets']:
                            num = random.randint(1, 1000)
                        target['dzets'].update({num: 3})

                        if 'semw_jet' in player['customtexts'] and player['customtexts']['semw_jet']:
                            game['text'] += 'üßô‚Äç‚ôÄÔ∏è|' + player['name'] + ' –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ "–≠–Ω–µ—Ä–≥–∏—è –î—Ä–µ–≤–Ω–∏—Ö" –Ω–∞–¥ ' + target[
                                'name'] + '. –ß–µ—Ä–µ–∑ –¥–≤–∞ —Ö–æ–¥–∞ ' + player['name'] + ' –±—É–¥–µ—Ç –ø–æ–ª–Ω –º–∞–≥–∏—á–µ—Å–∫–æ–π —Å–∏–ª—ã –∏ –≥–æ—Ç–æ–≤ –∫ –ø–æ–¥–≤–∏–≥–∞–º!\n'
                        else:
                            game['text'] += 'üíâ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∂–µ—Ç –Ω–∞ ' + target[
                            'name'] + '! –ï–≥–æ —ç–Ω–µ—Ä–≥–∏—è –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ 2 —Ö–æ–¥–∞.\n'

                        player['inventory'].remove('dzet')

                elif idss[0] == 'hitin':
                    if 'hitin' in player['inventory']:
                        num = random.randint(1, 1000)
                        while num in target['hitins']:
                            num = random.randint(1, 1000)
                        target['hitins'].update({num: 3})
                        if 'semw_hitin' in player['customtexts'] and player['customtexts']['semw_hitin']:
                            game['text'] += 'üå≥|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è –ª–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–¥–µ–ª—è–µ—Ç ' + target['name'] + ' –∑–∞—â–∏—Ç–Ω–æ–π –∞—É—Ä–æ–π, —É–∫—Ä—ã–≤–∞—è –µ–≥–æ —Å–∏–ª–æ–π –ø—Ä–∏—Ä–æ–¥—ã!\n'
                        else:
                            game['text'] += 'üíâ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö–∏—Ç–∏–Ω –Ω–∞ ' + target['name'] + '!\n'
                        player['inventory'].remove('hitin')
                elif idss[0] == 'madpotion':
                    if 'madpotion' in player['inventory']:
                        if 'brun_alchemist' in player['customtexts'] and player['customtexts']['brun_alchemist']:
                            game['text'] += 'üëª|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Å—Ç–µ–Ω–¥ ' + target[
                                'name'] + "'a –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–≤–µ—Ä—à–∏—Ç—å –∞—Ç–∞–∫—É. MUDA!\n"
                        else:
                            game['text'] += 'üíâ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—ã–≤–æ—Ä–æ—Ç–∫—É –±–µ—à–µ–Ω—Å—Ç–≤–∞ –Ω–∞ ' + target[
                                'name'] + '!\n'
                        player['inventory'].remove('madpotion')
                        target['madpotion'] = True
                        if 'alchemist?3' in player['skills']:
                            target['doublemadpotion'] = True

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            for idss in player['dopuseditems']:
                target = game['players'][idss[1]]
                if idss[0] == 'bomb':
                    if 'bomb' in player['inventory']:
                        dmg = 1 + (player['bombcharge'] * 2)
                        if 'pyrotech?1' in player['skills']:
                            dmg = 1 + (player['bombcharge'] * 1)
                        if 'pyrotech?2' in player['skills']:
                            dmg = 1 + (player['bombcharge'] * 2)
                        if 'pyrotech?3' in player['skills']:
                            dmg = 1 + (player['bombcharge'] * 3)
                        showdmg = dmg
                        if dmg > 0:
                            player['demon'] = True
                        if not target['washitin']:
                            armor, text = getarmor(game, target, dmg)
                        else:
                            armor = target['dopblock']
                            if dmg < armor:
                                armor = dmg
                            text = ''
                            if armor > 0:
                                if 'semw_armor' in player['customtexts'] and player['customtexts']['semw_armor']:
                                    text = 'ü™ñ|' + target['name'] + ' –≤ —Å–≤–æ–µ–π –±—Ä–æ–Ω–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º—ã–º, —Å–Ω–∏–º–∞—è –≤—Å–µ–≥–æ ' + str(armor) + ' —É—Ä–æ–Ω–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–±–µ–∂–¥–∞—Ç—å –≤—Ä–∞–≥–æ–≤!\n'
                                else:
                                    text = 'üõ°| –ë—Ä–æ–Ω—è ' + target['name'] + ' —Å–Ω–∏–º–∞–µ—Ç ' + str(armor) + ' —É—Ä–æ–Ω–∞!\n'
                        dmg -= armor
                        target['dopblock'] -= armor
                        player['bombcharge'] = 0
                        if not target['shield']:
                            if dmg > 0:
                                player['outgoingdmgs'].append([target['id'], dmg])
                                target['incomingdmgs'].append([player['id'], dmg])
                        game['text'] += '‚ò¢|' + player['name'] + ' –±—Ä–æ—Å–∞–µ—Ç —Å–∞–º–æ–¥–µ–ª—å–Ω—É—é –±–æ–º–±—É –≤ ' + target[
                            'name'] + '! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(showdmg) + ' —É—Ä–æ–Ω–∞.\n'
                        game['text'] += text
                        player['inventory'].remove('bomb')
                        player['energy'] -= 2

            if player['act'][0] == 'knife':
                player['inventory'].remove('knife')
                target = game['players'][player['act'][1]]
                if 'robot' in player['skills']:
                    chance = player['hp']
                damage = 0
                if game['classic_game']:
                    damage = 1
                if 'robot' not in player['skills'] and player['energy'] <= 0:
                    chance = 0
                chance = 40 + (player['energy'] * 10)
                if not game['classic_game']:
                    if 'sniper' in player['skills']:
                        chance += 20
                    if 'visor' in player['skills']:
                        chance += 10
                    if target['act'] != None and target['act'][0] == 'perekat':
                        chance -= 50
                        if 'ninja' in target['skills']:
                            chance -= 950
                    if 'ninja?3' in target['skills']:
                        chance -= 10
                    if 'vor' in player['skills'] or 'vor?2' in player['skills'] or 'vor?3' in player['skills']:
                        chance += 10
                narkomantext = False
                if not game['classic_game']:
                    if 'narkoman' in player['skills'] or 'narkoman?1' in player['skills'] or 'narkoman?2' in player[
                        'skills'] or 'narkoman?3' in player['skills']:
                        chance -= 10
                        if 'narkoman?1' in player['skills']:
                            chance -= 10
                        for idss in game['players']:
                            target2 = game['players'][idss]
                            for idsss in target2['dopuseditems']:
                                itemtarget = game['players'][idsss[1]]
                                if itemtarget['id'] == player['id']:
                                    chance += 20
                                    narkomantext = True
                            if target2['act'] != None and target2['act'][0] in ['stimulator'] and target2['act'][1] == \
                                    player['id']:
                                chance += 20
                                narkomantext = True
                    if narkomantext:
                        game['effecttext'] += 'üôÉ|' + player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –∏ —É—Ä–æ–Ω!\n'
                if chance > 100:
                    chance = 100
                for i in range(1):
                    x = random.randint(1, 100)
                    if x <= chance:
                        damage += 1
                if damage > 0:
                    player['demon'] = True
                    damage = 0
                    if game['classic_game']:
                        damage = 1
                    if target['blood'] <= 0:
                        target['blood'] = 4
                        if 'dvuzhil' in target['skills']:
                            target['blood'] += 2
                        target['blood'] += get_target_dvuzhil(target)
                        if game['classic_game']:
                            game['text'] += 'üî™|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ ' + target[
                                'name'] + '! –ù–∞–Ω–µ—Å–µ–Ω–æ 1 —É—Ä–æ–Ω–∞. ‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                        else:
                            game['text'] += 'üî™|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ ' + target[
                                'name'] + '. ‚ù£Ô∏è|' + target['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é!\n'
                    else:
                        if target['blood'] > 1:
                            target['blood'] -= 1
                        if game['classic_game']:
                            game['text'] += 'üî™|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ ' + target[
                                'name'] + '! –ù–∞–Ω–µ—Å–µ–Ω–æ 1 —É—Ä–æ–Ω–∞. ‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'
                        else:
                            game['text'] += 'üî™|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ ' + target[
                                'name'] + '. ‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è!\n'
                    takedamage(game, player, target, damage)
                    # if 'pyromancer' in player['skills']:
                    #    player['pyrodamage'] = True
                else:
                    game['text'] += 'üí®|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –º–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–∂ –≤ ' + target[
                        'name'] + ', –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.\n'
                player['energy'] -= 1

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'sokrush':
                player['sokrushenie'] = True
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'chain':
                player['chain'] = True
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'strongshot':
                player['strongshot'] = True
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'narsil':
                player['narsil'] = True
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'firearrow':
                player['firearrow'] = True
                player['firearrowcd'] = firearrowcd
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'charge':
                player['charge'] = True
                player['chargecd'] = 4
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'truestrike':
                player['truestrike'] = True
                player['molotcd'] = 6
                if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                    player['molotcd'] = 0
                player['act'] = ['attack', player['act'][1]]

            if player['act'][0] == 'hitdown':
                player['hitdown'] = True
                player['shestcd'] = 6
                player['act'] = ['attack', player['act'][1]]

        for ids in game['players']:
            player = game['players'][ids]
            if 'miner' in player['skills']:
                player['minetimer'] -= 1
                if player['minetimer'] == 0:
                    enemylist = []
                    for idss in game['players']:
                        target = game['players'][idss]
                        if not target['dead'] and target['team'] != player['team']:
                            enemylist.append(target)
                    dmg = random.randint(2, 4)
                    if len(enemylist) == 0:
                        game['text'] += 'üß®|–ú–∏–Ω–∞ ' + player['name'] + ' –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–µ –Ω–∞–Ω–æ—Å—è –Ω–∏–∫–æ–º—É —É—Ä–æ–Ω–∞.\n'
                    else:
                        if len(enemylist) == 1:
                            enemy = enemylist[0]
                            target = enemy
                            showdmg, armortext = takedamage(game, player, target, dmg)
                            game['text'] += 'üß®|–ú–∏–Ω–∞ ' + player['name'] + ' –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–∞–Ω–æ—Å—è ' + str(
                                dmg) + ' —É—Ä–æ–Ω–∞ –ø–æ ' + enemy['name'] + '!\n'
                            game['text'] += armortext
                        else:
                            enemyshit = []
                            while len(enemyshit) < 2:
                                x = random.choice(enemylist)
                                while x in enemyshit:
                                    x = random.choice(enemylist)
                                enemyshit.append(x)
                            armortexts = []
                            for idsss in enemyshit:
                                target = idsss
                                showdmg, armortext = takedamage(game, player, target, dmg)
                                armortexts.append(armortext)
                            game['text'] += 'üß®|–ú–∏–Ω–∞ ' + player['name'] + ' –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–∞–Ω–æ—Å—è ' + str(
                                dmg) + ' —É—Ä–æ–Ω–∞ —Å–ª–µ–¥—É—é—â–∏–º —Ü–µ–ª—è–º: ' + \
                                            enemyshit[0]['name'] + ', ' + enemyshit[1]['name'] + '!\n'
                            for idsss in armortexts:
                                game['text'] += idsss

            if player['lucifer_hellfire'] > 0:
                game['text'] += '‚ô®Ô∏è|–ê—É—Ä–∞ –∞–¥—Å–∫–æ–≥–æ –ø–ª–∞–º–µ–Ω–∏ –õ—é—Ü–∏—Ñ–µ—Ä–∞ –ø–æ–¥–∂–∏–≥–∞–µ—Ç –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥!\n'
                player['lucifer_hellfire'] -= 1
                for idss in game['players']:
                    target = game['players'][idss]
                    if not target['dead']:
                        setfire(game, player, target, 1+player['luciferpower'])

            if player['act'] == None:
                continue
            if player['act'][0] == 'molotov':
                player['inventory'].remove('molotov')
                player['energy'] -= 2
                targets = 2
                enemys = []
                enemys_hitten = []
                alive = 0
                for idss in game['players']:
                    enemy = game['players'][idss]
                    if enemy['team'] != player['team'] and enemy['dead'] == False and enemy['team'] not in player[
                        'allies']:
                        enemys.append(enemy)
                while True:
                    if len(enemys_hitten) < targets and len(enemys) > len(enemys_hitten):
                        target = random.choice(enemys)
                        while target in enemys_hitten:
                            target = random.choice(enemys)
                        enemys_hitten.append(target)
                    else:
                        break
                damage = random.randint(0, 0)
                for idss in enemys_hitten:
                    target = idss
                    setfire(game, player, target, strength=1, duration=3)
                targettext = ''
                for idss in enemys_hitten:
                    targettext += idss['name'] + ', '
                targettext = targettext[:len(targettext) - 2]
                targettext += '.'
                if 'semw_molotov' in player['customtexts'] and player['customtexts']['semw_molotov']:
                    game['text'] += 'üéá|' + ' –§–µ–π–µ—Ä–≤–µ—Ä–∫ –æ—Ç ' +player['name'] + ' —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –Ω–µ–±–æ —è—Ä–∫–∏–º–∏ –≤—Å–ø—ã—à–∫–∞–º–∏ –∏ —Ü–≤–µ—Ç–Ω—ã–º–∏ –æ–≥–Ω—è–º–∏, –Ω–∞–ø–æ–ª–Ω—è—è –≤—Å–µ –≤–æ–∫—Ä—É–≥ –≤–æ—Å—Ç–æ—Ä–≥–æ–º –∏ —Ä–∞–¥–æ—Å—Ç—å—é! ' + targettext + ' –≤ –æ–≥–Ω–µ!\n'
                else:
                    game['text'] += 'üç∏|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –∫–æ–∫—Ç–µ–π–ª—å –º–æ–ª–æ—Ç–æ–≤–∞! ' + targettext + ' –≤ –æ–≥–Ω–µ!\n'

            elif player['act'][0] == 'perekat':
                if 'semw_perekat' in player['customtexts'] and player['customtexts']['semw_perekat']:
                    game['text'] += 'üß†|' + player['name'] + ' —É–∫–ª–æ–Ω—è–µ—Ç—Å—è —Å–∏–ª–æ–π –º—ã—Å–ª–∏.\n'
                elif 'alex_perekat' in player['customtexts'] and player['customtexts']['alex_perekat']:
                    game['text'] += 'üéÜ|' + player['name'] + ' —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª—Å—è –≤ –±–µ–∑–¥–Ω—É, –∏—Å—á–µ–∑–Ω—É–≤ –≤–æ –º–≥–ª–µ.\n'
                elif 'tuman_perekat' in player['customtexts'] and player['customtexts']['tuman_perekat']:
                    game['text'] += 'üåë|' + player['name'] + ' —Å–∫—Ä—ã–ª—Å—è –ø–æ–¥ –º—Ä–∞–∫–æ–º –Ω–æ—á–∏.\n'
                elif 'alan_perekat' in player['customtexts'] and player['customtexts']['alan_perekat']:
                    game['text'] += 'üïò|' + player['name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫–æ—Ä–æ–Ω–∫—É –Ω–∞—Ä—É—á–Ω—ã—Ö —á–∞—Å–æ–≤, —á—Ç–æ–±—ã –æ—Ç–º–æ—Ç–∞—Ç—å –Ω–∞–∑–∞–¥ –≤—Ä–µ–º—è –≤–æ–∫—Ä—É–≥ —Å–µ–±—è.\n'
                elif 'xitruiListochek_perekat' in player['customtexts'] and player['customtexts']['xitruiListochek_perekat']:
                    game['text'] += 'üëû|' + ' –°–¥–µ–ª–∞–≤ –æ–¥–∏–Ω —à–∞–≥ –≤ —Å—Ç–æ—Ä–æ–Ω—É, —Å–º–æ–≥ —É–∫–ª–æ–Ω–∏—Ç—å—Å—è –æ—Ç –∞—Ç–∞–∫–∏.\n'
                else:
                    game['text'] += 'üí®|' + player['name'] + ' –ø–µ—Ä–µ–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è.\n'
                player['perekatcd'] = 5
                if 'ninja?2' in player['skills'] or 'ninja?3' in player['skills']:
                    player['perekatcd'] = 4
                # if 'ninja' in player['skills']:
                #    player['perekatcd'] -= 1

            elif player['act'][0] == 'walk':
                game['text'] += 'üë£|' + player['name'] + ' –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É –≤–ø–ª–æ—Ç–Ω—É—é.\n'
                for ids in game['players']:
                    target = game['players'][ids]
                    if target['team'] != player['team']:
                        if target["id"] not in player["nearplayers"]:
                            player['nearplayers'].append(target['id'])
                        if player["id"] not in target["nearplayers"]:
                            target['nearplayers'].append(player['id'])
                        
            elif player['act'][0] == 'stimulator':
                try:
                    player['inventory'].remove('stimulator')
                except:
                    pass
                target = game['players'][player['act'][1]]
                hpregen = 2
                if 'medic?1' in player['skills']:
                    hpregen = 1
                if 'medic?2' in player['skills']:
                    hpregen = 2
                if 'medic?3' in player['skills']:
                    hpregen = 3
                target['hp'] += hpregen
                if target['hp'] >= target['maxhp']:
                    target['hp'] = target['maxhp']
                if target["id"] != player["id"]:
                    if 'meningoencephalitis_stimulator' in player['customtexts'] and player['customtexts']['meningoencephalitis_stimulator']:
                        game['text'] += 'ü•É|' + player['name'] + ' –ø–æ–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—å—è–∫–æ–º ' + target['name'] + '!\n'
                    else:
                        game['text'] += 'üíâ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä –Ω–∞ ' + target['name'] + '!\n'
                else:
                    if 'meningoencephalitis_stimulator' in player['customtexts'] and player['customtexts']['meningoencephalitis_stimulator']:
                        game['text'] += 'ü•É|' + player['name'] + ' –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥—É—à –∏–∑ –∫–æ–Ω—å—è–∫–∞!\n'
                    else:
                        game['text'] += 'üíâ|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä –Ω–∞ ' + target['name'] + '!\n'

                game['effecttext'] += '‚ô•' * target['hp'] + 'üíâ|' + target['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(
                    hpregen) + ' —Ö–ø. –û—Å—Ç–∞—ë—Ç—Å—è ' + str(target['hp']) + ' —Ö–ø.\n'


                
            elif player['act'][0] == 'bint':
                try:
                    player['inventory'].remove('bint')
                except:
                    pass
                target = game['players'][player['act'][1]]
                target['hp'] += 1
                bloodtext = False
                if target['blood'] > 0:
                    target['blood'] = 0
                    bloodtext = True
                if target['hp'] >= target['maxhp']:
                    target['hp'] = target['maxhp']
                if not bloodtext:
                    game['text'] += 'ü©π|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–Ω—Ç –Ω–∞ ' + target['name'] + '!\n'
                else:
                    game['text'] += 'ü©π|' + player['name'] + ' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–Ω—Ç –Ω–∞ ' + target[
                        'name'] + ', —Å–Ω–∏–º–∞—è —ç—Ñ—Ñ–µ–∫—Ç –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è!\n'
                game['effecttext'] += '‚ô•' * target['hp'] + 'ü©π|' + target['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç 1 —Ö–ø. –û—Å—Ç–∞—ë—Ç—Å—è ' + str(
                    target['hp']) + ' —Ö–ø.\n'
            elif player['act'][0] == 'grenade':
                player['inventory'].remove('grenade')
                player['energy'] -= 2
                targets = 2
                enemys = []
                enemys_hitten = []
                alive = 0
                for idss in game['players']:
                    enemy = game['players'][idss]
                    if enemy['team'] != player['team'] and enemy['dead'] == False and enemy['team'] not in player[
                        'allies']:
                        enemys.append(enemy)
                while True:
                    if len(enemys_hitten) < targets and len(enemys) > len(enemys_hitten):
                        target = random.choice(enemys)
                        while target in enemys_hitten:
                            target = random.choice(enemys)
                        enemys_hitten.append(target)
                    else:
                        break
                damage = random.randint(2, 3)
                damage += player['grenadedmgbonus']
                player['demon'] = True
                armortexts = []
                for idss in enemys_hitten:
                    curdamage = damage
                    target = idss
                    armor, curtext = getarmor(game, target, curdamage)
                    curdamage -= armor
                    armortexts.append(curtext)
                    if not target['shield']:
                        if curdamage > 0:
                            target['incomingdmgs'].append([player['id'], curdamage])
                            player['outgoingdmgs'].append([target['id'], curdamage])
                targettext = ''
                for idss in enemys_hitten:
                    targettext += idss['name'] + ', '
                targettext = targettext[:len(targettext) - 2]
                targettext += '.'
                if 'brun_grenade' in player['customtexts'] and player['customtexts']['brun_grenade']:
                    game['text'] += 'üòº|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç Killer Queen! –ü–µ—Ä–≤–∞—è –±–æ–º–±–∞! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(damage) + ' —É—Ä–æ–Ω–∞ —Å–ª–µ–¥—É—é—â–∏–º —Ü–µ–ª—è–º: ' + targettext + '\n'
                elif 'semw_grenade' in player['customtexts'] and player['customtexts']['semw_grenade']:
                    game['text'] += 'üò±|' + player['name'] + ' –∏–∑–¥–∞–µ—Ç –ø—Ä–æ–Ω–∑–∏—Ç–µ–ª—å–Ω—ã–π –∫—Ä–∏–∫ —É–∂–∞—Å–∞! ' + targettext + ' –∏—Å–ø—ã—Ç—ã–≤–∞—é—Ç —Å–∏–ª—å–Ω—ã–π —Å—Ç—Ä–∞—Ö, –ø–æ–ª—É—á–∞—è: ' + str(damage) + ' —É—Ä–æ–Ω–∞ —Å—Ç—Ä–∞—Ö–æ–º. ' + '\n'
                else:
                    game['text'] += 'üí£|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –≥—Ä–∞–Ω–∞—Ç—É! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(
                        damage) + ' —É—Ä–æ–Ω–∞ —Å–ª–µ–¥—É—é—â–∏–º —Ü–µ–ª—è–º: ' + targettext + '\n'
                if len(armortexts) > 0:
                    for idss in armortexts:
                        game['text'] += idss            

            elif player['act'][0] == 'blow_flamethrower':
                player['weapon'] = weaponlist.Fist()
                player['energy'] -= 2
                targets = 2
                enemys = []
                enemys_hitten = []
                alive = 0
                for idss in game['players']:
                    enemy = game['players'][idss]
                    if enemy['team'] != player['team'] and enemy['dead'] == False and enemy['team'] not in player[
                        'allies']:
                        enemys.append(enemy)
                while True:
                    if len(enemys_hitten) < targets and len(enemys) > len(enemys_hitten):
                        target = random.choice(enemys)
                        while target in enemys_hitten:
                            target = random.choice(enemys)
                        enemys_hitten.append(target)
                    else:
                        break
                damage = random.randint(2, 3)
                #damage += player['grenadedmgbonus']
                player['demon'] = True
                armortexts = []
                for idss in enemys_hitten:
                    curdamage = damage
                    target = idss
                    armor, curtext = getarmor(game, target, curdamage)
                    curdamage -= armor
                    armortexts.append(curtext)
                    setfire(game, player, target, strength=2, duration=3)
                    if not target['shield']:
                        if curdamage > 0:
                            target['incomingdmgs'].append([player['id'], curdamage])
                            player['outgoingdmgs'].append([target['id'], curdamage])
                targettext = ''
                for idss in enemys_hitten:
                    targettext += idss['name'] + ', '
                targettext = targettext[:len(targettext) - 2]
                targettext += '.'
                game['text'] += 'üí£üî•|' + player['name'] + ' –∫–∏–¥–∞–µ—Ç –æ–≥–Ω–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª –≤–æ –≤—Ä–∞–≥–æ–≤! –û—Ä—É–∂–∏–µ –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–∞–Ω–æ—Å–∏—Ç ' + str(
                    damage) + ' —É—Ä–æ–Ω–∞ —Å–ª–µ–¥—É—é—â–∏–º —Ü–µ–ª—è–º –∏ –ø–æ–¥–∂–∏–≥–∞–µ—Ç –∏—Ö: ' + targettext + '\n'
                if len(armortexts) > 0:
                    for idss in armortexts:
                        game['text'] += idss

            elif player['act'][0] == 'EXPLOSION':
                target = game['players'][player['act'][1]]
                game['text'] += 'üíÆ|' + player['name'] + ' –¥–æ—Å—Ç–∞–µ—Ç –ø–æ—Å–æ—Ö –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ ' + target['name'] + '.\n'
                game['text'] += 'üí¨' + player[
                    'name'] + ': –û —Ç—å–º–∞, –∫—É–¥–∞ –Ω–µ –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç —Å–≤–µ—Ç, –æ —á–µ—Ä–Ω–æ–µ –ø–ª–∞–º—è, —á—Ç–æ –Ω–µ –æ—Å–≤–µ—â–∞–µ—Ç —Ç—å–º—É, —É—Å–ª—ã—à—å –º–æ–π –∑–æ–≤. '
                game['text'] += '–°–æ–∂–≥–∏ –≤—Å–µ –∏ –≤—Å—è, –¥–æ–∫—É–¥–∞ –¥–æ—Ç—è–Ω–µ—Ç—Å—è —Ç–≤–æ—è –∫–∞—Ä–∞—é—â–∞—è –¥–ª–∞–Ω—å.\n'
                player['EXPLOSION'] = target['id']

            elif player['act'][0] == 'EXPLOSION2':
                target = game['players'][player['EXPLOSION']]
                game['text'] += 'üí¨' + player['name'] + ': –í–ó–†–´–í!\n'
                explosiondmg = 10  # random.randint(10, 11)
                firedmg = 6
                player['energy'] = -10
                player['recoverydebuff'].append([10, 2])
                if player['stun'] <= 0:
                    player['stun'] = 2
                else:
                    player['stun'] += 1
                game['text'] += 'üíÆ|–û–≥—Ä–æ–º–Ω–∞—è –≤–æ–ª–Ω–∞ –ø–ª–∞–º–µ–Ω–∏ –ø–æ—Ä–∞–∂–∞–µ—Ç ' + target['name'] + ', –Ω–∞–Ω–æ—Å—è ' + str(
                    explosiondmg) + ' —É—Ä–æ–Ω–∞ –∏ –ø–æ–¥–∂–∏–≥–∞—è —Ü–µ–ª—å. ' + player['name'] + ' –ø–∞–¥–∞–µ—Ç –Ω–∞ –∑–µ–º–ª—é –±–µ–∑ —Å–∏–ª.\n'
                setfire(game, player, target, strength=firedmg, duration=5)
                showdmg, text = takedamage(game, player, target, explosiondmg)
                game['text'] += text
                player['EXPLOSION'] = None
                player['EXPLOSIONcd'] = 10

            elif player['act'][0] == 'castle_explosion':
                target = game['players'][player['act'][1]]
                #game['text'] += 'üí¨' + player['name'] + ': –í–ó–†–´–í!\n'
                explosiondmg = 100  # random.randint(10, 11)
                firedmg = 100
                player['energy'] = -10
                player['recoverydebuff'].append([10, 2])
                if player['stun'] <= 0:
                    player['stun'] = 1000
                else:
                    player['stun'] += 1000
                #game['text'] += 'üíÆ|' + player['name'] + ' –¥–æ—Å—Ç–∞–µ—Ç –ø–æ—Å–æ—Ö –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ ' + target['name'] + '.\n'
                game['text'] += 'üí¨' + player[
                    'name'] + ': –û —Ç—å–º–∞, –∫—É–¥–∞ –Ω–µ –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç —Å–≤–µ—Ç, –æ —á–µ—Ä–Ω–æ–µ –ø–ª–∞–º—è, —á—Ç–æ –Ω–µ –æ—Å–≤–µ—â–∞–µ—Ç —Ç—å–º—É, —É—Å–ª—ã—à—å –º–æ–π –∑–æ–≤. '
                game['text'] += '–°–æ–∂–≥–∏ –≤—Å–µ –∏ –≤—Å—è, –¥–æ–∫—É–¥–∞ –¥–æ—Ç—è–Ω–µ—Ç—Å—è —Ç–≤–æ—è –∫–∞—Ä–∞—é—â–∞—è –¥–ª–∞–Ω—å... –í–ó–†–´–í!\n'
                game['text'] += 'üíÆ|–û–≥—Ä–æ–º–Ω–∞—è –≤–æ–ª–Ω–∞ –ø–ª–∞–º–µ–Ω–∏ –ø–æ—Ä–∞–∂–∞–µ—Ç ' + target['name'] + ', –Ω–∞–Ω–æ—Å—è ' + str(
                    explosiondmg) + ' —É—Ä–æ–Ω–∞ –∏ –ø–æ–¥–∂–∏–≥–∞—è —Ü–µ–ª—å. ' + player['name'] + ' –ø–∞–¥–∞–µ—Ç –Ω–∞ –∑–µ–º–ª—é –±–µ–∑ —Å–∏–ª.\n'
                setfire(game, player, target, strength=firedmg, duration=5)
                showdmg, text = takedamage(game, player, target, explosiondmg)
                game['text'] += text


            elif player['act'][0] == 'run':
                if game['dungeon']:
                    game['text'] += 'üò±|' + player[
                        'name'] + ' —Å–ª–∏—à–∫–æ–º –Ω–∞–ø—É–≥–∞–Ω, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±–æ–π. –û–Ω —Å–±–µ–≥–∞–µ—Ç –∏–∑ –ø–æ–¥–∑–µ–º–µ–ª—å—è.\n'
                else:
                    if 'dark_energy' in player['skills']:
                        game['text'] += '‚ò†Ô∏è|–¢—å–º–∞ –ø–æ–≥–ª–æ—â–∞–µ—Ç —Ä–∞–∑—É–º ' + player[
                            'name'] + '. –ò–≥—Ä–æ–∫ –º–µ—Ä—Ç–≤.\n'
                        player['dead_from_scare'] = True
                    else:
                        game['text'] += 'üò±|' + player[
                            'name'] + ' —Å–ª–∏—à–∫–æ–º –Ω–∞–ø—É–≥–∞–Ω, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±–æ–π. –û–Ω —Å–±–µ–≥–∞–µ—Ç.\n'
                player['dead'] = True


            elif player['act'][0] == 'random_lighting':
                player['invokercd'] = 2
                dmg = random.randint(1, 9)
                targets = []
                for idss in game['players']:
                    if game['players'][idss]['hp'] > 0 and not game['players'][idss]['dead']:
                        targets.append(game['players'][idss])
                target = random.choice(targets)
                showdmg, armortext = takedamage(game, player, target, dmg)
                game['text'] += '‚ö°Ô∏è|' + player['name'] + ' –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–ª–Ω–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—å–µ—Ç –ø–æ —Å–ª—É—á–∞–π–Ω–æ–π —Ü–µ–ª–∏ - ' + target[
                    'name'] + '! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(dmg) + ' —É—Ä–æ–Ω–∞.\n'
                game['text'] += armortext

            elif player['act'][0] == 'target_lighting':
                player['invokercd'] = 3
                dmg = random.randint(1, 3)
                target = game['players'][player['act'][1]]
                showdmg, armortext = takedamage(game, player, target, dmg)
                game['text'] += '‚ö°Ô∏è|' + player['name'] + ' –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–ª–Ω–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—å–µ—Ç –ø–æ ' + target[
                    'name'] + '! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(dmg) + ' —É—Ä–æ–Ω–∞.\n'
                game['text'] += armortext

            elif player['act'][0] == 'sunstrike':
                player['invokercd'] = 4
                target = game['players'][player['act'][1]]
                damage = random.randint(1, 2)
                showdmg, armortext = takedamage(game, player, target, damage)
                game['text'] += '‚òÄÔ∏è|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —è—Ä–∫–∏–π –ª—É—á —Å–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—å–µ—Ç –ø–æ ' + target[
                    'name'] + '! –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ' + str(damage) + \
                                ' —É—Ä–æ–Ω–∞ –∏ —Å–ª–∞–±–æ—Å—Ç—å (2) –Ω–∞ 3 —Ö–æ–¥–∞.\n'
                target['recoverydebuff'].append([2, 3])  # [0] - —Å–∏–ª–∞ –¥–µ–±–∞—Ñ—Ñ–∞, [1] - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                game['text'] += armortext

            elif player['act'][0] == 'blood_to_all':
                player['invokercd'] = 2
                targets = []
                for idss in game['players']:
                    if not game['players'][idss]['dead']:
                        targets.append(game['players'][idss])
                for idss in targets:
                    target = idss
                    if target['blood'] <= 0:
                        target['blood'] = 4
                        if 'dvuzhil' in target['skills']:
                            target['blood'] += 2
                        target['blood'] += get_target_dvuzhil(target)
                    else:
                        if target['blood'] > 1:
                            target['blood'] -= 1
                game['text'] += 'ü©∏|' + player[
                    'name'] + ' –ø–æ–≤—ã—à–∞–µ—Ç –¥–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞, –≤—Å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –Ω–∞ –ø–æ–ª–µ –±–æ—è –ø–æ–ª—É—á–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è!\n'

            elif player['act'][0] == 'fire_all':
                player['invokercd'] = 4
                targets = []
                for idss in game['players']:
                    if not game['players'][idss]['dead']:
                        targets.append(game['players'][idss])
                for idss in targets:
                    target = idss
                    setfire(game, player, target, strength=3, duration=3)

                game['text'] += 'üî•|' + player[
                    'name'] + ' —Å–æ–∑–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª—å—Ü–æ –æ–≥–Ω—è, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–∂–∏–≥–∞–µ—Ç –≤—Å–µ –ø–æ–ª–µ –±–æ—è!\n'

            elif player['act'][0] == 'blood_to_enemy':
                player['invokercd'] = 2
                target = game['players'][player['act'][1]]
                if target['blood'] <= 0:
                    target['blood'] = 4
                    if 'dvuzhil' in target['skills']:
                        target['blood'] += 2
                    target['blood'] += get_target_dvuzhil(target)
                else:
                    if target['blood'] > 1:
                        target['blood'] -= 1
                game['text'] += 'ü©∏|' + player['name'] + ' –ø–æ–≤—ã—à–∞–µ—Ç –¥–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞ –≤–æ–∫—Ä—É–≥ ' + target[
                    'name'] + ', —Ü–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏—è!\n'

            elif player['act'][0] == 'roots':
                player['invokercd'] = 3
                target = game['players'][player['act'][1]]
                target['roots'].append([player['id'], 2])
                target['roots'].append([player['id'], 3])
                game['text'] += 'üéã|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç –∫–æ—Ä–Ω–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—É—Ç—ã–≤–∞—é—Ç ' + target['name'] + '!\n'

            elif player['act'][0] == 'burrow2':
                player['burrowtarget'] = None
                player['burrowcd'] = 4
                player['burrowstrike'] = True
                target = game['players'][player['act'][1]]
                game['text'] += 'üï≥‚ùóÔ∏è|' + player['name'] + ' –≤—ã—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ –∑–µ–º–ª–∏ —Ä—è–¥–æ–º —Å '+target['name']+', –∞—Ç–∞–∫—É—è —Ü–µ–ª—å!\n'
                #player['shield'] = True
                #player['burrowtarget'] = target['id']
                player['act'] = ['attack', target['id']]

            elif 'cant_do_' in player['act'][0]:
                what = player['act'][0].split('_')[2]
                game['text'] += '‚ùì'+player['name']+' –ø—ã—Ç–∞–ª—Å—è —Å–¥–µ–ª–∞—Ç—å '+what+', –Ω–æ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å.\n'

            elif player['act'][0] == 'inc_energy':
                player['invokercd'] = 4
                target = game['players'][player['act'][1]]
                target['maxenergy'] += 2
                set_energy(game, player, player['maxenergy'])
                game['text'] += 'üí´|' + player['name'] + ' —á–∏—Ç–∞–µ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ, —É–≤–µ–ª–∏—á–∏–≤–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å —ç–Ω–µ—Ä–≥–∏–∏ ' + \
                                target['name'] + \
                                ' –Ω–∞ 2‚ö°Ô∏è! –≠–Ω–µ—Ä–≥–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.\n'

            elif player['act'][0] == 'falsespell':
                game['text'] += '‚ùì|' + player[
                    'name'] + ' –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –±–æ–π —Å–∏–ª–æ–π –º–∞–≥–∏–∏, —á–∏—Ç–∞—è –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è, –Ω–æ —É –Ω–µ–≥–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è.\n'

            elif player['act'][0] == 'blow':
                target = game['players'][player['act'][1]]
                target['blown'] = True
                targets = []
                dmg = 2
                player['demon'] = True
                for idss in game['players']:
                    if game['players'][idss]['team'] != player['team'] and not game['players'][idss]['dead']:
                        targets.append(game['players'][idss])
                for idss in targets:
                    idss['incomingdmgs'].append([player['id'], dmg])
                    player['outgoingdmgs'].append([idss['id'], dmg])
                game['text'] += 'üëø|' + player['name'] + ' –≤–∑—Ä—ã–≤–∞–µ—Ç —Ç—Ä—É–ø! –ù–∞–Ω–µ—Å–µ–Ω–æ 2 —É—Ä–æ–Ω–∞ –≤—Å–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º.\n'

            elif player['act'][0] == 'dark_energy':
                dmg = 0
                for idss in game['players']:
                    if game['players'][idss]['dark_counter'] > 0:
                        dmg += random.randint(2, 3)
                player['dark_energycd'] = 4
                target = game['players'][player['act'][1]]
                if target['act'] != None and target['act'][0] == 'perekat':
                    game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                        'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                                    '–Ω–æ —Ç–∞ —É—Å–ø–µ–≤–∞–µ—Ç —É–≤–µ—Ä–Ω—É—Ç—å—Å—è.\n'
                # elif target['controller'] == 'bot':
                #    game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                #        'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                #                    '–Ω–æ —Ç–∞ —Å–ª–∏—à–∫–æ–º –≥–ª—É–ø–∞, —á—Ç–æ–±—ã —á—Ç–æ-—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å.\n'
                else:
                    if not target['is_necromant'] and not target['is_radiodemon'] and not target["is_knight"]:
                        target['dark_counter_set'] += 3
                        if target['dark_counter_set'] > 4:
                            target['dark_counter_set'] = 4
                    else:
                        if target["is_knight"]:
                            if target["dark_counter"] <= 0:
                                target['dark_counter_set'] += 3
                        dmg = 0
                    armortext = ""
                    if dmg > 0:
                        showdmg, armortext = takedamage(game, player, target, dmg)
                    if target['id'] != player['id']:
                        if is_necromant_boss(target):
                            game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                                'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                                            '–ø—ã—Ç–∞—è—Å—å –ø–æ–≥—Ä—É–∑–∏—Ç—å –µ—ë —Ä–∞–∑—É–º –≤–æ —Ç—å–º—É.\n'
                            game['text'] += 'üí¨' + target[
                                'name'] + ': –Ø - –≤–µ–ª–∏—á–∞–π—à–∏–π –º–∞–≥, –ø–æ–≤–µ–ª–µ–≤–∞—é—â–∏–π —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π. –î—É–º–∞–µ—à—å, —è –Ω–µ —Å–º–æ–≥—É –æ—Ç—Ä–∞–∑–∏—Ç—å –≠–¢–û!?\n'
                            game['text'] += 'üíÄ|' + target[
                                'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—è –ø–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤ ' + player[
                                                'name'] + ' –∏ —É—Å–∏–ª–∏–≤–∞—è –µ–≥–æ. ' + player[
                                                'name'] + \
                                            ' —á“âÃõÕ¢ÃÉÃÄÕâÃúÕà—ÉÃµÕûÃßÕÇÃñÃ≠–≤“âÕùÕúÕÇÕáÃ£Ã∞—ÅÃ∏ÕùÃ®ÕãÃçÕÇÕöÕö—Ç“àÕûÃ¢ÃÑÃéÕÑÃò–≤Ãµ“áÕúÃîÃèÃ±—ÉÃ∂Õ°Õ¢ÕÑÃù–µÃµÃïÃ®ÃÜÃÅÃò—Ç“â“áÃ®ÕÜÃöÕïÕéÃ• —ÅÃ∑ÃõÕúÃàÕóÃ´—Ç“âÕ†ÃßÕÉÃãÃ´—Ä“âÕûÃ°ÃøÃöÃçÃúÕöÃ§–∞Ã∂“áÕ¢ÕÅÃöÃÄÕâÃó—ÖÃ∂Õ†Ã®ÕÄÃçÃåÕôÃû (' + str(
                                50) + ').\n'
                            player['dark_counter'] = 50
                        elif target['is_radiodemon']:
                            game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                                'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                                            '–ø—ã—Ç–∞—è—Å—å –ø–æ–≥—Ä—É–∑–∏—Ç—å –µ—ë —Ä–∞–∑—É–º –≤–æ —Ç—å–º—É, –Ω–æ —Ü–µ–ª—å –ø–æ–≥–ª–æ—â–∞–µ—Ç –µ—ë.\n'
                            game['text'] += 'üí¨' + target[
                                    'name'] + ': –¢–µ–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è... –í–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω—ã–π –≤–∫—É—Å!\n'
                        elif target["is_knight"]:
                            game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                                'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                                            '–Ω–æ –µ–π –ø–ª–µ–≤–∞—Ç—å.\n'


                        else:
                            if dmg == 0:
                                game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                                        'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                                                    '–ø–æ–≥—Ä—É–∂–∞—è –µ–µ —Ä–∞–∑—É–º –≤–æ —Ç—å–º—É. ' + target['name'] + \
                                                    ' —á“âÃõÕ¢ÃÉÃÄÕâÃúÕà—ÉÃµÕûÃßÕÇÃñÃ≠–≤“âÕùÕúÕÇÕáÃ£Ã∞—ÅÃ∏ÕùÃ®ÕãÃçÕÇÕöÕö—Ç“àÕûÃ¢ÃÑÃéÕÑÃò–≤Ãµ“áÕúÃîÃèÃ±—ÉÃ∂Õ°Õ¢ÕÑÃù–µÃµÃïÃ®ÃÜÃÅÃò—Ç“â“áÃ®ÕÜÃöÕïÕéÃ• —ÅÃ∑ÃõÕúÃàÕóÃ´—Ç“âÕ†ÃßÕÉÃãÃ´—Ä“âÕûÃ°ÃøÃöÃçÃúÕöÃ§–∞Ã∂“áÕ¢ÕÅÃöÃÄÕâÃó—ÖÃ∂Õ†Ã®ÕÄÃçÃåÕôÃû (' + str(
                                        target['dark_counter_set'] + target['dark_counter']) + \
                                                    ').\n'

                            else:
                                game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ' + target[
                                    'name'] + '. –ü–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ü–µ–ª–∏, ' + \
                                                '–ø–æ–≥—Ä—É–∂–∞—è –µ–µ —Ä–∞–∑—É–º –≤–æ —Ç—å–º—É –∏ –Ω–∞–Ω–æ—Å—è ' + str(dmg) + ' —É—Ä–æ–Ω–∞. ' + target[
                                                    'name'] + \
                                                ' —á“âÃõÕ¢ÃÉÃÄÕâÃúÕà—ÉÃµÕûÃßÕÇÃñÃ≠–≤“âÕùÕúÕÇÕáÃ£Ã∞—ÅÃ∏ÕùÃ®ÕãÃçÕÇÕöÕö—Ç“àÕûÃ¢ÃÑÃéÕÑÃò–≤Ãµ“áÕúÃîÃèÃ±—ÉÃ∂Õ°Õ¢ÕÑÃù–µÃµÃïÃ®ÃÜÃÅÃò—Ç“â“áÃ®ÕÜÃöÕïÕéÃ• —ÅÃ∑ÃõÕúÃàÕóÃ´—Ç“âÕ†ÃßÕÉÃãÃ´—Ä“âÕûÃ°ÃøÃöÃçÃúÕöÃ§–∞Ã∂“áÕ¢ÕÅÃöÃÄÕâÃó—ÖÃ∂Õ†Ã®ÕÄÃçÃåÕôÃû (' + str(
                                    target['dark_counter_set'] + target['dark_counter']) + \
                                                ').\n'

                    else:
                        if dmg == 0:
                            game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player['name'] + ' –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—å–º–µ –∑–∞–≤–ª–∞–¥–µ—Ç—å —Å–≤–æ–∏–º —Ä–∞–∑—É–º–æ–º.\n'
                        else:
                            game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|' + player[
                                'name'] + ' –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—å–º–µ –∑–∞–≤–ª–∞–¥–µ—Ç—å —Å–≤–æ–∏–º —Ä–∞–∑—É–º–æ–º, –ø–æ–ª—É—á–∞—è ' + str(dmg) + ' —É—Ä–æ–Ω–∞.\n'
                    game['text'] += armortext

            elif player['act'][0] == 'violet_beam':
                target = game['players'][player['act'][1]]
                if player['fireticks'] > 1:
                    player['fireticks'] = 1
                    player['firestrength'] = 0
                if target['act'] != None and target['act'][0] == 'perekat':
                    game[
                        'text'] += 'üü£|–°–∏–Ω–∏–µ –∏ –∫—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏ –∏ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –ª—É—á, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä–∞–≤–∏–ª—Å—è –∫ ' + \
                                   '–≥–æ–ª–æ–≤–µ ' + target['name'] + ', –Ω–æ —Ü–µ–ª—å —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞.\n'
                else:
                    target['dark_counter'] += 4
                    game[
                        'text'] += 'üü£|–°–∏–Ω–∏–µ –∏ –∫—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏ –∏ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –ª—É—á, –∫–æ—Ç–æ—Ä—ã–π –≤—Ä–µ–∑–∞–ª—Å—è –≤ ' + \
                                   '–≥–æ–ª–æ–≤—É ' + target['name'] + '. –¶–µ–ª—å —á—É–≤—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞—Ö (' + str(
                        target['dark_counter']) + ').\n'
                player['prepared_beam'] = None

            elif player['act'][0] == 'red_beam':
                target = game['players'][player['act'][1]]
                if player['fireticks'] > 1:
                    player['fireticks'] = 1
                    player['firestrength'] = 0
                dmg = 3
                dmg += player['darknessspelldmgbonus']
                firet = 6
                firet += player['darknessspelldmgbonus']
                if target['act'] != None and target['act'][0] == 'perekat':
                    game['text'] += 'üî¥|–ö—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –≤ —Ç–µ–ª–æ ' + \
                                    target['name'] + ', –Ω–æ —Ü–µ–ª—å —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞.\n'
                else:
                    game['text'] += 'üî¥|–ö—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –≤ —Ç–µ–ª–æ ' + \
                                    target['name'] + '. –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ' + str(dmg) + ' —É—Ä–æ–Ω–∞ –∏ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è!\n'
                    showdmg, armortext = takedamage(game, player, target, dmg)
                    game['text'] += armortext
                    setfire(game, player, target, strength=firet)
                player['prepared_beam'] = None

            elif player['act'][0] == 'blue_beam':
                target = game['players'][player['act'][1]]
                if player['fireticks'] > 1:
                    player['fireticks'] = 1
                    player['firestrength'] = 0
                dmg = random.randint(1, 3)
                dmg += player['darknessspelldmgbonus']
                if target['act'] != None and target['act'][0] == 'perekat':
                    game['text'] += 'üîµ|–°–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –∫ –Ω–æ–≥–∞–º ' + \
                                    target['name'] + ', –Ω–æ —Ü–µ–ª—å —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞.\n'
                else:
                    game['text'] += 'üîµ|–°–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –∫ –Ω–æ–≥–∞–º ' + \
                                    target['name'] + '. –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ' + str(dmg) + ' —É—Ä–æ–Ω–∞ –∏ –∑–∞–º–µ—Ä–∑–∞–µ—Ç!\n'
                    game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
                    showdmg, armortext = takedamage(game, player, target, dmg)
                    game['text'] += armortext
                    if target['stun'] > 0:
                        target['stun'] += 1 + player['darknessspelldmgbonus']
                    else:
                        target['stun'] = 2 + player['darknessspelldmgbonus']
                player['prepared_beam'] = None

            elif player['act'][0] == 'demonattack':
                target = game['players'][player['act'][1]]
                #beams = ['red', 'blue', 'violet']
                beam = player['demonbeam']
                if beam == 'red':
                    if player['energy'] <= 0:
                        game['text'] += 'üí®|–ö—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –≤ —Ç–µ–ª–æ ' + \
                                        target['name'] + ', –Ω–æ –ø—Ä–æ–º–∞—Ö–Ω—É–ª–∏—Å—å.\n'
                    else:
                        dmg = 2+round(player['darkdemon_strenght']/10)
                        firestrenght = 1+round(player['darkdemon_strenght']/12)
                        if target['act'] != None and target['act'][0] == 'perekat':
                            game['text'] += 'üî¥|–ö—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –≤ —Ç–µ–ª–æ ' + \
                                        target['name'] + ', –Ω–æ —Ü–µ–ª—å —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞.\n'
                        else:
                            game['text'] += 'üî¥|–ö—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –≤ —Ç–µ–ª–æ ' + \
                                    target['name'] + '. –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ' + str(dmg) + ' —É—Ä–æ–Ω–∞ –∏ –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è!\n'
                            showdmg, armortext = takedamage(game, player, target, dmg)
                            game['text'] += armortext
                            setfire(game, player, target, strength=firestrenght)
                elif beam == 'blue':
                    if player['energy'] <= 0:
                        game['text'] += 'üí®|–°–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –≤ —Ç–µ–ª–æ ' + \
                                        target['name'] + ', –Ω–æ –ø—Ä–æ–º–∞—Ö–Ω—É–ª–∏—Å—å.\n'
                    else:
                        dmg = 1+round(player['darkdemon_strenght']/12)
                        stunlen = 1+round(player['darkdemon_strenght']/18)
                        if target['act'] != None and target['act'][0] == 'perekat':
                            game['text'] += 'üîµ|–°–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –∫ –Ω–æ–≥–∞–º ' + \
                                    target['name'] + ', –Ω–æ —Ü–µ–ª—å —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞.\n'
                        else:
                            game['text'] += 'üîµ|–°–∏–Ω–∏–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏, —É—Å—Ç—Ä–µ–º–∏–≤—à–∏–µ—Å—è –∫ –Ω–æ–≥–∞–º ' + \
                                    target['name'] + '. –¶–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç ' + str(dmg) + ' —É—Ä–æ–Ω–∞ –∏ –∑–∞–º–µ—Ä–∑–∞–µ—Ç!\n'
                            showdmg, armortext = takedamage(game, player, target, dmg)
                            game['text'] += armortext
                            if target['stun'] > 0:
                                target['stun'] += stunlen
                            else:
                                target['stun'] = 1 + stunlen
                            game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'

                elif beam == 'violet':
                    dmg = 1 + round(player['darkdemon_strenght'] / 20)
                    if target['act'] != None and target['act'][0] == 'perekat':
                        game['text'] += 'üü£|–°–∏–Ω–∏–µ –∏ –∫—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏ –∏ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –ª—É—á, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä–∞–≤–∏–ª—Å—è –∫ ' + \
                                   '–≥–æ–ª–æ–≤–µ ' + target['name'] + ', –Ω–æ —Ü–µ–ª—å —É–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞.\n'
                    else:
                        game['text'] += 'üü£|–°–∏–Ω–∏–µ –∏ –∫—Ä–∞—Å–Ω—ã–µ –≥–ª–∞–∑–∞ –≤—ã–ø—É—Å—Ç–∏–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ª—É—á–∏ –∏ –æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –ª—É—á, –∫–æ—Ç–æ—Ä—ã–π –≤—Ä–µ–∑–∞–ª—Å—è –≤ ' + \
                                   '–≥–æ–ª–æ–≤—É ' + target['name'] + '. –°–æ–∑–Ω–∞–Ω–∏–µ —Ü–µ–ª–∏ –ø–æ–º—É—Ç–Ω–∏–ª–æ—Å—å. –ù–∞–Ω–µ—Å–µ–Ω–æ '+str(dmg)+' —É—Ä–æ–Ω–∞.\n'
                        showdmg, armortext = takedamage(game, player, target, dmg)
                        game['text'] += armortext

                player['energy'] -= 3


            elif player['act'][0] == 'big_dark_wave':
                target = game['players'][player['act'][1]]
                dmg = 8
                hp = 2
                player['last_dark_acts'] = []
                if target['act'] != None and target['act'][0] == 'perekat':
                    game[
                        'text'] += '‚ö´Ô∏è|–í—Å–µ –≥–ª–∞–∑–∞ —Å—É—â–µ—Å—Ç–≤–∞, –∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ, –∑–∞–∫—Ä—ã–ª–∏—Å—å. –ì–ª–∞–∑ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–Ω—ã–º, –∏ —Å—Ä–∞–∑—É ' + \
                                   '–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–ø—É—Å–∫–∞–µ—Ç —à–∏—Ä–æ–∫—É—é –≤–æ–ª–Ω—É —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤ ' + target['name'] + ', ' + \
                                   '–Ω–æ —Ü–µ–ª—å —É—Å–ø–µ–ª–∞ —É–≤–µ—Ä–Ω—É—Ç—å—Å—è.\n'
                else:
                    game[
                        'text'] += '‚ö´Ô∏è|–í—Å–µ –≥–ª–∞–∑–∞ —Å—É—â–µ—Å—Ç–≤–∞, –∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ, –∑–∞–∫—Ä—ã–ª–∏—Å—å. –ì–ª–∞–∑ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–Ω—ã–º, –∏ —Å—Ä–∞–∑—É ' + \
                                   '–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–ø—É—Å–∫–∞–µ—Ç —à–∏—Ä–æ–∫—É—é –≤–æ–ª–Ω—É —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤ ' + target['name'] + '. ' + \
                                   '–¶–µ–ª—å —á—É–≤—Å—Ç–≤—É–µ—Ç, –∫–∞–∫ –Ω–µ—á—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –µ–≥–æ —Ç–µ–ª—É, –≤—ã—Å–∞—Å—ã–≤–∞—è ' + \
                                   '–∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Å–∏–ª—ã. ' + target['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(
                        dmg) + ' —É—Ä–æ–Ω–∞, —Ç–µ—Ä—è–µ—Ç ' + str(hp) + '‚ô•Ô∏è –∏ –ª–∏—à–∞–µ—Ç—Å—è 1‚ö°Ô∏è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.\n'
                    showdmg, armortext = takedamage(game, player, target, dmg)
                    game['text'] += armortext
                    target['maxenergy'] -= 1
                    target['hp'] -= hp

            elif player['act'][0] == 'skeletonfire':
                target = game['players'][player['act'][1]]
                if target['stun'] <= 0:
                    target['stun'] = 2
                else:
                    target['stun'] += 1
                dmg = 5
                showdmg = dmg
                if dmg > 0:
                    player['demon'] = True
                if not target['washitin']:
                    armor, text = getarmor(game, target, dmg)
                else:
                    armor = target['dopblock']
                    if dmg < armor:
                        armor = dmg
                    text = ''
                    if armor > 0:
                        if 'semw_armor' in player['customtexts'] and player['customtexts']['semw_armor']:
                            text = 'ü™ñ|' + target['name'] + ' –≤ —Å–≤–æ–µ–π –±—Ä–æ–Ω–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º—ã–º, —Å–Ω–∏–º–∞—è –≤—Å–µ–≥–æ ' + str(armor) + ' —É—Ä–æ–Ω–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–±–µ–∂–¥–∞—Ç—å –≤—Ä–∞–≥–æ–≤!\n'
                        else:
                            text = 'üõ°| –ë—Ä–æ–Ω—è ' + target['name'] + ' —Å–Ω–∏–º–∞–µ—Ç ' + str(armor) + ' —É—Ä–æ–Ω–∞!\n'
                dmg -= armor
                target['dopblock'] -= armor
                if not target['shield']:
                    if dmg > 0:
                        player['outgoingdmgs'].append([target['id'], dmg])
                        target['incomingdmgs'].append([player['id'], dmg])
                game['text'] += 'üíÄüî•|' + player['name'] + ' –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–∫–ª—è—Ç—ã–π —á–µ—Ä–µ–ø –≤ ' + target[
                    'name'] + '! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(showdmg) + ' —É—Ä–æ–Ω–∞.\n'
                game['text'] += text
                game['effecttext'] += 'üåÄ|' + target['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
                player['skeletonfirecd'] = 6

            elif player['act'][0] == 'demon_transform':
                target = game['players'][player['act'][1]]
                game['text'] += '‚ùóÔ∏è|'+player['name']+' —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö, –Ω–∞ –≥–æ–ª–æ–≤–µ —É –Ω–µ–≥–æ –≤—ã—Ä–∞—Å—Ç–∞—é—Ç —Ä–æ–≥–∞, –∞ —É–ª—ã–±–∫–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Å–∫–∞–ª...\n'
                player['demon_transform_turn'] = True

            elif player['act'][0] == 'demon_transform2':
                game['text'] += '‚öúÔ∏è|'+player['name']+' –≤—ã–ø—É—Å–∫–∞–µ—Ç –∏–∑ —Å–≤–æ–µ–≥–æ —Ç–µ–ª–∞ —â—É–ø–∞–ª—å—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å –æ–≥—Ä–æ–º–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é —É—Å—Ç—Ä–µ–º–ª—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º, –∫—Ç–æ '+\
                '–ø–æ—Å–º–µ–ª –±—Ä–æ—Å–∏—Ç—å –≤—ã–∑–æ–≤ —Ä–∞–¥–∏–æ–¥–µ–º–æ–Ω—É.\n'
                if not game['completed_hell']:
                    for idss in game['players']:
                        target = game['players'][idss]
                        if target['team'] != player['team'] and not target['dead']:
                            necroability = False
                            if target['act'] != None and target['act'][0] == 'necrostaffability':
                                necroability = True
                            if target['controllable_necrofighter'] != None:
                                necroability = True
                            if not necroability:
                                if target['act'] != None and target['act'][0] in ['shield', 'shieldgen']:
                                    game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—Ä–æ–Ω–∑–∞—é—Ç —â–∏—Ç ' + target[
                                        'name'] + ' –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º —Å–∞–º–∏–º, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –∫ –ê–ª–∞—Å—Ç–æ—Ä—É, –æ—Ç–ø—Ä–∞–≤–ª—è—è —Ü–µ–ª—å —Ç–æ–º—É –ø—Ä—è–º–æ –≤ –ø–∞—Å—Ç—å.\n'
                                else:
                                    game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—Ä–æ–Ω–∑–∞—é—Ç ' + target[
                                        'name'] + ' –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –∫ –ê–ª–∞—Å—Ç–æ—Ä—É, –æ—Ç–ø—Ä–∞–≤–ª—è—è —Ü–µ–ª—å —Ç–æ–º—É –ø—Ä—è–º–æ –≤ –ø–∞—Å—Ç—å.\n'
                                target['dead'] = True
                                target['eliminated'] = True
                            else:
                                game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—ã—Ç–∞—é—Ç—Å—è –ø—Ä–æ–Ω–∑–∏—Ç—å ' + target[
                                    'name'] + ', –Ω–æ —â–∏—Ç—É –∏–∑ –Ω–µ–∫—Ä–æ—Ç–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏ —É–¥–∞–µ—Ç—Å—è —Å–¥–µ—Ä–∂–∞—Ç—å —É–¥–∞—Ä.\n'
                else:
                    for idss in game['players']:
                        target = game['players'][idss]
                        dmg = random.randint(1, 4)
                        dmg += player['radiodemonpower']
                        if target['team'] != player['team'] and not target['dead']:
                            necroability = False
                            if target['act'] != None and target['act'][0] == 'necrostaffability':
                                necroability = True
                            if target['controllable_necrofighter'] != None:
                                necroability = True
                            if not necroability:
                                if target['act'] != None and target['act'][0] == 'perekat':
                                    game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—ã—Ç–∞—é—Ç—Å—è –ø—Ä–æ–Ω–∑–∏—Ç—å ' + target[
                                        'name'] + ', –Ω–æ —Ç–æ—Ç —É—Å–ø–µ–≤–∞–µ—Ç —É–≤–µ—Ä–Ω—É—Ç—å—Å—è.\n'
                                else:
                                    if target['act'] != None and target['act'][0] in ['shield', 'shieldgen']:
                                        game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—Ä–æ–Ω–∑–∞—é—Ç —â–∏—Ç ' + target[
                                            'name'] + ' –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º —Å–∞–º–∏–º, –Ω–∞–Ω–æ—Å—è '+str(dmg)+' —É—Ä–æ–Ω–∞!\n'
                                    else:
                                        game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—Ä–æ–Ω–∑–∞—é—Ç ' + target[
                                            'name'] + ', –Ω–∞–Ω–æ—Å—è '+str(dmg)+' —É—Ä–æ–Ω–∞!\n'
                                    takedamage(game, player, target, dmg, ignoreshield = True)

                            else:
                                game['text'] += '‚öúÔ∏è|–©—É–ø–∞–ª—å—Ü–∞ –ø—ã—Ç–∞—é—Ç—Å—è –ø—Ä–æ–Ω–∑–∏—Ç—å ' + target[
                                    'name'] + ', –Ω–æ —â–∏—Ç—É –∏–∑ –Ω–µ–∫—Ä–æ—Ç–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏ —É–¥–∞–µ—Ç—Å—è —Å–¥–µ—Ä–∂–∞—Ç—å —É–¥–∞—Ä.\n'

                game['text'] += 'üí®|'+player['name'] + ' –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–≤–æ—é –æ–±—ã—á–Ω—É—é —Ñ–æ—Ä–º—É.\n'
                player['demon_transformcd'] = 10
                player['tentaclescd'] = 3
                player['rhino_eliminatecd'] = 3

            elif player['act'][0] == 'hellfire':
                dmg = player['hellfirecharges'] * 2
                player['demon'] = True
                game['text'] += 'üî•üî•|' + player['name'] + ' –≤—ã–∑—ã–≤–∞–µ—Ç –≤–æ–ª–Ω—É –∞–¥—Å–∫–æ–≥–æ –ø–ª–∞–º–µ–Ω–∏. –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(
                    dmg) + ' —É—Ä–æ–Ω–∞ –≤—Å–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º –Ω–∞ –ø–æ–ª–µ –±–æ—è!\n'
                player['hellfirecharges'] = 0
                for idss in game['players']:
                    target = game['players'][idss]
                    if not target['dead']:
                        showdmg, text = takedamage(game, player, target, dmg)
                        game['text'] += text

            elif player['act'][0] == 'dragon_fireball':
                target = game['players'][player['act'][1]]        
                damage, chaintext, sokrushtext, narsiltext, drobovik_hasnocharges, lastsnipertarget = generate_cube_hit_damage(game, player, target, cubes=5, accuracy=1)
                if damage > 0:
                    dmg = damage #random.randint(1, 6)
                    firestrength = random.randint(1, 4)
                    fireticks = random.randint(2, 4)
                    if "–¥—Ä–∞–∫–æ–Ω" in player["name"].lower():
                        game['text'] += '‚òÑÔ∏è|' + player['name'] + ' –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–∞—Å—Ç—å –∏ —Å–æ–∑–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –ª–µ—Ç–∏—Ç –≤ ' +target["name"]+"! –ù–∞–Ω–µ—Å–µ–Ω–æ "+str(dmg)+" —É—Ä–æ–Ω–∞.\n"
                    else:
                        game['text'] += '‚òÑÔ∏è|' + player[
                            'name'] + ' —Å–∏–ª–æ–π –º—ã—Å–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –ª–µ—Ç–∏—Ç –≤ ' + target[
                                            "name"] + "! –ù–∞–Ω–µ—Å–µ–Ω–æ " + str(dmg) + " —É—Ä–æ–Ω–∞.\n"

                    showdmg, text = takedamage(game, player, target, dmg)
                    firetext = setfire(game, player, target, strength=firestrength, duration=fireticks)
                    game['text'] += text
                    game['text'] += firetext+"\n"
                else:
                    if "–¥—Ä–∞–∫–æ–Ω" in player["name"].lower():
                        game['text'] += 'üí®|' + player['name'] + ' –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–∞—Å—Ç—å –∏ —Å–æ–∑–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä, –Ω–∞–ø—Ä–∞–≤–ª—è—è –µ–≥–æ –≤ ' +target["name"]+", –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.\n"
                    else:
                        game['text'] += 'üí®|' + player[
                            'name'] + ' —Å–∏–ª–æ–π –º—ã—Å–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä, –Ω–∞–ø—Ä–∞–≤–ª—è—è –µ–≥–æ –≤ ' + target[
                                            "name"] + ", –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.\n"

                player["energy"] -= 2
                if "dragon_power" in player["skills"]:
                    player["energy"] -= 1

            elif player['act'][0] == 'lastcharge':
                target = game['players'][player['act'][1]]
                if not game['completed_hell']:
                    if ((target['act'] != None and target['act'][0] == 'charge') or target['charge']) and target['act'][1] == player['id']:
                        game['text'] += 'üí¢|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                            'name'] + '. –¶–µ–ª—å –¥–µ–ª–∞–µ—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ —è—Ä–æ—Å—Ç–Ω—ã–π —Ä—ã–≤–æ–∫ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫ –Ω–æ—Å–æ—Ä–æ–≥—É, –∏ —Ç–æ—Ç, –∏—Å–ø—É–≥–∞–≤—à–∏—Å—å, –ø—Ä–æ–º–∞—Ö–∏–≤–∞–µ—Ç—Å—è.\n'
                        if not game['rhino_say']:
                            game['text'] += 'üí¨–ê–ª–∞—Å—Ç–æ—Ä|‚ù§Ô∏è‚Äçüî•: –ù–µ –∫–∞–∂–¥–æ–º—É —Ö–≤–∞—Ç–∏—Ç –¥—É—Ö–∞ —Ç–∞–∫ –±–µ–∑–±–∞—à–µ–Ω–Ω–æ –Ω–∞–ø–∞—Å—Ç—å –Ω–∞ –Ω–æ—Å–æ—Ä–æ–≥–∞! –Ø –≤–æ—Å—Ö–∏—â–µ–Ω!\n'
                            game['rhino_say'] = True
                    else:
                        if target['shield']:
                            game['text'] += 'üí¢|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ '+target['name']+', –ø—Ä–æ–±–∏–≤–∞—è —â–∏—Ç —Ü–µ–ª–∏ –∏ –ø–∞–¥–∞—è –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º –≤ –≥–ª—É–±–∏–Ω—ã –ø—Ä–µ–∏—Å–ø–æ–¥–Ω–µ–π, '+\
                                '—É—Å–ª—É–∂–ª–∏–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ —É–ª—ã–±–∞—é—â–∏–º—Å—è –ê–ª–∞—Å—Ç–æ—Ä–æ–º.\n'
                        else:
                            game['text'] += 'üí¢|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                                'name'] + ', –ø—Ä–æ–Ω–∑–∞—è —Ç–æ–≥–æ —Ä–æ–≥–æ–º –∏ –ø–∞–¥–∞—è –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º –≤ –≥–ª—É–±–∏–Ω—ã –ø—Ä–µ–∏—Å–ø–æ–¥–Ω–µ–π, ' + \
                                            '—É—Å–ª—É–∂–ª–∏–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ —É–ª—ã–±–∞—é—â–∏–º—Å—è –ê–ª–∞—Å—Ç–æ—Ä–æ–º.\n'
                        target['eliminated'] = True
                        target['dead'] = True
                else:
                    if ((target['act'] != None and target['act'][0] == 'charge') or target['charge']) and target['act'][1] == player['id']:
                        game['text'] += 'üí¢|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                            'name'] + '. –¶–µ–ª—å –¥–µ–ª–∞–µ—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ —è—Ä–æ—Å—Ç–Ω—ã–π —Ä—ã–≤–æ–∫ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫ –Ω–æ—Å–æ—Ä–æ–≥—É, –∏ —Ç–æ—Ç, –∏—Å–ø—É–≥–∞–≤—à–∏—Å—å, –ø—Ä–æ–º–∞—Ö–∏–≤–∞–µ—Ç—Å—è.\n'
                        if not game['rhino_say']:
                            game['text'] += 'üí¨–ê–ª–∞—Å—Ç–æ—Ä|‚ù§Ô∏è‚Äçüî•: –ù–µ –∫–∞–∂–¥–æ–º—É —Ö–≤–∞—Ç–∏—Ç –¥—É—Ö–∞ —Ç–∞–∫ –±–µ–∑–±–∞—à–µ–Ω–Ω–æ –Ω–∞–ø–∞—Å—Ç—å –Ω–∞ –Ω–æ—Å–æ—Ä–æ–≥–∞! –Ø –≤–æ—Å—Ö–∏—â–µ–Ω!\n'
                            game['rhino_say'] = True
                    else:
                        dmg = 15
                        if target['act'] != None:
                            if target['act'][0] == 'perekat':
                                if random.randint(1, 100) <= 40: #40% —à–∞–Ω—Å –ø–æ–ø–∞—Å—Ç—å
                                    game['text'] += 'üí¢|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                                        'name'] + ', —É–¥–∞—Ä—è—è —Ç—É —Ä–æ–≥–æ–º!' + \
                                                    ' –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(dmg) + ' —É—Ä–æ–Ω–∞.\n'
                                    takedamage(game, player, target, dmg)
                                else:
                                    game['text'] += 'üí®|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                                        'name'] + ', –ø—ã—Ç–∞—è—Å—å —É–¥–∞—Ä–∏—Ç—å —Ç—É —Ä–æ–≥–æ–º, –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.\n'
                            elif target['act'][0] == 'flash' and target['act'][1] == player['id']:
                                game['text'] += 'üí®|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                                    'name'] + ', –ø—ã—Ç–∞—è—Å—å —É–¥–∞—Ä–∏—Ç—å —Ç—É —Ä–æ–≥–æ–º, –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç.\n'
                            else:
                                game['text'] += 'üí¢|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç —Ä—ã–≤–æ–∫ –∫ ' + target[
                                    'name'] + ', —É–¥–∞—Ä—è—è —Ç—É —Ä–æ–≥–æ–º!' + \
                                                ' –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(dmg) + ' —É—Ä–æ–Ω–∞.\n'
                                takedamage(game, player, target, dmg)



            elif player['act'][0] == 'summon_treant':
                player['invokercd'] = 7
                player['summon_treant'] = 1
                game['text'] += 'üå≥|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–Ω—Ç–∞!\n'

            elif player['act'][0] == 'summon_mad_skeletons':
                player['summoned_mad_skeletons'] = True
                player['summon_mad_skeletons'] = game['dead_skeletons']
                if player['summon_mad_skeletons'] > 0:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç –ø–æ—Å–æ—Ö –Ω–∞–¥ —Å–æ–±–æ–π. –í –≥–ª–∞–∑–Ω–∏—Ü–∞—Ö —á–µ—Ä–µ–ø–∞ –æ–±—Ä–∞–∑—É—é—Ç—Å—è ' + \
                                    '—á–µ—Ä–Ω—ã–µ –∏—Å–∫—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø—É—Å—Ç—è —Å–µ–∫—É–Ω–¥—É —É–ª–µ—Ç–∞—é—Ç –≤ –ø—Ä–æ—Ö–æ–¥, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –∑–∞—à–ª–∏ –≤ —ç—Ç–æ—Ç –∑–∞–ª.\n'
                    if player['summon_mad_skeletons'] > 1:
                        if player['summon_mad_skeletons'] < 5:
                            game['effecttext'] += 'üëø|–ò–∑ –ø—Ä–æ—Ö–æ–¥–∞ –≤ –∫–æ–º–Ω–∞—Ç—É –ø—Ä–æ—Ç–∏—Å–∫–∏–≤–∞—é—Ç—Å—è ' + str(
                                player['summon_mad_skeletons']) + ' –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–ª–æ–±–Ω—ã—Ö —Å–∫–µ–ª–µ—Ç–∞, ' + \
                                                  '–ø—Ä–µ–≥—Ä–∞–∂–¥–∞—è –ø—É—Ç—å –∫ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏—é. –ö–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö –≤—ã–ª–∞–º—ã–≤–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–π –Ω–µ—Å—É—â–µ–π –∫–æ–ª–æ–Ω–Ω–µ –∑–∞–ª–∞ –∏ –±–µ—Ä–µ—Ç –µ—ë –≤ —Ä—É–∫–∏.\n'
                        if player['summon_mad_skeletons'] >= 5:
                            game['effecttext'] += 'üëø|–ò–∑ –ø—Ä–æ—Ö–æ–¥–∞ –≤ –∫–æ–º–Ω–∞—Ç—É –ø—Ä–æ—Ç–∏—Å–∫–∏–≤–∞—é—Ç—Å—è ' + str(
                                player['summon_mad_skeletons']) + ' –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–ª–æ–±–Ω—ã—Ö —Å–∫–µ–ª–µ—Ç–æ–≤, ' + \
                                                  '–ø—Ä–µ–≥—Ä–∞–∂–¥–∞—è –ø—É—Ç—å –∫ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏—é. –ö–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö –≤—ã–ª–∞–º—ã–≤–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–π –Ω–µ—Å—É—â–µ–π –∫–æ–ª–æ–Ω–Ω–µ –∑–∞–ª–∞ –∏ –±–µ—Ä–µ—Ç –µ—ë –≤ —Ä—É–∫–∏.\n'
                    else:
                        game['effecttext'] += 'üëø|–ò–∑ –ø—Ä–æ—Ö–æ–¥–∞ –≤ –∫–æ–º–Ω–∞—Ç—É –ø—Ä–æ—Ç–∏—Å–∫–∏–≤–∞–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–π –∑–ª–æ–±–Ω—ã–π —Å–∫–µ–ª–µ—Ç, ' + \
                                              '–ø—Ä–µ–≥—Ä–∞–∂–¥–∞—è –ø—É—Ç—å –∫ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏—é. –û–Ω –≤—ã–ª–∞–º—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∏–∑ –Ω–µ—Å—É—â–∏—Ö –∫–æ–ª–æ–Ω–Ω –∑–∞–ª–∞ –∏ –±–µ—Ä–µ—Ç –µ—ë –≤ —Ä—É–∫–∏.\n'
                    game['effecttext'] += 'üîµ|–í–æ–∫—Ä—É–≥ ' + player['name'] + ' –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∑–∞—â–∏—Ç–Ω—ã–π –±–∞—Ä—å–µ—Ä.\n'
                else:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç –ø–æ—Å–æ—Ö –Ω–∞–¥ —Å–æ–±–æ–π. –í –≥–ª–∞–∑–Ω–∏—Ü–∞—Ö —á–µ—Ä–µ–ø–∞ –æ–±—Ä–∞–∑—É—é—Ç—Å—è ' + \
                                    '—á–µ—Ä–Ω—ã–µ –∏—Å–∫—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø—É—Å—Ç—è —Å–µ–∫—É–Ω–¥—É —É–ª–µ—Ç–∞—é—Ç –≤ –ø—Ä–æ—Ö–æ–¥, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –∑–∞—à–ª–∏ –≤ —ç—Ç–æ—Ç –∑–∞–ª.\n'

                    game['effecttext'] += '‚ùì|–ß–µ—Ä–Ω—ã–µ –∏—Å–∫—Ä—ã, –≤—ã–ª–µ—Ç–µ–≤—à–∏–µ –∏–∑ —á–µ—Ä–µ–ø–∞, –≤–µ—Ä–Ω—É–ª–∏—Å—å –∫ –Ω–µ–º—É –≤ –≥–ª–∞–∑–Ω–∏—Ü—ã, –Ω–æ... ' + \
                                          '–ù–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ. –ì–æ—Ä—è—â–∏–µ –≥–ª–∞–∑–∞ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ —Ç–µ–ø–µ—Ä—å –≤—ã—Ä–∞–∂–∞—é—Ç —É–¥–∏–≤–ª–µ–Ω–∏–µ –∏ –ª–µ–≥–∫–æ–µ –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ.\n'

            elif player['act'][0] == 'summon_weak_skeletons':
                player['shield'] = True
                player['magic_strong_shield'] = True
                playeramount = 0
                for idss in game['players']:
                    if game['players'][idss]['controller'] != 'bot':
                        playeramount += 1
                summoned_skeles = playeramount * 2
                player['summon_weak_skeletons'] = summoned_skeles
                player['summoned_weak_skeletons'] = True
                if summoned_skeles >= 2 and summoned_skeles <= 4:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ö—Ä—ã—à–∫–∏ –≥—Ä–æ–±–æ–≤ –≤ –∑–∞–ª–µ –æ—Ç–∫–∏–Ω—É–ª–∏—Å—å, –∏ –æ—Ç—Ç—É–¥–∞ –≤—ã–ª–µ–∑–ª–æ ' + \
                                    str(summoned_skeles) + ' —Å–∫–µ–ª–µ—Ç–∞.\n'
                elif summoned_skeles >= 5:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ö—Ä—ã—à–∫–∏ –≥—Ä–æ–±–æ–≤ –≤ –∑–∞–ª–µ –æ—Ç–∫–∏–Ω—É–ª–∏—Å—å, –∏ –æ—Ç—Ç—É–¥–∞ –≤—ã–ª–µ–∑–ª–æ ' + \
                                    str(summoned_skeles) + ' —Å–∫–µ–ª–µ—Ç–æ–≤.\n'

            elif player['act'][0] == 'summon_weak_ghouls':
                player['shield'] = True
                player['magic_strong_shield'] = True
                playeramount = 0
                for idss in game['players']:
                    if game['players'][idss]['controller'] != 'bot':
                        playeramount += 1
                summoned_ghouls = playeramount * 1
                player['summon_weak_ghouls'] = summoned_ghouls
                player['summoned_weak_ghouls'] = True
                if summoned_ghouls == 1:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –° –ø–æ—Ç–æ–ª–∫–∞ –Ω–∞ –ø–æ–ª–µ –±–æ—è —Å–ø—Ä—ã–≥–∏–≤–∞–µ—Ç –≤—É—Ä–¥–∞–ª–∞–∫.\n'
                elif summoned_ghouls >= 2 and summoned_ghouls <= 4:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –° –ø–æ—Ç–æ–ª–∫–∞ –Ω–∞ –ø–æ–ª–µ –±–æ—è —Å–ø—Ä—ã–≥–∏–≤–∞—é—Ç ' + \
                                    str(summoned_ghouls) + ' –≤—É—Ä–¥–∞–ª–∞–∫–∞.\n'
                elif summoned_ghouls >= 5:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –° –ø–æ—Ç–æ–ª–∫–∞ –Ω–∞ –ø–æ–ª–µ –±–æ—è —Å–ø—Ä—ã–≥–∏–≤–∞—é—Ç ' + \
                                    str(summoned_ghouls) + ' –≤—É—Ä–¥–∞–ª–∞–∫–æ–≤.\n'

            elif player['act'][0] == 'summon_zombie_rats':
                player['shield'] = True
                player['magic_strong_shield'] = True
                playeramount = 0
                for idss in game['players']:
                    if game['players'][idss]['controller'] != 'bot':
                        playeramount += 1
                summoned_zombierats = playeramount * 1
                player['summon_zombie_rats'] = summoned_zombierats
                player['summoned_zombie_rats'] = True
                if summoned_zombierats == 1:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –≤—ã–ª–µ–∑–∞–µ—Ç –∑–æ–º–±–∏-–∫—Ä—ã—Å–∞!\n'
                elif summoned_zombierats >= 2:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –≤—ã–ª–µ–∑–∞—é—Ç ' + \
                                    str(summoned_zombierats) + ' –∑–æ–º–±–∏-–∫—Ä—ã—Å—ã!\n'
                elif summoned_zombierats >= 5:
                    game['text'] += 'üîÆ|' + player[
                        'name'] + ' –≤–∑–º–∞—Ö–∏–≤–∞–µ—Ç –ø–æ—Å–æ—Ö–æ–º, –æ–∫—Ä—É–∂–∞—è —Å–µ–±—è –º–∞–≥–∏—á–µ—Å–∫–∏–º –±–∞—Ä—å–µ—Ä–æ–º. –ò–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –≤—ã–ª–µ–∑–∞—é—Ç ' + \
                                    str(summoned_zombierats) + ' –∑–æ–º–±–∏-–∫—Ä—ã—Å!\n'

            elif player['act'][0] == 'wait_for_death':
                game['text'] += 'üìú|–ù–µ–∫—Ä–æ–º–∞–Ω—Ç —Ç—â–µ—Ç–Ω–æ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–∑–≤–∞—Ç—å —Å–µ–±–µ –Ω–∞ –ø–æ–º–æ—â—å –º–µ—Ä—Ç–≤–µ—Ü–æ–≤.\n'

            elif player['act'][0] == 'big_virus_mutant':
                player['invokercd'] = 5
                player['summon_virus'] = 1
                game['text'] += 'ü¶†|' + player[
                    'name'] + ' —Å–æ–∑–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–≥–æ –≤–∏—Ä—É—Å–Ω–æ–≥–æ –º—É—Ç–∞–Ω—Ç–∞ –∏–∑ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤! –ò —Å—É–¥—è –ø–æ –≤—Å–µ–º—É, –æ–Ω –Ω–µ –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è —Ö–æ–∑—è–∏–Ω—É...\n'

            elif player['act'][0] == 'standup':
                player['fell'] = False
                game['text'] += '‚¨ÜÔ∏è|' + player['name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —Å –∑–µ–º–ª–∏.\n'

            elif player['act'][0] == 'machinegun_charge':
                player['machinegun_charges'] += 1
                if 'zilch_machinegun' in player['customtexts'] and player['customtexts']['zilch_machinegun']:
                    game['text'] += 'üÜò|' + player['name'] + ' –∑–∞—Ä—è–∂–∞–µ—Ç –ø—É–ª–µ–º–µ—Ç –ù–∞—Ä—Å–∏–ª!\n'
                else:
                    game['text'] += 'üÜò|' + player['name'] + ' –∑–∞—Ä—è–∂–∞–µ—Ç –ø—É–ª–µ–º–µ—Ç!\n'

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'execution':
                player['execution'] = True
                player['act'] = ['attack', player['act'][1]]

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None and player['stun'] <= 0 and not player['dead'] and player['meditation'] == None:
                if player['lasthit'] > 0:
                    game['text'] += '‚ù§Ô∏è‚Äçüî•|' + player['name'] + ' —É–º–∏—Ä–∞–µ—Ç.\n'
                if player['darkness_sleep']:
                    player['darkness_uvorot'] += 1
                    if player['darkness_uvorot'] == 4:
                        player['dead'] = True
                        game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'
                else:
                    game['text'] += '‚¨áÔ∏è|' + player['name'] + ' –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ (–ê–§–ö)!\n'
                try:
                    medit('–í—Ä–µ–º—è –≤—ã—à–ª–æ!', player['msg'].chat.id, player['msg'].message_id)
                except:
                    pass
                player['afkcount'] += 1
                if player['afkcount'] >= 2 and not player['dead']:
                    player['suicide'] = True
            if player['act'] == None:
                continue
            if player['act'][0] == 'attack':
                target = game['players'][player['act'][1]]
                sokrush = False
                narsil = False
                chain = False
                execution = False
                if player['weapon'].name == '–ö—É–≤–∞–ª–¥–∞' and player['sokrushenie']:
                    sokrush = True
                elif player['weapon'].name == '–¶–µ–ø—å' and player['chain']:
                    chain = True
                elif player['weapon'].name == '–ö–æ–ø—å–µ –ù–∞—Ä—Å–∏–ª' and player['narsil']:
                    narsil = True
                elif player['execution'] and player['weapon'].name == '–ö–∞—Ç–∞–Ω–∞':
                    execution = True
                attackact(game, player, target, sokrush, chain, narsil, execution)

                if player['weapon'].name == '–ü—É–ª–µ–º–µ—Ç':
                    player['energy'] += player['weapon'].energycost
                    for machinegun_counter in range(9):
                        attackact(game, player, target, sokrush, chain, narsil, execution)
                        if machinegun_counter != 8:
                            player['energy'] += player['weapon'].energycost
                    player['machinegun_charges'] = 0

                elif player['weapon'].name == '–°—é—Ä–∏–∫–µ–Ω—ã':
                    player['droppedweapon'] = player['weapon']
                    shlost = 1
                    if player['weapon'].lvl == 4 and player['weapon'].modification == 2:
                        shlost = 0
                    player['shurikens'] -= shlost
                    if player['shurikenstothrow'] == 2 and player['shurikens'] >= 1:
                        attackact(game, player, target, sokrush, chain, narsil, execution)
                        player['shurikens'] -= shlost
                        player['energy'] += 1
                    if player['shurikens'] <= 0:
                        player['weapon'] = weaponlist.Fist()
                if player['energy'] < 0:
                    player['energy'] = 0

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'counterattack':
                game['text'] += '‚öîÔ∏è|' + player['name'] + ' –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–æ–≤–∞—Ç—å.\n'
                for ids in player['who_attacked']:
                    target = game['players'][ids]
                    attackact(game, player, target, counterattack=True)
                    if game['classic_game']:
                        player['energy'] -= 2
                if not game['classic_game']:
                    player['energy'] -= 1
                    player['spearcd'] = 3
                else:
                    player['spearcd'] = 4
            if player['weapon'].name == '–ö–æ–ø—å–µ' and player['weapon'].lvl == 4 and player['weapon'].modification == 1 and player['passivecounterattackcd'] <= 0:
                if len(player['who_attacked']) > 0:
                    target = random.choice(player['who_attacked'])
                    attackact(game, player, target, counterattack=True)
                    player['energy'] -= 1
                    player['passivecounterattackcd'] = 10

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'attack':
                target = game['players'][player['act'][1]]
                if player['weapon'].name == '–ö—É–≤–∞–ª–¥–∞' and player['sokrushenie']:
                    attackact(game, player, target)

                if player['weapon'].name == '–¶–µ–ø—å' and player['chain']:
                    attackact(game, player, target)

        for ids in game['players']:
            player = game['players'][ids]
            if player['madpotion']:
                player['sokrushenie'] = False
                player['chain'] = False
                player['narsil'] = False
                player['execution'] = False
                player['firearrow'] = False
                player['truestrike'] = False
                player['strongshot'] = False
                targets = []
                for idss in game['players']:
                    enemy = game['players'][idss]
                    if enemy['team'] != player['team'] and not enemy['dead']:
                        if not player['weapon'].ranged:
                            if enemy['id'] in player['nearplayers']:
                                targets.append(enemy['id'])
                        else:
                            targets.append(enemy['id'])
                rng = 1
                if player['doublemadpotion']:
                    rng = 2
                for i in range(rng):
                    if len(targets) == 0:
                        target = player
                    else:
                        target = game['players'][random.choice(targets)]
                    attackact(game, player, target)
                    if player['weapon'].name == '–°—é—Ä–∏–∫–µ–Ω—ã':
                        player['droppedweapon'] = player['weapon']
                        player['shurikens'] -= 1
                        if player['shurikens'] <= 0:
                            player['weapon'] = weaponlist.Fist()
                    if player['energy'] < 0:
                        player['energy'] = 0

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'incvizitor':
                target = game['players'][player['act'][1]]
                player['incvizitorcd'] = 3
                if 'incvizitor?1' in player['skills']:
                    player['incvizitorcd'] = 6
                if 'incvizitor?2' in player['skills']:
                    player['incvizitorcd'] = 5
                if 'incvizitor?3' in player['skills']:
                    player['incvizitorcd'] = 4
                incv = False
                for idss in target['dopuseditems']:
                    if idss[0] == 'bomb':
                        incv = True
                if target['team'] != player['team']:
                    if (target['act'] != None and target['act'][0] in ['attack', 'knife', 'molotov', 'grenade', 'blow',
                                                                       'lighting', 'charge', 'dark_energy'] or target[
                            'madpotion']) or incv:
                        target['curses'].append(['stun', 3])
                        if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                    game['text'] += 'üïã|' +player['name']+ ' –ø–æ–º—É—Ç–Ω—è–µ—Ç —Ä–∞–∑—É–º ' + target['name'] + ' \n'
                        else:
                                    game['text'] += 'üôè|' + player['name'] + ' –º–æ–ª–∏—Ç—Å—è. –ù–∞–¥ ' + target['name'] + ' —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Ç—É—á–∏!\n'
                    else:
                        if target['act'] != None and target['act'][0] == 'necrostaffability':
                            game['text'] += 'üôè‚ö°Ô∏è|' + player['name'] + ' –º–æ–ª–∏—Ç—Å—è. –í ' + target[
                                'name'] + ' –±—å–µ—Ç –º–æ–ª–Ω–∏—è –∏ –æ—Ç–Ω–∏–º–∞–µ—Ç —É —Ü–µ–ª–∏ 1‚ô•Ô∏è!\n'
                        else:
                                    if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                                game['text'] += '‚¨õÔ∏è|' +player['name']+ ' –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø–æ–º—É—Ç–Ω–∏—Ç—å —Ä–∞–∑—É–º ' + target['name'] + ' !\n'
                                    else:
                                                game['text'] += 'üí®|' + player['name'] + ' –º–æ–ª–∏—Ç—Å—è, –Ω–æ —Å ' + target['name'] + ' –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.\n'
                else:
                    if target['id'] == player['id']:
                                if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                            game['text'] += '‚ô£Ô∏è|' + player['name'] + ' –ø—Ä–∏—Å–ª—É—à–∏–≤–∞–µ—Ç—Å—è –∫ —Å–≤–æ–µ–º—É —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏—é...\n'
                                else:
                                            game['text'] += 'üôè|' + player['name'] + ' –º–æ–ª–∏—Ç—Å—è –∑–∞ —Å–µ–±—è!\n'
                    else:
                                if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                            game['text'] += '‚ô£Ô∏è|' + player['name'] + ' –ø—Ä–∏—Å–ª—É—à–∏–≤–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏—é ' + target['name'] + '!\n'
                                            target['molitva'] = True
                                else:
                                            game['text'] += 'üôè|' + player['name'] + ' –º–æ–ª–∏—Ç—Å—è –∑–∞ ' + target['name'] + '!\n'
                    target['molitva'] = True

            elif player['act'][0] == 'energy_blow':
                target = game['players'][player['act'][1]]
                dmg = target['energy']
                for idss in game['players']:
                    target2 = game['players'][idss]
                    if target2['team'] == target['team']:
                        takedamage(game, player, target2, dmg)
                target['energy'] = 0
                game['text'] += '‚ö°Ô∏è|'+player['name']+' –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ä–∞–¥–∏–æ–ø–æ—Å–æ—Ö, –∏ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –ª—É—á –±—å–µ—Ç –≤ '+target['name']+', –≤–∑—Ä—ã–≤–∞—è –≤—Å—é –µ–≥–æ —ç–Ω–µ—Ä–≥–∏—é! –¶–µ–ª—å –∏ –≤—Å–µ –µ—ë —Å–æ—é–∑–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç '+str(dmg)+' —É—Ä–æ–Ω–∞.\n'
                player['energy_blowcd'] = 2

            elif player['act'][0] == 'get_calm_pvp':
                game['text'] += '‚ù§Ô∏è‚Äçü©π' + player['name'] + ' –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞ –∏ –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è. –°—Ç—Ä–∞—Ö –æ—Ç—Å—Ç—É–ø–∞–µ—Ç!\n'
                player['dark_counter'] = 0
                player['pressed_info'] = True

            elif player['act'][0] == 'invoker_suicide':
                player['hp'] = 0
                player['dead'] = True
                if random.randint(1, 100) <= 8:
                    game['text'] += '‚ö´Ô∏è‚ö´Ô∏è‚ö´Ô∏è|' + player[
                        'name'] + ' —Å–æ–∑–¥–∞—ë—Ç –û“âÃïÕúÃìÃâÕëÃÅÃ≠ÕàÃ†–ìÃ∑Õ°Ã°ÕÑÃÜÃøÃêÃòÃôÕé–†“àÕùÃßÃöÃÄÕÄÃàÕöÕïÃ©Ã´Õá–ûÃ∂“áÕúÕëÃæÃóÕÖÃ©Õà–úÃ¥ÃõÃ¢ÕëÕåÕãÃîÃ™ÕéÃûÃùÃ≠–ù“àÃõÃ®ÃçÕÜÕÜÕÇÃéÃ†Ãó–£“âÃõÕ¢ÕÑÃìÃÜÕÄÃüÃ´–ÆÃ¥Õ†Ã¢ÕÄÕÑÃâÃÄÕéÕçÕçÃ™Ãò –ßÃ∏“áÕ¢ÃãÕÑÃöÃéÕçÃñÃ£ÕîÃ§–ÅÃ∏“áÃ°ÃàÕãÃäÃ´ÃØÕôÃ¶–†ÃµÕùÃ¢ÃåÕíÃèÃøÕÇÃ≥Õâ–ùÃ∑Õ†ÕúÃøÃêÃÉÃΩÕõÃúÃóÃ†Õà–£ÃµÕ†ÕúÃÑÃîÃèÃíÕéÕìÕôÕÖ–Æ“âÕ†Ã°ÃÅÕõÃìÃ•ÕîÃ£ –îÃ∂Õ°ÕúÃøÕãÃìÕÑÃèÃ©Ã¶Ã≠Ã•–´“àÕ°Ã°ÃÖÃäÃ§ÃØ–†“àÕûÕ¢ÃÅÕÜÕêÕÑÃñÃô–£“âÕ°ÃßÕäÃÅÃ≤Ã±Ã±,“âÕûÃ°ÃæÃíÃ•Ãû –∫–æ—Ç–æ—Ä–∞—è –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –Ω–∞ –ø–æ–ª–µ –±–æ—è. –í—Å–µ –º–µ—Ä—Ç–≤—ã, –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.\n'
                    for idss in game['players']:
                        target = game['players'][idss]
                        target['dead'] = True
                else:
                    game['text'] += '‚ö´Ô∏è|' + player['name'] + ' —Å–æ–∑–¥–∞—ë—Ç —á—ë—Ä–Ω—É—é –¥—ã—Ä—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–≥–ª–æ—â–∞–µ—Ç –∫–æ–ª–¥—É–Ω–∞. ' + \
                                    player['name'] + ' –º—ë—Ä—Ç–≤.\n'

            elif player['act'][0] == 'demondestroy':
                player['demondestroycd'] = 15
                target = game['players'][player['act'][1]]
                game['text'] += '‚ö´Ô∏è|–í—Å–µ –≥–ª–∞–∑–∞ '+player['name']+', –∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ, –∑–∞–∫—Ä—ã–ª–∏—Å—å. –ì–ª–∞–∑ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–Ω—ã–º, –∏ —Å—Ä–∞–∑—É ' + \
                                   '–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã–ø—É—Å–∫–∞–µ—Ç —à–∏—Ä–æ–∫—É—é –≤–æ–ª–Ω—É —Ç–µ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤ ' + target['name'] + '. ' + \
                                   '–¶–µ–ª—å —Ç–µ—Ä—è–µ—Ç –≤—Å—é —Å–≤–æ—é –∂–∏–∑–Ω–µ–Ω–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é.\n'
                target['hp'] = 0

        for ids in game['players']:
            player = game['players'][ids] 
            if player['act'] == None:
                continue
            if not game['classic_game']:
                if player['act'][0] == 'attack' or player['act'][0] == 'knife':
                    if 'pyromancer' in player['skills'] and player['pyrodamage']:
                        target = game['players'][player['act'][1]]
                        pyrodamage = 0
                        for idss in game['players']:
                            target2 = game['players'][idss]
                            if target2['fireticks'] > 0:
                                pyrodamage += 1

                        showpyrodamage = pyrodamage
                        if pyrodamage > 0:
                            player['demon'] = True
                        if not target['washitin']:
                            armor, text = getarmor(game, target, pyrodamage)
                        else:
                            armor = target['dopblock']
                            if pyrodamage < armor:
                                armor = pyrodamage
                            text = ''
                            if armor > 0:
                                if 'semw_armor' in player['customtexts'] and player['customtexts']['semw_armor']:
                                    text = 'ü™ñ|' + target['name'] + ' –≤ —Å–≤–æ–µ–π –±—Ä–æ–Ω–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º—ã–º, —Å–Ω–∏–º–∞—è –≤—Å–µ–≥–æ ' + str(armor) + ' —É—Ä–æ–Ω–∞ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–±–µ–∂–¥–∞—Ç—å –≤—Ä–∞–≥–æ–≤!\n'
                                else:
                                    text = 'üõ°| –ë—Ä–æ–Ω—è ' + target['name'] + ' —Å–Ω–∏–º–∞–µ—Ç ' + str(armor) + ' —É—Ä–æ–Ω–∞!\n'
                        pyrodamage -= armor
                        target['dopblock'] -= armor
                        if target['saberblock'] != None:
                            if player['id'] == target['saberblock'][0]:
                                sblock = target['saberblock'][1]
                                if sblock > pyrodamage:
                                    sblock = pyrodamage
                                pyrodamage -= sblock
                                target['saberblock'][1] -= sblock
                        if showpyrodamage > 0:
                            game['effecttext'] += 'üë∫|–ü–∏—Ä–æ–º–∞–Ω ' + player[
                                'name'] + ' –Ω–∞–Ω–æ—Å–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–Ω —Å–≤–æ–µ–π —Ü–µ–ª–∏ (' + str(showpyrodamage) + ')!\n'
                            game['effecttext'] += text
                        if not target['shield']:
                            if pyrodamage > 0:
                                player['outgoingdmgs'].append([target['id'], pyrodamage])
                                target['incomingdmgs'].append([player['id'], pyrodamage])

        for ids in game['players']:
            player = game['players'][ids]
            waitbatsdel = []
            for idss in player['waitbats']:
                idss[1] -= 1
                if idss[1] <= 0 and not player['dead']:
                    dmg = random.randint(3, 3) 
                    showdmg, text = takedamage(game, game['players'][idss[0]], player, dmg)
                    game['text'] += 'ü¶á|–õ–µ—Ç—É—á–∞—è –º—ã—à—å —Å–∞–¥–∏—Ç—Å—è –Ω–∞ ' + player['name'] + ' –∏ –∫—É—Å–∞–µ—Ç –µ–≥–æ! –ù–∞–Ω–µ—Å–µ–Ω–æ ' + str(
                        showdmg) + ' —É—Ä–æ–Ω–∞.\n'
                    game['text'] += text
                    waitbatsdel.append(idss)
                    # player['batsdamages'].append(idss[0])
            for idss in waitbatsdel:
                player['waitbats'].remove(idss)

            rootsdel = []
            for idss in player['roots']:
                print(idss)
                idss[1] -= 1
                if idss[1] <= 0 and not player['dead']:
                    dmg = 1 
                    showdmg, text = takedamage(game, game['players'][idss[0]], player, dmg) 
                    game['text'] += 'üéã|' + player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(dmg) + ' —É—Ä–æ–Ω–∞ –æ—Ç –∫–æ—Ä–Ω–µ–π!\n'
                    game['text'] += text 
                    rootsdel.append(idss)
            for idss in rootsdel:
                player['roots'].remove(idss) 
            if player['act'] == None:
                continue
            if player['act'][0] == 'skip':
                
                if 'zilch_skip' in player['customtexts'] and player['customtexts']['zilch_skip']:
                    if random.randint(1, 100) <= 75:
                        game['text'] += '‚òïÔ∏è|' + player['name'] + ' –ø—å–µ—Ç —á–∞–π.\n'
                    else:
                        game['text'] += 'üç¨|' + player['name'] + ' –µ—Å—Ç –∫–æ–Ω—Ñ–µ—Ç—ã.\n'
                        
                elif 'alex_skip' in player['customtexts'] and player['customtexts']['alex_skip']:
                    game['text'] += 'üåí|' + player['name'] + ', –ø–æ–ø–∏–≤–∞—è –∫–æ—Ñ–µ, —Å–µ—è–ª —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ —Å–≤–æ–∏–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º.\n'
                    
                elif 'meningoencephalitis_skip' in player['customtexts'] and player['customtexts']['meningoencephalitis_skip']:
                    game['text'] += '‚¨áÔ∏è|' + player['name'] + ' –¥–µ–ª–∞–µ—Ç –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –º—É–≤.\n'
                    
                else:
                    if player['fireticks'] > 0:
                        if 'autist' not in player['skills']:
                            game['text'] += 'üí®|' + player['name'] + ' —Ç—É—à–∏—Ç —Å–µ–±—è.\n'
                        else:
                            game['text'] += 'üí®|' + player['name'] + ' —Ç—É–ø–∏—Ç, –∞ –æ–≥–æ–Ω—å –Ω–∞ –Ω–µ–º –ø–æ—á–µ–º—É-—Ç–æ —Ç—É—Ö–Ω–µ—Ç.\n'
                    else:
                        if 'autist' not in player['skills']:
                            game['text'] += '‚¨áÔ∏è|' + player['name'] + ' –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥.\n' 
                        else:
                            game['text'] += '‚¨áÔ∏è|' + player['name'] + ' —Ç—É–ø–∏—Ç.\n'
                if player['fireticks'] > 0:
                    player['fireticks'] = 1
                    player['firestrength'] = 0

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue
            if player['act'][0] == 'zombieup':
                target = game['players'][player['act'][1]]
                if target['dead']:
                    target['dead'] = False
                    target['necrozombie'] = 3
                    target['maxnecrozombie'] = 3
                    if player['weapon'].name == '–ü–æ—Å–æ—Ö –ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞':
                        target['necrozombie'] = 2
                        target['maxnecrozombie'] = 2
                    target['weapon'] = weaponlist.Bite()
                    target['master'] = None
                    target['skills'] = []
                    target['inventory'] = []
                    game['text'] += 'üëø|' + player['name'] + ' –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∑–æ–º–±–∏.\n'

            elif player['act'][0] == 'break_weapons':
                player['invokercd'] = 0
                target = game['players'][player['act'][1]]
                if target['weapon'].name not in ['–ö—É–ª–∞–∫–∏', '–£–∫—É—Å –∑–æ–º–±–∏', '–†–æ–≥', '–†—É–∫–∞ —Ç—Ä–µ–Ω—Ç–∞', '–ö–æ–Ω–µ—á–Ω–æ—Å—Ç—å –≤–∏—Ä—É—Å–∞',
                                                 'One punch']:
                    target['lostweapon'] = True \
                # if player['weapon'].name not in ['–ö—É–ª–∞–∫–∏', '–£–∫—É—Å –∑–æ–º–±–∏', '–†–æ–≥', '–†—É–∫–∞ —Ç—Ä–µ–Ω—Ç–∞', '–ö–æ–Ω–µ—á–Ω–æ—Å—Ç—å –≤–∏—Ä—É—Å–∞']:
                #    player['weapon'] = weaponlist.Fist()
                game['text'] += 'üï≥|' + player['name'] + ' —Å–æ–∑–¥–∞–µ—Ç –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—É—é –∞–Ω–æ–º–∞–ª–∏—é –≤–æ–∫—Ä—É–≥ ' + target[
                    'name'] + ', —Ü–µ–ª—å —Ä–æ–Ω—è–µ—Ç —Å–≤–æ–µ –æ—Ä—É–∂–∏–µ!\n' 
 
            elif player['act'][0] == 'light_sword':
                player['invokercd'] = 4
                target = game['players'][player['act'][1]]
                target['weapon'] = weaponlist.LightSword()
                game['text'] += '‚òÄÔ∏è|–¢—É—á–∏ –Ω–∞–¥ ' + player[
                    'name'] + ' —Ä–∞–∑–¥–≤–∏–Ω—É–ª–∏—Å—å, –∏ —É–ø–∞–≤—à–∏–π —Å –Ω–µ–±–∞ –ª—É—á –∫–æ—Å–Ω—É–ª—Å—è –æ—Ä—É–∂–∏—è ' + target[
                                    'name'] + '. –û–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–æ—Å—å –≤ –ú–µ—á –°–≤–µ—Ç–∞!\n'

            elif player['act'][0] == 'infection':
                player['invokercd'] = 2
                target = game['players'][player['act'][1]]
                target['infected'] = True
                game['text'] += 'ü¶†|' + player['name'] + ' –æ—Ç—Ä–∞–≤–ª—è–µ—Ç ' + target[
                    'name'] + '! –¶–µ–ª—å –±—É–¥–µ—Ç —Ç–µ—Ä—è—Ç—å 2‚ö°Ô∏è –∫–∞–∂–¥—ã–π —Ö–æ–¥ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –æ—Ç–¥–æ—Ö–Ω–µ—Ç.\n'

            elif player['act'][0] == 'mind_control':
                target = game['players'][player['act'][1]]
                target['attack_self'] = True
                game['text'] += 'ü™¨|' + player['name'] + ' –≤–ø–∏–≤–∞–µ—Ç—Å—è –≤–∑–≥–ª—è–¥–æ–º –≤ ' + target[
                    'name'] + ', –ø–æ–¥—á–∏–Ω—è—è –µ–≥–æ —Ä–∞–∑—É–º —Å–≤–æ–µ–π –¥–µ–º–æ–Ω–∏—á–µ—Å–∫–æ–π –≤–æ–ª–µ.\n'
                player['mind_controlcd'] = 2

        for ids in game['players']:
            player = game['players'][ids]
            if player['act'] == None:
                continue

                    
            if 'add_tentacles' in player['skills'] and player['act'][1] != 'self':
                try:
                    target = game['players'][player['act'][1]]
                except:
                    target = None
                    
                if target != None and target['team'] != player['team']:
                    if random.randint(1, 100) <= 50:
                        hitchance = 90
                        if target['act'] != None and target['act'][0] == 'perekat':
                            hitchance -= 50
                            if 'ninja' in target['skills']:
                                hitchance -= 950

                        dmg = 1
                        firetext = ''  # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è firetext –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤

                        if random.randint(1, 100) <= hitchance:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∞–Ω—Å –ø–æ–ø–∞–¥–∞–Ω–∏—è
                            takedamage(game, player, target, dmg)

                            if target.get('act') is not None and ('skip' in target['act'] or 'stun' in target['act']):
                                firetext = None  # –ï—Å–ª–∏ —Ü–µ–ª—å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ –∏–ª–∏ –æ–≥–ª—É—à–µ–Ω–∞, –æ–≥–æ–Ω—å –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è
                            else:
                                firetext = setfire(game, player, target, strength=1, duration=3)  # –û–≥–æ–Ω—å –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è

                            if firetext:
                                game[
                                    'text'] += f'üß¨|–ò–∑ —Ç–µ–ª–∞ {player["name"]} –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ –∞—Ç–∞–∫—É—é—Ç {target["name"]}! –ù–∞–Ω–µ—Å–µ–Ω–æ {dmg} —É—Ä–æ–Ω–∞.{firetext}\n'
                            else:
                                game[
                                    'text'] += f'üß¨|–ò–∑ —Ç–µ–ª–∞ {player["name"]} –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ –∞—Ç–∞–∫—É—é—Ç {target["name"]}! –ù–∞–Ω–µ—Å–µ–Ω–æ {dmg} —É—Ä–æ–Ω–∞.\n'
                        else:
                            game[
                                'text'] += f'üí®|–ò–∑ —Ç–µ–ª–∞ {player["name"]} –≤—ã–ª–µ–∑–∞—é—Ç —â—É–ø–∞–ª—å—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ –∞—Ç–∞–∫—É—é—Ç {target["name"]}, –Ω–æ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç.\n'

        textstosend = []
        while len(game['text']) > 4000:
            textstosend.append(game['text'][:4000])
            game['text'] = game['text'][4000:]
        if not game['castlefight'] and not game['neuralfight']:
            if not game['cwbar']:
                while True:
                    tries = 0
                    try:
                        for idss in textstosend:
                            sendm(bot, game['id'], idss)
                            time.sleep(1)
                        if game['text'] != ' ' and game['text'] != '':
                            sendm(bot, game['id'], game['text'])
                        break
                    except: 
                        tries += 1
                        if tries > 100:
                            del games[game['id']]
                            return
                        time.sleep(3)

            for ids in game['players']:
                player = game['players'][ids]
                if player['id'] != game['id']:
                    try:
                        sendm(bot, player['id'], game['text'])
                        # for idss in textstosend:
                        #    sendm(bot, player['id'], idss)
                        #    time.sleep(1)
                    except:
                        pass
            for ids in game['spectators']:
                if ids not in game['players']:
                    try:
                        for idss in game['players']:
                            xx = game['players'][idss]
                            break
                        sendm(bot, ids, '[' + xx['name'] + ']\n' + game['text'])
                    except:
                        pass 
            time.sleep(1)
        else:
            if not game['neuralfight']:
                alltext = game['text'].split('\n')
                for ids in game['players']:
                    player = game['players'][ids]
                    try:
                        player['castlefighttexts'].append('\n–•–æ–¥ ' + str(game['turn'] - 1) + ':')
                        for idss in alltext:
                            if player['name'] + ' ' in idss or player['name'] + '.' in idss or player['name'] + ',' in idss or \
                                    player['name'] + '!' in idss:
                                player['castlefighttexts'].append(idss)
                    except:
                        pass
                allcastlesbattletext[game['id']].append(game['text'])
        for ids in game['players']:
            player = game['players'][ids]
            player['stun'] -= 1
            if player['stun'] == 0 and not player['dead']:
                if 'mewcomer_stun' in player['customtexts'] and player['customtexts']['mewcomer_stun']:
                            game['effecttext'] += 'üò±|' + player['name'] + ' —Ä–µ–∑–∫–æ –ø–æ–º–∞—Ö–∞–ª –≥–æ–ª–æ–≤–æ–π, –≤—Å–ø–æ–º–Ω–∏–≤, —á—Ç–æ –æ–Ω –¥–µ—Ä—ë—Ç—Å—è.\n'
                else:
                            game['effecttext'] += 'üåÄ|' + player['name'] + ' –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Å–µ–±—è.\n'
            player['fireticks'] -= 1
            if player['watershield'] > 0 and player['fireticks'] > 0:
                player['fireticks'] = 0
            if player['fireticks'] == 0:
                game['effecttext'] += 'üî•|–û–≥–æ–Ω—å –Ω–∞ ' + player['name'] + ' –ø–æ—Ç—É—Ö!\n'
                player['firestrength'] = 0 
            elif player['fireticks'] > 0:
                if len(player['who_fireds']) > 0:
                    player['who_fired'] = random.choice(player['who_fireds'])
                curdamage = player['firestrength']
                showdamage = curdamage
                if player['saberblock'] != None:
                    if player['who_fired'] == player['saberblock'][0]:
                        curdamage = 0

                if 'fire_regen' not in player['skills'] and 'fire_resistance' not in player['skills'] and 'lucifer_shield' not in player['skills'] and not player['is_radiodemon']:
                    showdmg, text = takedamage(game, game['players'][player['who_fired']], player, curdamage)
                    if player['firestrength'] > 1:

                        player['energy'] -= (player['firestrength'] - 1)
                        game['effecttext'] += 'üî•|' + player['name'] + ' –≥–æ—Ä–∏—Ç! –¢–µ—Ä—è–µ—Ç ' + str(
                            player['firestrength'] - 1) + ' —ç–Ω–µ—Ä–≥–∏–∏ –∏ –ø–æ–ª—É—á–∞–µ—Ç ' + str(player['firestrength']) + ' —É—Ä–æ–Ω–∞.\n'
                    else:
                        game['effecttext'] += 'üî•|' + player['name'] + ' –≥–æ—Ä–∏—Ç! –ü–æ–ª—É—á–∞–µ—Ç ' + str(
                            player['firestrength']) + ' —É—Ä–æ–Ω–∞.\n'
                else:
                    if 'fire_regen' in player['skills'] or player['is_radiodemon']:
                        text = 'üî•|' + player['name'] + ' –≥–æ—Ä–∏—Ç! –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ' + str(1) + ' –∂–∏–∑–Ω—å.\n'
                        #if player['hp'] < player['maxhp']:
                        player['hp'] += 1
                        player['fireticks'] = 1
                    elif 'fire_resistance' in player['skills']:
                        text = 'üî•|' + player['name'] + ' –≥–æ—Ä–∏—Ç, –Ω–æ –∞–¥—Å–∫–∞—è –∫–∞–º–µ–Ω–Ω–∞—è –∫–æ–∂–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç —É—Ä–æ–Ω.\n'
                    elif 'lucifer_shield' in player['skills']:
                        text = 'üî•üî¥|' + player['name'] + ' –≥–æ—Ä–∏—Ç! –û–≥–æ–Ω—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—ã–π –±–∞—Ä—å–µ—Ä –≤–æ–∫—Ä—É–≥ –õ—é—Ü–∏—Ñ–µ—Ä–∞, –±–ª–æ–∫–∏—Ä—É—è –≤—Ö–æ–¥—è—â–∏–π —É—Ä–æ–Ω.\n'
                        player['shield'] = True
                        player['incomingdmgs'] = []
                        player['fireticks'] = 1
                game['players'][player['who_fired']]['demon'] = True
                game['effecttext'] += text

        game['text'] = '–≠—Ñ—Ñ–µ–∫—Ç—ã ' + str(game['turn'] - 1) + ':\n'
        if game['effecttext'] != '':
            game['text'] += game['effecttext']
            game['effecttext'] = ''
        illusions = []
        skeletons = []
        treants = []
        viruses = []
        madskeles = []
        weakskeles = [] 
        weakghouls = []
        zombierats = []
        necrofighters = []
        angryrhinos = []
        for ids in game['players']:
            player = game['players'][ids]
            if player['createillusion']: 
                player['illusion'] = True
                player['illusioncd'] = 5
                player['illusionturns'] = 3
                illusions.append(createplayer(user=None, uid=0 - player['id'], weapon=weaponlist.Non(), hp=0,
                                              name='–ò–ª–ª—é–∑–∏—è ' + player['name'], dead=True, iamillusion=True))
            if player['blood'] > 0:
                player['blood'] -= 1
                if player['blood'] <= 0:
                    if player['is_necromant']:
                        pass
                    else:
                        hp = 1
                        player['hp'] -= hp
                        player['can_summon_zombie'] = True

                    if not player['dead']:
                        if player['is_necromant']:
                            game['text'] += '‚ù£Ô∏è|' + player['name'] + ' –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ!\n'
                        else:
                            if '–¢—å–º–∞' in player['name'] and player['team'] == 'dark' and player['controller'] == 'bot':
                                game['text'] += '‚ù£Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç 1 –≥–ª–∞–∑.\n'
                            else:
                                game['text'] += '‚ù£Ô∏è|–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –æ—Ç–Ω–∏–º–∞–µ—Ç —É ' + player['name'] + ' –∂–∏–∑–Ω—å!\n' 
                                game['text'] += '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                                    1) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(player['hp']) + ' —Ö–ø.\n'
                            if 'regeneration' in player['skills'] and random.randint(1, 6) == 1:
                                player['hp'] += 1
                                game['text'] += '‚ùóÔ∏è|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1 –∂–∏–∑–Ω—å.\n'
                            for idss in game['players']:
                                target = game['players'][idss]
                                if target['team'] != player['team']:
                                    if target['weapon'].lvl == 4 and target['weapon'].modification == 2 and target['weapon'].name == '–ù–æ–∂':
                                        target['hp'] += 1
                                        if target['hp'] > target['maxhp']:
                                            target['hp'] = target['maxhp']
                                        game['text'] += 'üßõüèª|–ù–æ–∂ ' + target['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –µ–º—É 1 –∂–∏–∑–Ω—å.\n'

                    if 'skeletonking' in player['skills']:
                        for i in range(1):
                            skeletonuser = newskeletonuser(game)
                            skeleton = createplayer(skeletonuser, photo=None)
                            for ids in skeleton:
                                x = ids
                                break
                            number = 1
                            for idss in game['players']:
                                if '–°–∫–µ–ª–µ—Ç' in game['players'][idss]['name'] and game['players'][idss][
                                    'controller'] == 'bot':
                                    number += 1
                            number += len(skeletons)
                            skeleton[x]['name'] = '–°–∫–µ–ª–µ—Ç ' + str(number) + '|üíÄ' 
                            skeleton[x]['team'] = player['team']
                            skeleton[x]['controller'] = 'bot'
                            skeleton[x]['weapon'] = weaponlist.Sword()
                            skeleton[x]['hp'] = 1
                            skeleton[x]['maxhp'] = 1
                            for idss in game['players']: 
                                skeleton[x]['nearplayers'].append(game['players'][idss]['id'])
                                game['players'][idss]['nearplayers'].append(skeleton[x]['id'])
                            skeletons.append(skeleton) 
                            game['text'] += 'üíÄ|' + player['name'] + ' –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Å–∫–µ–ª–µ—Ç–∞!\n'

                    if 'berserk' in player['skills'] or 'berserk?1' in player['skills'] or 'berserk?2' in player[
                        'skills'] or 'berserk?3' in player['skills']:
                        maxen = 9
                        if 'protivogaz' in player['skills']:
                            maxen += 1
                        if player['maxenergy'] < maxen:
                            player['maxenergy'] += hp
                        actualenergy = regen_energy(game, player, hp)
                        if 'alex_berserk' in player['customtexts'] and player['customtexts']['alex_berserk']:
                            game['text'] += 'üëø|–†–∞–∑—É–º –ê—Ä—Ö–∏–¥–µ–º–æ–Ω–∞ '+player['name']+' —Ä–∞–∑—Ä—É—à–∞–µ—Ç—Å—è! –ü–æ–ª—É—á–∞–µ—Ç '+str(actualenergy)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        elif 'tuman_berserk' in player['customtexts'] and player['customtexts']['tuman_berserk']:
                            game['text'] += '‚óºÔ∏è|' +player['name']+ ' –≥–æ—Ä–∏—Ç —á—ë—Ä–Ω—ã–º –ø–ª–∞–º–µ–Ω–µ–º! –ü–æ–ª—É—á–∞–µ—Ç '+str(actualenergy)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        else:
                            game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(actualenergy)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        player['maxenergy'] += hp
                        if player['maxenergy'] > maxen:
                            player['maxenergy'] = maxen 
                        if player['hp'] == 1:
                            if 'alex_berserk' in player['customtexts'] and player['customtexts']['alex_berserk']:
                                game['text'] += 'üëø|–†–∞–∑—É–º –ê—Ä—Ö–∏–¥–µ–º–æ–Ω–∞ '+player['name']+' —Ä–∞–∑—Ä—É—à–µ–Ω! –ê—Ä—Ö–∏–¥–µ–º–æ–Ω –≤–ø–∞–¥–∞–µ—Ç –≤ –±–µ–∑—É–º–∏–µ!\n'
                            elif 'tuman_berserk' in player['customtexts'] and player['customtexts']['tuman_berserk']:
                                game['text'] += 'üñ§|' +player['name']+ ' –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç —á–µ—Ä–Ω—ã–º –æ–≥–Ω–µ–º, –∏ –æ–±—Ä–µ—Ç–∞–µ—Ç –ò—Å—Ç–∏–Ω–Ω—É—é —Ñ–æ—Ä–º—É!\n'
                            else:
                                game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –≤—Ö–æ–¥–∏—Ç –≤ –±–æ–µ–≤–æ–π —Ç—Ä–∞–Ω—Å!\n'
                    if player['weapon'].name == '–†–æ–≥':
                        if player['hp'] < player['maxhp'] / 2 and not player['madness']:
                            player['madness'] = True 
                            player['energy'] += len(game['players']) - 1
                            player['maxenergy'] += len(game['players']) - 1
                            player['weapon'].dmgbonus += len(game['players']) - 1 
                            game['text'] += '‚ùóÔ∏è|' + player['name'] + ' –≤ —è—Ä–æ—Å—Ç–∏!\n' 
                else:
                    if not player['dead']:
                        game['text'] += '‚ù£Ô∏è|' + player['name'] + ' –∏—Å—Ç–µ–∫–∞–µ—Ç –∫—Ä–æ–≤—å—é! (' + str(player['blood']) + ')\n'

            player['dark_counter'] += player['dark_counter_set']
            player['dark_counter_set'] = 0

            if player['need_to_doom']:
                #player['doomedskills'] = player['skills']
                player['doomedinventory'] = player['inventory']
                #player['skills'] = []
                player['inventory'] = []
                player['need_to_doom'] = False

            deldooms = []
            if not player['dead']:
                for idss in player['bigdooms']:
                    idss[1] -= 1
                    target = game['players'][idss[0]]
                    if idss[1] < 2:
                        takedamage(game, target, player, 1)
                        game['text'] += '‚ù§Ô∏è‚Äçüî•|' + player['name'] + ' –≥–æ—Ä–∏—Ç —Å–∏–Ω–∏–º –ø–ª–∞–º–µ–Ω–µ–º! –ü–æ–ª—É—á–∞–µ—Ç 1 —É—Ä–æ–Ω–∞.\n'
                    if idss[1] <= 0:
                        if len(player['doomedskills']) > 0:
                            player['skills'] = player['doomedskills']
                            player['doomedskills'] = []
                            player['inventory'] = player['doomedinventory']
                            player['doomedinventory'] = []
                        deldooms.append(idss)
                        game['text'] += 'üí®|' + player['name'] + ' –∏–∑–±–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç –ø—Ä–æ–∫–ª—è—Ç–∏—è.\n'
            for idss in deldooms:
                player['bigdooms'].remove(idss)

            if player['dark_counter'] >= 5:
                if not player['dead']:
                    if game['dungeon']:
                        game['text'] += 'üíÄ|' + player[
                            'name'] + ' —Å–ª–∏—à–∫–æ–º –Ω–∞–ø—É–≥–∞–Ω, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–æ—Ö–æ–¥. –û–Ω –∫–æ–Ω—á–∞–µ—Ç –∂–∏–∑–Ω—å —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ–º.\n'
                    else:
                        game['text'] += 'üíÄ|' + player[
                            'name'] + ' —Å–ª–∏—à–∫–æ–º –Ω–∞–ø—É–≥–∞–Ω, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±–æ–π. –û–Ω –∫–æ–Ω—á–∞–µ—Ç –∂–∏–∑–Ω—å —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ–º.\n'
                    player['dead'] = True

            if player['team'] == 'dark' and '–¢–µ–Ω—å –∫—Ä—ã—Å—ã' in player['name'] and player['controller'] == 'bot':
                if player['hp'] > 0:
                    if player['cant_die']:
                        player['cant_die'] = False
                        game['text'] += '‚ù§Ô∏è|' + player['name'] + ' –æ–±—Ä–µ—Ç–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ—á–µ—Ä—Ç–∞–Ω–∏—è!\n'
                        player['name'] = '–ö—Ä—ã—Å–∞|üê≠'
                        player['weapon'] = random.choice(npcweapons)()
                        player['hp'] = 2

            cursedel = []
            for idss in player['curses']:
                idss[1] -= 1
                if idss[1] == 0:
                    cursedel.append(idss)
                    if idss[0] == 'stun':
                        if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                    game['text'] += 'üëÅÔ∏è‚ùóÔ∏è|–†–∞–∑—É–º ' + player['name'] + ' —Å‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–±“à‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–∏‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–≤‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–∞‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–µ“â“á‚Äå‚Äå‚Äå‚Äå‚Äå—Ç“à‚Äå‚Äå‚Äå‚Äå‚Äå—Å“â“á‚Äå‚Äå‚Äå‚Äå‚Äå—è‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå –≤ –≤–æ–¥–æ–≤–æ—Ä–æ—Ç–µ —Ç‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå–º“â‚Äå‚Äå–Ω‚Äå‚Äå‚Äå—ã“à‚Äå‚Äå—Ö‚Äå‚Äå‚Äå –º‚Äå‚Äå‚Äå—ã‚Äå‚Äå‚Äå—Å“à‚Äå‚Äå–ª‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå–π‚Äå‚Äå‚Äån'
                        else:
                                    game['text'] += 'üå©|–ì–Ω–µ–≤ –Ω–µ–±–µ—Å –æ–±—Ä—É—à–∏–≤–∞–µ—Ç—Å—è –Ω–∞ ' + player['name'] + ' –≤ –≤–∏–¥–µ –º–æ–ª–Ω–∏–∏!\n'
                        game['text'] += 'üåÄ|' + player['name'] + ' –æ–≥–ª—É—à–µ–Ω!\n'
                        if player['stun'] <= 0:
                            player['stun'] = 1
                        else:
                            player['stun'] += 1
                else:
                    if idss[0] == 'stun':
                        if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                    game['text'] += 'üëÅÔ∏è|' + player['name'] + ' –¢‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå—Ä‚Äå‚Äå—è“à‚Äå–µ‚Äå—Ç“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå –∫‚Äå‚Äå‚Äå–æ“à‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–Ω‚Äå‚Äå—Ç‚Äå—Ä–æ“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–ª‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå—å‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå... (' + str(idss[1]) + ')\n'
                        else:
                                    game['text'] += '‚òÅÔ∏è|–ù–∞–¥ ' + player['name'] + ' —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Ç—É—á–∏. (' + str(idss[1]) + ')\n'
            for idss in cursedel:
                player['curses'].remove(idss)

            frozendel = []
            for idss in player['frozen_buttons']:
                idss[1] -= 1
                if idss[1] == 0:
                    frozendel.append(idss)
            for idss in frozendel:
                player['frozen_buttons'].remove(idss)

            if player['suicide'] and not player['dead']:
                if game['testequipgame']:
                    game['text'] += 'üîö|' + player['name'] + ' –ø–æ–∫–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª–∏–≥–æ–Ω.\n'
                elif 'probel_suicide' in player['customtexts'] and player['customtexts']['probel_suicide']:
                    game['text'] += '‚ö∞Ô∏è|' + player['name'] + ' —É—Å—Ç–∞–ª —Å—Ä–∞–∂–∞—Ç—å—Å—è –∏ –ª–µ–≥ –≤ –≥—Ä–æ–±.\n'
                else:
                    game['text'] += '‚ò†Ô∏è|' + player['name'] + ' –∫–æ–Ω—á–∞–µ—Ç –∂–∏–∑–Ω—å —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ–º.\n'
                for ids in player['ritualists']:
                    game['players'][ids[0]]['ritual_ability'] = True
                player['dead'] = True
                player['dead_from_scare'] = True

            if player['meditation'] != None and player['act'] == None:
                if player['meditation'] == 'regen':
                    if len(player['incomingdmgs']) > 0:
                        player['hp'] += 2
                        game['text'] += 'üí™|–ú–µ–¥–∏—Ç–∞—Ü–∏—è —Å—Ç–æ–π–∫–æ—Å—Ç–∏ ' + player['name'] + ' –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!\n'
                        game['text'] += '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ' + str(
                            2) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(player['hp']) + ' —Ö–ø.\n'
                    else:
                        game['text'] += 'üí™|–ú–µ–¥–∏—Ç–∞—Ü–∏—è —Å—Ç–æ–π–∫–æ—Å—Ç–∏ ' + player['name'] + ' –ø—Ä–æ–≤–∞–ª–µ–Ω–∞, —É—Ä–æ–Ω –Ω–µ –±—ã–ª –ø–æ–ª—É—á–µ–Ω.\n'
                if player['meditation'] == 'strike':
                    if len(player['incomingdmgs']) == 0:
                        target = game['players'][player['meditationtarget']]
                        target['hp'] -= 1
                        game['text'] += 'üëÅ|–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ ' + player['name'] + ' –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! ' + player[
                            'name'] + ' –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ ' + target['name'] + ' –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ –∞—Ç–∞–∫—É–µ—Ç –µ–≥–æ!\n'
                        game['text'] += '‚ô•Ô∏è' * target['hp'] + '|' + target['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                            1) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(target['hp']) + ' —Ö–ø.\n'
                    else:
                        game['text'] += 'üëÅ|–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ ' + player['name'] + ' –ø—Ä–æ–≤–∞–ª–µ–Ω–∞, —É—Ä–æ–Ω –±—ã–ª –ø–æ–ª—É—á–µ–Ω.\n'

                player['meditation'] = None
                player['meditationtarget'] = None
            if player['domeditation']:
                try:
                    target = game['players'][player['meditationtarget']]
                except:
                    target = 'self'
                player['meditationcd'] = 5
                if target != 'self':
                    # player['meditationtarget'] = target['id']
                    player['meditation'] = 'strike'
                else:
                    player['meditation'] = 'regen'
                game['text'] += 'üí§|' + player['name'] + ' –º–µ–¥–∏—Ç–∏—Ä—É–µ—Ç.\n'

        for ids in illusions:
            game['players'].update(ids)

        for ids in game['players']:
            player = game['players'][ids]
            if player['demonshield']:
                targets = []
                dmg = 0
                for idss in player['incomingdmgs']:
                    target = game['players'][idss[0]]
                    targets.append(target)
                    dmg += idss[1]
                if player['darkdemon_strenght'] >= 80 and len(targets) > 0:
                    target = random.choice(targets)
                    takedamage(game, player, target, dmg)
                    game['text'] += "üî∫|"+player['name']+' –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ª—É—á —Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏ –≤ '+target['name']+", –Ω–∞–Ω–æ—Å—è "+str(dmg)+" —É—Ä–æ–Ω–∞.\n"
                player['incomingdmgs'] = []

        if not game['castlefight'] and not game['neuralfight']:
            if game['text'] != '–≠—Ñ—Ñ–µ–∫—Ç—ã ' + str(game['turn'] - 1) + ':\n':
                if not game['cwbar']:
                    tries = 0
                    while True:
                        try:
                            sendm(bot, game['id'], game['text'])
                            break
                        except:
                            tries += 1
                            if tries > 100:
                                del games[game['id']]
                                return
                            time.sleep(3)
                for ids in game['players']:
                    player = game['players'][ids]
                    if player['id'] != game['id']:
                        try:
                            sendm(bot, player['id'], game['text'])
                        except:
                            pass
                for ids in game['spectators']:
                    if ids not in game['players']:
                        try:
                            for idss in game['players']:
                                xx = game['players'][idss]
                                break
                            sendm(bot, ids, '[' + xx['name'] + ']\n' + game['text'])
                        except:
                            pass
                time.sleep(1)
        else:
            if not game['neuralfight']:
                alltext = game['text'].split('\n')
                for ids in game['players']:
                    player = game['players'][ids]
                    for idss in alltext:
                        if player['name'] + ' ' in idss or player['name'] + '.' in idss or player['name'] + ',' in idss or \
                                player['name'] + '!' in idss:
                            try:
                                player['castlefighttexts'].append(idss)
                            except:
                                pass
                allcastlesbattletext[game['id']].append(game['text'])

        game['text'] = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö–æ–¥–∞ ' + str(game['turn'] - 1) + ':\n'
        game['flashed'] = []
        light_strikesdel = []
        for idss in game['light_strikes']:
            idss[1] -= 1
            if idss[1] <= 0:
                armortexts = ''
                for idsss in game['players']:
                    player = game['players'][idsss]
                    if not player['dead']:
                        showdmg, armortext = takedamage(game, player, player, 5)
                        armortexts += armortext

                game[
                    'text'] += '‚ö†Ô∏è|' + '–ü–æ–ª–µ –±–æ—è –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—ç–ª–µ–∫—Ç—Ä–∏–∑–æ–≤–∞–ª–æ—Å—å, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —ç–ª–µ–∫—Ç—Ä–æ–≤–∑—Ä—ã–≤! –í—Å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –ø–æ–ª—É—á–∞—é—Ç 5 —É—Ä–æ–Ω–∞.\n'
                game['text'] += armortexts
                light_strikesdel.append(idss)
            else:
                game['text'] += '‚ö†Ô∏è|' + '–ü–æ–ª–µ –±–æ—è —ç–ª–µ–∫—Ç—Ä–∏–∑—É–µ—Ç—Å—è (' + str(idss[1]) + ')\n'
                # player['batsdamages'].append(idss[0])
        for idss in light_strikesdel:
            game['light_strikes'].remove(idss)

        for ids in game['players']:
            player = game['players'][ids]
            player['nextturndamage'] = 0

        for ids in game['players']:
            player = game['players'][ids]
            if 'demonlord' in player['skills']:
                hellcharges = 0
                charge = True
                if player['act'] != None:
                    if player['act'][0] == 'hellfire':
                        charge = False
                if charge:
                    for ids in player['outgoingdmgs']:
                        hellcharges += 1
                    if hellcharges > 0:
                        player['hellfirecharges'] += hellcharges
                        game['text'] += '‚ô®Ô∏è|' + player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –∑–∞—Ä—è–¥—ã –∞–¥—Å–∫–æ–≥–æ –ø–ª–∞–º–µ–Ω–∏ (' + str(
                            hellcharges) + ')!\n'
            cdtext = ''
            bonusreload = 0
            if 'dark_energy' in player['skills']:
                for idss in game['players']: 
                    if game['players'][idss]['dark_counter'] > 0:
                        bonusreload += 1
            player['peregrev'] += player['addperegrev']
            player['addperegrev'] = 0
            player['perekatcd'] -= (1 + bonusreload)

            player['shieldgencd'] -= (1 + bonusreload)
            if player['shieldgencd'] > 0 and (
                    'shieldgen' in player['skills'] or 'shieldgen?1' in player['skills'] or 'shieldgen?2' in player[
                'skills'] or 'shieldgen?3' in player['skills']):
                cdtext += '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —â–∏—Ç–æ–≤ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['shieldgencd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['hypnotistcd'] -= (1 + bonusreload)
            if player['hypnotistcd'] > 0 and 'hypnotist' in player['skills']:
                cdtext += '–ì–∏–ø–Ω–æ–∑ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['hypnotistcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['sokrusheniecd'] -= (1 + bonusreload)
            player['visorcd'] -= (1 + bonusreload)
            if player['visorcd'] > 0 and 'visor' in player['skills']:
                cdtext += '–í–∏–∑–æ—Ä –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['visorcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['shield'] = False
            player['act'] = None
            player['dopuseditems'] = []
            wasenergy = False
            if player['energy'] > 0:
                wasenergy = True
            player['energy'] -= player['lostenergy']
            if player['energy'] <= 0 and wasenergy:
                if player['policestun']:
                    if player['stun'] > 0:
                        player['stun'] += 1
                    else:
                        player['stun'] = 2
                    game['text'] += 'üåÄ|' + player['name'] + ' –æ–≥–ª—É—à–µ–Ω –ø–æ–ª–∏—Ü–µ–π—Å–∫–æ–π –¥—É–±–∏–Ω–∫–æ–π!\n'
            player['policestun'] = False
            player['lostenergy'] = 0
            player['sokrushenie'] = False
            player['waszero'] = False
            player['chaincd'] -= (1 + bonusreload)
            player['chain'] = False
            player['strongshot'] = False
            player['providets'] = False
            player['narsilcd'] -= (1 + bonusreload)
            player['narsil'] = False
            player['pyrodamage'] = False
            player['who_steal'] = []
            player['wasarmor_from_hitin'] = False
            player['vor'] = False
            player['doomcd'] -= (1+bonusreload)
            if player['set_first_hit']:
                player['first_hit'] = True
                player['set_first_hit'] = False
            player['weaponshield'] = False
            player['dark_energycd'] -= 1
            if player['dark_energycd'] > 0 and 'dark_energy' in player['skills']:
                cdtext += '–≠–Ω–µ—Ä–≥–∏—è —Ç—å–º—ã –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['dark_energycd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['vorcd'] -= (1 + bonusreload)
            if player['vorcd'] > 0 and ('vor' in player['skills'] or 'vor?1' in player['skills'] or 'vor?2' in player[
                'skills'] or 'vor?3' in player['skills']):
                cdtext += '–í–æ—Ä –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['vorcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['bombercd'] -= (1 + bonusreload)
            if player['bombercd'] > 0 and 'bomber' in player['skills']:
                cdtext += '–ú–∏–Ω—ë—Ä –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['bombercd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['bicepc'] = False
            player['bicepccd'] -= (1 + bonusreload)
            if player['bicepccd'] > 0 and 'bicepc' in player['skills']:
                cdtext += '–ë–∏—Ü–µ–ø—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['bicepccd']) + ' —Ö–æ–¥–æ–≤.\n'

            player['spearcd'] -= (1 + bonusreload)
            player['who_attacked'] = []
            player['navodcd'] -= (1 + bonusreload)
            if player['navodcd'] > 0 and 'navod' in player['skills']:
                cdtext += '–ù–∞–≤–æ–¥—á–∏–∫ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['navodcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['changeweaponcd'] -= 1
            player['execution'] = False
            player['incvizitorcd'] -= (1 + bonusreload)
            if player['incvizitorcd'] > 0 and (
                    'incvizitor' in player['skills'] or 'incvizitor?1' in player['skills'] or 'incvizitor?2' in player[
                'skills'] or 'incvizitor?3' in player['skills']):
                cdtext += '–ò–Ω–∫–≤–∏–∑–∏—Ç–æ—Ä –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['incvizitorcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['meditationcd'] -= (1 + bonusreload)
            player['energy_blowcd'] -= 1
            player['tentaclescd'] -= 1
            player['demon_transformcd'] -= 1
            player['rhino_eliminatecd'] -= 1
            player['mind_controlcd'] -= 1
            if player['meditationcd'] > 0 and 'monk' in player['skills']:
                cdtext += '–ú–æ–Ω–∞—Ö –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['meditationcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['invokercd'] -= (1 + bonusreload)
            if player['invokercd'] > 0 and 'invoker' in player['skills']:
                cdtext += '–ó–∞–∫–ª–∏–Ω–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['invokercd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['energydraincd'] -= (1 + bonusreload)
            if player['energydraincd'] > 0 and player['demonlordform']:
                cdtext += '–í—ã–ø–∏–≤–∞–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['energydraincd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['inzhenercd'] -= (1 + bonusreload)
            if player['inzhenercd'] > 0 and (
                    'inzhener' in player['skills'] or 'inzhener?1' in player['skills'] or 'inzhener?2' in player[
                'skills'] or 'inzhener?3' in player['skills']):
                cdtext += '–ò–Ω–∂–µ–Ω–µ—Ä –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['inzhenercd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['domeditation'] = False
            player['parrycd'] -= (1 + bonusreload)
            lb = False
            if player['luciferbladecd'] > 0:
                lb = True
            player['luciferbladecd'] -= (1 + bonusreload)
            if player['luciferbladecd'] <= 0 and lb:
                game['text'] += 'üî•|–ö–ª–∏–Ω–æ–∫ –õ—é—Ü–∏—Ñ–µ—Ä–∞ –≤–æ—Å–ø–ª–∞–º–µ–Ω–∏–ª—Å—è!\n'
            player['madpotion'] = False
            player['firearrow'] = False
            player['hitdown'] = False
            player['firearrowcd'] -= (1 + bonusreload)
            player['washitin'] = False
            player['obrezcd'] -= 1
            player['wasarmor_from_armorskill'] = False
            player['wasarmor_from_selfarmor'] = False
            player['wasarmor_from_cherep'] = False
            player['dopblock'] = 0
            player['who_fireds'] = []
            player['saberblock'] = None
            player['clawscd'] -= 1
            if player['weapon'].name == '–ë—É–ª–∞–≤–∞' and player['weapon'].lvl == 4 and player['weapon'].modification == 1 and game['turn']%3 == 0:
                player['weapon'].dmgbonus += 1
                game['text'] += '‚ûï|–ë–æ–Ω—É—Å –∫ —É—Ä–æ–Ω—É —É –±—É–ª–∞–≤—ã '+player['name']+' –≤—ã—Ä–æ—Å –Ω–∞ 1.\n'
            player['burrowcd'] -= (1+bonusreload)
            player['burrowstrike'] = False
            player['demoncd'] -= (1 + bonusreload)
            player['chargecd'] -= (1 + bonusreload)
            player['shestcd'] -= (1 + bonusreload)
            player['light_aspect'] -= (1 + bonusreload)
            player['priestcd'] -= (1 + bonusreload)
            player['doublemadpotion'] = False
            player['necrostaffabilitycd'] -= (1)
            player['EXPLOSIONcd'] -= (1 + bonusreload)
            player['magic_strong_shield'] = False
            player['demonshield'] = False
            player['demonshieldcd'] -= (1+bonusreload)
            player['demondestroycd'] -= (1+bonusreload)
            player['lucifer_hellfire'] -= 1
            player['lucifer_hellfirecd'] -= (1+bonusreload)
            player["wing_attackcd"] -= 1
            player['hypnodebuff'] = 0
            if player['is_necromant']:
                player['stun'] = 0
            if player['priestcd'] > 0 and 'priest' in player['skills']:
                cdtext += '–°–≤—è—â–µ–Ω–Ω–∏–∫ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['priestcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['multicastcd'] -= 1
            if player['chargecd'] > 0 and 'charge' in player['skills']:
                cdtext += '–†—ã–≤–æ–∫ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['chargecd']) + ' —Ö–æ–¥–æ–≤.\n'
                
            if ('alchemist' in player['skills'] or 'alchemist?1' in player['skills'] or 'alchemist?2' in player[
                'skills'] or 'alchemist?3' in player['skills']):
            
                player['madpotioncd'] -= (1 + bonusreload)
            
                if player['madpotioncd'] <= 0:
                    if game['dungeon']:
                        if 'madpotion' not in player['inventory']:
                            player['inventory'].append('madpotion')
                    else:
                        player['inventory'].append('madpotion')
                    if 'alchemist?3' in player['skills']:
                        player['madpotioncd'] = 6
                        cdtext += '–°—ã–≤–æ—Ä–æ—Ç–∫–∞ –±–µ—à–µ–Ω—Å—Ç–≤–∞ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['madpotioncd']) + ' —Ö–æ–¥–æ–≤.\n'
                    elif 'alchemist?2' in player['skills']:
                        player['madpotioncd'] = 8
                        cdtext += '–°—ã–≤–æ—Ä–æ—Ç–∫–∞ –±–µ—à–µ–Ω—Å—Ç–≤–∞ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['madpotioncd']) + ' —Ö–æ–¥–æ–≤.\n'
                    elif 'alchemist?1' in player['skills']:
                        player['madpotioncd'] = 10
                        cdtext += '–°—ã–≤–æ—Ä–æ—Ç–∫–∞ –±–µ—à–µ–Ω—Å—Ç–≤–∞ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['madpotioncd']) + ' —Ö–æ–¥–æ–≤.\n'
                    else:
                        player['madpotioncd'] = 9
                        cdtext += '–°—ã–≤–æ—Ä–æ—Ç–∫–∞ –±–µ—à–µ–Ω—Å—Ç–≤–∞ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['madpotioncd']) + ' —Ö–æ–¥–æ–≤.\n'

                    

            player['truestrike'] = False
            player['molotcd'] -= (1 + bonusreload)
            player['charge'] = False
            player['attackedthisturn'] = False
            if player['demoncd'] > 0 and 'demon' in player['skills']:
                cdtext += 'Bloodseeker –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['demoncd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['skeletonfirecd'] -= (1 + bonusreload)
            if player['skeletonfirecd'] > 0 and 'skeletonking' in player['skills']:
                cdtext += '–ê–¥—Å–∫–∏–π –æ–≥–æ–Ω—å –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['skeletonfirecd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['minercd'] -= (1 + bonusreload)
            if player['minercd'] > 0 and 'miner' in player['skills']:
                cdtext += '–ú–∏–Ω–∞ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['minercd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['illusioncd'] -= (1 + bonusreload)
            if player['illusioncd'] > 0 and 'illusionist' in player['skills']:
                cdtext += '–ò–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['illusioncd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['bat'] = False
            player['batcd'] -= (1 + bonusreload)
            if player['batcd'] > 0 and 'vampire' in player['skills']:
                cdtext += '–õ–µ—Ç—É—á–∞—è –º—ã—à—å –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ ' + str(player['batcd']) + ' —Ö–æ–¥–æ–≤.\n'
            player['illusionturns'] -= (1 + bonusreload)
            if player['illusionturns'] == 0:
                player['illusion'] = False
                game['text'] += 'üí®|–ò–ª–ª—é–∑–∏—è ' + player['name'] + ' –∏—Å–ø–∞—Ä–∏–ª–∞—Å—å!\n'
                game['players'][0 - player['id']]['fireticks'] = -1
            if player['watershield'] > 0:
                actualenergy = regen_energy(game, player, 2)
                game['text'] += 'üîã|' + player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(actualenergy) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n'

            player['watershield'] -= 1
            if player['watershield'] == 0:
                game['text'] += 'üí®|–í–æ–¥—è–Ω–æ–π —â–∏—Ç ' + player['name'] + ' –∏—Å–ø–∞—Ä–∏–ª—Å—è!\n'
            player['watershieldcd'] -= (1 + bonusreload)

            if game['testequipgame']:
                teamlist = []
                if player['controller'] == 'bot' and player['team'] != 'dummys':
                    for idss in game['players']: 
                        target = game['players'][idss]
                        if target['team'] not in teamlist and not target['dead'] and target['controller'] != 'bot':
                            teamlist.append(target['team'])
                    if len(teamlist) == 0:
                        player['dead'] = True
                        game['text'] += 'üîö|' + player['name'] + ' –ø–æ–∫–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª–∏–≥–æ–Ω.\n'

            player['createillusion'] = False
            player['demonform'] = False
            player['cuts'] += player['addcuts']
            player['addcuts'] = 0
            player['turnelements'] = getturnelements()
            player['selectedelements'] = []
            if not game['castlefight'] and not game['neuralfight']:
                if cdtext != '':
                    if player['controller'] == 'player':
                        try:
                            sendm(bot, player['id'], cdtext)
                        except:
                            pass
            if not player['lastcharge']:
                player['bowcharge'] = 0
            player['lastcharge'] = False
            rm = []
            for ids in player['ritualists']:
                ids[1] -= 1
                if ids[1] <= 0:
                    rm.append(ids)
            for ids in rm:
                player['ritualists'].remove(ids)
            if player['act'] != None:
                player['afkcount'] = 0
            if player['lostweapon']:
                player['droppedweapon'] = player['weapon']
                if game['classic_game']:
                    player['weapon'] = weaponlist.Fist_classic()
                else:
                    player['weapon'] = weaponlist.Fist()

            player['lostweapon'] = False
            dzetdel = []
            hitindel = []
            for idss in player['dzets']:
                player['dzets'][idss] -= 1
                if player['dzets'][idss] <= 0 and not player['dead']:
                    actualenergy = set_energy(game, player, player['maxenergy'])
                    # if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫':
                    #    game['text'] += 'üß∞|'+player['name'] + ' –∑–∞—Ä—è–∂–∞–µ—Ç 1 –ø–∞—Ç—Ä–æ–Ω –≤ –¥—Ä–æ–±–æ–≤–∏–∫.\n'

                    if actualenergy < player['maxenergy']:
                        game['text'] += 'üíâ|–≠–Ω–µ—Ä–≥–∏—è ' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! (' + str(
                            actualenergy) + '/' + str(player['maxenergy']) + ')\n'
                    else:
                        game['text'] += 'üíâ|–≠–Ω–µ—Ä–≥–∏—è ' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π! (' + str(
                            player['maxenergy']) + ')\n'
                    dzetdel.append(idss)
                    if player['weapon'].name == '–î—Ä–æ–±–æ–≤–∏–∫': 
                        if player['drobovik_charges'] < 2:
                            player['drobovik_charges'] += 1

            for idss in player['hitins']:
                player['hitins'][idss] -= 1
                if player['hitins'][idss] <= 0 and not player['dead']: 
                    game['text'] += 'üåÄ|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç —Ö–∏—Ç–∏–Ω–∞. –ò–≥—Ä–æ–∫ –æ–≥–ª—É—à–µ–Ω!\n'
                    if player['stun'] <= 0:
                        player['stun'] = 1
                    else:
                        player['stun'] += 1
                    hitindel.append(idss)

            for idss in dzetdel:
                del player['dzets'][idss]
            for idss in hitindel:
                del player['hitins'][idss]
            
            
            if player['infected'] and not player['dead']:
                player['energy'] -= 2
                if player['energy'] < 0:
                    player['energy'] = 0
                game['text'] += 'ü¶†|' + player['name'] + ' –æ—Ç—Ä–∞–≤–ª–µ–Ω! (-2‚ö°Ô∏è)\n'

            recoverydebuffdel = []
            for idss in player['recoverydebuff']:
                idss[1] -= 1
                if idss[1] <= 0:
                    # game['text'] += 'üéã|'+player['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(dmg)+' —É—Ä–æ–Ω–∞ –æ—Ç –∫–æ—Ä–Ω–µ–π!\n'
                    recoverydebuffdel.append(idss) \
                    # player['batsdamages'].append(idss[0])
            for idss in recoverydebuffdel:
                player['recoverydebuff'].remove(idss)

            infected_weapondel = []
            for idss in player['infected_weapon']:
                idss[1] -= 1
                if idss[1] <= 0:
                    # game['text'] += 'üéã|'+player['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(dmg)+' —É—Ä–æ–Ω–∞ –æ—Ç –∫–æ—Ä–Ω–µ–π!\n'
                    infected_weapondel.append(idss)
                    # player['batsdamages'].append(idss[0])
            for idss in infected_weapondel:
                player['infected_weapon'].remove(idss)

            player['seetext'] = '–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ (–ê–§–ö)!'
            player['pyrodamage'] = False
            player['adrenaline'] = False
            if player['is_necromant']:
                player['stun'] = 0
            if player['energy'] > player['maxenergy']:
                player['energy'] = player['maxenergy']
                game['text'] += 'üí®|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç –∏–∑–ª–∏—à–µ–∫ —ç–Ω–µ—Ä–≥–∏–∏.\n'
            if player['energy'] < 0:
                player['energy'] = 0
            if player['zombie'] != False:
                player['zombie'] -= 1
                if player['zombie'] <= 0:
                    player['zombie'] = False
                    deadplayer(game, player, [], skeletons)
            outgoingdmg = 0
            incomingdmg_hp = 0
            incomingdmg = 0
            enemys_sadist = []
            for idss in player['incomingdmgs']:
                target = game['players'][idss[0]]
                targetincoming = 0
                targetoutgoing = 0
                for idsss in target['outgoingdmgs']:
                    targetoutgoing += idsss[1]
                for idsss in target['incomingdmgs']:
                    targetincoming += idsss[1]
                if (targetoutgoing >= targetincoming or target['team'] == player['team']) and targetoutgoing > 0:
                    incomingdmg_hp += idss[1]
                    if game['castlefight']:
                        maxdmgtohp = 0
                        maxhp = player['hp']
                        while maxhp >0:
                            maxdmgtohp += player['dmglimit']
                            maxhp -= 1
                        dodmginhp = idss[1]
                        if dodmginhp > maxdmgtohp:
                            dodmginhp = maxdmgtohp
                        target['do_damage_in_hp'] += dodmginhp
                    if target['id'] not in enemys_sadist:
                        enemys_sadist.append(target['id'])
                incomingdmg += idss[1]
            for idss in player['outgoingdmgs']: 
                outgoingdmg += idss[1]
            ############################## CLASSIC ###################################
            if game['classic_game']:
                teams_damage = {}
                for idss in game['players']:
                    testtarget = game['players'][idss]
                    incomingtestdmg = 0
                    for idsss in testtarget['incomingdmgs']:
                        incomingtestdmg += idsss[1]

                    if testtarget['team'] not in teams_damage:
                        teams_damage.update({testtarget['team']:{'takendmg':incomingtestdmg}})
                    else:
                        teams_damage[testtarget['team']]['takendmg'] += incomingtestdmg
                most_damage = -100000
                for idss in teams_damage:
                    if teams_damage[idss]['takendmg'] > most_damage:
                        most_damage = teams_damage[idss]['takendmg']
                if teams_damage[player['team']]['takendmg'] < most_damage:
                    incomingdmg_hp = 0
            # print(player['name'])
            # print(incomingdmg_hp)
            # logtext = player['name']+':\nincomingdmg_hp='+str(incomingdmg_hp)+'\n'+'incomingdmg:'+str(incomingdmg)
            # global logs
            # sendm(bot, logs, logtext)
            # print('\n')
            #  if 'demon' in player['skills'] and len(player['outgoingdmgs']) == 0 and not player['demon'] and not player['dead']:
            #   incomingdmg_hp += 3
            #  game['text'] += 'üëπüî•|Bloodseeker '+player['name']+' –≥–æ—Ä–∏—Ç –≤–µ—á–Ω—ã–º –ø–ª–∞–º–µ–Ω–µ–º –∏ –ø–æ–ª—É—á–∞–µ—Ç 3 —É—Ä–æ–Ω–∞!\n'
            #  game['text'] += '‚ô•Ô∏è'*player['hp']+'|'+player['name']+' —Ç–µ—Ä—è–µ—Ç '+str(1)+' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è '+str(player['hp'])+' —Ö–ø.\n'
            #  if 'berserk' in player['skills']:
            #       game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(1)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
            #     player['energy'] += 1
            #      player['maxenergy'] += 1
            #      if player['hp'] == 1:
            #           game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –≤—Ö–æ–¥–∏—Ç –≤ –±–æ–µ–≤–æ–π —Ç—Ä–∞–Ω—Å!\n'
            player['demon'] = False
            if player['summon_treant'] > 0:
                for i in range(player['summon_treant']):
                    treant = summon_treant(game, player, treants)
                    treants.append(treant)
                player['summon_treant'] = 0
            if player['summon_mad_skeletons'] > 0:
                for i in range(player['summon_mad_skeletons']):
                    madskele = summon_mad_skeleton(game, player, len(madskeles))
                    madskeles.append(madskele)
                player['summon_mad_skeletons'] = 0
            if player['summon_weak_skeletons'] > 0:
                for i in range(player['summon_weak_skeletons']):
                    weakskele = summon_dung_skeleton(game, weakskeles, hp=1, team=player['team'])
                    weakskeles.append(weakskele)
                player['summon_weak_skeletons'] = 0
            if player['summon_weak_ghouls'] > 0:
                for i in range(player['summon_weak_ghouls']):
                    weakghoul = summon_ghoul(game, len(weakghouls), hp=6, energy=5, team=player['team'], dmglimit=4)
                    weakghouls.append(weakghoul)
                player['summon_weak_ghouls'] = 0
            if player['summon_zombie_rats'] > 0: 
                for i in range(player['summon_zombie_rats']):
                    zombierat = summon_zombierat(game, len(zombierats), team=player['team'])
                    zombierats.append(zombierat)
                player['summon_zombie_rats'] = 0
            if player['summon_necrofighter'] != None:
                if player['summon_necrofighter'] == 'ghoul':
                    necrofighter = summon_ghoul(game, len(necrofighters), team=player['team'], full_control=True,
                                                player=player) 
                if player['summon_necrofighter'] == 'rat':
                    necrofighter = summon_zombierat(game, len(necrofighters), team=player['team'], full_control=True,
                                                    player=player)
                if player['summon_necrofighter'] == 'weakskele':
                    necrofighter = summon_dung_skeleton(game, necrofighters, team=player['team'], full_control=True,
                                                        player=player)
                if player['summon_necrofighter'] == 'rhino':
                    necrofighter = summon_hell_rhino(game, necrofighters, team=player['team'], full_control=True,
                                                        player=player)
                summonednecrofighter = player['summon_necrofighter']
                player['summon_necrofighter'] = None
                for idsss in necrofighter:
                    x = idsss
                    break
                # necrofighter[x]['name']
                # player['control_necrofighter'] = necrofighter['id']
                player['controllable_necrofighter'] = necrofighter[x]['id']
                if summonednecrofighter == 'weakskele':
                    for idss in game['players']:
                        game['players'][idss]['nearplayers'].append(necrofighter[x]['id'])
                        necrofighter[x]['nearplayers'].append(game['players'][idss]['id'])
                necrofighters.append(necrofighter)
            if player['summon_angry_rhino']:
                player['summon_angry_rhino'] = False
                angryrhino = summon_angry_rhino(game, player['team'], player['angry_rhino_target'])
                angryrhinos.append(angryrhino)
            if player['summon_virus'] > 0:
                for i in range(player['summon_virus']):
                    virus = summon_virus(game, player, viruses)
                    viruses.append(virus)
                player['summon_virus'] = 0
            if incomingdmg > 0 and 'doomed' in player['skills']:
                player['doomed_amount'] += 1
                game['text'] += 'üî•' * player['hp'] + '|–ê–¥—Å–∫–æ–µ –ø–ª–∞–º—è –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç ' + player['name'] + ' ('+str(player['doomed_amount'])+'/7)!\n'
            if incomingdmg_hp > 0 and not player['dead']:
                hp = 1
                dmg = incomingdmg_hp
                if dmg > 999999:
                    hp = random.randint(99999999, 999999999999)
                else:
                    while dmg >= player['dmglimit']:
                        dmg -= player['dmglimit'] 
                        hp += 1
                if 'doomed' not in player['skills']:
                    player['hp'] -= hp
                    showlosthptext = '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                        hp) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(player['hp']) + ' —Ö–ø.'
                    if is_dark_boss(player):
                        game['text'] += 'üëÅ‚Äçüó®' + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(hp) + ' –≥–ª–∞–∑.\n'
                    else:
                        game['text'] += '‚ô•Ô∏è' * player['hp'] + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç ' + str(
                            hp) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(player['hp']) + ' —Ö–ø.\n'
                    if player['is_magmaworm']:
                        for idss in game['players']:
                            if not game['players'][idss]['dead']:
                                setfire(game, player, game['players'][idss], strength=hp)
                        game['text'] += 'üî•' + '|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —á–∞—Å—Ç—å —Ö–≤–æ—Å—Ç–∞. –¢–∞ –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, –ø–æ–¥–∂–∏–≥–∞—è –ø–æ–ª–µ –±–æ—è!\n'
                else:
                    pass
                player['can_summon_zombie'] = True
                if 'regeneration' in player['skills'] and random.randint(1, 6) == 1:
                    player['hp'] += 1
                    game['text'] += '‚ùóÔ∏è|' + player['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1 –∂–∏–∑–Ω—å.\n'
                if 'berserk' in player['skills'] or 'berserk?1' in player['skills'] or 'berserk?2' in player[
                    'skills'] or 'berserk?3' in player['skills']:
                    maxen = 9
                    if 'protivogaz' in player['skills']:
                        maxen += 1
                    if player['maxenergy'] < maxen:
                        player['maxenergy'] += hp
                    actualregen = regen_energy(game, player, hp)
                    if 'alex_berserk' in player['customtexts'] and player['customtexts']['alex_berserk']:
                        game['text'] += 'üëø|–†–∞–∑—É–º –ê—Ä—Ö–∏–¥–µ–º–æ–Ω–∞ '+player['name']+' —Ä–∞–∑—Ä—É—à–∞–µ—Ç—Å—è! –ü–æ–ª—É—á–∞–µ—Ç '+str(actualregen)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                    elif 'tuman_berserk' in player['customtexts'] and player['customtexts']['tuman_berserk']:
                        game['text'] += '‚óºÔ∏è|' +player['name']+ ' –≥–æ—Ä–∏—Ç —á—ë—Ä–Ω—ã–º –ø–ª–∞–º–µ–Ω–µ–º! –ü–æ–ª—É—á–∞–µ—Ç '+str(actualregen)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                    else:
                        game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –ø–æ–ª—É—á–∞–µ—Ç '+str(actualregen)+' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                    player['maxenergy'] += hp
                    if player['maxenergy'] > maxen:
                        player['maxenergy'] = maxen
                    if player['hp'] == 1: 
                        if 'alex_berserk' in player['customtexts'] and player['customtexts']['alex_berserk']:
                            game['text'] += 'üëø|–†–∞–∑—É–º –ê—Ä—Ö–∏–¥–µ–º–æ–Ω–∞ '+player['name']+' —Ä–∞–∑—Ä—É—à–µ–Ω! –ê—Ä—Ö–∏–¥–µ–º–æ–Ω –≤–ø–∞–¥–∞–µ—Ç –≤ –±–µ–∑—É–º–∏–µ!\n'
                        elif 'tuman_berserk' in player['customtexts'] and player['customtexts']['tuman_berserk']:
                            game['text'] += 'üñ§|' +player['name']+ ' –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç —á–µ—Ä–Ω—ã–º –æ–≥–Ω–µ–º, –∏ –æ–±—Ä–µ—Ç–∞–µ—Ç –ò—Å—Ç–∏–Ω–Ω—É—é —Ñ–æ—Ä–º—É!\n'
                        else:
                            game['text'] += 'üò°|–ë–µ—Ä—Å–µ—Ä–∫ '+player['name']+' –≤—Ö–æ–¥–∏—Ç –≤ –±–æ–µ–≤–æ–π —Ç—Ä–∞–Ω—Å!\n'
                if 'skeletonking' in player['skills']: 
                    for i in range(hp):
                        skeleton = summon_skeleton(game, player, skeletons)
                        skeletons.append(skeleton)
                if player['is_rhino']:
                    if player['hp'] < player['maxhp'] / 2 and not player['madness']:
                        player['madness'] = True
                        regen_energy(game, player, len(game['players']) - 1)
                        player['maxenergy'] += len(game['players']) - 1
                        player['weapon'].dmgbonus += len(game['players']) - 1 
                        game['text'] += '‚ùóÔ∏è|' + player['name'] + ' –≤ —è—Ä–æ—Å—Ç–∏!\n'
                if game['pureduel_rats'] and player['controller'] == 'bot':
                    player['weights'] = random_duelrat_weights()

                        # for idsss in player['batsdamages']:
                #    enemy = game['players'][idsss]
                #    enemy['hp'] += 1
                #    game['text'] += '‚ô•Ô∏è'*enemy['hp']+'|'+enemy['name']+' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç '+str(1)+' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è '+str(enemy['hp'])+' —Ö–ø.\n'
                # player['batsdamages'] = []
                for idss in enemys_sadist:
                    enemy = game['players'][idss]
                    if game['castlefight']:
                        try:
                            enemy['castlefighttexts'].append(showlosthptext)
                        except:
                            pass
                        enemy['take_enemy_hp'] += hp
                    if ('sadist' in enemy['skills'] or 'sadist?1' in enemy['skills'] or 'sadist?2' in enemy[
                        'skills'] or 'sadist?3' in enemy['skills']):
                        actualregen = regen_energy(game, enemy, hp)
                        if 'sadist?1' in enemy['skills']:
                            game['text'] += 'üòÉ|–°–∞–¥–∏—Å—Ç ' + enemy['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(
                                actualregen) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n'
                        elif 'sadist?2' in enemy['skills']:
                            dopdmgs = random.randint(0, 1)
                            game['text'] += 'üòÉ|–°–∞–¥–∏—Å—Ç ' + enemy['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(
                                actualregen) + ' —ç–Ω–µ—Ä–≥–∏–∏ –∏ +' + str(dopdmgs) + ' —É—Ä–æ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥.\n'
                            enemy['nextturndamage'] += dopdmgs
                        elif 'sadist?3' in enemy['skills']:
                            dopdmgs = random.randint(0, 2)
                            game['text'] += 'üòÉ|–°–∞–¥–∏—Å—Ç ' + enemy['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(
                                actualregen) + ' —ç–Ω–µ—Ä–≥–∏–∏ –∏ +' + str(dopdmgs) + ' —É—Ä–æ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥.\n'
                            enemy['nextturndamage'] += dopdmgs
                        elif 'sadist' in enemy['skills']:
                            if 'wizy_sadist' in enemy['customtexts'] and enemy['customtexts']['wizy_sadist']:
                                game['text'] += ('üòÉ|–ù–∞–±–ª—é–¥–∞—è –∑–∞ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è–º–∏ —Å–≤–æ–∏—Ö —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ ' + enemy['name']+ ' –æ—â—É—â–∞–µ—Ç –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π –ø—Ä–∏–ª–∏–≤ —Å–∏–ª—ã, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è ' + str(actualregen) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n')
                            else:
                                game['text'] += ('üòÉ|–°–∞–¥–∏—Å—Ç ' + enemy['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç ' + str(actualregen) + ' —ç–Ω–µ—Ä–≥–∏–∏.\n')
                    if enemy['necrozombie'] > 0:
                        enemy['getfood'] = True
                    if 'demon' in enemy['skills'] and enemy['demonheal'] > 0:
                        enemy['hp'] += hp 
                        if enemy['hp'] > enemy['maxhp']:
                            enemy['hp'] = enemy['maxhp']
                        game['text'] += '‚ô•Ô∏è' * enemy['hp'] + '|Bloodseeker ' + enemy[
                            'name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ' + str(hp) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(
                            enemy['hp']) + ' —Ö–ø.\n'
                        if enemy['hp'] > 0:
                            if enemy['dead']:
                                enemy['dead'] = False
                                game['text'] += 'üëπ' + '|' + enemy['name'] + ' –≤–æ—Å—Å—Ç–∞–ª –∏–∑ –º—ë—Ä—Ç–≤—ã—Ö!\n'
                    if 'ghoul_vampirism' in enemy['skills'] or enemy['weapon'].name == '–ó—É–±—ã –≤—É—Ä–¥–∞–ª–∞–∫–∞':
                        if game['botfight']:
                            chance = 20
                        else:
                            chance = 100
                        if random.randint(1, 100) <= chance:
                            enemy['hp'] += hp
                            if enemy['hp'] > enemy['maxhp']:
                                enemy['hp'] = enemy['maxhp']
                            game['text'] += '‚ô•Ô∏è' * enemy['hp'] + '|' + enemy['name'] + ' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ' + str(
                                hp) + ' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è ' + str(enemy['hp']) + ' —Ö–ø.\n'
                            if enemy['hp'] > 0: 
                                if enemy['dead']:
                                    enemy['dead'] = False
                                    game['text'] += 'üëπ' + '|' + enemy['name'] + ' –≤–æ—Å—Å—Ç–∞–ª –∏–∑ –º—ë—Ä—Ç–≤—ã—Ö!\n'
                    # if 'vampire' in enemy['skills']:
                    # enemy['hp'] += hp
                    # if enemy['hp'] > enemy['maxhp']:
                    #    enemy['hp'] = enemy['maxhp']
                    # game['text'] += '‚ô•Ô∏è'*enemy['hp']+'|–í–∞–º–ø–∏—Ä '+enemy['name']+' –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç '+str(hp)+' –∂–∏–∑–Ω—å(–µ–π). –û—Å—Ç–∞–µ—Ç—Å—è '+str(enemy['hp'])+' —Ö–ø.\n'
                    # if enemy['hp'] > 0:
                    #    if enemy['dead']:
                    #        enemy['dead'] = False
                    #        game['text'] += 'üëπ'+'|'+enemy['name']+' –≤–æ—Å—Å—Ç–∞–ª –∏–∑ –º—ë—Ä—Ç–≤—ã—Ö!\n'

            if player['virus_attacks'] >= 3 and not player['dead']:
                deadplayer(game, player, enemys_sadist, skeletons)
            if player['dead_from_dark'] and not player['dead']:
                deadplayer(game, player, enemys_sadist, skeletons)

            armordebuffdel = []
            for idss in player["armor_debuff"]:
                player["armor_debuff"][idss]["duration"] -= 1
                if player['armor_debuff'][idss]["duration"] <= 0: 
                    armordebuffdel.append(idss)
                    
            for idss in armordebuffdel:
                del player['armor_debuff'][idss]
            for idss in player["armor_debuff_set"]:
                code = 0
                while code in player["armor_debuff"]:
                    code += 1
                player["armor_debuff"][code] = player["armor_debuff_set"][idss]
            player["armor_debuff_set"] = {}
            if player['hp'] <= 0 and not player['dead']:
                if not player['molitva']:
                    # for idss in player['ritualists']:
                    #    game['players'][idss[0]]['ritual_ability'] = True
                    # player['ritualists'] = []
                    savechance = 30
                    if 'incvizitor?1' in player['skills']:
                        savechance = 10
                    if 'incvizitor?2' in player['skills']:
                        savechance = 25
                    if 'incvizitor?3' in player['skills']:
                        savechance = 40
                    if ('incvizitor' in player['skills'] or 'incvizitor?1' in player['skills'] or 'incvizitor?2' in \
                        player['skills'] or 'incvizitor?3' in player['skills']) and not player['alreadysaved'] and random.randint(1, 100) <= savechance:
                        if not player['punchdead'] and not player['eliminated']:
                            player['hp'] = 1
                            if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                        game['text'] += 'üñ§|–ß‚Äå‚Äå‚Äå‚Äå‚Äå—ë‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå—Ä‚Äå‚Äå‚Äå‚Äå‚Äå–Ω“â“á‚Äå‚Äå‚Äå‚Äå‚Äå–æ“à‚Äå‚Äå‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå —Å“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–µ“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå—Ä‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–¥“à‚Äå‚Äå‚Äå‚Äå‚Äå—Ü“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå –Ω–µ –¥–∞—ë—Ç —É–º–µ—Ä–µ—Ç—å ' + player['name'] + '!\n' 
                                        player['alreadysaved'] = True
                            else:
                                        game['text'] += 'üòá|–í—ã—Å—à–∏–µ —Å–∏–ª—ã —Å–ø–∞—Å–ª–∏ ' + player['name'] + '!\n' 
                                        player['alreadysaved'] = True
                        else:
                            game['text'] += '‚ö∞Ô∏è|–î–∞–∂–µ –≤—ã—Å—à–∏–º —Å–∏–ª–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–ø–∞—Å—Ç–∏ ' + player['name'] + '.\n'
                    elif ('zombie' in player['skills'] or 'zombie?1' in player['skills'] or 'zombie?2' in player['skills'] or 'zombie?3' in player['skills']) and player['zombie'] == False:
                        if '–¢–µ–Ω—å –∫—Ä—ã—Å—ã' in player['name'] and player['controller'] == 'bot' and player[
                            'team'] == 'dark' and player['cant_die']:
                            pass
                        else:
                            if not player['eliminated']:
                                player['zombie'] = 2
                                if 'zombie?1' in player['skills']:
                                    player['zombie'] = 1
                                if 'zombie?2' in player['skills']:
                                    player['zombie'] = 2
                                if 'zombie?3' in player['skills']:
                                    player['zombie'] = 3
                                game['text'] += 'üò¨|' + player['name'] + ' –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å—Ä–∞–∂–∞—Ç—å—Å—è, –∏—Å—Ç–µ–∫–∞—è –∫—Ä–æ–≤—å—é!\n'
                            else:
                                game['text'] += 'üò¨|' + player['name'] + ' –Ω–µ —Å–ø–æ—Å–æ–±–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å—Ä–∞–∂–∞—Ç—å—Å—è.\n'
                    else:
                        if player['zombie'] == False:
                            if player['necrozombie'] <= 0:
                                deadplayer(game, player, enemys_sadist, skeletons)
                else:
                    if not player['punchdead'] and not player['eliminated']:
                        player['hp'] = 1
                        if 'tuman_incvizitor' in player['customtexts'] and player['customtexts']['tuman_incvizitor']:
                                    game['text'] += 'üñ§|–ß‚Äå‚Äå‚Äå‚Äå‚Äå—ë‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå—Ä‚Äå‚Äå‚Äå‚Äå‚Äå–Ω“â“á‚Äå‚Äå‚Äå‚Äå‚Äå–æ“à‚Äå‚Äå‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå —Å“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–µ“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå—Ä‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–¥“à‚Äå‚Äå‚Äå‚Äå‚Äå—Ü“â‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå–µ‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå‚Äå –Ω–µ –¥–∞—ë—Ç —É–º–µ—Ä–µ—Ç—å ' + player['name'] + '!\n' 
                        else:
                                    game['text'] += 'üòá|–í—ã—Å—à–∏–µ —Å–∏–ª—ã —Å–ø–∞—Å–ª–∏ ' + player['name'] + '!\n'
                    else:
                        game['text'] += '‚ö∞Ô∏è|–î–∞–∂–µ –≤—ã—Å—à–∏–º —Å–∏–ª–∞–º –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–ø–∞—Å—Ç–∏ ' + player['name'] + '.\n'
            player['lasthit'] -= 1
            if player['lasthit'] == 0 and not player['dead']:
                player['dead'] = True
                game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'
            if player['punchdead'] and not player['dead']:
                game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'
                player['dead'] = True
        for ids in game['summon_castlefight_skeles']:
            game['players'].update(ids)
        game['summon_castlefight_skeles'] = []
        for ids in game['summon_imps']:
            game['players'].update(ids)
        game['summon_imps'] = []
        if game['darkcastle_demon'] > 0:
            darkcastledemon = summon_darkcastle_demon(game)
            game['players'].update(darkcastledemon)
            game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|–í–æ–∏–Ω—ã –∑–∞–º–∫–∞ —Ç—å–º—ã –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–ª–∏ —Å–æ–±–æ–π, –≤—ã–ø—É—Å—Ç–∏–≤ –Ω–∞ –≤–æ–ª—é –¥–µ–º–æ–Ω–∞ –¢—å–º—ã —Å —Å–∏–ª–æ–π ('+str(game['darkcastle_demon'])+')!\n'
            game['darkcastle_demon'] = 0
        for ids in skeletons:
            game['players'].update(ids)
        for ids in treants:
            game['players'].update(ids)
        for ids in viruses:
            game['players'].update(ids)
        for ids in madskeles:
            game['players'].update(ids)
        for ids in weakskeles:
            game['players'].update(ids)
        for ids in weakghouls:
            game['players'].update(ids)
        for ids in zombierats:
            game['players'].update(ids)
        for ids in necrofighters:
            game['players'].update(ids)
        for ids in angryrhinos:
            game['players'].update(ids)
        waitbarremove = []
        for ids in game['waitbarplayers']:
            user = cwusers.find_one({'id': ids})
            game['players'].update(createplayer(uid=user['id'], name=user['name'], photo=None))
            player = game['players'][user['id']]
            player['team'] = player['id']
            set_player_battle_stats(player, user)
            set_player_bar_stats(player, user)
            waitbarremove.append(ids)
        for ids in waitbarremove:
            game['waitbarplayers'].remove(ids)
        for ids in game['players']:
            player = game['players'][ids]
            if player['necrozombie'] > 0:
                if player['getfood']:
                    player['necrozombie'] = player['maxnecrozombie']
                else:
                    game['text'] += 'üò±|–ó–æ–º–±–∏ ' + player['name'] + ' —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –≥–æ–ª–æ–¥–∞!\n'
                player['necrozombie'] -= 1
                if player['necrozombie'] == 0 or player['getlasthit']:
                    player['dead'] = True
                    game['text'] += '‚ò†Ô∏è|' + player['name'] + ' —Ç–µ—Ä—è–µ—Ç —Å–æ–∑–Ω–∞–Ω–∏–µ.\n'
                player['getfood'] = False
            if player['energy'] > player['maxenergy']:
                player['energy'] = player['maxenergy']
            player['demonheal'] -= 1
            if player['demonheal'] == 0:
                game['text'] += 'üí®|–§–æ—Ä–º–∞ –¥–µ–º–æ–Ω–∞ ' + player['name'] + ' –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!\n'
            player['incomingdmgs'] = []
            player['outgoingdmgs'] = []
            player['molitva'] = False
        for ids in game['players']:
            player = game['players'][ids]
            if player['dead']:
                player['deadturns'] += 1
        for ids in game['players']:
            player = game['players'][ids]
            if 'dark_energy' in player['skills'] and player['dead']:
                darks = 0
                for idss in game['players']:
                    notdead = False
                    if game['players'][idss]['dark_counter'] > 0:
                        if not game['players'][idss]['dead']:
                            notdead = True
                        if game['players'][idss]['deadturns'] <= 1:
                            notdead = True
                        if notdead:
                            darks += 1
                # if darks >= 2:
                #    if not player['dead_from_scare']:
                #        player['dead'] = False
                #        player['deadturns'] = 0
                #        game['text'] += 'üëÅ‚ö´Ô∏è‚ö´Ô∏èüëÅ|–¢–µ–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç '+player['name']+' —É–º–µ—Ä–µ—Ç—å!\n'
        game[
            'freeze_energy'] -= 1  ########################################################################## FREEZE ENERGY ################################################
        if not game['castlefight'] and not game['neuralfight']:
            if game['text'] != '':
                if not game['cwbar']:
                    tries = 0
                    while True:
                        try:
                            sendm(bot, game['id'], game['text'])
                            break
                        except:
                            tries += 1
                            if tries > 100:
                                del games[game['id']]
                                return
                            time.sleep(3)
                for ids in game['players']:
                    player = game['players'][ids]
                    if player['id'] != game['id']:
                        try:
                            sendm(bot, player['id'], game['text'])
                        except:
                            pass
                for ids in game['spectators']:
                    if ids not in game['players']:
                        try:
                            for idss in game['players']:
                                xx = game['players'][idss]
                                break
                            sendm(bot, ids, '[' + xx['name'] + ']\n' + game['text'])
                        except:
                            pass
                time.sleep(1)
        else:
            if not game['neuralfight']:
                alltext = game['text'].split('\n')
                for ids in game['players']:
                    player = game['players'][ids]
                    for idss in alltext:
                        if player['name'] + ' ' in idss or player['name'] + '.' in idss or player['name'] + ',' in idss or player['name'] + '!' in idss:
                            try:
                                player['castlefighttexts'].append(idss)
                            except:
                                pass
                allcastlesbattletext[game['id']].append(game['text'])
                allcastlesbattletext[game['id']].append('–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!')


        if game['neuralfight'] and game['turn'] >= 100:
            for ids in game['players']:
                game['players'][ids]['dead'] = True
                game['failed_neural'] = True
        if not game['castlefight']: 
            teams = []
            for ids in game['players']:
                player = game['players'][ids]
                if not player['dead'] and player['team'] not in teams:
                    teams.append(player['team'])
        else:
            teams = []
            for ids in game['players']:
                player = game['players'][ids]
                if player['castlefightrole'] == 'attacker':
                    if not player['dead'] and 'attackers' not in teams: 
                        teams.append('attackers')
                elif player['castlefightrole'] == 'defer':
                    if not player['dead'] and 'defers' not in teams:
                        teams.append('defers')
        dm_end = False
        if game["dm"] and get_remain_dm_deaths(game) <= 0:
            dm_end = True
            winner_dm = None
            players_dm_score = {}
            for idss in game["players"]:
                player = game["players"][idss]
                players_dm_score[player["id"]] = {'id':player["id"], 'name':player['name'], 'score':0}
                if player["count_as_dm"]:
                    players_dm_score[player["id"]]["score"] -= player["dm_deaths"]*3
                else:
                    players_dm_score[player["id"]]["score"] = -99999999999
            maxscore = -99999999999
            topdmplayer = None
            dmtext = ""
            players_dm_score_sorted = {}

            repeats = len(players_dm_score)
            for i in range(repeats):
                tops = -999999999999
                toppl = None
                for idss in players_dm_score:
                    if players_dm_score[idss]["id"] not in players_dm_score_sorted and players_dm_score[idss]["score"] > tops:
                        toppl = idss
                players_dm_score_sorted[toppl] = players_dm_score[toppl]
            i = 0
            for idss in players_dm_score_sorted:
                scoreplayer = players_dm_score_sorted[idss]
                if i == 0:
                    dmtext += "üî• "+scoreplayer["name"]+": "+str(scoreplayer["score"])+"‚≠ê\n"
                    winner = scoreplayer
                else:
                    dmtext += scoreplayer["name"]+": "+str(scoreplayer["score"])+"‚≠ê\n"
                i+=1
                if scoreplayer['score'] > maxscore:
                    topdmplayer = scoreplayer
                    maxscore = scoreplayer['score']
            winners = []
            for idss in players_dm_score:
                if players_dm_score[idss]["score"] == maxscore:
                    winners.append(players_dm_score[idss])
            sendm(bot, game["id"], dmtext)
            time.sleep(2)
            if len(winners) == 1:
                sendm(bot, game["id"], "üî• –ü–æ–±–µ–¥–∏–ª "+winners[0]["name"]+"!")
                del games[game["id"]]
                return
            else:
                text=""
                for idss in winners:
                    text += idss["name"]+", "
                text = text[:len(text)-2]
                sendm(bot, game["id"], "üî• –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏: "+text+"!")
                del games[game["id"]]
                return
        if (len(teams) > 1 or game['cwbar']):
            if not game['castlefight'] and not game['neuralfight']:
                if game['cwduel'] or game['cwrats'] or game['cwduelrats'] or game['cwbar']:
                    for ids in game['players']:
                        player = game['players'][ids]
                        if player['controller'] != 'bot':
                            try:
                                sendm(bot, player['id'], '–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!')
                            except:
                                pass
                else:
                    tries = 0
                    while True:
                        try:
                            sendm(bot, game['id'], '–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!')
                            break
                        except:
                            tries += 1
                            if tries > 100: 
                                del games[game['id']]
                                return
                            time.sleep(3)
            # for ids in game['spectators']:
            #    try:
            #        sendm(bot, ids, '–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!')
            #    except:
            #        pass
            game['text'] = ''
            humans = []
            for ids in game['players']:
                player = game['players'][ids]
                if not player['dead'] and player['controller'] == 'player':
                    humans.append(player['id'])
            if not game['castlefight'] and not game['neuralfight']:
                if len(humans) == 0:
                    time.sleep(7)
            next_turn(game, bot)
        else:
            game['was_1_turn'] = False
            try:
                if game['neuralfight']:
                    #print("demons take score: demon "+str(game['fullneuraldemon1']))
                    winner = None
                    for ids in game['players']:
                        player = game['players'][ids]
                        if player['hp'] > 0:
                            winner = player
                    if game['failed_neural']:
                        for ids in game['players']:
                            player = game['players'][ids]
                            game['demons'][player['fullneuraldemon']]['score'] -= 2
                    else:
                        if winner == None:
                            for ids in game['players']:
                                player = game['players'][ids]
                                game['demons'][player['fullneuraldemon']]['score'] += 1
                        else:
                            for ids in game['players']:
                                player = game['players'][ids]
                                if player['id'] == winner['id']:
                                    game['demons'][player['fullneuraldemon']]['score'] += 2
                                else:
                                    game['demons'][player['fullneuraldemon']]['score'] -= 2
                
                if not game['castlefight']:
                    
                    if isinstance(teams[0], int):
                        winner = game['players'][teams[0]]
                        if game['cwrats']:
                            rat = None
                            for idsss in game["players"]:
                                p2 = game["players"][idsss]
                                if p2["id"] != winner["id"]:
                                    rat = p2
                            get_player_exp_for_rathunt(winner['id'], True, hp=winner['hp'], rat = rat)
                            user = cwusers.find_one({'id': winner['id']})
                            spent_battle_items(user, winner['inventory'], winner['used_rat_toy'])
                            count_user_kills(user, winner['kills'])
                            if winner['used_rat_toy']:
                                c_rat = None
                                for idss in game['players']:
                                    target = game['players'][idss]
                                    if target['controller'] == 'bot':
                                        c_rat = target
                                        break
                                sendm(cwbot, user['id'], "–í—ã —Ä–µ—à–∏–ª–∏ –ø—Ä–∏—Ä—É—á–∏—Ç—å –ø–æ–±–µ–∂–¥–µ–Ω–Ω—É—é –∫—Ä—ã—Å—É. –í—ã –ø—Ä–∏–≤–µ–ª–∏ –µ—ë –∫ —Å–µ–±–µ –≤ –∑–∞–º–æ–∫, –≤—ã–ª–µ—á–∏–ª–∏ –∏ –¥–∞–ª–∏ –∏–≥—Ä—É—à–∫—É-–∫—Ä—ã—Å—É. –¢–µ–ø–µ—Ä—å –æ–Ω–∞ "+\
                                                   "–≥–æ—Ç–æ–≤–∞ —Å—Ä–∞–∂–∞—Ç—å—Å—è –∑–∞ –≤–∞—Å.")
                                cwusers.update_one({'id':user['id']},{'$set':{'personal_rat':{'skills':c_rat['skills'], 'weaponname':c_rat['weapon'].name, 'weaponlvl':c_rat['weapon'].lvl}}})
                        if game['cwduelrats']:
                            get_player_exp_for_duel(winner['id'], True, hp=winner['hp'])
                            user = cwusers.find_one({'id': winner['id']})
                            spent_battle_items(user, winner['inventory'])
                            count_user_kills(user, winner['kills'])
                        if game['cwduel']:
                            for idsss in game['players']:
                                player = game['players'][idsss] 
                                if player['id'] == winner['id']:
                                    get_player_exp_for_duel(player['id'], True)
                                else:
                                    get_player_exp_for_duel(player['id'], False)
                                user = cwusers.find_one({'id': player['id']})
                                spent_battle_items(user, player['inventory'])
                                count_user_kills(user, player['kills'])

                    else:
                        for idsss in game['players']:
                            looser = game['players'][idsss]
                            break
                        if game['cwrats']:
                            rat = None
                            for idsss in game["players"]:
                                p2 = game["players"][idsss]
                                if p2["id"] != looser["id"]:
                                    rat = p2
                            get_player_exp_for_rathunt(looser['id'], False, rat=rat)
                            user = cwusers.find_one({'id': looser['id']})
                            spent_battle_items(user, looser['inventory'])
                            count_user_kills(user, looser['kills'])
                        if game['cwduelrats']:
                            get_player_exp_for_duel(looser['id'], False)
                            user = cwusers.find_one({'id': looser['id']})
                            spent_battle_items(user, looser['inventory'])
                            count_user_kills(user, looser['kills'])
                        bb = False
                        if teams[0] == 'rats':
                            winner = {'name': '–ö—Ä—ã—Å|üê≠', 'team': 'rats', 'photo': ratphoto, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'ghoul':
                            winner = {'name': '–í—É—Ä–¥–∞–ª–∞–∫–æ–≤|üëπ', 'team': 'ghoul', 'photo': None, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'necromant':
                            winner = {'name': '–ù–µ–∫—Ä–æ–º–∞–Ω—Ç–∞|üñ§', 'team': 'necromant', 'photo': necromantphoto,
                                      'controller': 'bot'}
                            bb = True
                        if teams[0] == 'rhino':
                            winner = {'name': '–ù–æ—Å–æ—Ä–æ–≥–∞|ü¶è', 'team': 'rhino', 'photo': rhinophoto, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'virus':
                            winner = {'name': '–í–∏—Ä—É—Å–∞|ü¶†', 'team': 'virus', 'photo': None, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'dummys':
                            winner = {'name': '–ú–∞–Ω–µ–∫–µ–Ω–∞|üéÉ', 'team': 'dummys', 'photo': None, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'dark':
                            winner = {'name': '–¢—å–º—ã|‚ö´Ô∏è', 'team': 'dark', 'photo': None, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'knight':
                            winner = {'name': '–†—ã—Ü–∞—Ä—è|‚öîÔ∏è', 'team': 'knight', 'photo': knight_photo, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'dragon':
                            winner = {'name': '–î—Ä–∞–∫–æ–Ω–∞|üê¶‚Äçüî•', 'team': 'dragon', 'photo': None, 'controller': 'bot'}
                            bb = True
                        if teams[0] == 'hell':
                            hellphoto = None
                            if game['dungeonlvl'] == 3:
                                hellphoto = radiodemonphoto
                            winner = {'name': '–ê–¥–∞|üî•', 'team': 'dark', 'photo': hellphoto, 'controller': 'bot'}
                            bb = True
                        if not bb:
                            winner = {'name': '–±–æ—Ç–æ–≤', 'team': None, 'photo': None, 'controller': 'bot'}

                        # sendm(bot, pasyuk_id, '–ö—Ä—ã—Å—ã –ø–æ–±–µ–¥–∏–ª–∏!')
                    if game['cwrats'] or game['cwduel'] or game['cwduelrats']:
                        for ids in game['players']:
                            player = game['players'][ids]
                            if player['controller'] != 'bot':
                                try:
                                    sendm(bot, player['id'], '–ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ ' + winner['name'] + '!')
                                except:
                                    pass
                    else:
                        if not game['neuralfight']:
                            tries = 0
                            while True:
                                try:
                                    if winner['photo'] == None:
                                        if winner['team'] == 'dummys':
                                            sendm(bot, game['id'], '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª–∏–≥–æ–Ω –ø—É—Å—Ç, –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.')
                                        else:
                                            sendm(bot, game['id'], '–ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ ' + winner['name'] + '!')
                                    else:
                                        try:
                                            bot.send_photo(game['id'], winner['photo'],
                                                           caption='–ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ ' + winner['name'] + '!')
                                        except:
                                            print(traceback.format_exc())
                                            try:
                                                sendm(bot, game['id'], '–ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ ' + winner['name'] + '!')
                                            except:
                                                pass
                                    break
                                except:
                                    tries += 1
                                    if tries > 100:
                                        del games[game['id']]
                                        return
                                    time.sleep(3)


                else:
                    try:
                        if len(teams) > 0:
                            winner = teams[0]
                        else:
                            winner = None
                        playerlist = {}
                        for ids in game['players']:
                            player = game['players'][ids]
                            playerlist.update({player['id']: {'id': player['id'], 'name': player['name'],
                                                              'castle': player['castle'],
                                                              'do_damage_in_hp': player['do_damage_in_hp'], \
                                                              'take_enemy_hp': player['take_enemy_hp'],
                                                              'castlefightrole': player['castlefightrole'], 'full_npc':player['full_npc']}})
                            user = cwusers.find_one({'id': player['id']}) 
                            spent_battle_items(user, player['inventory'])
                            count_user_kills(user, player['kills'])
                            # sendm(cwbot, pasyuk_id, game['id'])
                        castlefightinfo.update(
                            {game['id']: {'winner': winner, 'name': game['id'], 'score': 0, 'players': playerlist}})
                        # sendm(cwbot, pasyuk_id, game['id'])
                        for ids in game['players']:
                            player = game['players'][ids]
                            newcastlefighttexts = []
                            emoj = "üó°"
                            if player['castlefightrole'] == 'defer':
                                emoj = "üõ°"
                            newcastlefighttexts.append(
                                emoj + '|–ù–∞–Ω–µ—Å–µ–Ω–æ –ø–æ–ª–µ–∑–Ω–æ–≥–æ —É—Ä–æ–Ω–∞: (' + str(player['do_damage_in_hp']) + ')\n')
                            if not player['full_npc']:
                                for ids in player['castlefighttexts']:
                                    newcastlefighttexts.append(ids)
                                player['castlefighttexts'] = newcastlefighttexts
                                try:
                                    cwusers.update_one({'id': player['id']},
                                                       {'$set': {'lastbattlelogs': player['castlefighttexts']}})
                                except:
                                    pass
                    except:
                        sendm(cwbot, pasyuk_id, traceback.format_exc())

            except:
                if game['castlefight']:
                    sendm(cwbot, pasyuk_id, game['id'] + ' bugged!')
                    sendm(cwbot, pasyuk_id, traceback.format_exc())
                winner = None
                if game['cwrats'] or game['cwduelrats']:
                    sendm(bot, game['id'], '–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!')
                    for idsss in game['players']:
                        player = game['players'][idsss]
                        break
                    if game['cwduelrats']:
                        get_player_exp_for_duel(player['id'], False)
                    else:
                        rat = None
                        for idsss in game["players"]:
                            p2 = game["players"][idsss]
                            if p2["id"] != player["id"]:
                                rat = p2
                        get_player_exp_for_rathunt(player['id'], False, rat=rat)
                    user = cwusers.find_one({'id': player['id']})
                    spent_battle_items(user, player['inventory'])
                    count_user_kills(user, player['kills'])
                elif game['cwduel']:
                    for idsss in game['players']:
                        player = game['players'][idsss]
                        sendm(bot, player['id'], '–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!')
                        get_player_exp_for_duel(player['id'], False)
                        user = cwusers.find_one({'id': player['id']})
                        spent_battle_items(user, player['inventory'])
                        count_user_kills(user, player['kills'])
                else:
                    if not game['neuralfight']:
                        tries = 0
                        while True:
                            try:
                                sendm(bot, game['id'], '–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!')
                                break
                            except:
                                tries += 1
                                if tries > 100:
                                    del games[game['id']]
                                    return
                                time.sleep(3)
            if game['rp_fight']:
                for ids in game['players']:
                    player = game['players'][ids]
                    if player['rp_fighter']:
                        users.update_one({'id': player['id']}, {
                            '$set': {'rp_profile.hp': player['hp'], 'rp_profile.inventory': player['inventory'],
                                     'rp_profile.dmglimit': player['dmglimit'],
                                     'rp_profile.maxenergy': player['maxenergy']}})
            if winner != None and game['dungeon']:
                if winner['controller'] != 'bot':
                    try:
                        sendm(bot, pasyuk_id, '–≠—Ç–∞–∂ ' + str(game['dungeonlvl']) + ' (' + game[
                            'dungeon_type'] + ') –ø—Ä–æ–π–¥–µ–Ω (' + winner['name'] + ')!')
                    except:
                        pass
                    if game['dungeon_type'] == 'rhino':
                        if game['dungeonlvl'] < 3:
                            game['dungeonlvl'] += 1
                            game['text'] = '–•–æ–¥ 1:\n'
                            game['turn'] = 1
                            game['effecttext'] = ''
                            players = []
                            for ids in game['players']:
                                player = game['players'][ids]
                                if player['controller'] != 'bot':
                                    players.append(player)
                            game['players'] = {}
                            for ids in players:
                                x = ids
                                game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                            for ids in game['players']:
                                team = game['players'][ids]['id']
                                break
                            for ids in game['players']:
                                player = game['players'][ids]
                                player['team'] = team
                            rhinoamount = 0
                            ratamount = 0
                            skeletonamount = 0
                            rats = []
                            rhinos = []
                            skeletons = []
                            if game['dungeonlvl'] == 2:
                                ratamount = len(players)
                                skeletonamount = len(players)
                            if game['dungeonlvl'] == 3:
                                ratamount = 0
                                rhinoamount = 1
                                plen = len(game['players'])
                                while plen >= 4:
                                    rhinoamount += 1 
                                    plen -= 4
                            i = 0
                            while i < ratamount:
                                rat = summon_rat(game, len(rats))
                                rats.append(rat)
                                i += 1
                            i = 0 
                            while i < rhinoamount:
                                rhino = summon_rhino(game, len(rhinos))
                                rhinos.append(rhino)
                                i += 1
                            i = 0
                            while i < skeletonamount:
                                skeleton = summon_dung_skeleton(game, skeletons)
                                skeletons.append(skeleton)
                                i += 1
                            for ids in rats:
                                game['players'].update(ids)
                            for ids in rhinos:
                                game['players'].update(ids)
                            for ids in skeletons: 
                                game['players'].update(ids)
                            try:
                                sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                    game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                            except: 
                                pass
                            for ids in game['spectators']:
                                if ids not in game['players']:
                                    try:
                                        for idss in game['players']:
                                            xx = game['players'][idss]
                                            break
                                        sendm(bot, ids, '[' + xx['name'] + ']\n' + '–≠—Ç–∞–∂ ' + str(
                                            game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                    except:
                                        pass

                            threading.Timer(2, select_weapon, args=[game]).start()
                            return
                        else:
                            if game['dungeonlvl'] == 3:
                                game['dungeonlvl'] += 1
                                game['text'] = '–•–æ–¥ 1:\n'
                                game['turn'] = 1
                                game['effecttext'] = ''
                                players = []
                                for ids in game['players']: 
                                    player = game['players'][ids]
                                    if player['controller'] != 'bot':
                                        players.append(player)
                                game['players'] = {}
                                for ids in players:
                                    x = ids
                                    game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                                for ids in game['players']:
                                    team = game['players'][ids]['id']
                                    break
                                for ids in game['players']:
                                    player = game['players'][ids]
                                    player['team'] = player['id'] 
                                if len(game['players']) > 1:
                                    try:
                                        sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(game[
                                                                                       'dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è –¥—É—Ö–æ–º –Ω–æ—Å–æ—Ä–æ–≥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                    except:
                                        pass
                                    for ids in game['spectators']:
                                        try:
                                            sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(game[
                                                                                    'dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è –¥—É—Ö–æ–º –Ω–æ—Å–æ—Ä–æ–≥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                        except:
                                            pass
                                    threading.Timer(2, select_weapon, args=[game]).start() 
                                else:
                                    for ids in game['players']:
                                        player = game['players'][ids]
                                    try:
                                        sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∏–ª –¥—É—Ö –Ω–æ—Å–æ—Ä–æ–≥–∞!')
                                    except:
                                        pass
                                    users.update_one({'id': player['id']}, {'$set': {'rhinosoul': True}})
                                    try:
                                        users.update_one({'id': player['id']}, {'$inc': {'rhino_wins': 1}})
                                    except:
                                        users.update_one({'id': player['id']}, {'$set': {'rhino_wins': 1}})
                                    sendm(bot, game['id'], player[
                                        'name'] + ' –ø–æ–≥–ª–æ—â–∞–µ—Ç –¥—É—Ö –Ω–æ—Å–æ—Ä–æ–≥–∞ –∏ –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —Ä—ã–≤–æ–∫!')
                                    for ids in game['spectators']:
                                        try:
                                            sendm(bot, ids, player[
                                                'name'] + ' –ø–æ–≥–ª–æ—â–∞–µ—Ç –¥—É—Ö –Ω–æ—Å–æ—Ä–æ–≥–∞ –∏ –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —Ä—ã–≤–æ–∫!') 
                                        except:
                                            pass
                                    del games[game['id']]
                                    return
                                return
                            else:
                                player = winner 
                                try:
                                    sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∏–ª –¥—É—Ö –Ω–æ—Å–æ—Ä–æ–≥–∞!')
                                except: 
                                    pass
                                users.update_one({'id': player['id']}, {'$set': {'rhinosoul': True}})
                                try:
                                    users.update_one({'id': player['id']}, {'$inc': {'rhino_wins': 1}})
                                except:
                                    users.update_one({'id': player['id']}, {'$set': {'rhino_wins': 1}})
                                sendm(bot, game['id'], player[
                                    'name'] + ' –ø–æ–≥–ª–æ—â–∞–µ—Ç –¥—É—Ö –Ω–æ—Å–æ—Ä–æ–≥–∞ –∏ –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —Ä—ã–≤–æ–∫!')
                                for ids in game['spectators']:
                                    try:
                                        sendm(bot, ids, player[
                                            'name'] + ' –ø–æ–≥–ª–æ—â–∞–µ—Ç –¥—É—Ö –Ω–æ—Å–æ—Ä–æ–≥–∞ –∏ –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å - —Ä—ã–≤–æ–∫!')
                                    except:
                                        pass
                                del games[game['id']]
                                return
                    elif game['dungeon_type'] == 'dragon':
                        if game['dungeonlvl'] < 3:
                            game['dungeonlvl'] += 1
                            game['text'] = '–•–æ–¥ 1:\n'
                            game['turn'] = 1
                            game['effecttext'] = ''
                            players = []
                            for ids in game['players']:
                                player = game['players'][ids]
                                if player['controller'] != 'bot':
                                    players.append(player)
                            game['players'] = {}
                            for ids in players:
                                x = ids
                                game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                            for ids in game['players']:
                                team = game['players'][ids]['id']
                                break
                            for ids in game['players']:
                                player = game['players'][ids]
                                player['team'] = team
                            dragonamount = 0
                            knightamount = 0
                            dragons = []
                            knights = []
                            if game['dungeonlvl'] == 2:
                                dragonamount = len(players)
                            if game['dungeonlvl'] == 3:
                                knightamount = len(players)
                            i = 0
                            while i < dragonamount:
                                dragon = summon_dragon(game, len(dragons))
                                dragons.append(dragon)
                                i += 1
                            i = 0 
                            while i < knightamount:
                                knight = summon_knight(game, len(knights))
                                knights.append(knight)
                                i += 1
                            i = 0
                            for ids in knights:
                                game['players'].update(ids)
                            for ids in dragons:
                                game['players'].update(ids)
                            try:
                                sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                    game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                            except: 
                                pass
                            for ids in game['spectators']:
                                if ids not in game['players']:
                                    try:
                                        for idss in game['players']:
                                            xx = game['players'][idss]
                                            break
                                        sendm(bot, ids, '[' + xx['name'] + ']\n' + '–≠—Ç–∞–∂ ' + str(
                                            game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                    except:
                                        pass

                            threading.Timer(2, select_weapon, args=[game]).start()
                            return
                        else:
                            if game['dungeonlvl'] == 3:
                                game['dungeonlvl'] += 1
                                game['text'] = '–•–æ–¥ 1:\n'
                                game['turn'] = 1
                                game['effecttext'] = ''
                                players = []
                                for ids in game['players']: 
                                    player = game['players'][ids]
                                    if player['controller'] != 'bot':
                                        players.append(player)
                                game['players'] = {}
                                for ids in players:
                                    x = ids
                                    game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                                for ids in game['players']:
                                    team = game['players'][ids]['id']
                                    break
                                for ids in game['players']:
                                    player = game['players'][ids]
                                    player['team'] = player['id'] 
                                if len(game['players']) > 1:
                                    try:
                                        sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(game[
                                                                                       'dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –Ω–∞–≥—Ä–∞–¥—É –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                    except:
                                        pass
                                    for ids in game['spectators']:
                                        try:
                                            sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(game[
                                                                                    'dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –Ω–∞–≥—Ä–∞–¥—É –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                        except:
                                            pass
                                    threading.Timer(2, select_weapon, args=[game]).start() 
                                else:
                                    for ids in game['players']:
                                        player = game['players'][ids]
                                    try:
                                        sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∏–ª –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –¥–∞–Ω–∂ –¥—Ä–∞–∫–æ–Ω–∞!')
                                    except:
                                        pass

                                    users.update_one({'id': player['id']}, {'$set': {'dragon_reward': True}})
                                    try:
                                        users.update_one({'id': player['id']}, {'$inc': {'dragon_wins': 1}})
                                    except:
                                        users.update_one({'id': player['id']}, {'$set': {'dragon_wins': 1}})
                                    sendm(bot, game['id'],
                                          'üí¨–†—ã—Ü–∞—Ä—å: –¢—ã... –ü–æ–±–µ–¥–∏–ª –º–µ–Ω—è. –ù–æ –Ω–µ —É–±–∏–ª. –°–∏–ª–∞ –¥—Ä–∞–∫–æ–Ω–∞ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –º–Ω–µ –ø–æ–≥–∏–±–Ω—É—Ç—å —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ...')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          'üí¨–†—ã—Ü–∞—Ä—å: –†–∞–∑ —Ç—ã —Å–º–æ–≥ –ø—Ä–∏–¥—Ç–∏ –≤ –º–æ–π –∑–∞–º–æ–∫, –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –º–∏–Ω–∏-–Ω–æ—Å–æ—Ä–æ–≥–∞ –∏ –ø–æ–±–µ–¥–∏—Ç—å –º–µ–Ω—è –∏ –≤ –æ–±–ª–∏–∫–µ –¥—Ä–∞–∫–æ–Ω–∞, –∏ –≤ –æ–±–ª–∏–∫–µ —Ä—ã—Ü–∞—Ä—è, —Ç—ã –¥–æ—Å—Ç–æ–∏–Ω –ø–æ–ª—É—á–∏—Ç—å —á–∞—Å—Ç–∏—Ü—É –º–æ–µ–π —Å–∏–ª—ã.')
                                    time.sleep(5)
                                    sendm(bot, game['id'],
                                          '–û–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —Å –∑–µ–º–ª–∏, –ø—Ä–µ–≤—Ä–∞—â–∞—è—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –¥—Ä–∞–∫–æ–Ω–∞.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–û–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–∞—Å—Ç—å, –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–µ—á—Ç–æ –≤—Ä–æ–¥–µ –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ —à–∞—Ä–∞, –Ω–æ —Å–≤–µ—Ç—è—â–µ–µ—Å—è –∂—ë–ª—Ç—ã–º –∏ –Ω–µ –∏—Å–ø—É—Å–∫–∞—é—â–µ–µ –∂–∞—Ä–∞.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–°–ø—É—Å—Ç—è —Å–µ–∫—É–Ω–¥—É —ç—Ç–æ –Ω–µ—á—Ç–æ –≤—Ä–µ–∑–∞–µ—Ç—Å—è –≤ –≤–∞—Å, –Ω–æ –≤—ã –Ω–µ –æ—â—É—â–∞–µ—Ç–µ —É–¥–∞—Ä–∞.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–û–Ω–æ —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è —É –≤–∞—Å –≤ –≥—Ä—É–¥–∏, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—è —Ç–µ–ø–ª–æ –ø–æ –≤—Å–µ–º—É —Ç–µ–ª—É.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          'üí¨–†—ã—Ü–∞—Ä—å: —Ç—ã —Å–∞–º –ø–æ–π–º—ë—à—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–í–∑–º–∞—Ö–Ω—É–≤ –∫—Ä—ã–ª—å—è–º–∏, –æ–Ω —É–ª–µ—Ç–∞–µ—Ç –Ω–∞ –æ–¥–Ω—É –∏–∑ –±–∞—à–µ–Ω —Å–≤–æ–µ–≥–æ –∑–∞–º–∫–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –µ–≥–æ –∏–∑ –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–ü—ã—Ç–∞—è—Å—å –≤—ã—Å–≤–æ–±–æ–¥–∏—Ç—å –Ω–æ–≤–æ–æ–±—Ä–µ—Ç–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –≤—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç–µ —Å–∏–ª–µ –≤–Ω—É—Ç—Ä–∏ –≤–∞—Å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤–∞—à–∏–º —Ç–µ–ª–æ–º.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                          '–í—ã —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç–µ—Å—å –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö, –æ–±—Ä–∞—Å—Ç–∞–µ—Ç–µ —á–µ—à—É–µ–π –∏ –æ–±—Ä–µ—Ç–∞–µ—Ç–µ –∫—Ä—ã–ª—å—è.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–í—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ –≤–∑–º–∞—Ö–Ω—É—Ç—å –∫—Ä—ã–ª—å—è–º–∏ - –∏ –±–ª–∏–∂–∞–π—à–∞—è –≥–æ—Ä—Å—Ç—å –∫–∞–º–Ω–µ–π, –æ—Å—Ç–∞–≤—à–∞—è—Å—è –ø–æ—Å–ª–µ –≤–∞—à–µ–≥–æ —Å—Ä–∞–∂–µ–Ω–∏—è, —É–ª–µ—Ç–µ–ª–∞ –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                          '–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä... –û—Ç–∫—Ä—ã–≤ –ø–∞—Å—Ç—å, –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ –µ–≥–æ, –∏ –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –º–æ–∂–µ—Ç–µ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∫—É–¥–∞ –∑–∞—Ö–æ—Ç–∏—Ç–µ.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                          '–í –∑–Ω–∞–∫ —É–≤–∞–∂–µ–Ω–∏—è –∫ —Ä—ã—Ü–∞—Ä—é, –≤—ã —Ä–µ—à–∞–µ—Ç–µ –Ω–µ –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä –≤–Ω—É—Ç—Ä–∏ –µ–≥–æ –∑–∞–º–∫–∞.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–í—ã —Å–∏–ª–æ–π –º—ã—Å–ª–∏ –¥–µ–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç–µ —à–∞—Ä –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–µ–ª–æ–≤–µ–∫–∞, –æ—â—É—â–∞—è —Å–ª–∞–±–æ—Å—Ç—å –ø–æ—Å–ª–µ —Ç–∞–∫–∏—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                          '–û–±—Ä–µ—Ç–∞—è –æ–±—ã—á–Ω—É—é —Ñ–æ—Ä–º—É, –≤—ã –ø–æ–∫–∏–¥–∞–µ—Ç–µ —ç—Ç–æ –º–µ—Å—Ç–æ.')
                                    time.sleep(1)
                                    sendm(bot, game['id'],
                                          player["name"]+' –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: –°–∏–ª–∞ –¥—Ä–∞–∫–æ–Ω–∞!')
                                    del games[game['id']]
                                    return
                                return
                            else:
                                player = winner 
                                try:
                                    sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–±–µ–¥–∏–ª —Ä—ã—Ü–∞—Ä—è!')
                                except: 
                                    pass
                                users.update_one({'id': player['id']}, {'$set': {'dragon_reward': True}})
                                try:
                                    users.update_one({'id': player['id']}, {'$inc': {'dragon_wins': 1}})
                                except:
                                    users.update_one({'id': player['id']}, {'$set': {'dragon_wins': 1}})
                                sendm(bot, game['id'],
                                      'üí¨–†—ã—Ü–∞—Ä—å: –¢—ã... –ü–æ–±–µ–¥–∏–ª –º–µ–Ω—è. –ù–æ –Ω–µ —É–±–∏–ª. –°–∏–ª–∞ –¥—Ä–∞–∫–æ–Ω–∞ –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç –º–Ω–µ –ø–æ–≥–∏–±–Ω—É—Ç—å —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ...')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      'üí¨–†—ã—Ü–∞—Ä—å: –†–∞–∑ —Ç—ã —Å–º–æ–≥ –ø—Ä–∏–¥—Ç–∏ –≤ –º–æ–π –∑–∞–º–æ–∫, –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –º–∏–Ω–∏-–Ω–æ—Å–æ—Ä–æ–≥–∞ –∏ –ø–æ–±–µ–¥–∏—Ç—å –º–µ–Ω—è –∏ –≤ –æ–±–ª–∏–∫–µ –¥—Ä–∞–∫–æ–Ω–∞, –∏ –≤ –æ–±–ª–∏–∫–µ —Ä—ã—Ü–∞—Ä—è, —Ç—ã –¥–æ—Å—Ç–æ–∏–Ω –ø–æ–ª—É—á–∏—Ç—å —á–∞—Å—Ç–∏—Ü—É –º–æ–µ–π —Å–∏–ª—ã.')
                                time.sleep(5)
                                sendm(bot, game['id'],
                                      '–û–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —Å –∑–µ–º–ª–∏, –ø—Ä–µ–≤—Ä–∞—â–∞—è—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –¥—Ä–∞–∫–æ–Ω–∞.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–û–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–∞—Å—Ç—å, –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–µ—á—Ç–æ –≤—Ä–æ–¥–µ –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ —à–∞—Ä–∞, –Ω–æ —Å–≤–µ—Ç—è—â–µ–µ—Å—è –∂—ë–ª—Ç—ã–º –∏ –Ω–µ –∏—Å–ø—É—Å–∫–∞—é—â–µ–µ –∂–∞—Ä–∞.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–°–ø—É—Å—Ç—è —Å–µ–∫—É–Ω–¥—É —ç—Ç–æ –Ω–µ—á—Ç–æ –≤—Ä–µ–∑–∞–µ—Ç—Å—è –≤ –≤–∞—Å, –Ω–æ –≤—ã –Ω–µ –æ—â—É—â–∞–µ—Ç–µ —É–¥–∞—Ä–∞.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–û–Ω–æ —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è —É –≤–∞—Å –≤ –≥—Ä—É–¥–∏, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—è —Ç–µ–ø–ª–æ –ø–æ –≤—Å–µ–º—É —Ç–µ–ª—É.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      'üí¨–†—ã—Ü–∞—Ä—å: —Ç—ã —Å–∞–º –ø–æ–π–º—ë—à—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–í–∑–º–∞—Ö–Ω—É–≤ –∫—Ä—ã–ª—å—è–º–∏, –æ–Ω —É–ª–µ—Ç–∞–µ—Ç –Ω–∞ –æ–¥–Ω—É –∏–∑ –±–∞—à–µ–Ω —Å–≤–æ–µ–≥–æ –∑–∞–º–∫–∞, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –µ–≥–æ –∏–∑ –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–ü—ã—Ç–∞—è—Å—å –≤—ã—Å–≤–æ–±–æ–¥–∏—Ç—å –Ω–æ–≤–æ–æ–±—Ä–µ—Ç–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, –≤—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç–µ —Å–∏–ª–µ –≤–Ω—É—Ç—Ä–∏ –≤–∞—Å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤–∞—à–∏–º —Ç–µ–ª–æ–º.')
                                time.sleep(4)
                                sendm(bot, game['id'],
                                      '–í—ã —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç–µ—Å—å –≤ —Ä–∞–∑–º–µ—Ä–∞—Ö, –æ–±—Ä–∞—Å—Ç–∞–µ—Ç–µ —á–µ—à—É–µ–π –∏ –æ–±—Ä–µ—Ç–∞–µ—Ç–µ –∫—Ä—ã–ª—å—è.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–í—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ –≤–∑–º–∞—Ö–Ω—É—Ç—å –∫—Ä—ã–ª—å—è–º–∏ - –∏ –±–ª–∏–∂–∞–π—à–∞—è –≥–æ—Ä—Å—Ç—å –∫–∞–º–Ω–µ–π, –æ—Å—Ç–∞–≤—à–∞—è—Å—è –ø–æ—Å–ª–µ –≤–∞—à–µ–≥–æ —Å—Ä–∞–∂–µ–Ω–∏—è, —É–ª–µ—Ç–µ–ª–∞ –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.')
                                time.sleep(4)
                                sendm(bot, game['id'],
                                      '–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä... –û—Ç–∫—Ä—ã–≤ –ø–∞—Å—Ç—å, –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ –µ–≥–æ, –∏ –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –º–æ–∂–µ—Ç–µ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∫—É–¥–∞ –∑–∞—Ö–æ—Ç–∏—Ç–µ.')
                                time.sleep(4)
                                sendm(bot, game['id'],
                                      '–í –∑–Ω–∞–∫ —É–≤–∞–∂–µ–Ω–∏—è –∫ —Ä—ã—Ü–∞—Ä—é, –≤—ã —Ä–µ—à–∞–µ—Ç–µ –Ω–µ –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä –≤–Ω—É—Ç—Ä–∏ –µ–≥–æ –∑–∞–º–∫–∞.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–í—ã —Å–∏–ª–æ–π –º—ã—Å–ª–∏ –¥–µ–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç–µ —à–∞—Ä –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–µ–ª–æ–≤–µ–∫–∞, –æ—â—É—â–∞—è —Å–ª–∞–±–æ—Å—Ç—å –ø–æ—Å–ª–µ —Ç–∞–∫–∏—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π.')
                                time.sleep(3)
                                sendm(bot, game['id'],
                                      '–û–±—Ä–µ—Ç–∞—è –æ–±—ã—á–Ω—É—é —Ñ–æ—Ä–º—É, –≤—ã –ø–æ–∫–∏–¥–∞–µ—Ç–µ —ç—Ç–æ –º–µ—Å—Ç–æ.')
                                time.sleep(1)
                                sendm(bot, game['id'],
                                      player["name"]+' –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: –°–∏–ª–∞ –¥—Ä–∞–∫–æ–Ω–∞!')

                                del games[game['id']]
                                return
                    elif game['dungeon_type'] == 'dark':
                        if game['dungeonlvl'] < 3:
                            game['dungeonlvl'] += 1
                            game['text'] = '–•–æ–¥ 1:\n'
                            game['turn'] = 1 
                            game['effecttext'] = ''
                            players = []
                            for ids in game['players']:
                                player = game['players'][ids]
                                if player['controller'] != 'bot':
                                    players.append(player)
                            game['players'] = {}
                            for ids in players:
                                x = ids
                                game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                            for ids in game['players']:
                                team = game['players'][ids]['id']
                                break 
                            for ids in game['players']:
                                player = game['players'][ids]
                                player['team'] = team
                            darknessamount = 0
                            darkratamount = 0
                            amalgamaamount = 0
                            darkrats = []
                            darknesss = []
                            amalgamas = []
                            if game['dungeonlvl'] == 2:
                                amalgamaamount = len(players)
                            if game['dungeonlvl'] == 3:
                                darkratamount = 0
                                darknessamount = 1
                                # plen = len(game['players'])
                                # while plen >= 4:
                                #    darknessamount += 1
                                #    plen -= 4
                            i = 0
                            while i < darkratamount:
                                darkrat = summon_darkrat(game, len(darkrats))
                                darkrats.append(darkrat)
                                i += 1
                            i = 0
                            while i < darknessamount:
                                darkness = summon_darkness(game, len(darknesss))
                                darknesss.append(darkness)
                                i += 1
                            i = 0
                            while i < amalgamaamount:
                                amalgama = summon_amalgama(game, amalgamas)
                                amalgamas.append(amalgama)
                                i += 1
                            for ids in darkrats:
                                game['players'].update(ids)
                            for ids in darknesss:
                                game['players'].update(ids)
                            for ids in amalgamas:
                                game['players'].update(ids)
                            try:
                                sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                    game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                            except:
                                pass
                            for ids in game['spectators']:
                                try:
                                    sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(
                                        game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                except:
                                    pass

                            threading.Timer(2, select_weapon, args=[game]).start()
                            return
                        else:
                            if game['dungeonlvl'] == 3:
                                game['dungeonlvl'] += 1
                                game['text'] = '–•–æ–¥ 1:\n'
                                game['turn'] = 1
                                game['effecttext'] = ''
                                players = []
                                for ids in game['players']:
                                    player = game['players'][ids]
                                    if player['controller'] != 'bot':
                                        players.append(player)
                                game['players'] = {}
                                for ids in players:
                                    x = ids
                                    game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                                for ids in game['players']:
                                    team = game['players'][ids]['id']
                                    break
                                for ids in game['players']:
                                    player = game['players'][ids]
                                    player['team'] = player['id']
                                if len(game['players']) > 1:
                                    try:
                                        sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                            game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è ' +
                                                         '–Ω–∞–≥—Ä–∞–¥–æ–π –¥–∞–Ω–∂–∞ —Ç—å–º—ã –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                    except:
                                        pass 
                                    for ids in game['spectators']:
                                        try: 
                                            sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(
                                                game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è ' +
                                                             '–Ω–∞–≥—Ä–∞–¥–æ–π –¥–∞–Ω–∂–∞ —Ç—å–º—ã –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                        except:
                                            pass
                                    threading.Timer(2, select_weapon, args=[game]).start()
                                else:
                                    for ids in game['players']:
                                        player = game['players'][ids]
                                    try:
                                        sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –¥–∞–Ω–∂–∞ —Ç—å–º—ã!')
                                    except:
                                        pass
                                    users.update_one({'id': player['id']}, {'$set': {'dark_reward': True}})
                                    try:
                                        users.update_one({'id': player['id']}, {'$inc': {'darkness_wins': 1}})
                                    except:
                                        users.update_one({'id': player['id']}, {'$set': {'darkness_wins': 1}})
                                    for ids in game['spectators']:
                                        try:
                                            sendm(bot, ids, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –¥–∞–Ω–∂–∞ —Ç—å–º—ã!')
                                        except:
                                            pass
                                    sendm(bot, game['id'],
                                                     '–°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã —Å–ø—Ä—è—Ç–∞–ª–∏—Å—å –∑–∞ –¥–≤–µ—Ä—å—é, –æ–Ω–∞ –∏—Å—á–µ–∑–ª–∞. –ü—Ä–æ—Å—Ç–æ —Ä–∞—Å—Ç–≤–æ—Ä–∏–ª–∞—Å—å –≤ –≤–æ–∑–¥—É—Ö–µ. –í—ã ' +
                                                     '–∑–∞–≥–ª—è–Ω—É–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –≤—ã—à–ª–∏, –∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–∏—á–µ–≥–æ. –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è ' +
                                                     '—Ç—å–º–∞, –±–µ–∑ –µ–¥–∏–Ω–æ–≥–æ –Ω–∞–º–µ–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.')
                                    time.sleep(6)
                                    sendm(bot, game['id'],
                                                     '–í–∏–¥–∏–º–æ, –≤–∑—Ä—ã–≤ —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞ —É–Ω–∏—á—Ç–æ–∂–∏–ª –≤—Å–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏–ª–æ—Å—å –≤ –∫–æ–º–Ω–∞—Ç–µ.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                                     'üí¨' + player[
                                                         'name'] + ': –•–æ—Ä–æ—à–æ, —á—Ç–æ –º—ã—Å–ª—å —Å–ø—Ä—è—Ç–∞—Ç—å—Å—è –∑–∞ –¥–≤–µ—Ä—å—é –ø—Ä–∏—à–ª–∞ –º–Ω–µ —Ä–∞–Ω—å—à–µ, —á–µ–º –æ–Ω–æ —Ä–µ—à–∏–ª–æ –≤–∑–æ—Ä–≤–∞—Ç—å—Å—è.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                                     '–ü–æ–∫–∏–¥–∞—è –ø–æ–¥–∑–µ–º–µ–ª—å–µ, –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–Ω–æ–µ –æ—â—É—â–µ–Ω–∏–µ, –∫–∞–∫ –±—É–¥—Ç–æ —Ç–µ–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤—Å–µ –µ—â–µ ' +
                                                     '–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –≤–∞—Å.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                                     '–ü–æ–≤–∏–Ω—É—è—Å—å —ç—Ç–æ–º—É —á—É–≤—Å—Ç–≤—É, –≤—ã –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ —Ä—É–∫—É –≤ —Å—Ç–æ—Ä–æ–Ω—É –≥–æ–ª—É–±—è, –ø—Ä–æ–ª–µ—Ç–∞–≤—à–µ–≥–æ –Ω–∞–¥ –≤–∞–º–∏. ' +
                                                     '–°—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ —Ç–µ–º–Ω–æ–≥–æ —Ç—É–º–∞–Ω–∞ –≤—ã—Ä–≤–∞–ª—Å—è –∏–∑ –≤–∞—à–µ–π –ª–∞–¥–æ–Ω–∏ –∏ –Ω–∞–ø—Ä–∞–≤–∏–ª—Å—è –≤ —Å—Ç–æ—Ä–æ–Ω—É –ø—Ç–∏—Ü—ã.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                                     '–ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω –¥–æ—Å—Ç–∏–≥ —Ü–µ–ª–∏ - —Ç–∞ —É–ø–∞–ª–∞ –Ω–∞ –∑–µ–º–ª—é –∑–∞–º–µ—Ç—Ä–≤–æ.')
                                    time.sleep(2)
                                    sendm(bot, game['id'], 'üí¨' + player[
                                        'name'] + ': –ù–µ —è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞–ª —ç—Ç–æ –∂–µ–ª–∞–Ω–∏–µ... –ù–∞–¥–æ –±—ã—Ç—å –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ —Å —ç—Ç–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π.')
                                    time.sleep(2)
                                    sendm(bot, game['id'], '–ü–æ–ª—É—á–µ–Ω–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: *–≠–Ω–µ—Ä–≥–∏—è —Ç—å–º—ã*!',
                                                     parse_mode='markdown')
                                    del games[game['id']]
                                    return
                                return
                            else:
                                player = winner 
                                try:
                                    sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∏–ª —ç–Ω–µ—Ä–≥–∏—é —Ç—å–º—ã!')
                                except: 
                                    pass
                                users.update_one({'id': player['id']}, {'$set': {'dark_reward': True}})
                                try:
                                    users.update_one({'id': player['id']}, {'$inc': {'darkness_wins': 1}})
                                except:
                                    users.update_one({'id': player['id']}, {'$set': {'darkness_wins': 1}})
                                sendm(bot, game['id'], player[
                                    'name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –¥–∞–Ω–∂–∞ —Ç—å–º—ã!')
                                for ids in game['spectators']:
                                    try:
                                        sendm(bot, ids, player[
                                            'name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –¥–∞–Ω–∂–∞ —Ç—å–º—ã!')
                                    except:
                                        pass
                                del games[game['id']]
                                return
                    elif game['dungeon_type'] == 'ghoul':
                        if game['dungeonlvl'] < 3:
                            game['dungeonlvl'] += 1
                            game['text'] = '–•–æ–¥ 1:\n'
                            game['turn'] = 1
                            game['effecttext'] = ''
                            players = []
                            for ids in game['players']:
                                player = game['players'][ids]
                                if player['controller'] != 'bot':
                                    players.append(player)
                            game['players'] = {}
                            for ids in players:
                                x = ids
                                game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                            for ids in game['players']:
                                team = game['players'][ids]['id']
                                break
                            for ids in game['players']:
                                player = game['players'][ids]
                                player['team'] = team
                            ghoulamount = 0
                            necromantamount = 0
                            weakskeleamount = 0
                            ghouls = []
                            necromants = []
                            weakskeles = []
                            if game['dungeonlvl'] == 2:
                                ghoulamount = len(players)
                                weakskeleamount = len(players)
                            if game['dungeonlvl'] == 3:
                                necromantamount = 1
                                # plen = len(game['players'])
                                # while plen >= 4:
                                #    necromantamount += 1
                                #    plen -= 4
                            i = 0
                            while i < ghoulamount:
                                ghoul = summon_ghoul(game, len(ghouls))
                                ghouls.append(ghoul)
                                i += 1
                            i = 0
                            while i < necromantamount:
                                necromant = summon_necromant(game, len(necromants))
                                necromants.append(necromant)
                                i += 1
                            i = 0
                            while i < weakskeleamount:
                                weakskele = summon_weakskele(game, len(weakskeles),
                                                             weakskeletype='afraid_of_loneliness')
                                weakskeles.append(weakskele)
                                i += 1
                            for ids in weakskeles:
                                game['players'].update(ids)
                            for ids in ghouls:
                                game['players'].update(ids)
                            for ids in necromants:
                                game['players'].update(ids)
                            try:
                                sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                    game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                            except:
                                pass
                            for ids in game['spectators']:
                                try:
                                    sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(
                                        game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                except:
                                    pass

                            threading.Timer(2, select_weapon, args=[game]).start()
                            return
                        else:
                            if game['dungeonlvl'] == 3:
                                game['dungeonlvl'] += 1
                                game['text'] = '–•–æ–¥ 1:\n'
                                game['turn'] = 1
                                game['effecttext'] = ''
                                players = []
                                for ids in game['players']:
                                    player = game['players'][ids]
                                    if player['controller'] != 'bot':
                                        players.append(player)
                                game['players'] = {}
                                for ids in players:
                                    x = ids
                                    game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo']))
                                for ids in game['players']:
                                    team = game['players'][ids]['id']
                                    break
                                for ids in game['players']:
                                    player = game['players'][ids]
                                    player['team'] = player['id']
                                if len(game['players']) > 1:
                                    try:
                                        sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                            game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è ' +
                                                         '–ø–æ—Å–æ—Ö–æ–º –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                    except:
                                        pass
                                    for ids in game['spectators']:
                                        try:
                                            sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(
                                                game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –ë–∏—Ç–≤–∞ –∑–∞ –ø—Ä–∞–≤–æ –≤–ª–∞–¥–µ–Ω–∏—è ' +
                                                             '–ø–æ—Å–æ—Ö–æ–º –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                        except:
                                            pass
                                    threading.Timer(2, select_weapon, args=[game]).start()
                                else:
                                    for ids in game['players']:
                                        player = game['players'][ids]
                                    try:
                                        sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞!')
                                    except:
                                        pass
                                    users.update_one({'id': player['id']}, {'$set': {'staff_of_necromant': True}})
                                    try:
                                        users.update_one({'id': player['id']}, {'$inc': {'necromant_wins': 1}})
                                    except:
                                        users.update_one({'id': player['id']}, {'$set': {'necromant_wins': 1}})
                                    for ids in game['spectators']:
                                        try:
                                            sendm(bot, ids, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞!')
                                        except:
                                            pass
                                    sendm(bot, game['id'],
                                                     '–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –Ω–∞–Ω–µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–¥–∞—Ä –ø–æ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç—É, –µ–≥–æ —Ç–µ–ª–æ —Ç—É—Ç –∂–µ ' +
                                                     '–ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–æ—Å—å –≤ –ø—Ä–∞—Ö. –û—Å—Ç–∞–ª—Å—è –ª–∏—à—å –ø–æ—Å–æ—Ö —Å —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —á–µ—Ä–µ–ø–æ–º –Ω–∞ –∫–æ–Ω—Ü–µ. ' +
                                                     '–í—ã —Ä–µ—à–∞–µ—Ç–µ –≤–∑—è—Ç—å –µ–≥–æ –≤ —Ä—É–∫–∏...')
                                    time.sleep(6)
                                    sendm(bot, game['id'],
                                                     '–í—ã –∂–¥–µ—Ç–µ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É. –ü—è—Ç—å. –î–µ—Å—è—Ç—å. –ö–∞–∂–µ—Ç—Å—è, –ø–æ—Å–æ—Ö –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —É–±–∏–≤–∞—Ç—å –≤–∞—Å. –í–¥—Ä—É–≥ –µ–≥–æ –≥–ª–∞–∑–Ω–∏—Ü—ã ' +
                                                     '–∑–∞–≥–æ—Ä–µ–ª–∏—Å—å —á–µ—Ä–Ω—ã–º —Å–≤–µ—Ç–æ–º, –∫–∞–∫ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç –ø—ã—Ç–∞–ª—Å—è –ø—Ä–∏–∑–≤–∞—Ç—å –≥–∏–≥–∞–Ω—Ç—Å–∫–∏—Ö —Å–∫–µ–ª–µ—Ç–æ–≤.')
                                    time.sleep(4)
                                    if game['dead_skeletons'] == 0:
                                        sendm(bot, game['id'],
                                                         '–í—ã –æ—â—É—â–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–Ω—É—é —Å–∏–ª—É. –î–µ–ª–∞–µ—Ç–µ –≤–∑–º–∞—Ö –ø–æ—Å–æ—Ö–æ–º - –∏ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–∞—Ä—å–µ—Ä.' +
                                                         ' –°–ø—É—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏–∑ –∞—Ä–∫–∏, —è–≤–ª—è—é—â–µ–π—Å—è –≤—Ö–æ–¥–æ–º –≤ —ç—Ç–æ—Ç –∑–∞–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç, –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã ' +
                                                         '—Ä–µ—à–∏–ª–∏ –Ω–µ —É–±–∏–≤–∞—Ç—å.')
                                        time.sleep(5)
                                        sendm(bot, game['id'],
                                                         'üí¨–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç|ü¶¥: –ü–æ–≤–µ–ª–∏-–∏-–∏-–∏—Ç–µ–ª—å! –ü—Ä–∏–∫–∞-–∞-–∞-–∞–∑—ã–≤–∞–π—Ç–µ!')
                                        time.sleep(3)
                                        sendm(bot, game['id'],
                                                         '–°–∏–ª–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –æ—â—É—Ç–∏–ª–∏ - —Å–∏–ª–∞ –ø–æ–≤–µ–ª–µ–≤–∞—Ç—å –º—ë—Ä—Ç–≤—ã–º–∏. –í–º–µ—Å—Ç–µ —Å —ç—Ç–∏–º –≤—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø–æ–Ω–∏–º–∞—Ç—å, ' +
                                                         '–æ —á–µ–º –æ–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç. –ò –ø–µ—Ä–≤—ã–π –≤–∞—à –ø—Ä–∏–∫–∞–∑ –±—ã–ª...')
                                        time.sleep(4)
                                        sendm(bot, game['id'], 'üí¨' + player['name'] + ': ' + player[
                                            'name'] + ' –ø–æ–≤–µ–ª–µ–≤–∞–µ—Ç - —Ç—ã —Å–≤–æ–±–æ–¥–µ–Ω!')
                                        time.sleep(3) 
                                        sendm(bot, game['id'], 'üí¨–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç|ü¶¥: –°–ø–∞—Å–∏-–∏-–∏-–∏–±–æ...')
                                        time.sleep(3)
                                        sendm(bot, game['id'],
                                                         '–ü–æ—Å–ª–µ —á–µ–≥–æ –¥—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç —Ä–∞—Å—Å—ã–ø–∞–ª—Å—è, –ø—Ä–µ–≤—Ä–∞—Ç–∏–≤—à–∏—Å—å –≤ –æ–±—ã—á–Ω—É—é –≥—Ä—É–¥—É –∫–æ—Å—Ç–µ–π. –ï—â—ë –≤ –ø–µ—Ä–≤–æ–º –±–æ—é ' +
                                                         '–≤—ã –ø–æ–Ω—è–ª–∏, —á—Ç–æ —ç—Ç–æ–º—É —Å–∫–µ–ª–µ—Ç—É –¥–∞–∂–µ –∑–∞–≥—Ä–æ–±–Ω–∞—è –∂–∏–∑–Ω—å –Ω–∞–¥–æ–µ–ª–∞.')
                                        time.sleep(4)
                                        sendm(bot, game['id'],
                                                         '–ö–æ–≥–¥–∞ —Å–∫–µ–ª–µ—Ç–æ–º –±—ã–ª –∏—Å–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏–∫–∞–∑, –º–∞–≥–∏—á–µ—Å–∫–∞—è –æ–±–æ–ª–æ—á–∫–∞ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –∏—Å—á–µ–∑–ª–∞, –∏ –≤—ã –æ—â—É—Ç–∏–ª–∏ ' +
                                                         '—Ä–µ–∑–∫–∏–π —É–ø–∞–¥–æ–∫ —Å–∏–ª.')
                                        time.sleep(3)
                                        sendm(bot, game['id'], 'üí¨' + player[
                                            'name'] + ': –î–æ–ª–≥–∞—è –∂–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ —É —ç—Ç–æ–π —à—Ç—É–∫–æ–≤–∏–Ω—ã...')
                                        time.sleep(3)
                                        sendm(bot, game['id'], '–ü–æ–ª—É—á–µ–Ω–æ –æ—Ä—É–∂–∏–µ: *–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞*!',
                                                         parse_mode='markdown')
                                    else:
                                        sendm(bot, game['id'],
                                                         '–í—ã –æ—â—É—â–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–Ω—É—é —Å–∏–ª—É. –î–µ–ª–∞–µ—Ç–µ –≤–∑–º–∞—Ö –ø–æ—Å–æ—Ö–æ–º - –∏ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–∞—Ä—å–µ—Ä.' +
                                                         ' –°–ø—É—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –≤—ã–∫–∞–ø—ã–≤–∞–µ—Ç—Å—è —Å–∫–µ–ª–µ—Ç.')
                                        time.sleep(4)
                                        sendm(bot, game['id'],
                                                         'üí¨–°–∫–µ–ª–µ—Ç|üíÄ: –ü–æ–≤–µ–ª–∏-–∏-–∏-–∏—Ç–µ–ª—å! –ü—Ä–∏–∫–∞-–∞-–∞-–∞–∑—ã–≤–∞–π—Ç–µ!')
                                        time.sleep(3)
                                        sendm(bot, game['id'],
                                                         '–°–∏–ª–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –æ—â—É—Ç–∏–ª–∏ - —Å–∏–ª–∞ –ø–æ–≤–µ–ª–µ–≤–∞—Ç—å –º—ë—Ä—Ç–≤—ã–º–∏. –í–º–µ—Å—Ç–µ —Å —ç—Ç–∏–º –≤—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø–æ–Ω–∏–º–∞—Ç—å, ' +
                                                         '–æ —á–µ–º –æ–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç.')
                                        time.sleep(4)
                                        sendm(bot, game['id'], 'üí¨' + player['name'] + ': ' + player[
                                            'name'] + ' –ø–æ–≤–µ–ª–µ–≤–∞–µ—Ç - –≤–µ—Ä–Ω–∏—Å—å –≤ –∑–µ–º–ª—é!')
                                        time.sleep(2)
                                        sendm(bot, game['id'], 'üí¨–°–∫–µ–ª–µ—Ç|üíÄ: –ö–∞-–∞-–∞–∫ –ø—Ä–∏–∫–∞-–∞-–∞-–∞–∂–µ—Ç–µ!')
                                        time.sleep(2)
                                        sendm(bot, game['id'], '–ü–æ—Å–ª–µ —á–µ–≥–æ —Å–∫–µ–ª–µ—Ç –∑–∞–∫–æ–ø–∞–ª—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –∑–µ–º–ª—é.')
                                        time.sleep(2)
                                        sendm(bot, game['id'],
                                                         '–ö–æ–≥–¥–∞ —Å–∫–µ–ª–µ—Ç–æ–º –±—ã–ª –∏—Å–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏–∫–∞–∑, –º–∞–≥–∏—á–µ—Å–∫–∞—è –æ–±–æ–ª–æ—á–∫–∞ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –∏—Å—á–µ–∑–ª–∞, –∏ –≤—ã –æ—â—É—Ç–∏–ª–∏ ' +
                                                         '—Ä–µ–∑–∫–∏–π —É–ø–∞–¥–æ–∫ —Å–∏–ª.')
                                        time.sleep(3)
                                        sendm(bot, game['id'], 'üí¨' + player[
                                            'name'] + ': –î–æ–ª–≥–∞—è –∂–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ —É —ç—Ç–æ–π —à—Ç—É–∫–æ–≤–∏–Ω—ã...')
                                        time.sleep(3)
                                        sendm(bot, game['id'], '–ü–æ–ª—É—á–µ–Ω–æ –æ—Ä—É–∂–∏–µ: *–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞*!',
                                                         parse_mode='markdown')

                                    del games[game['id']]
                                    return
                                return
                            else:
                                player = winner
                                try:
                                    sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞!')
                                except:
                                    pass
                                users.update_one({'id': player['id']}, {'$set': {'staff_of_necromant': True}})
                                try:
                                    users.update_one({'id': player['id']}, {'$inc': {'necromant_wins': 1}})
                                except:
                                    users.update_one({'id': player['id']}, {'$set': {'necromant_wins': 1}})
                                for ids in game['spectators']:
                                    try:
                                        sendm(bot, ids, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞!')
                                    except:
                                        pass

                                sendm(bot, game['id'],
                                                 '–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –Ω–∞–Ω–µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–¥–∞—Ä –ø–æ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç—É, –µ–≥–æ —Ç–µ–ª–æ —Ç—É—Ç –∂–µ ' +
                                                 '–ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–æ—Å—å –≤ –ø—Ä–∞—Ö. –û—Å—Ç–∞–ª—Å—è –ª–∏—à—å –ø–æ—Å–æ—Ö —Å —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —á–µ—Ä–µ–ø–æ–º –Ω–∞ –∫–æ–Ω—Ü–µ. ' +
                                                 '–í—ã —Ä–µ—à–∞–µ—Ç–µ –≤–∑—è—Ç—å –µ–≥–æ –≤ —Ä—É–∫–∏...')
                                time.sleep(6)
                                sendm(bot, game['id'],
                                                 '–í—ã –∂–¥–µ—Ç–µ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É. –ü—è—Ç—å. –î–µ—Å—è—Ç—å. –ö–∞–∂–µ—Ç—Å—è, –ø–æ—Å–æ—Ö –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —É–±–∏–≤–∞—Ç—å –≤–∞—Å. –í–¥—Ä—É–≥ –µ–≥–æ –≥–ª–∞–∑–Ω–∏—Ü—ã ' +
                                                 '–∑–∞–≥–æ—Ä–µ–ª–∏—Å—å —á–µ—Ä–Ω—ã–º —Å–≤–µ—Ç–æ–º, –∫–∞–∫ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç –ø—ã—Ç–∞–ª—Å—è –ø—Ä–∏–∑–≤–∞—Ç—å –≥–∏–≥–∞–Ω—Ç—Å–∫–∏—Ö —Å–∫–µ–ª–µ—Ç–æ–≤.')
                                time.sleep(4)
                                if game['dead_skeletons'] == 0:
                                    sendm(bot, game['id'],
                                                     '–í—ã –æ—â—É—â–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–Ω—É—é —Å–∏–ª—É. –î–µ–ª–∞–µ—Ç–µ –≤–∑–º–∞—Ö –ø–æ—Å–æ—Ö–æ–º - –∏ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–∞—Ä—å–µ—Ä.' +
                                                     ' –°–ø—É—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏–∑ –∞—Ä–∫–∏, —è–≤–ª—è—é—â–µ–π—Å—è –≤—Ö–æ–¥–æ–º –≤ —ç—Ç–æ—Ç –∑–∞–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç, –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã ' +
                                                     '—Ä–µ—à–∏–ª–∏ –Ω–µ —É–±–∏–≤–∞—Ç—å.')
                                    time.sleep(5)
                                    sendm(bot, game['id'],
                                                     'üí¨–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç|ü¶¥: –ü–æ–≤–µ–ª–∏-–∏-–∏-–∏—Ç–µ–ª—å! –ü—Ä–∏–∫–∞-–∞-–∞-–∞–∑—ã–≤–∞–π—Ç–µ!')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                                     '–°–∏–ª–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –æ—â—É—Ç–∏–ª–∏ - —Å–∏–ª–∞ –ø–æ–≤–µ–ª–µ–≤–∞—Ç—å –º—ë—Ä—Ç–≤—ã–º–∏. –í–º–µ—Å—Ç–µ —Å —ç—Ç–∏–º –≤—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø–æ–Ω–∏–º–∞—Ç—å, ' +
                                                     '–æ —á–µ–º –æ–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç. –ò –ø–µ—Ä–≤—ã–π –≤–∞—à –ø—Ä–∏–∫–∞–∑ –±—ã–ª...')
                                    time.sleep(4)
                                    sendm(bot, game['id'], 'üí¨' + player['name'] + ': ' + player[
                                        'name'] + ' –ø–æ–≤–µ–ª–µ–≤–∞–µ—Ç - —Ç—ã —Å–≤–æ–±–æ–¥–µ–Ω!')
                                    time.sleep(3)
                                    sendm(bot, game['id'], 'üí¨–î—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç|ü¶¥: –°–ø–∞—Å–∏-–∏-–∏-–∏–±–æ...')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                                     '–ü–æ—Å–ª–µ —á–µ–≥–æ –¥—Ä—è—Ö–ª—ã–π —Å–∫–µ–ª–µ—Ç —Ä–∞—Å—Å—ã–ø–∞–ª—Å—è, –ø—Ä–µ–≤—Ä–∞—Ç–∏–≤—à–∏—Å—å –≤ –æ–±—ã—á–Ω—É—é –≥—Ä—É–¥—É –∫–æ—Å—Ç–µ–π. –ï—â—ë –≤ –ø–µ—Ä–≤–æ–º –±–æ—é ' +
                                                     '–≤—ã –ø–æ–Ω—è–ª–∏, —á—Ç–æ —ç—Ç–æ–º—É —Å–∫–µ–ª–µ—Ç—É –¥–∞–∂–µ –∑–∞–≥—Ä–æ–±–Ω–∞—è –∂–∏–∑–Ω—å –Ω–∞–¥–æ–µ–ª–∞.')
                                    time.sleep(4)
                                    sendm(bot, game['id'],
                                                     '–ö–æ–≥–¥–∞ —Å–∫–µ–ª–µ—Ç–æ–º –±—ã–ª –∏—Å–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏–∫–∞–∑, –º–∞–≥–∏—á–µ—Å–∫–∞—è –æ–±–æ–ª–æ—á–∫–∞ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –∏—Å—á–µ–∑–ª–∞, –∏ –≤—ã –æ—â—É—Ç–∏–ª–∏ ' +
                                                     '—Ä–µ–∑–∫–∏–π —É–ø–∞–¥–æ–∫ —Å–∏–ª.')
                                    time.sleep(3)
                                    sendm(bot, game['id'], 'üí¨' + player[
                                        'name'] + ': –î–æ–ª–≥–∞—è –∂–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ —É —ç—Ç–æ–π —à—Ç—É–∫–æ–≤–∏–Ω—ã...')
                                    time.sleep(3)
                                    sendm(bot, game['id'], '–ü–æ–ª—É—á–µ–Ω–æ –æ—Ä—É–∂–∏–µ: *–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞*!',
                                                     parse_mode='markdown')
                                else:
                                    sendm(bot, game['id'],
                                                     '–í—ã –æ—â—É—â–∞–µ—Ç–µ —Å—Ç—Ä–∞–Ω–Ω—É—é —Å–∏–ª—É. –î–µ–ª–∞–µ—Ç–µ –≤–∑–º–∞—Ö –ø–æ—Å–æ—Ö–æ–º - –∏ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –æ–±—Ä–∞–∑—É–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–∞—Ä—å–µ—Ä.' +
                                                     ' –°–ø—É—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –≤—ã–∫–∞–ø—ã–≤–∞–µ—Ç—Å—è —Å–∫–µ–ª–µ—Ç.')
                                    time.sleep(4)
                                    sendm(bot, game['id'], 'üí¨–°–∫–µ–ª–µ—Ç|üíÄ: –ü–æ–≤–µ–ª–∏-–∏-–∏-–∏—Ç–µ–ª—å! –ü—Ä–∏–∫–∞-–∞-–∞-–∞–∑—ã–≤–∞–π—Ç–µ!')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                                     '–°–∏–ª–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –æ—â—É—Ç–∏–ª–∏ - —Å–∏–ª–∞ –ø–æ–≤–µ–ª–µ–≤–∞—Ç—å –º—ë—Ä—Ç–≤—ã–º–∏. –í–º–µ—Å—Ç–µ —Å —ç—Ç–∏–º –≤—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø–æ–Ω–∏–º–∞—Ç—å, ' +
                                                     '–æ —á–µ–º –æ–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç.')
                                    time.sleep(4)
                                    sendm(bot, game['id'], 'üí¨' + player['name'] + ': ' + player[
                                        'name'] + ' –ø–æ–≤–µ–ª–µ–≤–∞–µ—Ç - –≤–µ—Ä–Ω–∏—Å—å –≤ –∑–µ–º–ª—é!')
                                    time.sleep(2) 
                                    sendm(bot, game['id'], 'üí¨–°–∫–µ–ª–µ—Ç|üíÄ: –ö–∞-–∞-–∞–∫ –ø—Ä–∏–∫–∞-–∞-–∞-–∞–∂–µ—Ç–µ!')
                                    time.sleep(2)
                                    sendm(bot, game['id'], '–ü–æ—Å–ª–µ —á–µ–≥–æ —Å–∫–µ–ª–µ—Ç –∑–∞–∫–æ–ø–∞–ª—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –∑–µ–º–ª—é.')
                                    time.sleep(2)
                                    sendm(bot, game['id'],
                                                     '–ö–æ–≥–¥–∞ —Å–∫–µ–ª–µ—Ç–æ–º –±—ã–ª –∏—Å–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏–∫–∞–∑, –º–∞–≥–∏—á–µ—Å–∫–∞—è –æ–±–æ–ª–æ—á–∫–∞ –≤–æ–∫—Ä—É–≥ –≤–∞—Å –∏—Å—á–µ–∑–ª–∞, –∏ –≤—ã –æ—â—É—Ç–∏–ª–∏ ' +
                                                     '—Ä–µ–∑–∫–∏–π —É–ø–∞–¥–æ–∫ —Å–∏–ª.')
                                    time.sleep(3)
                                    sendm(bot, game['id'], 'üí¨' + player[
                                        'name'] + ': –î–æ–ª–≥–∞—è –∂–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ —É —ç—Ç–æ–π —à—Ç—É–∫–æ–≤–∏–Ω—ã...')
                                    time.sleep(3)
                                    sendm(bot, game['id'], '–ü–æ–ª—É—á–µ–Ω–æ –æ—Ä—É–∂–∏–µ: *–ü–æ—Å–æ—Ö –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∞*!',
                                                     parse_mode='markdown')
                                try:
                                    game['timer'].cancel()
                                except:
                                    pass
                                idstoremove = []
                                for ids in game['alltimers']:
                                    try:
                                        ids.cancel()
                                        # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                                        idstoremove.append(ids)
                                    except:
                                        pass
                                for ids in idstoremove:
                                    game['alltimers'].remove(ids)
                                del games[game['id']]
                                return

                    elif game['dungeon_type'] == 'hell':
                        if game['dungeonlvl'] < 3:
                            game['dungeonlvl'] += 1
                            game['text'] = '–•–æ–¥ 1:\n'
                            game['turn'] = 1
                            game['effecttext'] = ''
                            players = []
                            for ids in game['players']:
                                player = game['players'][ids]
                                if player['controller'] != 'bot':
                                    players.append(player)
                            game['players'] = {}
                            for ids in players:
                                x = ids
                                game['players'].update(createplayer(uid=x['id'], name=x['name'], photo=x['photo'], completed_hell=x['completed_hell']))
                            for ids in game['players']:
                                team = game['players'][ids]['id']
                                break
                            for ids in game['players']:
                                player = game['players'][ids]
                                player['team'] = team
                            eyedemonamount = 0
                            radiodemonamount = 0
                            magmawormamount = 0
                            eyedemons = []
                            radiodemons = []
                            magmaworms = []

                            playervalue = len(players)
                            if game['dungeonlvl'] == 2:
                                magmawormamount = len(players)
                                eyedemonamount = len(players)
                            if game['dungeonlvl'] == 3:
                                radiodemonamount = 1
                                # plen = len(game['players'])
                                # while plen >= 4:
                                #    necromantamount += 1
                                #    plen -= 4
                            i = 0
                            while i < eyedemonamount:
                                eyedemon = summon_eyedemon(game, len(eyedemons), hp = 4)
                                eyedemons.append(eyedemon)
                                i += 1
                            i = 0
                            while i < magmawormamount:
                                magmaworm = summon_magmaworm(game, len(magmaworms))
                                magmaworms.append(magmaworm)
                                i += 1
                            i = 0
                            while i < radiodemonamount:
                                radiodemon = summon_radiodemon(game)
                                radiodemons.append(radiodemon)
                                i += 1
                            i = 0

                            for ids in radiodemons:
                                game['players'].update(ids)
                            for ids in magmaworms:
                                game['players'].update(ids)
                            for ids in eyedemons:
                                game['players'].update(ids)
                            try:
                                sendm(bot, game['id'], '–≠—Ç–∞–∂ ' + str(
                                    game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                            except:
                                pass
                            for ids in game['spectators']:
                                try:
                                    sendm(bot, ids, '–≠—Ç–∞–∂ ' + str(
                                        game['dungeonlvl'] - 1) + ' –ø—Ä–æ–π–¥–µ–Ω! –í—ã —Å–ø—É—Å–∫–∞–µ—Ç–µ—Å—å –Ω–∏–∂–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ –æ—Ä—É–∂–∏–µ!')
                                except:
                                    pass

                            threading.Timer(2, select_weapon, args=[game]).start()
                            return
                        else:
                            if game['dungeonlvl'] == 3:
                                if True:
                                    for ids in game['players']:
                                        player = game['players'][ids]
                                        try:
                                            sendm(bot, pasyuk_id, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–∫—Ä–æ–≤–∏—â–µ –∞–¥–∞!')
                                        except:
                                            pass
                                        try:
                                            users.update_one({'id': player['id']}, {'$inc': {'hell_wins': 1}})
                                        except:
                                            users.update_one({'id': player['id']}, {'$set': {'hell_wins': 1}})
                                        users.update_one({'id': player['id']}, {'$set': {'hell_reward': True}})
                                        for ids in game['spectators']:
                                            try:
                                                sendm(bot, ids, player['name'] + ' –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–∫—Ä–æ–≤–∏—â–µ –∞–¥–∞!')
                                            except:
                                                pass
                                    sendm(bot, game['id'], '–í–Ω–µ–∑–∞–ø–Ω–æ —É–ø–∞–≤—à–∏–π –Ω–∞ –∑–µ–º–ª—é –ê–ª–∞—Å—Ç–æ—Ä –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–∏ –≤ —á–µ–º –Ω–µ –±—ã–≤–∞–ª–æ.')
                                    time.sleep(5)
                                    sendm(bot, game['id'],
                                                     'üí¨–ê–ª–∞—Å—Ç–æ—Ä|‚ù§Ô∏è‚Äçüî•: –î—É–º–∞–ª–∏, —è —É–º–µ—Ä? –ú—ã –≤ –∞–¥—É, —è –£–ñ–ï –ú–Å–†–¢–í!')
                                    time.sleep(2)
                                    sendm(bot, game['id'],
                                                     '–û–Ω –∑–∞—Å–º–µ—è–ª—Å—è.')
                                    time.sleep(2)
                                    sendm(bot, game['id'],
                                                     'üí¨–ê–ª–∞—Å—Ç–æ—Ä|‚ù§Ô∏è‚Äçüî•: –û–¥–Ω–∞–∫–æ, –≤–∞–º —É–¥–∞–ª–æ—Å—å –º–µ–Ω—è —Ä–∞–∑–≤–ª–µ—á—å! –°–¥–µ–ª–∞—é –≤–∏–¥, —á—Ç–æ –ø—Ä–æ–∏–≥—Ä–∞–ª, –∏ –æ—Å—Ç–∞–≤–ª—é –≤–∞–º –≤–æ—Ç —ç—Ç—É —à—Ç—É–∫—É.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                                     '–°–ø—É—Å—Ç—è –º–≥–Ω–æ–≤–µ–Ω—å–µ –ø–æ—Å–ª–µ —Å–≤–æ–∏—Ö —Å–ª–æ–≤ –æ–Ω –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ —Ç–µ–Ω—å –∏ —É—à–µ–ª –ø–æ–¥ –∑–µ–º–ª—é.')
                                    time.sleep(3)
                                    sendm(bot, game['id'],
                                                         '...')
                                    time.sleep(4)
                                    sendm(bot, game['id'], '–ü–æ–ª—É—á–µ–Ω–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: —â—É–ø–∞–ª—å—Ü–∞ –∞–¥–∞!',
                                                         parse_mode='markdown')


                                    del games[game['id']]
                                    return
                                return

            if not game['castlefight'] and not game['cwrats'] and not game['cwduel'] and not game['cwduelrats'] and not game['neuralfight']:
                if game['teamplay'] and game['playersamount'] > 2:
                    stats = teamstats
                if game['playersamount'] == 2:
                    stats = duelstats
                if game['playersamount'] > 2 and not game['teamplay']:
                    stats = massbattlestats
                s = stats.find_one({})
                if game['pureduel_rats']:
                    for ids in game['players']:
                        player = game['players'][ids]
                        if player['controller'] == 'bot':
                            rat = player
                        else:
                            target = player
                    ratdemons.update_one({'id':target['id']},{'$set':{'demons':rat['rat_demons']}})
                if winner != None:
                    for ids in game['players']:
                        player = game['players'][ids]
                        if game['rats']:
                            if game['playersamount'] == 2:
                                if player['controller'] == 'bot':
                                    if player['team'] == winner['team']:
                                        rats.update_one({}, {'$inc': {'wins': 1, 'games': 1}})
                                        rats.update_one({}, {'$inc': {'diff' + str(game['rat_difficulty']) + '.wins': 1,
                                                                      'diff' + str(
                                                                          game['rat_difficulty']) + '.games': 1}})
                                    else:
                                        rats.update_one({}, {'$inc': {'games': 1}})
                                        rats.update_one({},
                                                        {'$inc': {'diff' + str(game['rat_difficulty']) + '.games': 1}})
                                else:
                                    user = users.find_one({'id': player['id']})
                                    try:
                                        user['ratstats']
                                    except:
                                        users.update_one({'id': user['id']},
                                                         {'$set': {'ratstats': {'diff1': {'games': 0, 'wins': 0},
                                                                                'diff2': {'games': 0, 'wins': 0},
                                                                                'diff3': {'games': 0, 'wins': 0}}}})
                                    if player['team'] == winner['team']:
                                        users.update_one({'id': player['id']}, {
                                            '$inc': {'ratstats.diff' + str(game['rat_difficulty']) + '.wins': 1,
                                                     'ratstats.diff' + str(game['rat_difficulty']) + '.games': 1}})
                                    else:
                                        users.update_one({'id': player['id']}, {
                                            '$inc': {'ratstats.diff' + str(game['rat_difficulty']) + '.games': 1}})
                            break
                        if game['bossfight']:
                            break
                        if game['dungeon']:
                            break
                        if game['testequipgame']:
                            break
                        if game['testequipgame_tournier']:
                            break
                        if game['pureduel_rats']:
                            break
                        if game['classic_game']:
                            break
                        if player['controller'] == 'bot':
                            continue
                        if player['droppedweapon'] != None:
                            player['weapon'] = player['droppedweapon']
                        user = users.find_one({'id': player['id']})
                        if user == None:
                            users.insert_one(createuser(player))
                            user = users.find_one({'id': player['id']})
                        try:
                            user['duels']
                        except:
                            users.update_one({'id': user['id']}, {'$set': {'duels': {'games': 0, 'wins': 0}}})
                        try:
                            user['teams']
                        except:
                            users.update_one({'id': user['id']}, {'$set': {'teams': {'games': 0, 'wins': 0}}})
                        try:
                            user['massbattles']
                        except:
                            users.update_one({'id': user['id']}, {'$set': {'massbattles': {'games': 0, 'wins': 0}}})
                        try:
                            user['pureduels']
                        except:
                            users.update_one({'id': user['id']}, {'$set': {'pureduels': {'games': 0, 'wins': 0}}})
                        if player['team'] == winner['team']:
                            users.update_one({'id': user['id']}, {'$inc': {'wins': 1}})
                            if stats == duelstats:
                                users.update_one({'id': user['id']}, {'$inc': {'duels.wins': 1}})
                            if stats == teamstats:
                                users.update_one({'id': user['id']}, {'$inc': {'teams.wins': 1}})
                            if stats == massbattlestats:
                                users.update_one({'id': user['id']}, {'$inc': {'massbattles.wins': 1}})
                            if game['pureduel'] and game['playersamount'] == 2:
                                users.update_one({'id': user['id']}, {'$inc': {'pureduels.wins': 1}})
                            if game['turn'] > 3:
                                for idss in player['skills']:
                                    if idss not in s['skills']:
                                        stats.update_one({}, {'$set': {
                                            'skills.' + idss: {'name': idss, 'wins': 0, 'games': 0, 'ties': 0}}})
                                    stats.update_one({}, {
                                        '$inc': {'skills.' + idss + '.wins': 1, 'skills.' + idss + '.games': 1}})

                                if player['weapon'].name not in s['weapons']:
                                    stats.update_one({}, {'$set': {
                                        'weapons.' + player['weapon'].name: {'name': player['weapon'].name, 'wins': 0,
                                                                             'games': 0, 'ties': 0}}})
                                stats.update_one({}, {'$inc': {'weapons.' + player['weapon'].name + '.wins': 1,
                                                               'weapons.' + player['weapon'].name + '.games': 1}})

                                bamount = 0
                                curbuild = None
                                for idss in s['builds']:
                                    bamount += 1
                                    sovpadenie = False
                                    b = s['builds'][idss]
                                    if b['weapon'] == player['weapon'].name:
                                        sovpadenie = True
                                        for idsss in player['skills']:
                                            if idsss not in b['skills']:
                                                sovpadenie = False
                                    if sovpadenie:
                                        curbuild = b
                                        break
                                if curbuild != None:
                                    stats.update_one({}, {'$inc': {'builds.' + str(curbuild['id']) + '.games': 1,
                                                                   'builds.' + str(curbuild['id']) + '.wins': 1}})
                                else:
                                    stats.update_one({}, {'$set': {
                                        'builds.' + str(bamount): {'id': str(bamount), 'weapon': player['weapon'].name,
                                                                   'skills': player['skills'], 'games': 1, 'wins': 1,
                                                                   'ties': 0}}})
                        else:
                            if game['turn'] > 3:
                                for idss in player['skills']:
                                    if idss not in s['skills']:
                                        stats.update_one({}, {'$set': {
                                            'skills.' + idss: {'name': idss, 'wins': 0, 'games': 0, 'ties': 0}}})
                                    stats.update_one({}, {'$inc': {'skills.' + idss + '.games': 1}})
                                if player['weapon'].name not in s['weapons']:
                                    stats.update_one({}, {'$set': {
                                        'weapons.' + player['weapon'].name: {'name': player['weapon'].name, 'wins': 0,
                                                                             'games': 0, 'ties': 0}}})
                                stats.update_one({}, {'$inc': {'weapons.' + player['weapon'].name + '.games': 1}}) 
                                bamount = 0
                                curbuild = None
                                for idss in s['builds']:
                                    bamount += 1
                                    sovpadenie = False
                                    b = s['builds'][idss]
                                    if b['weapon'] == player['weapon'].name:
                                        sovpadenie = True
                                        for idsss in player['skills']:
                                            if idsss not in b['skills']:
                                                sovpadenie = False
                                    if sovpadenie:
                                        curbuild = b
                                        break
                                if curbuild != None:
                                    stats.update_one({}, {'$inc': {'builds.' + str(curbuild['id']) + '.games': 1}})
                                else:
                                    stats.update_one({}, {'$set': {
                                        'builds.' + str(bamount): {'id': str(bamount), 'weapon': player['weapon'].name,
                                                                   'skills': player['skills'], 'games': 1, 'wins': 0,
                                                                   'ties': 0}}})
                        users.update_one({'id': user['id']}, {'$inc': {'games': 1}})
                        if game['pureduel'] and game['playersamount'] == 2:
                            users.update_one({'id': user['id']}, {'$inc': {'pureduels.games': 1}})
                        if stats == duelstats:
                            users.update_one({'id': user['id']}, {'$inc': {'duels.games': 1}})
                        if stats == teamstats:
                            users.update_one({'id': user['id']}, {'$inc': {'teams.games': 1}})
                        if stats == massbattlestats:
                            users.update_one({'id': user['id']}, {'$inc': {'massbattles.games': 1}})

                else:
                    for ids in game['players']:
                        player = game['players'][ids]
                        if game['rats']:
                            if game['playersamount'] == 2:
                                if player['controller'] == 'bot':
                                    rats.update_one({}, {'$inc': {'games': 1}})
                            break
                        if game['bossfight']:
                            break
                        if game['dungeon']:
                            break
                        if game['testequipgame']:
                            break
                        if game['testequipgame_tournier']:
                            break
                        if player['controller'] == 'bot':
                            continue
                        if player['droppedweapon'] != None:
                            player['weapon'] = player['droppedweapon']
                        user = users.find_one({'id': player['id']})
                        if user == None:
                            users.insert_one(createuser(player))
                            user = users.find_one({'id': player['id']})
                        try:
                            user['ties']
                        except:
                            users.update_one({'id': user['id']}, {
                                '$set': {'ties': 0, 'duels.ties': 0, 'teams.ties': 0, 'massbattles.ties': 0}})
                        users.update_one({'id': user['id']}, {'$inc': {'games': 1, 'ties': 1}})
                        if stats == duelstats:
                            users.update_one({'id': user['id']}, {'$inc': {'duels.games': 1, 'duels.ties': 1}})
                        if stats == teamstats:
                            users.update_one({'id': user['id']}, {'$inc': {'teams.games': 1, 'teams.ties': 1}})
                        if stats == massbattlestats:
                            users.update_one({'id': user['id']},
                                             {'$inc': {'massbattles.games': 1, 'massbattles.ties': 1}})
                        if game['turn'] > 3: 
                            for idss in player['skills']:
                                if idss not in s['skills']:
                                    stats.update_one({}, {
                                        '$set': {'skills.' + idss: {'name': idss, 'wins': 0, 'games': 0, 'ties': 0}}})
                                stats.update_one({}, {
                                    '$inc': {'skills.' + idss + '.games': 1, 'skills.' + idss + '.ties': 1}})
                            if player['weapon'].name not in s['weapons']:
                                stats.update_one({}, {'$set': {
                                    'weapons.' + player['weapon'].name: {'name': player['weapon'].name, 'wins': 0,
                                                                         'games': 0, 'ties': 0}}})
                            stats.update_one({}, {'$inc': {'weapons.' + player['weapon'].name + '.games': 1,
                                                           'weapons.' + player['weapon'].name + '.ties': 1}})

                            bamount = 0
                            curbuild = None
                            for idss in s['builds']:
                                bamount += 1
                                sovpadenie = False
                                b = s['builds'][idss]
                                if b['weapon'] == player['weapon'].name:
                                    sovpadenie = True
                                    for idsss in player['skills']:
                                        if idsss not in b['skills']:
                                            sovpadenie = False
                                if sovpadenie:
                                    curbuild = b
                                    break
                            if curbuild != None:
                                stats.update_one({},
                                                 {'$inc': {'builds.' + str(curbuild['id']) + '.games': 1, 'ties': 1}})
                            else:
                                stats.update_one({}, {'$set': {
                                    'builds.' + str(bamount): {'id': str(bamount), 'weapon': player['weapon'].name,
                                                               'skills': player['skills'], 'games': 1, 'wins': 0,
                                                               'ties': 0}}})
            try:
                # try:
                # game['timer'].cancel()
                # idstoremove = []
                # for ids in game['alltimers']:
                #    try:
                #        ids.cancel()
                # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                #        idstoremove.append(ids)
                #    except:
                #        pass
                # for ids in idstoremove:
                #    game['alltimers'].remove(ids)
                # except:
                #    pass
                try:
                    if game['title'] == 'None':
                        game['title'] = game['players'][game['id']]['name']
                    if not game['castlefight'] and not game['neuralfight']:
                        sendm(bot, pasyuk_id, '–ò–≥—Ä–∞ –≤ —á–∞—Ç–µ ' + str(game['title']) + ' –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!')
                except:
                    pass
                if not game['castlefight'] and not game['neuralfight']:
                    if game['cwrats'] or game['cwduel'] or game['cwduelrats']:
                        del cwgames[game['id']]
                    else:
                        del games[game['id']]
                if game['neuralfight']:
                    #print("next cycle soon")
                    global demon_amount
                    if game['cycle'] <= game['maxcycle']:
                        m = game['m']
                        game2 = creategame(m)
                        #print(game2)
                        for idssss in game2:
                            x = idssss
                            break
                        game2 = game2[x]
                        game2['fullneuraldemon2'] = game['fullneuraldemon2'] + 1
                        game2['fullneuraldemon1'] = game['fullneuraldemon1']
                        game2['cycle'] = game['cycle']
                        game2['maxcycle'] = game['maxcycle']
                        if game2['fullneuraldemon2'] >= demon_amount-1:
                            game2['fullneuraldemon1'] = game['fullneuraldemon1']+1
                            game2['fullneuraldemon2'] = game2['fullneuraldemon1']+1
                            if game2['fullneuraldemon1'] >= demon_amount-1:
                                game2['cycle'] = game['cycle']+1
                                game2['fullneuraldemon1'] = 0
                                game2['fullneuraldemon2'] = 1
                                sendm(bot, 441399484, "–ó–∞–≤–µ—Ä—à–µ–Ω "+str(game['cycle'])+" —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ–º–æ–Ω–æ–≤ —Å–æ –≤—Å–µ–º–∏.")
                        game2['neuralfight'] = True
                        game2['pureduel_rats'] = True
                        game2['pureduel'] = True
                        game2['demons'] = game['demons']
                        game2['m'] = game['m']
                        #print("neurodemon1 = ", game2['fullneuraldemon1'])
                        del games[game['id']]
                        games.update({m.chat.id:game2})
                        #print(games)
                        #bot.send_message(m.chat.id, '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ–∫—Ä—ã—Å.')
                        game = games[m.chat.id]
                        #print("16322: ",game['fullneuraldemon1'])
                        threading.Thread(target = goo, args = [m, m.chat.id, game]).start()
                        return
                    else:
                        best_demons = []
                        maxscore = -10000
                        for ids in game['demons']:
                            demon = game['demons'][ids]
                            if demon['score'] >= maxscore:
                                maxscore = demon['score']
                        for ids in game['demons']:
                            demon = game['demons'][ids]
                            if demon['score'] >= maxscore:
                                best_demons.append(demon)
                        best_demon_selected = random.choice(best_demons)
                        mutation_rate = 30
                        new_demons = {}
                        for i in range(demon_amount):
                            if i == 0:
                                new_demon = best_demon_selected
                                new_demon['score'] = 0
                                new_demon['number'] = i
                            else:
                                new_demon = {'pattern':{}, 'score':0, 'number':i}
                                for ids in best_demon_selected['pattern']:
                                    new_pattern = {ids:best_demon_selected['pattern'][ids]}
                                    if random.randint(1, 100) <= mutation_rate:
                                        new_acts = ['attack', 'adrenaline', 'reload', 'perekat', 'vor', 'shield', 'flash']
                                        new_acts.remove(new_pattern[ids])
                                        new_demon['pattern'][ids] = random.choice(new_acts)
                                    else:
                                        new_demon['pattern'][ids] = best_demon_selected['pattern'][ids]
                            new_demons.update({i:new_demon})

                        i = 1
                        while Path('demons_'+str(demon_amount)+'_generation_'+str(i)+'.pickle').is_file():
                            i += 1
                        with open('demons_'+str(demon_amount)+'_generation_'+str(i)+'.pickle', 'wb') as f:
                            pickle.dump(new_demons, f)

                        sendm(bot, 441399484, "–ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –∫—Ä—ã—Å –∑–∞–≤–µ—Ä—à–µ–Ω. –ü–æ–∫–æ–ª–µ–Ω–∏–µ " + str(i) + " –≥–æ—Ç–æ–≤–æ. –ù–∞–∏–≤—ã—Å—à–∏–π –±–∞–ª–ª: "+str(maxscore))
                        m = game['m']
                        del games[game['id']]
                        infinity_teaching(m)
                        return
            except:
                print(traceback.format_exc())
    except:
        try:
            sendm(bot, pasyuk_id, traceback.format_exc())
        except:
            print(traceback.format_exc())
        try:
            sendm(bot, game['id'], '–û—à–∏–±–∫–∞! –°–±—Ä–∞—Å—ã–≤–∞—é –∏–≥—Ä—É.')
        except:
            pass
        # try:
        # game['timer'].cancel()
        # idstoremove = []
        # for ids in game['alltimers']:
        #    try:
        #        ids.cancel()
        # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
        #        idstoremove.append(ids)
        #    except:
        #        pass
        # for ids in idstoremove:
        #    game['alltimers'].remove(ids)
        # except:
        #    pass
        try:
            del games[game['id']]
        except:
            try:
                del cwgames[game['id']]
            except:
                pass


def regen_energy(game, player, amount):
    for ids in player['recoverydebuff']:
        amount -= ids[0]
    if amount < 0:
        amount = 0
    if game['freeze_energy'] <= 0:
        player['energy'] += amount
    return amount


def set_energy(game, player, amount):
    regen = amount - player['energy']
    for ids in player['recoverydebuff']:
        regen -= ids[0]
    if regen < 0:
        regen = 0
    if game['freeze_energy'] <= 0:
        player['energy'] += regen
    return player['energy']


def createbotfightgame(chat=botfights):
    while True:
        try:
            if not allowgames:
                sendm(bot, chat, '–ü—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –∏–≥—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!')
            else:
                if chat not in games:
                    game = creategame(chatid=chat)
                    games.update(game)
                    game = games[chat]
                    game['botfight'] = True
                    t = threading.Timer(300, cancelgame, args=[game['id']])
                    t.start()
                    game['canceltimer'] = t
                    sendm(bot, chat, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±–∏—Ç–≤–µ –±–æ—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–∞! /v_join –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.')
        except:
            pass
        time.sleep(300)


def createuser(player):
    return {
        'id': player['id'],
        'name': player['name'],
        'games': 0,
        'wins': 0

    }


def createuser2(user):
    return {
        'id': user.id,
        'name': user.first_name,
        'games': 0,
        'wins': 0

    }


def getdarknesscode(y=2):
    x = ''
    while len(x) < y:
        x += str(random.randint(0, 1))
    return x


def creategame(m=None, diff=1, dungtype='rhino', chatid=None, castlefight=False, cwrats=False, cwduel=False,
               cwduelrats=False):
    if m != None:
        chid = m.chat.id
        ttle = str(m.chat.title)
        creator = m.from_user.id
    else:
        chid = chatid
        ttle = str(None)
        creator = pasyuk_id
    x = {chid: {
        'id': chid,
        'title': str(ttle),
        'players': {},
        'msg': None,
        'turn': 1,
        'text': '–•–æ–¥ 1:\n',
        'started': False,
        'timer': None,
        'effecttext': '',
        'stage': None,
        'providets': False,
        'test': False,
        'teamplay': False,
        'canceltimer': None,
        'rats': False,
        'flashed': [],
        'hypnotists': [],
        'playersamount': 0,
        'creator': creator,
        'bossfight': False,
        'dungeon': False,
        'dungeonlvl': 1,
        'gl': False,
        'g': False,
        'freeze_energy': 0,
        'light_strikes': [],
        'alreadyaddedrats': False,
        'spectators': [],
        'rat_difficulty': diff,
        'dungeon_type': dungtype,
        'dead_skeletons': 0,
        'tournier': False,
        'allrandom': False,
        'pureduel': False,
        'testequipgame': False,
        'magictournier': False,
        'rp_fight': False,
        'code1': getdarknesscode(),
        'code2': getdarknesscode(),
        'botfight': False,
        'dark_said': False,
        'can_hide_dark': False,
        'castlefight': castlefight,
        'cwrats': cwrats,
        'alltimers': [],
        'cwduel': cwduel,
        'cwduelrats': cwduelrats,
        'was_1_turn': False,
        'turntimer': time.time(),
        'cwbar': False,
        'waitbarplayers': [],
        'waitbarleave': [],
        'classic_game':False,
        'pureduel_rats':False,
        'm':None,
        'maxcycle':100,
        'cycle':1,
        'fullneuraldemon1':0,
        'fullneuraldemon2': 1,
        'failed_neural':False,
        'neuralfight':False,
        'pureduel_rats_hard':False,
        'pokemonhunt':False,
        'pokemon_daytime':'day',
        'necromant_reborn_buff':0,
        'summon_castlefight_skeles':[],
        'darkcastle_demon':0,
        'summoned_castlefight_skeletons':0,
        'summon_imps':[],
        'summon_magmaworms':[],
        'customtextlist':[],
        'testequipgame_tournier':False,
        'summon_wars':False,
        'rhino_say':False,
        'rhinotext1':False,
        'completed_hell':False,
        'simulate_first_run':False,
        'dm':False,
        'sum_dm_deaths':8,
        'dop_skills':0,
        'new_limit':False,
        "knight_need_dark_energy": False,
        "alreadyaddedknights":False

    }
    }

    return x


threading.Thread(target=createbotfightgame, args=[]).start()


def getturnelements():
    elems = ['fire', 'water', 'ice', 'light', 'electro', 'air', 'life', 'random', 'virus', 'blood', 'death', 'mech',
             'nature']
    returnelems = []
    while len(returnelems) < 9:
        e = random.choice(elems)
        while e in returnelems:
            e = random.choice(elems)
        returnelems.append(e)
    return returnelems


def createplayer(user=None, uid=None, weapon=None, hp=None, name=None, dead=None, photo=None, iamillusion=False, completed_hell=False):
    ctexts = {}
    if user != None:
        userid = user.id
        user_name = user.first_name
        try:
            ctexts = users.find_one({'id': user.id})['customtexts']
        except:
            pass
    else:
        userid = 0
        user_name = 'None'
    if uid != None:
        userid = uid

    x = {userid: {
        'id': userid,
        'name': user_name,
        'photo': photo,
        'hp': 4,
        'maxhp': 4,
        'energy': 5,
        'maxenergy': 5,
        'skills': [],
        'weapon': None,
        'act': None,
        'ready': False,
        'team': None,
        'stage': None,
        'dead': False,
        'incomingdmg': 0,
        'outgoingdmg': 0,
        'nearplayers': [userid],
        'perekatcd': 0,
        'shieldgencd': 0,
        'shield': False,
        'dmglimit': 6,
        'maxdmglimit': 6,
        'zombie': False,
        'inventory': [],
        'blood': 0,
        'stun': 0,
        'hypnotistcd': 0,
        'adrenaline': False,
        'fireticks': 0,
        'firestrength': 0,
        'suicide': False,
        'who_fired': None,
        'outgoingdmgs': [],
        'incomingdmgs': [],
        'maintarget': None,
        'peregrev': 0,
        'addperegrev': 0,
        'afkcount': 0,
        'visorcd': 0,
        'providets': False,
        'seetext': '–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ (–ê–§–ö)!',
        'lasttarget': None,
        'bulavabonus': 0,
        'droppedweapon': None,
        'dzet': False,
        'dzets': {},
        'hitins': {},
        'dopuseditems': [],
        'lostenergy': 0,
        'sokrushenie': False,
        'sokrusheniecd': 0,
        'waszero': False,
        'chain': False,
        'chaincd': 0,
        'lostweapon': False,
        'narsil': False,
        'narsilcd': 0,
        'pyrodamage': False,
        'who_steal': [],
        'vor': False,
        'vorcd': 0,
        'spearcd': 0,
        'who_attacked': [],
        'ritualistamount': 1,
        'ritualists': [],
        'ritual_ability': False,
        'navodcd': 0,
        'secondweapon': weaponlist.Fist(),
        'changeweaponcd': 0,
        'bowcharge': 0,
        'lastcharge': False,
        'necrozombie': 0,
        'getfood': False,
        'msg': None,
        'blown': False,
        'incvizitorcd': 0,
        'curses': [],
        'execution': False,
        'parrycd': 0,
        'madpotion': False,
        'grenade': 'grenade',
        'molitva': False,
        'firearrow': False,
        'firearrowcd': 0,
        'washitin': False,
        'dopblock': 0,
        'who_fireds': [],
        'saberblock': None,
        'illusion': False,
        'illusioncd': 0,
        'illusionturns': 0,
        'createillusion': False,
        'demon': False,
        'demonheal': 0,
        'demonform': False,
        'demoncd': 0,
        'claws': False,
        'clawscd': 0,
        'controller': 'player',
        'cuts': 0,
        'addcuts': 0,
        'bombcharge': 0,
        'electrolostenergy': 0,
        'watershield': 0,
        'watershieldcd': 0,
        'shurikens': 4,
        'shurikenstothrow': 1,
        'meditation': None,
        'meditationtarget': None,
        'meditationcd': 0,
        'domeditation': False,
        'bicepccd': 0,
        'bicepc': False,
        'baseballhits': 0,
        'sawhits': 1,
        'knifehits': 1,
        'flamehits': 0,
        'axehits': 1,
        'lastact': ['skip', 'self'],
        'skeletonfirecd': 0,
        'batcd': 0,
        'bat': False,
        'waitbats': [],
        'vampirebites': 0,
        'iamillusion': iamillusion,
        'boss': False,
        'demonlordform': False,
        'hellfirecharges': 0,
        'energydraincd': 0,
        'batsdamages': [],
        'selfarmor': 0,
        'selfarmorchance': 0,
        'charge': False,
        'chargecd': 0,
        'madness': False,
        'chereparmor': 0,
        'shieldarmor': 8,
        'weaponshield': False,
        'attackedthisturn': False,
        'customtexts': ctexts,
        'truestrike': False,
        'molotcd': 0,
        'multicast': 1,
        'multicastcd': 0,
        'lasthit': 0,
        'getlasthit': False,
        'turnelements': getturnelements(),
        'selectedelements': [],
        'invokercd': 0,
        'summon_treant': 0,
        'roots': [],
        'recoverydebuff': [],
        'infected': False,
        'infected_weapon': [],
        'summon_virus': 0,
        'virus_attacks': 0,
        'iceheart': 0,
        'fell': False,
        'shestcd': 0,
        'hitdown': False,
        'light_aspect': 0,
        'dopriest': None,
        'priestcd': 0,
        'getbuffs3': [],
        'getbuffs2': [],
        'weakskeletype': 'normal',
        'summon_mad_skeletons': 0,
        'summon_weak_skeletons': 0,
        'summon_weak_ghouls': 0,
        'summon_zombie_rats': 0,
        'summoned_mad_skeletons': False,
        'summoned_weak_skeletons': False,
        'summoned_weak_ghouls': False,
        'summoned_zombie_rats': False,
        'madskele_attack': 0,
        'already_wait': False,
        'magic_strong_shield': False,
        'can_regen_hp_by_reload': 0,
        'necrostaffabilitycd': 0,
        'summon_necrofighter': None,
        'master': None,
        'controllable_necrofighter': None,
        'can_summon_zombie': True,
        'machinegun_charges': 0,
        'alreadysaved': False,
        'drobovik_charges': 1,
        'bombercd': 0,
        'minetimer': 0,
        'EXPLOSIONcd': 0,
        'EXPLOSION': None,
        'inzhenercd': 0,
        'inzheneritems': [],
        'madpotioncd': 9,
        'wasarmor_from_armorskill': False,
        'wasarmor_from_selfarmor': False,
        'wasarmor_from_cherep': False,
        'rp_fighter': False,
        'rp_weapon': 'None',
        'user': None,
        'dark_counter': 0,
        'cant_die': True,
        'dark_gun_charges': 0,
        'dark_dog_attacks': 0,
        'amalgama_must_mutate': False,
        'tesak_bonus': 3,
        'maxnecrozombie': 3,
        'pressed_info': False,
        'darkness_sleep': False,
        'darkness_uvorot': 0,
        'dark_true_form': False,
        'last_dark_acts': [],
        'prepared_beam': None,
        'dark_die_stage': 0,
        'darknessspelldmgbonus': 0,
        'hide_in_door': False,
        'dark_energycd': 0,
        'dark_counter_set': 0,
        'deadturns': 0,
        'dead_from_scare': False,
        'frozen_buttons': [],
        'minercd': 0,
        'allies': [],
        'take_enemy_hp': 0,
        'do_damage_in_hp': 0,
        'bloodresist': 0,
        'nextturndamage': 0,
        'is_dark_boss': False,
        'is_dark_rat': False,
        'is_amalgama': False,
        'is_necromant': False,
        'is_rhino': False,
        'is_vurdalak': False,
        'is_mad_skele': False,
        'passivevor': False,
        'strongshot': False,
        'obrezcd': 0,
        'loosedamage': 0,
        'grenadedmgbonus': 0,
        'doublemadpotion': False,
        'punchdead': False,
        'wasarmor_from_hitin':False,
        'hypnodebuff':0,
        'weights':{'flash':20, 'attack':20, 'adrenaline':20, 'perekat':20, 'reload':20, 'vor':20},
        'rat_demons':{},
        'target_potential_acts':[],
        'choicen_demon':None,
        'fullneuraldemon_final':None,
        'castle_explosion':False,
        'used_rat_toy':False,
        'have_rat_toy':False,
        'full_npc':False,
        'summon_dark_demon':False,
        'darkdemon_strenght':0,
        'darkcastle_demon':False,
        'demonshieldcd':0,
        'demondestroycd':0,
        'demonshield':False,
        'was_castlenecromant_skele':False,
        'dead_from_dark':False,
        'doomed_amount':0,
        'is_imp':False,
        'is_magmaworm':False,
        'is_lucifer':False,
        'burrowcd':0,
        'burrowtarget':None,
        'burrowstrike':False,
        'luciferpower':0,
        'luciferbladecd':0,
        'used_doom':False,
        'bigdooms':[],
        'doomedskills':[],
        'lucifer_hellfire':0,
        'lucifer_hellfirecd':3,
        'rest_after_doom':0,
        'passivecounterattackcd':0,
        'policestun':False,
        'kills':0,
        'first_hit':False,
        'set_first_hit':False,
        'collecting_souls':False,
        'doomcd':0,
        'is_catapult':False,
        'doomedinventory':[],
        'need_to_doom':False,
        'is_snowman':False,
        'is_eyedemon':False,
        'is_radiodemon':False,
        'demon_transform_turn':False,
        'eliminated':False,
        'tentacles_turn':False,
        'tentacles_target':None,
        'energy_blowcd':0,
        'tentaclescd':0,
        'demon_transformcd':0,
        'rhino_eliminatecd':0,
        'mind_controlcd': 0,
        'attack_self':False,
        'lastattacktarget':None,
        'angry_rhino_target':None,
        'summon_angry_rhino':False,
        'completed_hell':completed_hell,
        'dm_deaths':0,
        "count_as_dm":False,
        "wing_attackcd":0,
        "dragon_fireballcd":0,
        "is_knight":False,
        "is_dragon":False,
        "knight_rifle_talk":False,
        "armor_debuff":{},
        "armor_debuff_set":{}
                

    }
    }

    if weapon != None:
        x[userid]['weapon'] = weapon
    if hp != None:
        x[userid]['hp'] = hp
    if name != None:
        x[userid]['name'] = name
    if dead != None:
        x[userid]['dead'] = dead
    return x


@bot.inline_handler(func = lambda query: True)
def inliness(query):
  try:
    game = None
    for ids in games:
        if query.from_user.id in games[ids]['players']:
            game = games[ids]
            player = games[ids]['players'][query.from_user.id]
            break
    if game == None:
        return

    text = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–µ'

    q = []

    q.append(types.InlineQueryResultArticle('1', '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–µ', description = query.query,
                                            input_message_content=types.InputTextMessageContent(message_text=player['name']+' —á—Ç–æ-—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç.')))
    bot.answer_inline_query(query.id, q, cache_time = 0)
  except:
    sendm(bot, 441399484, traceback.format_exc())

@bot.chosen_inline_handler(func=lambda result: True)
def test_chosen(result):
  try:
    game = None
    for ids in games:
        if result.from_user.id in games[ids]['players']:
            game = games[ids]
            player = games[ids]['players'][result.from_user.id]
            break
    if game == None:
        return
    chosen = int(result.result_id)
    text = result.query
    if result.query == '':
        return
    for ids in game['players']:
        target = game['players'][ids]
        if target['team'] == player['team']:
            try:
                sendm(bot, target['id'], '‚ùóÔ∏è|'+player['name']+': '+text)
            except:
                pass


  except:
    sendm(bot, 441399484, traceback.format_exc())

def checkdarkness(game, player):
    try:
        if player['dark_counter'] > 1:
            if not player['ready'] and player['msg'] != None:
                chance = 30
                if player['dark_counter'] == 2:
                    chance = 30
                if player['dark_counter'] == 3:
                    chance = 40
                if player['dark_counter'] == 4:
                    chance = 50
                if random.randint(1, 100) <= chance:
                    old_kb = getfightkb(game, player)
                    new_kb = getdarkkb(game, player)
                    medit('üëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅüëÅ', player['msg'].chat.id, player['msg'].message_id, reply_markup=new_kb)
                    time.sleep(random.randint(2, 3))
                    text = getplayertext(game, player)
                    if not player['ready'] and player['msg'] != None:
                        medit(text, player['msg'].chat.id, player['msg'].message_id, reply_markup=old_kb)
    except:
        print(traceback.format_exc())


def checks():
    while True:
        try:
            for ids in games:
                game = games[ids]
                if game['neuralfight']:
                    continue
                if game['started']:
                    if game['stage'] == 'turn':
                        ready = 0
                        for ids in game['players']:
                            player = game['players'][ids]
                            threading.Thread(target=checkdarkness, args=[game, player]).start()
                            if player['ready']:
                                ready += 1
                        if len(game['players']) == ready or time.time() - game['turntimer'] >= 120:
                            # try:
                            #    game['timer'].cancel()
                            # except:
                            #    pass
                            # idstoremove = []
                            # for ids in game['alltimers']:
                            #    try:
                            #        ids.cancel()
                            # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                            #        idstoremove.append(ids)
                            #    except:
                            #        pass
                            # for ids in idstoremove:
                            #    game['alltimers'].remove(ids)
                            threading.Thread(target=end_turn, args=[game, bot]).start()
                    if game['stage'] == 'weapons':
                        ready = 0
                        for ids in game['players']:
                            player = game['players'][ids]
                            if player['ready']:
                                ready += 1
                        if len(game['players']) == ready or time.time() - game['turntimer'] >= 120:
                            # game['timer'].cancel()
                            # idstoremove = []
                            # for ids in game['alltimers']:
                            #    try:
                            #        ids.cancel()
                            # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                            #        idstoremove.append(ids)
                            #    except:
                            #        pass
                            # for ids in idstoremove:
                            #    game['alltimers'].remove(ids)
                            threading.Thread(target=select_skills, args=[game]).start()
                    if game['stage'] == 'skills':
                        ready = 0
                        for ids in game['players']:
                            player = game['players'][ids]
                            if player['ready']:
                                ready += 1
                        if len(game['players']) == ready or time.time() - game['turntimer'] >= 120:
                            # game['timer'].cancel()
                            # idstoremove = []
                            # for ids in game['alltimers']:
                            #    try:
                            #        ids.cancel()
                            # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                            #        idstoremove.append(ids)
                            #    except:
                            #        pass
                            # for ids in idstoremove:
                            #    game['alltimers'].remove(ids)
                            threading.Thread(target=next_turn, args=[game]).start()
        except:
            sendm(bot, pasyuk_id, traceback.format_exc())
        time.sleep(5)


####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
threading.Thread(target=checks, args=[]).start()


####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################


def checks_cw():
    while True:
        try:
            for ids in cwgames:
                game = cwgames[ids]
                if game['started']:
                    if game['stage'] == 'turn':
                        ready = 0
                        for ids in game['players']:
                            player = game['players'][ids]
                            # threading.Thread(target = checkdarkness, args = [game, player]).start()
                            if player['ready']:
                                ready += 1
                        if len(game['players']) == ready or time.time() - game['turntimer'] >= 120:
                            # try:
                            #    game['timer'].cancel()
                            # except:
                            #    pass
                            # idstoremove = []
                            # for ids in game['alltimers']:
                            #    try:
                            #        ids.cancel()
                            # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                            #        idstoremove.append(ids)
                            #    except:
                            #        pass
                            # for ids in idstoremove:
                            #    game['alltimers'].remove(ids)
                            if game['stage'] == 'turn':
                                if game['cwrats'] or game['cwduel'] or game['cwduelrats']:
                                    threading.Thread(target=end_turn, args=[game, cwbot]).start()
                                else:
                                    threading.Thread(target=end_turn, args=[game, cwbot]).start()
                    if game['stage'] == 'weapons':
                        ready = 0
                        for ids in game['players']:
                            player = game['players'][ids]
                            if player['ready']:
                                ready += 1
                        if len(game['players']) == ready or time.time() - game['turntimer'] >= 120:
                            # game['timer'].cancel()
                            # idstoremove = []
                            # for ids in game['alltimers']:
                            #    try:
                            #        ids.cancel()
                            #        #sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                            #        idstoremove.append(ids)
                            #    except:
                            #        pass
                            # for ids in idstoremove:
                            #    game['alltimers'].remove(ids)
                            if game['cwrats'] or game['cwduel'] or game['cwduelrats']:
                                threading.Thread(target=select_skills, args=[game, cwbot]).start()
                            else:
                                threading.Thread(target=select_skills, args=[game, cwbot]).start()
                    if game['stage'] == 'skills':
                        ready = 0
                        for ids in game['players']:
                            player = game['players'][ids]
                            if player['ready']:
                                ready += 1
                        if len(game['players']) == ready or time.time() - game['turntimer'] >= 120:
                            # game['timer'].cancel()
                            # idstoremove = []
                            # for ids in game['alltimers']:
                            #    try:
                            #        ids.cancel()
                            # sendm(cwbot, pasyuk_id, '–û—Ç–∫–ª—é—á–µ–Ω –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä!')
                            #        idstoremove.append(ids)
                            #    except:
                            #        pass
                            # for ids in idstoremove:
                            #    game['alltimers'].remove(ids)
                            if game['cwrats'] or game['cwduel'] or game['cwduelrats']:
                                threading.Thread(target=next_turn, args=[game, cwbot]).start()
                            else:
                                threading.Thread(target=next_turn, args=[game, cwbot]).start()
        except:
            sendm(cwbot, pasyuk_id, traceback.format_exc())
        time.sleep(5)


def checks_bar():
    while True:
        try:
            for ids in bargames:
                game = bargames[ids]
                if game['started']:
                    if game['stage'] == 'turn':
                        if time.time() - game['turntimer'] >= 30:
                            threading.Thread(target=end_turn, args=[game, cwbot]).start()
                    if game['stage'] == 'weapons':
                        if time.time() - game['turntimer'] >= 10:
                            threading.Thread(target=select_skills, args=[game, cwbot]).start()
                    if game['stage'] == 'skills':
                        if time.time() - game['turntimer'] >= 10:
                            threading.Thread(target=next_turn, args=[game, cwbot]).start()

        except:
            sendm(cwbot, pasyuk_id, traceback.format_exc())
        time.sleep(5)


threading.Thread(target=checks_bar, args=[]).start()


def medit(message_text, chat_id, message_id, reply_markup=None, parse_mode=None, bot=bot):
    return bot.edit_message_text(chat_id=chat_id, message_id=message_id, text=message_text,
                                 reply_markup=reply_markup, parse_mode=parse_mode)


def poll(b):
    b.infinity_polling()


print('7777')


def polll(b):
    try:
        b.infinity_polling()
    except:
        try:
            b.send_message(pasyuk_id, traceback.format_exc())
        except:
            pass


# import mmmderevnya
# import getip
# import weather
# try:
#    import counter
# except:
#    print(traceback.format_exc())

# threading.Thread(target = polll, args = [ukrus.bot]).start()
# threading.Thread(target = polll, args = [mmmderevnya.bot]).start()
# threading.Thread(target = polll, args = [mmmderevnya.bot101]).start()
# threading.Thread(target = polll, args = [getip.bot]).start()
# threading.Thread(target = polll, args = [weather.bot]).start()
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################

####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
# try:
#    threading.Thread(target = polll, args = [counter.bot]).start()
# except:
#    print(traceback.format_exc())

# try:
#   import cw_map_draw
#    threading.Thread(target = polll, args = [cw_map_draw.bot]).start()
# except:
#    sendm(cwbot, pasyuk_id, traceback.format_exc())

####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
try:
    threading.Thread(target=polll, args=[bot]).start()
except:
    print(traceback.format_exc())
    try:
        sendm(bot, pasyuk_id, traceback.format_exc())
    except:
        pass

def start_addition_bots():
    threading.Thread(target=checks_cw, args=[]).start()
    threading.Thread(target=polll, args=[cwbot]).start()
    threading.Thread(target=polll, args=[shennon.bot]).start()
    import buckshot
    threading.Thread(target=polll, args=[buckshot.bot]).start()
    import random_events_alice
    import popusk
    threading.Thread(target=polll, args=[random_events_alice.bot]).start()
    threading.Thread(target=polll, args=[popusk.bot]).start()
    import debilikambodja
    threading.Thread(target=polll, args=[debilikambodja.bot]).start()

    from parser.battle_log_reader import start_parser
    start_parser()

start_addition_bots()

####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
####################################### –†–ê–°–ö–û–ú–ú–ò–¢–ò–¢–¨ ##################################################################
#dfbottoken = '736069523:AAEGFANhfsJfnStaoL3d8NhSrCPHL3LikV0'
#dfbot = telebot.TeleBot(dfbottoken)
#try:

#    import dickfindbot
#except:
#    dfbot.send_message(pasyuk_id, traceback.format_exc())
#import rampartguild

#threading.Thread(target=rampartguild.bot.infinity_polling, args=[]).start()
#rampartguild.bot.send_message(pasyuk_id, '–ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!')
#rampartguild.userbot.run()


# import pyrogram.types
# from pyrogram import Client
# from pyrogram.types import ChatPermissions
# from datetime import datetime, timedelta

# api_id = 712117
# api_hash = '318eb14ccff924fc1f5f265e465fd140'

# ubot = Client("my_p_account", api_id=api_id, api_hash=api_hash)

# bannedrchats = [-567287661]


# bannedusers = [257452723]


# @ubot.on_message()
# def alltext(ubot, m):
#    try:
#        if m.from_user.id in bannedusers and m.chat.id in bannedrchats:
#            try:
#                ubot.delete_messages(m.chat.id, m.id, revoke=False)
#                print('Deleted')
#            except:
#                pass
# print(traceback.format_exc())
# if m.from_user.id == pasyuk_id:
#    print(m.chat.id)

#    except:
#        pass
# print(traceback.format_exc())

# import funnikbot
# from multiprocessing import Process
# def runuserbot(ub):
#    threading.Timer(2, funnikbot.geteventlog, args=[-1001260934969]).start()
#    ub.run()
# try:
#    proc1 = Process(target=runuserbot, args=[funnikbot.ubot2])
#    proc1.start()
# except:
#    print(traceback.format_exc())

# ubot.run()

